!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("@jupyter-widgets/base"));else if("function"==typeof define&&define.amd)define(["@jupyter-widgets/base"],e);else{var n="object"==typeof exports?e(require("@jupyter-widgets/base")):e(t["@jupyter-widgets/base"]);for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=241)}([function(t,e,n){"use strict";const i=new(n(264).a)({id:"luma.gl"});var r=n(24),o=(n(201),n(80)),a=n(67),s=n(15),u=n(30);function c(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function l(t,e,n=!0){return function(t,e,n,i,r){const o=h(t[0],e,n);let a=p(t[1],e,i,r),s=h(t[0]+1,e,n);const u=s===n-1?s:s-1;let c;s=p(t[1]+1,e,i,r),r?(s=0===s?s:s+1,c=a,a=s):c=s===i-1?s:s-1;return{x:o,y:a,width:Math.max(u-o+1,1),height:Math.max(c-a+1,1)}}(e,c(t),t.drawingBufferWidth,t.drawingBufferHeight,n)}function h(t,e,n){return Math.min(Math.round(t*e),n-1)}function p(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const f=Object(s.isBrowser)(),d=f&&"undefined"!=typeof document,A={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function g(t={}){Object(u.a)(f,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),t=Object.assign({},A,t);const{width:e,height:n}=t;function o(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}let a;t.onError=o;const{canvas:s}=t;return a=function(t,e){const{onError:n}=e;let i=null;const r=t=>i=t.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let s=null;a&&(s=s||t.getContext("webgl2",e),s=s||t.getContext("experimental-webgl2",e));o&&(s=s||t.getContext("webgl",e),s=s||t.getContext("experimental-webgl",e));if(t.removeEventListener("webglcontextcreationerror",r,!1),!s)return n("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"));e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1);e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1);return s}(function({canvas:t,width:e=800,height:n=600,onError:i}){let r;if("string"==typeof t){d&&"complete"===document.readyState||i("createGLContext called on canvas '".concat(t,"' before page was loaded")),r=document.getElementById(t)}else t?r=t:(r=document.createElement("canvas"),r.id="lumagl-canvas",r.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",r.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",document.body.insertBefore(r,document.body.firstChild));return r}({canvas:s,width:e,height:n,onError:o}),t),a?(a=m(a,t),function(t){const e=Object(r.e)(t)?"WebGL2":"WebGL1",n=function(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),o=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:o||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),o=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",a=t.debug?" debug":"";i.info(1,"".concat(e).concat(a," context ").concat(o))()}(a),a):null}function m(t,e={}){if(!t||t._instrumented)return t;t._version=t._version||function(t){if("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext)return 2;return 1}(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},A,e);const{manageState:n,debug:r}=e;return n&&Object(a.c)(t,{copyState:!1,log:(...t)=>i.log(1,...t)()}),f&&r&&(s.global.makeDebugContext?(t=s.global.makeDebugContext(t,e),i.level=Math.max(i.level,1)):i.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function y(t,e={}){if(t.canvas){return void function(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;r&&o||(i.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,o=t.canvas.height||1);t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const a=t.luma.canvasSizeInfo;if(a.clientWidth!==r||a.clientHeight!==o||a.devicePixelRatio!==e){let n=e;const a=Math.floor(r*n),s=Math.floor(o*n);t.canvas.width=a,t.canvas.height=s,t.drawingBufferWidth===a&&t.drawingBufferHeight===s||(i.warn("Device pixel ratio clamped")(),n=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/o),t.canvas.width=Math.floor(r*n),t.canvas.height=Math.floor(o*n)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:o,devicePixelRatio:e})}}(t,function(t){const e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}(e.useDevicePixels),e)}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}n.d(e,"k",(function(){return i})),n.d(e,"i",(function(){return r.d})),n.d(e,"j",(function(){return r.e})),n.d(e,"g",(function(){return r.c})),n.d(e,"b",(function(){return r.b})),n.d(e,"a",(function(){return r.a})),n.d(e,"f",(function(){return o.a})),n.d(e,"n",(function(){return o.c})),n.d(e,"l",(function(){return o.b})),n.d(e,"o",(function(){return o.d})),n.d(e,"c",(function(){return g})),n.d(e,"m",(function(){return y})),n.d(e,"h",(function(){return m})),n.d(e,"e",(function(){return c})),n.d(e,"d",(function(){return l}))},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return o}));var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},function(t,e,n){"use strict";var i=n(14);n.d(e,"a",(function(){return i.a})),n.d(e,"b",(function(){return i.b})),n.d(e,"c",(function(){return i.c})),n.d(e,"d",(function(){return i.d})),n.d(e,"e",(function(){return i.e})),n.d(e,"f",(function(){return i.f})),n.d(e,"g",(function(){return i.g}))},function(t,e,n){"use strict";n(134),n(173),n(135);n(162);n(44);n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return s})),n.d(e,"f",(function(){return u})),n.d(e,"j",(function(){return l})),n.d(e,"i",(function(){return h})),n.d(e,"h",(function(){return p})),n.d(e,"c",(function(){return f})),n.d(e,"a",(function(){return d})),n.d(e,"g",(function(){return A})),n.d(e,"d",(function(){return g}));var i=1/Math.PI*180,r=1/180*Math.PI,o={};function a(t){return Math.round(t/o.EPSILON)*o.EPSILON}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.precision,i=void 0===n?o.precision||4:n;return t=a(t),"".concat(parseFloat(t.toPrecision(i)))}function u(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function c(t,e,n){if(u(t)){n=n||((r=t).clone?r.clone():new Array(r.length));for(var i=0;i<n.length&&i<t.length;++i)n[i]=e(t[i],i,n);return n}var r;return e(t)}function l(t){return p(t)}function h(t){return f(t)}function p(t,e){return c(t,(function(t){return t*r}),e)}function f(t,e){return c(t,(function(t){return t*i}),e)}function d(t,e,n){return c(t,(function(t){return Math.max(e,Math.min(n,t))}))}function A(t,e,n){return u(t)?t.map((function(t,i){return A(t,e[i],n)})):n*e+(1-n)*t}function g(t,e,n){var i=o.EPSILON;n&&(o.EPSILON=n);try{if(t===e)return!0;if(u(t)&&u(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(!g(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=o.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{o.EPSILON=i}}o.EPSILON=1e-12,o.debug=!1,o.precision=4,o.printTypes=!1,o.printDegrees=!1,o.printRowMajor=!0},function(t,e,n){"use strict";n.r(e);var i=n(5),r=n(131),o=n(148),a=n(91),s=n(136);const u=[255,255,255],c=1,l=[0,0,1],h=[0,0,1];let p=0;class f{constructor(t={}){const{color:e=u}=t,{intensity:n=c}=t,{position:i=h}=t;this.id=t.id||"point-".concat(p++),this.color=e,this.intensity=n,this.type="point",this.position=i,this.attenuation=function(t){if("attenuation"in t)return t.attenuation;if("intensity"in t)return[0,0,t.intensity];return l}(t),this.projectedLight={...this}}getProjectedLight({layer:t}){const{projectedLight:e}=this,n=t.context.viewport,{coordinateSystem:r,coordinateOrigin:o}=t.props,a=Object(s.b)(this.position,{viewport:n,coordinateSystem:r,coordinateOrigin:o,fromCoordinateSystem:n.isGeospatial?i.a.LNGLAT:i.a.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return e.color=this.color,e.intensity=this.intensity,e.position=a,e}}var d=n(112);class A extends f{getProjectedLight({layer:t}){const{projectedLight:e}=this,n=t.context.viewport,{coordinateSystem:i,coordinateOrigin:r,modelMatrix:o}=t.props,{project_uCameraPosition:a}=Object(d.b)({viewport:n,modelMatrix:o,coordinateSystem:i,coordinateOrigin:r});return e.color=this.color,e.intensity=this.intensity,e.position=a,e}}const g=Math.PI/180,m=23.4397*g;function y(t,e,n){const i=g*-n,r=g*e,o=function(t){return function(t){return t/864e5-.5+2440588}(t)-2451545}(t),a=function(t){const e=function(t){const e=t,n=g*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e));return e+n+102.9372*g+Math.PI}((n=t,g*(357.5291+.98560028*n)));var n;return{declination:b(e,0),rightAscension:_(e,0)}}(o),s=function(t,e){return g*(280.147+360.9856235*t)-e}(o,i)-a.rightAscension;return{azimuth:x(s,r,a.declination),altitude:w(s,r,a.declination)}}function v(t,e,n){const{azimuth:i,altitude:r}=y(t,e,n);return[Math.sin(i)*Math.cos(r),Math.cos(i)*Math.cos(r),-Math.sin(r)]}function _(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(m)-Math.tan(e)*Math.sin(m),Math.cos(n))}function b(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(m)+Math.cos(e)*Math.sin(m)*Math.sin(n))}function x(t,e,n){const i=t,r=e,o=n;return Math.atan2(Math.sin(i),Math.cos(i)*Math.sin(r)-Math.tan(o)*Math.cos(r))}function w(t,e,n){const i=t,r=e,o=n;return Math.asin(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(i))}class E extends a.a{constructor({timestamp:t,...e}){super(e),this.timestamp=t}getProjectedLight({layer:t}){const{viewport:e}=t.context;if(e.resolution>0){const[t,e,n]=v(this.timestamp,0,0);this.direction=[t,-n,e]}else{const{latitude:t,longitude:n}=e;this.direction=v(this.timestamp,t,n)}return this}}var T=n(81),S=n(170),P=n(58);const M=[-1,-1,1,-1,-1,1,1,1];class C extends S.a{constructor(t,e){const n=M.map(t=>-1===t?0:t);super(t,Object.assign({},e,{vs:"attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",geometry:new P.a({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(M)},aTexCoord:{size:2,value:new Float32Array(n)},aCoordinate:{size:2,value:new Float32Array(n)}}})})),this.setVertexCount(4)}}var I=n(0),O=n(175),L=n(165);class R extends L.a{constructor(t,e={}){super(t,e);const{module:n,fs:i,id:r}=e;this.model=new C(t,{id:r,fs:i,modules:[n]})}render(t){const e=this.gl;Object(I.o)(e,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},()=>this._renderPass(e,t))}delete(){this.model.delete(),this.model=null}_renderPass(t,{inputBuffer:e,outputBuffer:n}){Object(O.a)(t,{color:!0}),this.model.draw({moduleSettings:this.props.moduleSettings,uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}var k=n(195);class D extends T.a{constructor(t,e={}){super(e),this.id="".concat(t.name,"-pass"),Object(k.b)(t),this.module=t}postRender(t,e){this.passes||(this.passes=function(t,e,n,i){if(e.filter||e.sampler){const r=B(e);return[new R(t,{id:n,module:e,fs:r,moduleSettings:i})]}return(e.passes||[]).map((r,o)=>{const a=B(e,r),s="".concat(n,"-").concat(o);return new R(t,{id:s,module:e,fs:a,moduleSettings:i})})}(t,this.module,this.id,this.props));const{target:n}=e;let i=e.inputBuffer,r=e.swapBuffer;for(let t=0;t<this.passes.length;t++){n&&t===this.passes.length-1&&(r=n),this.passes[t].render({inputBuffer:i,outputBuffer:r});const e=r;r=i,i=e}return i}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=null}}}function B(t,e=t){if(e.filter){return(t=>"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n"))("string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor"))}if(e.sampler){return(t=>"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n"))("string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor"))}return null}var F=n(82),z=n(189),N=n(156),j=n(153),U=n(108),V=n(188),G=n(158),W=n(35),H=n(104),q=n(2),X=n(12),Z=n(19);const Q=Math.PI/180,Y=180/Math.PI;class K extends W.a{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:i=11,nearZMultiplier:r=.1,farZMultiplier:o=2,resolution:a=10}=t;let{width:s,height:u,altitude:c=1.5}=t;s=s||1,u=u||1,c=Math.max(.75,c);const l=(new q.a).lookAt({eye:[0,-c,0],up:[0,0,1]}),h=Math.pow(2,i);l.rotateX(e*Q),l.rotateZ(-n*Q),l.scale(h/u);const p=Math.atan(.5/c),f=512*h/u;super({...t,width:s,height:u,viewMatrix:l,longitude:n,latitude:e,zoom:i,fovyRadians:2*p,aspect:s/u,focalDistance:c,near:r,far:Math.min(2,1/f+1)*c*o}),this.resolution=a,this.distanceScales=function(){const t=Math.PI/180*256;return{unitsPerMeter:[256/6370972,256/6370972,256/6370972],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,256/6370972],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}()}get projectionMode(){return i.c.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,this.height/2],e),i=this.unproject([this.width/2,0],e),r=this.unproject([this.width,this.height/2],e),o=this.unproject([this.width/2,this.height],e);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],i[0],o[0]),Math.min(n[1],r[1],i[1],o[1]),Math.max(n[0],r[0],i[0],o[0]),Math.max(n[1],r[1],i[1],o[1])]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[i,r,o]=t,a=e?r:this.height-r,{pixelUnprojectionMatrix:s}=this;let u;if(Number.isFinite(o))u=J(s,[i,a,o,1]);else{const t=J(s,[i,a,-1,1]),e=J(s,[i,a,1,1]),r=256*((n||0)/6370972+1),o=X.n(X.o([],t,e)),c=X.n(t),l=X.n(e),h=4*((4*c*l-(o-c-l)**2)/16)/o,p=(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(o);u=X.h([],t,e,p)}const[c,l,h]=this.unprojectPosition(u);return Number.isFinite(o)?[c,l,h]:Number.isFinite(n)?[c,l,n]:[c,l]}projectPosition(t){const[e,n,i=0]=t,r=e*Q,o=n*Q,a=Math.cos(o),s=256*(i/6370972+1);return[Math.sin(r)*a*s,-Math.cos(r)*a*s,Math.sin(o)*s]}unprojectPosition(t){const[e,n,i]=t,r=X.f(t),o=Math.asin(i/r);return[Math.atan2(e,-n)*Y,o*Y,6370972*(r/256-1)]}projectFlat(t){return t}unprojectFlat(t){return t}getMapCenterByLngLatPosition({lngLat:t,pos:e}){const n=this.unproject(e);return[t[0]-n[0]+this.longitude,t[1]-n[1]+this.latitude]}}function J(t,e){const n=Z.n([],e,t);return Z.k(n,n,1/n[3]),n}var $=n(224),tt=n(93),et=n(207),nt=n(285),it=n(111),rt=n(57),ot=n(149),at=n(16),st=n(56),ut=n(113),ct=n(29),lt=n(49),ht=n(43);const pt=[0,0,0],ft=0,dt=0,At=90,gt=-90,mt={transitionDuration:300,transitionEasing:t=>t,transitionInterpolator:new lt.a(["position","pitch","bearing"]),transitionInterruption:ht.a.BREAK};class yt extends ut.a{constructor({width:t,height:e,position:n=pt,bearing:i=dt,pitch:r=ft,longitude:o,latitude:a,maxPitch:s=At,minPitch:u=gt,startRotatePos:c,startBearing:l,startPitch:h,startZoomPosition:p,startZoom:f}){super({width:t,height:e,position:n,bearing:i,pitch:r,longitude:o,latitude:a,maxPitch:s,minPitch:u}),this._state={startRotatePos:c,startBearing:l,startPitch:h,startZoomPosition:p,startZoom:f}}getDirection(t=!1){return new q.d({bearing:this._viewportProps.bearing,pitch:t?90:90+this._viewportProps.pitch}).toVector3().normalize()}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:o}=this._state,{width:a,height:s}=this._viewportProps;if(!i||!Number.isFinite(r)||!Number.isFinite(o))return this;let u;if(t){u={bearing:r-180*((t[0]-i[0])/a),pitch:o-90*((t[1]-i[1])/s)}}else u={bearing:r-e,pitch:o-n};return this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this._viewportProps.position,startZoom:this._viewportProps.zoom})}zoom({scale:t}){let{startZoomPosition:e}=this._state;e||(e=this._viewportProps.position);const n=this.getDirection();return this._move(n,20*Math.log2(t),e)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}moveLeft(t=20){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:Math.PI/2}),t)}moveRight(t=20){const e=this.getDirection(!0);return this._move(e.rotateZ({radians:-Math.PI/2}),t)}moveUp(t=20){const e=this.getDirection(!0);return this._move(e,t)}moveDown(t=20){const e=this.getDirection(!0);return this._move(e.negate(),t)}rotateLeft(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-t})}zoomIn(t=2){return this.zoom({scale:t})}zoomOut(t=2){return this.zoom({scale:1/t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this._viewportProps},{bearing:i,longitude:r}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}_move(t,e,n=this._viewportProps.position){const i=t.scale(e);return this._getUpdatedState({position:new q.c(n).add(i)})}_getUpdatedState(t){return new yt({...this._viewportProps,...this._state,...t})}_applyConstraints(t){const{pitch:e,maxPitch:n,minPitch:i,longitude:r,bearing:o}=t;return t.pitch=Object(q.e)(e,i,n),(r<-180||r>180)&&(t.longitude=Object(ct.e)(r+180,360)-180),(o<-180||o>180)&&(t.bearing=Object(ct.e)(o+180,360)-180),t}}class vt extends st.a{constructor(t){super(yt,t)}_getTransitionProps(){return mt}}class _t extends W.a{constructor(t){const{modelMatrix:e=null,bearing:n=0,pitch:i=0,up:r=[0,0,1]}=t,o=function({bearing:t,pitch:e}){return new q.d({bearing:t,pitch:e}).toVector3().normalize()}({bearing:n,pitch:-90===i?1e-4:90+i}),a=e?e.transformDirection(o):o,s=Object(at.g)(t),u=Math.pow(2,s),c=(new q.a).lookAt({eye:[0,0,0],center:a,up:r}).scale(u);super({...t,zoom:s,viewMatrix:c})}}class bt extends rt.a{constructor(t){super({...t,type:_t})}get controller(){return this._getControllerProps({type:vt})}}bt.displayName="FirstPersonView";const xt="Z",wt=0,Et=0,Tt=0,St=[0,0,0],Pt=-90,Mt=90,Ct=-1/0,It=1/0,Ot={transitionDuration:300,transitionEasing:t=>t,transitionInterpolator:new lt.a(["target","zoom","rotationX","rotationOrbit"]),transitionInterruption:ht.a.BREAK},Lt=t=>Math.pow(2,t);class Rt extends ut.a{constructor({makeViewport:t,width:e,height:n,orbitAxis:i=xt,rotationX:r=wt,rotationOrbit:o=Et,target:a=St,zoom:s=Tt,minRotationX:u=Pt,maxRotationX:c=Mt,minZoom:l=Ct,maxZoom:h=It,startPanPosition:p,startTarget:f,startRotatePos:d,startRotationX:A,startRotationOrbit:g,startZoomPosition:m,startZoom:y}){super({width:e,height:n,orbitAxis:i,rotationX:r,rotationOrbit:o,target:a,zoom:s,minRotationX:u,maxRotationX:c,minZoom:l,maxZoom:h}),this._state={startPanPosition:p,startTarget:f,startRotatePos:d,startRotationX:A,startRotationOrbit:g,startZoomPosition:m,startZoom:y},this.makeViewport=t}panStart({pos:t}){const{target:e}=this._viewportProps;return this._getUpdatedState({startPanPosition:t,startTarget:e})}pan({pos:t,startPos:e}){const{startPanPosition:n,startTarget:i}=this._state,r=new q.b(t).subtract(n);return this._getUpdatedState({target:this._calculateNewTarget({startTarget:i,pixelOffset:r})})}panEnd(){return this._getUpdatedState({startPanPosition:null,startTarget:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:i,startRotationX:r,startRotationOrbit:o}=this._state,{width:a,height:s}=this._viewportProps;if(!i||!Number.isFinite(r)||!Number.isFinite(o))return this;let u;if(t){let e=(t[0]-i[0])/a;const n=(t[1]-i[1])/s;(r<-90||r>90)&&(e*=-1),u={rotationX:r+180*n,rotationOrbit:o+180*e}}else u={rotationX:r+n,rotationOrbit:o+e};return this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this._viewportProps},{rotationOrbit:i}=n;return Math.abs(i-e.rotationOrbit)>180&&(n.rotationOrbit=i<0?i+360:i-360),n}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:t,startTarget:this._viewportProps.target,startZoom:this._viewportProps.zoom})}zoom({pos:t,startPos:e,scale:n}){const{zoom:i,width:r,height:o,target:a}=this._viewportProps;let{startZoom:s,startZoomPosition:u,startTarget:c}=this._state;Number.isFinite(s)||(s=i,c=a,u=e||t);const l=this._calculateNewZoom({scale:n,startZoom:s}),h=Lt(s),p=Lt(l),f=(r/2-u[0])*(p/h-1),d=(o/2-u[1])*(p/h-1);return this._getUpdatedState({zoom:l,target:this._calculateNewTarget({startTarget:c,zoom:l,pixelOffset:[f,d]})})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startTarget:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){const e=[-t,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:e})})}moveRight(t=50){const e=[t,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:e})})}moveUp(t=50){const e=[0,-t];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:e})})}moveDown(t=50){const e=[0,t];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:e})})}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+t})}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:n,minZoom:i}=this._viewportProps;Number.isFinite(e)||(e=this._viewportProps.zoom);const r=e+Math.log2(t);return Object(q.e)(r,i,n)}_calculateNewTarget({startTarget:t,zoom:e,pixelOffset:n}){const i={...this._viewportProps};Number.isFinite(e)&&(i.zoom=e),t&&(i.target=t);const r=this.makeViewport(i),o=r.project(i.target);return r.unproject([o[0]-n[0],o[1]-n[1],o[2]])}_getUpdatedState(t){return new Rt({...this._viewportProps,...this._state,...t})}_applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i,maxRotationX:r,minRotationX:o,rotationOrbit:a}=t;return t.zoom=Object(q.e)(i,n,e),t.rotationX=Object(q.e)(t.rotationX,o,r),(a<-180||a>180)&&(t.rotationOrbit=Object(ct.e)(a+180,360)-180),t}}class kt extends st.a{constructor(t){super(Rt,t)}_getTransitionProps(){return Ot}}const Dt=Math.PI/180;function Bt({height:t,fovy:e,orbitAxis:n,rotationX:i,rotationOrbit:r,zoom:o}){const a=.5/Math.tan(e*Dt/2),s="Z"===n?[0,0,1]:[0,1,0],u="Z"===n?[0,-a,0]:[0,0,a],c=(new q.a).lookAt({eye:u,up:s});c.rotateX(i*Dt),"Z"===n?c.rotateZ(r*Dt):c.rotateY(r*Dt);const l=Math.pow(2,o)/(t||1);return c.scale(l),c}class Ft extends W.a{constructor(t){const{height:e,fovy:n=50,orbitAxis:i="Z",target:r=[0,0,0],rotationX:o=0,rotationOrbit:a=0,zoom:s=0}=t;super({...t,longitude:null,viewMatrix:Bt({height:e,fovy:n,orbitAxis:i,rotationX:o,rotationOrbit:a,zoom:s}),fovy:n,position:r,zoom:s})}}class zt extends rt.a{constructor(t){super({...t,type:Ft})}get controller(){return this._getControllerProps({type:kt})}}zt.displayName="OrbitView";const Nt={transitionDuration:300,transitionEasing:t=>t,transitionInterpolator:new lt.a(["target","zoom"]),transitionInterruption:ht.a.BREAK};class jt extends st.a{constructor(t){t.dragMode=t.dragMode||"pan",super(Rt,t)}_onPanRotate(t){return!1}_getTransitionProps(){return Nt}}const Ut=(new q.a).lookAt({eye:[0,0,1]});function Vt({width:t,height:e,near:n,far:i}){return t=t||1,e=e||1,(new q.a).ortho({left:-t/2,right:t/2,bottom:-e/2,top:e/2,near:n,far:i})}class Gt extends W.a{constructor(t){const{width:e,height:n,near:i=.1,far:r=1e3,zoom:o=0,target:a=[0,0,0],flipY:s=!0}=t,u=Math.pow(2,o);super({...t,longitude:null,position:a,viewMatrix:Ut.clone().scale([u,u*(s?-1:1),u]),projectionMatrix:Vt({width:e,height:n,near:i,far:r}),zoom:o})}}class Wt extends rt.a{constructor(t){super({...t,type:Gt})}get controller(){return this._getControllerProps({type:jt})}}Wt.displayName="OrthographicView";var Ht=n(105);const qt={transitionDuration:300,transitionEasing:t=>t,transitionInterpolator:new lt.a(["longitude","latitude","zoom"]),transitionInterruption:ht.a.BREAK};class Xt extends Ht.a{_applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:i}=t;t.zoom=Object(q.e)(i,n,e);const{longitude:r,latitude:o}=t;return(r<-180||r>180)&&(t.longitude=Object(ct.e)(r+180,360)-180),t.latitude=Object(q.e)(o,-89,89),t}}class Zt extends st.a{constructor(t){t.dragMode=t.dragMode||"pan",super(Xt,t)}setProps(t){super.setProps(t),this.dragRotate=!1,this.touchRotate=!1}_getTransitionProps(){return qt}}class Qt extends rt.a{constructor(t){super({...t,type:K})}get controller(){return this._getControllerProps({type:Zt})}}Qt.displayName="GlobeView";var Yt=n(208),Kt=n(106);const Jt=["bearing","pitch"],$t={speed:1.2,curve:1.414};class te extends Kt.a{constructor(t={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),this.props={...$t,...t}}interpolateProps(t,e,n){const i=Object(at.c)(t,e,n,this.props);for(const r of Jt)i[r]=Object(q.g)(t[r]||0,e[r]||0,n);return i}getDuration(t,e){let{transitionDuration:n}=e;return"auto"===n&&(n=Object(at.f)(t,e,this.props)),n}}var ee=n(6),ne=n(45),ie=n(209),re=n(63),oe=n(152),ae=n(75),se=n(151),ue=n(128);n.d(e,"COORDINATE_SYSTEM",(function(){return i.a})),n.d(e,"LightingEffect",(function(){return r.a})),n.d(e,"AmbientLight",(function(){return o.a})),n.d(e,"DirectionalLight",(function(){return a.a})),n.d(e,"PointLight",(function(){return f})),n.d(e,"_CameraLight",(function(){return A})),n.d(e,"_SunLight",(function(){return E})),n.d(e,"PostProcessEffect",(function(){return D})),n.d(e,"_LayersPass",(function(){return F.a})),n.d(e,"Deck",(function(){return z.a})),n.d(e,"LayerManager",(function(){return N.a})),n.d(e,"AttributeManager",(function(){return j.a})),n.d(e,"Layer",(function(){return U.a})),n.d(e,"CompositeLayer",(function(){return V.a})),n.d(e,"DeckRenderer",(function(){return G.a})),n.d(e,"Viewport",(function(){return W.a})),n.d(e,"WebMercatorViewport",(function(){return H.a})),n.d(e,"_GlobeViewport",(function(){return K})),n.d(e,"picking",(function(){return $.a})),n.d(e,"project",(function(){return tt.a})),n.d(e,"project32",(function(){return et.a})),n.d(e,"gouraudLighting",(function(){return nt.a})),n.d(e,"phongLighting",(function(){return nt.b})),n.d(e,"shadow",(function(){return it.a})),n.d(e,"View",(function(){return rt.a})),n.d(e,"MapView",(function(){return ot.a})),n.d(e,"FirstPersonView",(function(){return bt})),n.d(e,"OrbitView",(function(){return zt})),n.d(e,"OrthographicView",(function(){return Wt})),n.d(e,"_GlobeView",(function(){return Qt})),n.d(e,"Controller",(function(){return st.a})),n.d(e,"MapController",(function(){return Ht.b})),n.d(e,"_GlobeController",(function(){return Zt})),n.d(e,"FirstPersonController",(function(){return vt})),n.d(e,"OrbitController",(function(){return kt})),n.d(e,"OrthographicController",(function(){return jt})),n.d(e,"Effect",(function(){return T.a})),n.d(e,"LayerExtension",(function(){return Yt.a})),n.d(e,"TRANSITION_EVENTS",(function(){return ht.a})),n.d(e,"TransitionInterpolator",(function(){return Kt.a})),n.d(e,"LinearInterpolator",(function(){return lt.a})),n.d(e,"FlyToInterpolator",(function(){return te})),n.d(e,"log",(function(){return ee.a})),n.d(e,"createIterable",(function(){return ne.a})),n.d(e,"fp64LowPart",(function(){return ct.b})),n.d(e,"Tesselator",(function(){return ie.a})),n.d(e,"_fillArray",(function(){return re.a})),n.d(e,"_flatten",(function(){return re.b})),n.d(e,"_count",(function(){return oe.a})),n.d(e,"_memoize",(function(){return ae.a})),n.d(e,"_mergeShaders",(function(){return se.a})),n.d(e,"_compareProps",(function(){return ue.a}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a}));var i=n(6);const r={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(r,"IDENTITY",{get:()=>i.a.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const o={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},a={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}}},function(t,e,n){"use strict";var i=n(264);e.a=new i.a({id:"deck"})},,function(t,e,n){"use strict";n.d(e,"q",(function(){return r})),n.d(e,"f",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"h",(function(){return s})),n.d(e,"p",(function(){return u})),n.d(e,"o",(function(){return c})),n.d(e,"k",(function(){return l})),n.d(e,"l",(function(){return h})),n.d(e,"m",(function(){return p})),n.d(e,"n",(function(){return f})),n.d(e,"e",(function(){return d})),n.d(e,"c",(function(){return A})),n.d(e,"d",(function(){return g})),n.d(e,"j",(function(){return m})),n.d(e,"i",(function(){return y})),n.d(e,"g",(function(){return v})),n.d(e,"b",(function(){return _}));var i=n(1);function r(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function o(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],f=e[11],d=e[12],A=e[13],g=e[14],m=e[15],y=n*s-i*a,v=n*u-r*a,_=n*c-o*a,b=i*u-r*s,x=i*c-o*s,w=r*c-o*u,E=l*A-h*d,T=l*g-p*d,S=l*m-f*d,P=h*g-p*A,M=h*m-f*A,C=p*m-f*g,I=y*C-v*M+_*P+b*S-x*T+w*E;return I?(I=1/I,t[0]=(s*C-u*M+c*P)*I,t[1]=(r*M-i*C-o*P)*I,t[2]=(A*w-g*x+m*b)*I,t[3]=(p*x-h*w-f*b)*I,t[4]=(u*S-a*C-c*T)*I,t[5]=(n*C-r*S+o*T)*I,t[6]=(g*_-d*w-m*v)*I,t[7]=(l*w-p*_+f*v)*I,t[8]=(a*M-s*S+c*E)*I,t[9]=(i*S-n*M-o*E)*I,t[10]=(d*x-A*_+m*y)*I,t[11]=(h*_-l*x-f*y)*I,t[12]=(s*T-a*P-u*E)*I,t[13]=(n*P-i*T+r*E)*I,t[14]=(A*v-d*b-g*y)*I,t[15]=(l*b-h*v+p*y)*I,t):null}function a(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],p=t[11],f=t[12],d=t[13],A=t[14],g=t[15];return(e*a-n*o)*(h*g-p*A)-(e*s-i*o)*(l*g-p*d)+(e*u-r*o)*(l*A-h*d)+(n*s-i*a)*(c*g-p*f)-(n*u-r*a)*(c*A-h*f)+(i*u-r*s)*(c*d-l*f)}function s(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],A=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],b=n[2],x=n[3];return t[0]=v*i+_*s+b*h+x*A,t[1]=v*r+_*u+b*p+x*g,t[2]=v*o+_*c+b*f+x*m,t[3]=v*a+_*l+b*d+x*y,v=n[4],_=n[5],b=n[6],x=n[7],t[4]=v*i+_*s+b*h+x*A,t[5]=v*r+_*u+b*p+x*g,t[6]=v*o+_*c+b*f+x*m,t[7]=v*a+_*l+b*d+x*y,v=n[8],_=n[9],b=n[10],x=n[11],t[8]=v*i+_*s+b*h+x*A,t[9]=v*r+_*u+b*p+x*g,t[10]=v*o+_*c+b*f+x*m,t[11]=v*a+_*l+b*d+x*y,v=n[12],_=n[13],b=n[14],x=n[15],t[12]=v*i+_*s+b*h+x*A,t[13]=v*r+_*u+b*p+x*g,t[14]=v*o+_*c+b*f+x*m,t[15]=v*a+_*l+b*d+x*y,t}function u(t,e,n){var i,r,o,a,s,u,c,l,h,p,f,d,A=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*A+e[4]*g+e[8]*m+e[12],t[13]=e[1]*A+e[5]*g+e[9]*m+e[13],t[14]=e[2]*A+e[6]*g+e[10]*m+e[14],t[15]=e[3]*A+e[7]*g+e[11]*m+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*A+s*g+h*m+e[12],t[13]=r*A+u*g+p*m+e[13],t[14]=o*A+c*g+f*m+e[14],t[15]=a*A+l*g+d*m+e[15]),t}function c(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function l(t,e,n,r){var o,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x,w,E,T,S,P,M,C=r[0],I=r[1],O=r[2],L=Math.hypot(C,I,O);return L<i.b?null:(C*=L=1/L,I*=L,O*=L,o=Math.sin(n),s=1-(a=Math.cos(n)),u=e[0],c=e[1],l=e[2],h=e[3],p=e[4],f=e[5],d=e[6],A=e[7],g=e[8],m=e[9],y=e[10],v=e[11],_=C*C*s+a,b=I*C*s+O*o,x=O*C*s-I*o,w=C*I*s-O*o,E=I*I*s+a,T=O*I*s+C*o,S=C*O*s+I*o,P=I*O*s-C*o,M=O*O*s+a,t[0]=u*_+p*b+g*x,t[1]=c*_+f*b+m*x,t[2]=l*_+d*b+y*x,t[3]=h*_+A*b+v*x,t[4]=u*w+p*E+g*T,t[5]=c*w+f*E+m*T,t[6]=l*w+d*E+y*T,t[7]=h*w+A*E+v*T,t[8]=u*S+p*P+g*M,t[9]=c*S+f*P+m*M,t[10]=l*S+d*P+y*M,t[11]=h*S+A*P+v*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function h(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*i,t[5]=a*r+l*i,t[6]=s*r+h*i,t[7]=u*r+p*i,t[8]=c*r-o*i,t[9]=l*r-a*i,t[10]=h*r-s*i,t[11]=p*r-u*i,t}function p(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*i,t[1]=a*r-l*i,t[2]=s*r-h*i,t[3]=u*r-p*i,t[8]=o*i+c*r,t[9]=a*i+l*r,t[10]=s*i+h*r,t[11]=u*i+p*r,t}function f(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*i,t[1]=a*r+l*i,t[2]=s*r+h*i,t[3]=u*r+p*i,t[4]=c*r-o*i,t[5]=l*r-a*i,t[6]=h*r-s*i,t[7]=p*r-u*i,t}function d(t,e){var n=e[0],i=e[1],r=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,l),t}function A(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,u=r+r,c=n*a,l=i*a,h=i*s,p=r*a,f=r*s,d=r*u,A=o*a,g=o*s,m=o*u;return t[0]=1-h-d,t[1]=l+m,t[2]=p-g,t[3]=0,t[4]=l-m,t[5]=1-c-d,t[6]=f+A,t[7]=0,t[8]=p+g,t[9]=f-A,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g(t,e,n,i,r,o,a){var s=1/(n-e),u=1/(r-i),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function m(t,e,n,i,r){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}function y(t,e,n,i,r,o,a){var s=1/(e-n),u=1/(i-r),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(a+o)*c,t[15]=1,t}function v(t,e,n,r){var o,a,s,u,c,l,h,p,f,d,A=e[0],g=e[1],m=e[2],y=r[0],v=r[1],_=r[2],b=n[0],x=n[1],w=n[2];return Math.abs(A-b)<i.b&&Math.abs(g-x)<i.b&&Math.abs(m-w)<i.b?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=A-b,p=g-x,f=m-w,o=v*(f*=d=1/Math.hypot(h,p,f))-_*(p*=d),a=_*(h*=d)-y*f,s=y*p-v*h,(d=Math.hypot(o,a,s))?(o*=d=1/d,a*=d,s*=d):(o=0,a=0,s=0),u=p*s-f*a,c=f*o-h*s,l=h*a-p*o,(d=Math.hypot(u,c,l))?(u*=d=1/d,c*=d,l*=d):(u=0,c=0,l=0),t[0]=o,t[1]=u,t[2]=h,t[3]=0,t[4]=a,t[5]=c,t[6]=p,t[7]=0,t[8]=s,t[9]=l,t[10]=f,t[11]=0,t[12]=-(o*A+a*g+s*m),t[13]=-(u*A+c*g+l*m),t[14]=-(h*A+p*g+f*m),t[15]=1,t)}function _(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],p=t[9],f=t[10],d=t[11],A=t[12],g=t[13],m=t[14],y=t[15],v=e[0],_=e[1],b=e[2],x=e[3],w=e[4],E=e[5],T=e[6],S=e[7],P=e[8],M=e[9],C=e[10],I=e[11],O=e[12],L=e[13],R=e[14],k=e[15];return Math.abs(n-v)<=i.b*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-_)<=i.b*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(o-b)<=i.b*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-x)<=i.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-w)<=i.b*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-E)<=i.b*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-T)<=i.b*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-S)<=i.b*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-P)<=i.b*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(p-M)<=i.b*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-C)<=i.b*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-I)<=i.b*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(A-O)<=i.b*Math.max(1,Math.abs(A),Math.abs(O))&&Math.abs(g-L)<=i.b*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(m-R)<=i.b*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-k)<=i.b*Math.max(1,Math.abs(y),Math.abs(k))}},function(t,e,n){"use strict";var i={};function r(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}function o(...t){return(t=t.map((e,n)=>(n&&(e=e.replace(new RegExp("^".concat("/")),"")),n!==t.length-1&&(e=e.replace(new RegExp("".concat("/","$")),"")),e))).join("/")}n.r(i),n.d(i,"dirname",(function(){return r})),n.d(i,"join",(function(){return o})),n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"f",(function(){return o})),n.d(e,"h",(function(){return a})),n.d(e,"g",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"j",(function(){return h})),n.d(e,"b",(function(){return p})),n.d(e,"c",(function(){return f})),n.d(e,"i",(function(){return d})),n.d(e,"k",(function(){return A}));const i=t=>"boolean"==typeof t,r=t=>"function"==typeof t,o=t=>null!==t&&"object"==typeof t,a=t=>o(t)&&t.constructor==={}.constructor,s=t=>o(t)&&r(t.then),u=t=>t&&"function"==typeof t[Symbol.iterator],c=t=>t&&"function"==typeof t[Symbol.asyncIterator],l=t=>t&&r(t.next),h=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,p=t=>"undefined"!=typeof Blob&&t instanceof Blob,f=t=>t&&"object"==typeof t&&t.isBuffer,d=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||o(t)&&r(t.tee)&&r(t.cancel)&&r(t.getReader))(t)||(t=>o(t)&&r(t.read)&&r(t.pipe)&&i(t.readable))(t),A=t=>(t=>o(t)&&r(t.abort)&&r(t.getWriter))(t)||(t=>o(t)&&r(t.end)&&r(t.write)&&i(t.writable))(t)},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return u}));var i=n(3);function r(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function o(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(i.b.debug&&!r(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}var s={};function u(t,e){s[t]||(s[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"g",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"i",(function(){return s})),n.d(e,"j",(function(){return u})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"h",(function(){return h})),n.d(e,"q",(function(){return p})),n.d(e,"p",(function(){return f})),n.d(e,"r",(function(){return d})),n.d(e,"k",(function(){return A})),n.d(e,"l",(function(){return g})),n.d(e,"m",(function(){return m})),n.d(e,"a",(function(){return y})),n.d(e,"o",(function(){return _})),n.d(e,"f",(function(){return b})),n.d(e,"n",(function(){return x}));var i=n(1);function r(){var t=new i.a(3);return i.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function a(t,e,n){var r=new i.a(3);return r[0]=t,r[1]=e,r[2]=n,r}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function u(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function c(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function l(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=r*u-o*s,t[1]=o*a-i*u,t[2]=i*s-r*a,t}function h(t,e,n,i){var r=e[0],o=e[1],a=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t}function p(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[3]*i+n[7]*r+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/a,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/a,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/a,t}function f(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}function d(t,e,n){var i=n[0],r=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=r*c-o*u,h=o*s-i*c,p=i*u-r*s,f=r*p-o*h,d=o*l-i*p,A=i*h-r*l,g=2*a;return l*=g,h*=g,p*=g,f*=2,d*=2,A*=2,t[0]=s+l+f,t[1]=u+h+d,t[2]=c+p+A,t}function A(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function g(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function m(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function y(t,e){var n=a(t[0],t[1],t[2]),i=a(e[0],e[1],e[2]);u(n,n),u(i,i);var r=c(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}var v,_=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},b=o,x=function(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i};v=r()},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";(function(t){var i=n(3),r=n(204);n.d(e,"b",(function(){return r.a}));var o=n(147);n.d(e,"c",(function(){return o.a}));var a=n(205);n.d(e,"a",(function(){return a.a})),n.d(e,"f",(function(){return i.d})),n.d(e,"e",(function(){return i.a})),n.d(e,"g",(function(){return i.g}));var s=n(146);n.d(e,"d",(function(){return s.a}));var u={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t};(u.global||u.self||u.window).mathgl={config:i.b}}).call(this,n(61))},function(t,e,n){t.exports=n(245)},function(t,e,n){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var c=n(19);function l(t,e){var n=c.n([],e,t);return c.k(n,n,1/n[3]),n}function h(t,e){var n=t%e;return n<0?e+n:n}function p(t,e,n){return n*e+(1-n)*t}var f=n(8),d=n(22),A=n(12);function g(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var m=Math.PI,y=m/4,v=m/180,_=180/m;function b(t){return Math.pow(2,t)}function x(t){return Math.log2(t)}function w(t){var e=a(t,2),n=e[0],i=e[1];g(Number.isFinite(n)),g(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var r=i*v;return[512*(n*v+m)/(2*m),512*(m+Math.log(Math.tan(y+.5*r)))/(2*m)]}function E(t){var e=a(t,2),n=e[0],i=e[1],r=n/512*(2*m)-m,o=2*(Math.atan(Math.exp(i/512*(2*m)-m))-y);return[r*_,o*_]}function T(t){var e=t.latitude;return g(Number.isFinite(e)),x(4003e4*Math.cos(e*v))-9}function S(t){var e=t.latitude,n=t.longitude,i=t.highPrecision,r=void 0!==i&&i;g(Number.isFinite(e)&&Number.isFinite(n));var o={},a=Math.cos(e*v),s=512/360/a,u=512/4003e4/a;if(o.unitsPerMeter=[u,u,u],o.metersPerUnit=[1/u,1/u,1/u],o.unitsPerDegree=[512/360,s,u],o.degreesPerUnit=[.703125,1/s,1/u],r){var c=v*Math.tan(e*v)/a,l=512/360*c/2,h=512/4003e4*c,p=h/s*u;o.unitsPerDegree2=[0,l,h],o.unitsPerMeter2=[p,0,p]}return o}function P(t,e){var n=a(t,3),i=n[0],r=n[1],o=n[2],s=a(e,3),u=s[0],c=s[1],l=s[2],h=S({longitude:i,latitude:r,highPrecision:!0}),p=h.unitsPerMeter,f=h.unitsPerMeter2,d=w(t);d[0]+=u*(p[0]+f[0]*c),d[1]+=c*(p[1]+f[1]*c);var A=E(d),g=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[A[0],A[1],g]:A}function M(t){var e=t.height,n=t.pitch,i=t.bearing,r=t.altitude,o=t.scale,a=t.center,s=void 0===a?null:a,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return f.p(u,u,[0,0,-r]),f.l(u,u,-n*v),f.n(u,u,i*v),o/=e,f.o(u,u,[o,o,o]),s&&f.p(u,u,A.i([],s)),u}function C(t){var e=t.width,n=t.height,i=t.altitude,r=void 0===i?1.5:i,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,u=void 0===s?1:s,c=t.farZMultiplier,l=void 0===c?1:c,h=a*v,p=Math.atan(.5/r),f=Math.sin(p)*r/Math.sin(Math.min(Math.max(Math.PI/2-h-p,.01),Math.PI-.01));return{fov:2*p,aspect:e/n,focalDistance:r,near:u,far:(Math.sin(h)*f+r)*l}}function I(t){var e=t.width,n=t.height,i=t.pitch,r=C({width:e,height:n,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=r.fov,a=r.aspect,s=r.near,u=r.far;return f.j([],o,a,s,u)}function O(t,e){var n=a(t,3),i=n[0],r=n[1],o=n[2],s=void 0===o?0:o;return g(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(s)),l(e,[i,r,s,1])}function L(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=a(t,3),r=i[0],o=i[1],s=i[2];if(g(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(s)){var u=l(e,[r,o,s,1]);return u}var c=l(e,[r,o,0,1]),h=l(e,[r,o,1,1]),p=c[2],f=h[2],A=p===f?0:((n||0)-p)/(f-p);return d.c([],c,h,A)}function R(t){var e=t.width,n=t.height,i=t.bounds,r=t.minExtent,o=void 0===r?0:r,s=t.maxZoom,u=void 0===s?24:s,c=t.padding,l=void 0===c?0:c,h=t.offset,p=void 0===h?[0,0]:h,f=a(i,2),d=a(f[0],2),A=d[0],m=d[1],y=a(f[1],2),v=y[0],_=y[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else g(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var b=new F({width:e,height:n,longitude:0,latitude:0,zoom:0}),x=b.project([A,_]),w=b.project([v,m]),E=[Math.max(Math.abs(w[0]-x[0]),o),Math.max(Math.abs(w[1]-x[1]),o)],T=[e-l.left-l.right-2*Math.abs(p[0]),n-l.top-l.bottom-2*Math.abs(p[1])];g(T[0]>0&&T[1]>0);var S=T[0]/E[0],P=T[1]/E[1],M=(l.right-l.left)/2/S,C=(l.bottom-l.top)/2/P,I=[(w[0]+x[0])/2+M,(w[1]+x[1])/2+C],O=b.unproject(I),L=Math.min(u,b.zoom+Math.log2(Math.abs(Math.min(S,P))));return g(Number.isFinite(L)),{longitude:O[0],latitude:O[1],zoom:L}}var k=Math.PI/180;function D(t){var e,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.width,o=t.height,a=t.unproject,s={targetZ:i},u=a([0,o],s),c=a([r,o],s),l=Math.atan(.5/t.altitude),h=(90-t.pitch)*k;return l>h-.01?(e=B(t,0,i),n=B(t,r,i)):(e=a([0,0],s),n=a([r,0],s)),[u,c,n,e]}function B(t,e,n){var i=t.pixelUnprojectionMatrix,r=l(i,[e,0,1,1]),o=l(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2]),s=E(d.c([],r,o,a));return s[2]=n,s}var F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},n=e.width,i=e.height,r=e.latitude,o=void 0===r?0:r,a=e.longitude,u=void 0===a?0:a,c=e.zoom,l=void 0===c?0:c,h=e.pitch,p=void 0===h?0:h,f=e.bearing,d=void 0===f?0:f,A=e.altitude,g=void 0===A?1.5:A,m=e.nearZMultiplier,y=void 0===m?.02:m,v=e.farZMultiplier,_=void 0===v?1.01:v;s(this,t),n=n||1,i=i||1;var x=b(l);g=Math.max(.75,g);var E=w([u,o]);E[2]=0,this.projectionMatrix=I({width:n,height:i,pitch:p,altitude:g,nearZMultiplier:y,farZMultiplier:_}),this.viewMatrix=M({height:i,scale:x,center:E,pitch:p,bearing:d,altitude:g}),this.width=n,this.height=i,this.scale=x,this.latitude=o,this.longitude=u,this.zoom=l,this.pitch=p,this.bearing=d,this.altitude=g,this.center=E,this.distanceScales=S(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}var e,n,i;return e=t,(n=[{key:"_initMatrices",value:function(){var t=this.width,e=this.height,n=this.projectionMatrix,i=this.viewMatrix,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];f.h(r,r,n),f.h(r,r,i),this.viewProjectionMatrix=r;var o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];f.o(o,o,[t/2,-e/2,1]),f.p(o,o,[1,-1,0]),f.h(o,o,r);var a=f.f([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o);if(!a)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=a}},{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&f.b(e.projectionMatrix,this.projectionMatrix)&&f.b(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,i=void 0===n||n,r=this.projectPosition(t),o=O(r,this.pixelProjectionMatrix),s=a(o,2),u=s[0],c=s[1],l=i?c:this.height-c;return 2===t.length?[u,l]:[u,l,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,i=void 0===n||n,r=e.targetZ,o=void 0===r?void 0:r,s=a(t,3),u=s[0],c=s[1],l=s[2],h=i?c:this.height-c,p=o&&o*this.distanceScales.unitsPerMeter[2],f=L([u,h,l],this.pixelUnprojectionMatrix,p),d=this.unprojectPosition(f),A=a(d,3),g=A[0],m=A[1],y=A[2];return Number.isFinite(l)?[g,m,y]:Number.isFinite(o)?[g,m,o]:[g,m]}},{key:"projectPosition",value:function(t){var e=a(w(t),2);return[e[0],e[1],(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=a(E(t),2);return[e[0],e[1],(t[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(t){return w(t)}},{key:"unprojectFlat",value:function(t){return E(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=L(t.pos,this.pixelUnprojectionMatrix),i=w(e),r=d.a([],i,d.d([],n));return E(d.a([],this.center,r))}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,o=R(Object.assign({width:i,height:r,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:i,height:r,longitude:a,latitude:s,zoom:u})}},{key:"getBounds",value:function(t){var e=this.getBoundingRegion(t),n=Math.min.apply(Math,o(e.map((function(t){return t[0]})))),i=Math.max.apply(Math,o(e.map((function(t){return t[0]}))));return[[n,Math.min.apply(Math,o(e.map((function(t){return t[1]}))))],[i,Math.max.apply(Math,o(e.map((function(t){return t[1]}))))]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return D(this,t.z||0)}}])&&u(e.prototype,n),i&&u(e,i),t}();function z(t){var e=t.width,n=t.height,i=t.longitude,r=t.latitude,o=t.zoom,a=t.pitch,s=void 0===a?0:a,u=t.bearing,c=void 0===u?0:u;(i<-180||i>180)&&(i=h(i+180,360)-180),(c<-180||c>180)&&(c=h(c+180,360)-180);var l=new F({width:e,height:n,longitude:i,latitude:r,zoom:o}),p=l.project([i,85.05113])[1],f=l.project([i,-85.05113])[1],d=0;return f-p<n&&(o+=Math.log2(n/(f-p)),p=(l=new F({width:e,height:n,longitude:i,latitude:r,zoom:o})).project([i,85.05113])[1],f=l.project([i,-85.05113])[1]),p>0?d=p:f<n&&(d=f-n),d&&(r=l.unproject([e/2,n/2+d])[1]),{width:e,height:n,longitude:i,latitude:r,zoom:o,pitch:s,bearing:c}}function N(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var U=["longitude","latitude","zoom"],V={curve:1.414,speed:1.2};function G(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r={},o=H(t,e,i),a=o.startZoom,s=o.startCenterXY,u=o.uDelta,c=o.w0,l=o.u1,h=o.S,f=o.rho,A=o.rho2,g=o.r0;if(l<.01){var m,y=N(U);try{for(y.s();!(m=y.n()).done;){var v=m.value,_=t[v],b=e[v];r[v]=p(_,b,n)}}catch(t){y.e(t)}finally{y.f()}return r}var w=n*h,T=Math.cosh(g)/Math.cosh(g+f*w),S=c*((Math.cosh(g)*Math.tanh(g+f*w)-Math.sinh(g))/A)/l,P=1/T,M=a+x(P),C=d.e([],u,S);d.a(C,C,s);var I=E(C);return r.longitude=I[0],r.latitude=I[1],r.zoom=M,r}function W(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i=Object.assign({},V,i),o=r.screenSpeed,a=r.speed,s=r.maxDuration,u=H(t,e,i),c=u.S,l=u.rho,h=1e3*c;return n=Number.isFinite(o)?h/(o/l):h/a,Number.isFinite(s)&&n>s?0:n}function H(t,e,n){var i=(n=Object.assign({},V,n)).curve,r=t.zoom,o=[t.longitude,t.latitude],a=b(r),s=e.zoom,u=[e.longitude,e.latitude],c=b(s-r),l=w(o),h=w(u),p=d.f([],h,l),f=Math.max(t.width,t.height),A=f/c,g=d.b(p)*a,m=Math.max(g,.01),y=i*i,v=(A*A-f*f+y*y*m*m)/(2*f*y*m),_=(A*A-f*f-y*y*m*m)/(2*A*y*m),x=Math.log(Math.sqrt(v*v+1)-v),E=Math.log(Math.sqrt(_*_+1)-_);return{startZoom:r,startCenterXY:l,uDelta:p,w0:f,u1:g,S:(E-x)/i,rho:i,rho2:y,r0:x,r1:E}}n.d(e,"d",(function(){return D})),n.d(e,"b",(function(){return R})),n.d(e,"k",(function(){return z})),n.d(e,"c",(function(){return G})),n.d(e,"f",(function(){return W})),n.d(e,"j",(function(){return w})),n.d(e,"m",(function(){return E})),n.d(e,"n",(function(){return O})),n.d(e,"l",(function(){return L})),n.d(e,"g",(function(){return T})),n.d(e,"e",(function(){return S})),n.d(e,"a",(function(){return P})),n.d(e,"i",(function(){return M})),n.d(e,"h",(function(){return C}))},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"g",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"k",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"m",(function(){return h})),n.d(e,"j",(function(){return p})),n.d(e,"d",(function(){return f})),n.d(e,"i",(function(){return d})),n.d(e,"n",(function(){return A})),n.d(e,"o",(function(){return g})),n.d(e,"f",(function(){return m})),n.d(e,"e",(function(){return y}));var i=n(1);function r(t){var e=new i.a(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function o(t,e,n,r){var o=new i.a(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function l(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function h(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function p(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=o*a,t}function f(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function d(t,e,n,i){var r=e[0],o=e[1],a=e[2],s=e[3];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=a+i*(n[2]-a),t[3]=s+i*(n[3]-s),t}function A(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t}function g(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*i+s*o-u*r,h=c*r+u*i-a*o,p=c*o+a*r-s*i,f=-a*i-s*r-u*o;return t[0]=l*c+f*-a+h*-u-p*-s,t[1]=h*c+f*-s+p*-a-l*-u,t[2]=p*c+f*-u+l*-s-h*-a,t[3]=e[3],t}function m(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function y(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=e[0],u=e[1],c=e[2],l=e[3];return Math.abs(n-s)<=i.b*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-u)<=i.b*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-c)<=i.b*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-l)<=i.b*Math.max(1,Math.abs(a),Math.abs(l))}var v,_;v=new i.a(4),i.a!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),_=v},function(t,e,n){t.exports=n(249)()},function(t,e,n){"use strict";function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"i",(function(){return h})),n.d(e,"j",(function(){return p})),n.d(e,"f",(function(){return A}));var i=n(1);function r(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function a(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u(t,e,n,i){var r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t}function c(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function l(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function h(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function p(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}var f,d,A=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};f=new i.a(2),i.a!=Float32Array&&(f[0]=0,f[1]=0),d=f},,function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u}));var i=n(30);function r(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version)))}function o(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function a(t){return o(t)?t:null}function s(t){return Object(i.a)(r(t),"Invalid WebGLRenderingContext"),t}function u(t){return Object(i.a)(o(t),"Requires WebGL2"),t}},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a}));var i=n(6);let r={};function o(t){r=t}function a(t){i.a.level>0&&r[t]&&r[t].call(...arguments)}},,function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(33),r=n(60),o=n(78),a=n(0),s=n(197),u=n(13);const c={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},l={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:c},h={removedProps:c};class p extends i.a{constructor(t,e={}){super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(t=this.accessor){return Math.round(this.byteLength/r.a.getBytesPerElement(t))}getVertexCount(t=this.accessor){return Math.round(this.byteLength/r.a.getBytesPerVertex(t))}initialize(t={}){return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Object(s.a)("Buffer",t,l),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return"accessor"in(t=Object(s.a)("Buffer",t,h))&&this.setAccessor(t.accessor),this}setAccessor(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new r.a(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:i=0}=t,r=t.byteLength||t.length;Object(u.a)(e);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),0!==i||void 0!==r?(Object(a.a)(this.gl),this.gl.bufferSubData(this.target,n,e,i,r)):this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(e),this}copyData({sourceBuffer:t,readOffset:e=0,writeOffset:n=0,size:i}){const{gl:r}=this;return Object(a.a)(r),r.bindBuffer(36662,t.handle),r.bindBuffer(36663,this.handle),r.copyBufferSubData(36662,36663,e,n,i),r.bindBuffer(36662,null),r.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:i=0}={}){Object(a.a)(this.gl);const r=Object(o.c)(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(e),c=n;let l,h;t?(h=t.length,l=h-c):(l=Math.min(s,i||s),h=c+l);const p=Math.min(s,l);return i=i||p,Object(u.a)(i<=p),t=t||new r(h),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,i),this.gl.bindBuffer(36662,null),t}bind({target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:i}={}){return 35345===t||35982===t?void 0!==i?this.gl.bindBufferRange(t,e,this.handle,n,i):(Object(u.a)(0===n),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind({target:t=this.target,index:e=this.accessor&&this.accessor.index}={}){return 35345===t||35982===t?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t,e=0,n=t.byteLength+e){Object(u.a)(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,e,t),this.gl.bindBuffer(i,null),this.debugData=t.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const a=Object(o.b)(t);return Object(u.a)(a),this.setAccessor(new r.a(this.accessor,{type:a})),this}_setByteLength(t,e=this.usage){Object(u.a)(t>=0),this._trackDeallocatedMemory();let n=t;0===t&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=t/Object(o.c)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(t){this.accessor.type||this.setAccessor(new r.a(this.accessor,{type:Object(o.b)(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return a.k.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return a.k.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return a.k.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return a.k.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new r.a(this.accessor,t),this}}},function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"b",(function(){return h})),n.d(e,"f",(function(){return f}));var i=n(64),r=n(2);function o(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(t,e){const n=t%e;return n<0?e+n:n}function s(t){return[t[12],t[13],t[14]]}function u(t){const e={};return e.left=l(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),e.right=l(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),e.bottom=l(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),e.top=l(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),e.near=l(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),e.far=l(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]),e}const c=new r.c;function l(t,e,n,i){c.set(t,e,n);const o=c.len();return{distance:i/o,normal:new r.c(-t/o,-e/o,-n/o)}}function h(t){return t-Math.fround(t)}let p;function f(t,{size:e=1,startIndex:n=0,endIndex:r}){Number.isFinite(r)||(r=t.length);const o=(r-n)/e;p=i.a.allocate(p,o,{type:Float32Array,size:2*e});let a=n,s=0;for(;a<r;){for(let n=0;n<e;n++){const i=t[a++];p[s+n]=i,p[s+n+e]=h(i)}s+=2*e}return p.subarray(0,o*e*2)}},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n(0),r=n(140),o=n(87),a=n(99),s=n(13),u=n(260);const c="Resource subclass must define virtual methods";class l{constructor(t,e={}){Object(i.b)(t);const{id:n,userData:r={}}=e;this.gl=t,this.gl2=t,this.id=n||Object(a.c)(this.constructor.name),this.userData=r,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete({deleteChildren:t=!1}={}){const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(t=>t.delete()),this}bind(t=this.handle){if("function"!=typeof t)return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t,e={}){t=Object(o.b)(this.gl,t),Object(s.a)(t);const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=Object(i.j)(this.gl);if(!((!("webgl2"in n)||t)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const e=n.webgl1,i="webgl2"in n?n.webgl2:n.webgl1;return t?i:e}}return this._getParameter(t,e)}getParameters(t={}){const{parameters:e,keys:n}=t,r=this.constructor.PARAMETERS||{},a=Object(i.j)(this.gl),s={},u=e||Object.keys(r);for(const e of u){const i=r[e];if(i&&(!("webgl2"in i)||a)&&(!("extension"in i)||this.gl.getExtension(i.extension))){const r=n?Object(o.a)(this.gl,e):e;s[r]=this.getParameter(e,t),n&&"GLenum"===i.type&&(s[r]=Object(o.a)(this.gl,s[r]))}}return s}setParameter(t,e){t=Object(o.b)(this.gl,t),Object(s.a)(t);const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=Object(i.j)(this.gl);if(!((!("webgl2"in n)||t)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=Object(o.b)(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return Object(u.a)(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(c)}_deleteHandle(){throw new Error(c)}_bindHandle(t){throw new Error(c)}_getOptsFromHandle(){throw new Error(c)}_getParameter(t,e){throw new Error(c)}_setParameter(t,e){throw new Error(c)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this.constructor.name,e=r.a.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this.constructor.name;r.a.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t,e=this.constructor.name){const n=r.a.get("Memory Usage");n.get("GPU Memory").addCount(t),n.get("".concat(e," Memory")).addCount(t),this.byteLength=t}_trackDeallocatedMemory(t=this.constructor.name){const e=r.a.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n(6),r=n(29),o=n(2),a=n(8),s=n(16),u=n(5);const c=Math.PI/180,l=Object(r.a)(),h=[0,0,0],p={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class f{constructor(t={}){const{id:e=null,x:n=0,y:i=0,width:r=1,height:o=1}=t;this.id=e||this.constructor.displayName||"viewport",this.x=n,this.y=i,this.width=r||1,this.height=o||1,this._frustumPlanes={},this._initViewMatrix(t),this._initProjectionMatrix(t),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?u.c.WEB_MERCATOR:u.c.WEB_MERCATOR_AUTO_OFFSET:u.c.IDENTITY}equals(t){return t instanceof f&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Object(o.f)(t.projectionMatrix,this.projectionMatrix)&&Object(o.f)(t.viewMatrix,this.viewMatrix))}project(t,{topLeft:e=!0}={}){const n=this.projectPosition(t),i=Object(s.n)(n,this.pixelProjectionMatrix),[r,o]=i,a=e?o:this.height-o;return 2===t.length?[r,a]:[r,a,i[2]]}unproject(t,{topLeft:e=!0,targetZ:n}={}){const[i,r,o]=t,a=e?r:this.height-r,u=n&&n*this.distanceScales.unitsPerMeter[2],c=Object(s.l)([i,a,o],this.pixelUnprojectionMatrix,u),[l,h,p]=this.unprojectPosition(c);return Number.isFinite(o)?[l,h,p]:Number.isFinite(n)?[l,h,n]:[l,h]}projectPosition(t){const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(t){return this.isGeospatial?Object(s.j)(t):t}unprojectFlat(t){return this.isGeospatial?Object(s.m)(t):t}getBounds(t={}){const e={targetZ:t.z||0},n=this.unproject([0,0],e),i=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),o=this.unproject([this.width,this.height],e);return[Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1]),Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])]}getDistanceScales(t=null){return t?Object(s.e)({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:n=1,height:i=1}){return t<this.x+this.width&&this.x<t+n&&e<this.y+this.height&&this.y<e+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Object(r.d)(this.viewProjectionMatrix)),this._frustumPlanes)}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix({orthographic:t,fovyRadians:e,aspect:n,focalDistance:i,near:r,far:a}){return t?(new o.a).orthographic({fovy:e,aspect:n,focalDistance:i,near:r,far:a}):(new o.a).perspective({fovy:e,aspect:n,near:r,far:a})}_initViewMatrix(t){const{viewMatrix:e=l,longitude:n=null,latitude:i=null,zoom:r=null,position:a=null,modelMatrix:u=null,focalDistance:c=1,distanceScales:f=null}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this.zoom=r,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(s.g)({latitude:i})+Math.log2(c):0);const d=Math.pow(2,this.zoom);this.scale=d,this.distanceScales=this.isGeospatial?Object(s.e)({latitude:i,longitude:n}):f||p,this.focalDistance=c,this.distanceScales.metersPerUnit=new o.c(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new o.c(this.distanceScales.unitsPerMeter),this.position=h,this.meterOffset=h,a&&(this.position=a,this.modelMatrix=u,this.meterOffset=u?u.transformVector(a):a),this.isGeospatial?(this.longitude=n,this.latitude=i,this.center=this._getCenterInWorld({longitude:n,latitude:i})):this.center=a?this.projectPosition(a):[0,0,0],this.viewMatrixUncentered=e,this.viewMatrix=(new o.a).multiplyRight(this.viewMatrixUncentered).translate(new o.c(this.center||h).negate())}_getCenterInWorld({longitude:t,latitude:e}){const{meterOffset:n,distanceScales:i}=this,r=new o.c(this.projectPosition([t,e,0]));if(n){const t=new o.c(n).scale(i.unitsPerMeter);r.add(t)}return r}_initProjectionMatrix(t){const{projectionMatrix:e=null,orthographic:n=!1,fovyRadians:i,fovy:r=75,near:o=.1,far:a=1e3,focalDistance:s=1}=t;this.projectionMatrix=e||this._createProjectionMatrix({orthographic:n,fovyRadians:i||r*c,aspect:this.width/this.height,focalDistance:s,near:o,far:a})}_initPixelMatrices(){const t=Object(r.a)();a.h(t,t,this.projectionMatrix),a.h(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=a.f([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Object(r.c)(this.viewMatrixInverse);const e=Object(r.a)(),n=Object(r.a)();a.o(e,e,[this.width/2,-this.height/2,1]),a.p(e,e,[1,-1,0]),a.h(n,e,this.viewProjectionMatrix),this.pixelProjectionMatrix=n,this.viewportMatrix=e,this.pixelUnprojectionMatrix=a.f(Object(r.a)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||i.a.warn("Pixel project matrix not invertible")()}}f.displayName="Viewport"},function(t,e,n){"use strict";var i=n(79),r=n(10),o=n(94);class a{log(){return t=>{}}info(){return t=>{}}warn(){return t=>{}}error(){return t=>{}}}n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return h})),n.d(e,"c",(function(){return p})),n.d(e,"a",(function(){return f}));const s={fetch:null,CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new class{constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},metadata:!1,transforms:[],attributeName:null,attributeType:null,reuseWorkers:!0,_workerType:void 0},u={dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},c=()=>{i.b.loaders=i.b.loaders||{};const{loaders:t}=i.b;return t._state=t._state||{},t._state},l=()=>{const t=c();return t.globalOptions=t.globalOptions||{...s},t.globalOptions};function h(t){const e=c(),n=l();e.globalOptions=g(n,t)}function p(t,e,n,i){return n=n||[],function(t,e,n=console){d(t,null,n,s,u,e);for(const i of e){const r=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},a=i.defaultOptions&&i.defaultOptions[i.id]||{};d(r,i.id,n,o,a,e)}}(t,n=Array.isArray(n)?n:[n]),g(e,t,i)}function f(t,e){const n=l(),i=t.fetch||n.fetch;return"function"==typeof i?i:Object(r.f)(i)?t=>Object(o.a)(t,i):e&&e.fetch?e.fetch:e=>Object(o.a)(e,t)}function d(t,e,n,i,o,a){const s=e||"Top level",u=e?"".concat(e,"."):"";for(const c in t){const l=!e&&Object(r.f)(t[c]);if(!(c in i))if(c in o)n.warn("".concat(s," loader option '").concat(u).concat(c,"' deprecated, use '").concat(o[c],"'"));else if(!l){const t=A(c,a);n.warn("".concat(s," loader option '").concat(u).concat(c,"' not recognized. ").concat(t))}}}function A(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const e in r.options){if(t===e)return"Did you mean '".concat(r.id,".").concat(e,"'?");const o=e.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(e,"'?"))}return i}function g(t,e,n){const i={...t.options||{}};return function(t,e){!e||"baseUri"in t||(t.baseUri=e)}(i,n),null===i.log&&(i.log=new a),m(i,l()),m(i,e),i}function m(t,e){for(const n in e)if(n in e){const i=e[n];Object(r.h)(i)&&Object(r.h)(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}},function(t,e,n){const i=n(243);Object.assign(i,n(53),n(255),n(254),n(185),n(257),n(186)),t.exports=i},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(110);function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(i.a)(t,e)}},function(t,e,n){"use strict";var i=n(134);function r(t,e){return!e||"object"!==Object(i.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));const i={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},r={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")}},function(t,e,n){"use strict";function i({source:t,target:e,start:n=0,end:i,size:r,getData:o}){i=i||e.length;const a=t.length,s=i-n;if(a>s)return void e.set(t.subarray(0,s),n);if(e.set(t,n),!o)return;let u=a;for(;u<s;){const i=o(u,t);for(let t=0;t<r;t++)e[n+u]=i[t]||0,u++}}n.d(e,"e",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return c})),n.d(e,"f",(function(){return l}));const r={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function o(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",{...r[t.type],...e,...t}):null}function a(t,e){return e.getBuffer()?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function s(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function u(t){t.push(t.shift())}function c(t,e){const{doublePrecision:n,settings:i,value:r,size:o}=t,a=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*o)*a}function l({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:o,getData:a=(t=>t)}){const s=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*s,l=n.byteOffset,h=n.startIndices,p=o&&h,f=c(n,e),d=n.state.constant;if(!p&&r>=f)return;const A=d?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!d){const t=a;a=(e,i)=>n._normalizeConstant(t(e,i))}const g=d?(t,e)=>a(A,e):(t,e)=>a(A.subarray(t,t+u),e),m=t.getData({length:r}),y=new Float32Array(f);!function({source:t,target:e,size:n,getData:r,sourceStartIndices:o,targetStartIndices:a}){if(!Array.isArray(a))return i({source:t,target:e,size:n,getData:r}),e;let s=0,u=0;const c=r&&((t,e)=>r(t+u,e)),l=Math.min(o.length,a.length);for(let r=1;r<l;r++){const l=o[r]*n,h=a[r]*n;i({source:t.subarray(s,l),target:e,start:u,end:h,size:n,getData:c}),s=l,u=h}u<e.length&&i({source:[],target:e,start:u,size:n,getData:c})}({source:m,target:y,sourceStartIndices:o,targetStartIndices:h,size:u,getData:g}),t.byteLength<y.byteLength+l&&t.reallocate(y.byteLength+l),t.subData({data:y,offset:l})}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var i=n(65);function r(t){if(Array.isArray(t)&&(t=t[0]),!t)return!1;return Array.isArray(t.extensions)}function o(t){let e;return Object(i.a)(t,"null loader"),Object(i.a)(r(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t.parseTextSync||t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));var i=n(70);const r=()=>{},o={BREAK:1,SNAP_TO_END:2,IGNORE:3},a={transitionEasing:t=>t,transitionInterruption:o.BREAK,onTransitionStart:r,onTransitionInterrupt:r,onTransitionEnd:r};class s{constructor(t,e={}){this.ControllerState=t,this.props={...a,...e},this.propsInTransition=null,this.transition=new i.a(e.timeline),this.onViewStateChange=e.onViewStateChange||r,this.onStateChange=e.onStateChange||r,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const n=this.props;if(t={...a,...t},this.props=t,this._shouldIgnoreViewportChange(n,t))return e;if(this._isTransitionEnabled(t)){const{interruption:i,endProps:r}=this.transition.settings,a={...n,...i===o.SNAP_TO_END?r:this.propsInTransition||n};this._triggerTransition(a,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:n}=t;return(e>0||"auto"===e)&&Boolean(n)}_isUpdateDueToCurrentTransition(t){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===o.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}_triggerTransition(t,e){const n=new this.ControllerState(t),i=new this.ControllerState(e).shortestPathFrom(n),{transitionInterpolator:r}=e,o=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(0===o)return;const a=e.transitionInterpolator.initializeProps(t,i);this.propsInTransition={},this.duration=o,this.transition.start({duration:o,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:a.start,endProps:a.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t(e)}}_onTransitionUpdate(t){const{time:e,settings:{interpolator:n,startProps:i,endProps:r,duration:o,easing:a}}=t,s=a(e/o),u=n.interpolateProps(i,r,s);this.propsInTransition=new this.ControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return s}));const i=[],r=[];function o(t,e=0,n=1/0){let o=i;const a={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?o=t:t.length>0&&(r.length=t.length,o=r):o=i,(e>0||Number.isFinite(n))&&(o=(Array.isArray(o)?o:Array.from(o)).slice(e,n),a.index=e-1),{iterable:o,objectInfo:a}}function a(t){return t&&t[Symbol.asyncIterator]}function s(t,{size:e,stride:n,offset:i,startIndices:r,nested:o}){const a=t.BYTES_PER_ELEMENT,s=n?n/a:e,u=i?i/a:0,c=Math.floor((t.length-u)/s);return(n,{index:i,target:a})=>{if(!r){const n=i*s+u;for(let i=0;i<e;i++)a[i]=t[n+i];return a}const l=r[i],h=r[i+1]||c;let p;if(o){p=new Array(h-l);for(let n=l;n<h;n++){const i=n*s+u;a=new Array(e);for(let n=0;n<e;n++)a[n]=t[i+n];p[n-l]=a}}else if(s===e)p=t.subarray(l*e+u,h*e+u);else{p=new t.constructor((h-l)*e);let n=0;for(let i=l;i<h;i++){const r=i*s+u;for(let i=0;i<e;i++)p[n++]=t[r+i]}}return p}}},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";var i=n(17),r=n(18),o=n(3),a={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function s(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=u(t,n);return i!==e&&(h(t,n),!0)}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Math.sign(c(t,e))}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;return l(t,(function(t,e,i,r){n+=A(t,e,i,r)}),e),n/2}function l(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.start,r=void 0===i?0:i,a=n.end,s=void 0===a?t.length:a,u=n.size,c=void 0===u?2:u,l=n.isClosed,h=(s-r)/c,p=0;p<h-1;++p)e(t[r+p*c],t[r+p*c+1],t[r+(p+1)*c],t[r+(p+1)*c+1],p,p+1);var f=r+(h-1)*c,d=l||Object(o.d)(t[r],t[f])&&Object(o.d)(t[r+1],t[f+1]);d||e(t[f],t[f+1],t[r],t[r+1],h-1,0)}function h(t,e){for(var n=e.start,i=void 0===n?0:n,r=e.end,o=void 0===r?t.length:r,a=e.size,s=void 0===a?2:a,u=(o-i)/s,c=Math.floor(u/2),l=0;l<c;++l)for(var h=i+l*s,p=i+(u-1-l)*s,f=0;f<s;++f){var d=t[h+f];t[h+f]=t[p+f],t[p+f]=d}}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Math.sign(f(t,e))}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;return d(t,(function(t,e){n+=A(t[0],t[1],e[0],e[1])}),e),n/2}function d(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.start,r=void 0===i?0:i,a=n.end,s=void 0===a?t.length:a,u=n.isClosed,c=r;c<s-1;++c)e(t[c],t[c+1],c,c+1);var l=u||Object(o.d)(t[s-1],t[0]);l||e(t[s-1],t[0],s-1,0)}function A(t,e,n,i){return(t+n)*(e-i)}!function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),this.points=e,this.isFlatArray=!Object(o.f)(e[0]),this.options={start:n.start||0,end:n.end||e.length,size:n.size||2,isClosed:n.isClosed},Object.freeze(this)}Object(r.a)(t,[{key:"getSignedArea",value:function(){return this.isFlatArray?c(this.points,this.options):f(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(t){this.isFlatArray?l(this.points,(function(e,n,i,r,o,a){t([e,n],[i,r],o,a)}),this.options):d(this.points,t,this.options)}},{key:"modifyWindingDirection",value:function(t){return this.isFlatArray?s(this.points,t,this.options):function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=p(t,n);return i!==e&&(t.reverse(),!0)}(this.points,t,this.options)}}])}();function g(t,e){var n=e.length,i=t.length;if(i>0){for(var r=!0,o=0;o<n;o++)if(t[i-n+o]!==e[o]){r=!1;break}if(r)return!1}for(var a=0;a<n;a++)t[i+a]=e[a];return!0}function m(t,e){for(var n=e.length,i=0;i<n;i++)t[i]=e[i]}function y(t,e,n,i){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=i+e*n,a=0;a<n;a++)r[a]=t[o+a];return r}function v(t,e,n,i){var r,o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(8&n)r=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(4&n)r=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(2&n)r=(i[2]-t[0])/(e[0]-t[0]),o=2;else{if(!(1&n))return null;r=(i[0]-t[0])/(e[0]-t[0]),o=0}for(var s=0;s<t.length;s++)a[s]=(1&o)===s?i[o]:r*(e[s]-t[s])+t[s];return a}function _(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function b(t){var e,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.size,o=void 0===r?2:r,a=i.broken,s=void 0!==a&&a,u=i.gridResolution,c=void 0===u?10:u,l=i.gridOffset,h=void 0===l?[0,0]:l,p=i.startIndex,f=void 0===p?0:p,d=i.endIndex,A=void 0===d?t.length:d,b=(A-f)/o,x=[],w=[x],E=y(t,0,o,f),P=T(E,c,h,[]),M=[];g(x,E);for(var C=1;C<b;C++){for(n=_(e=y(t,C,o,f,e),P);n;){v(E,e,n,P,M);var I=_(M,P);I&&(v(E,M,I,P,M),n=I),g(x,M),m(E,M),S(P,c,n),s&&x.length>o&&(x=[],w.push(x),g(x,E)),n=_(e,P)}g(x,e),m(E,e)}return s?w:w[0]}function x(t,e){for(var n=0;n<e.length;n++)t.push(e[n]);return t}function w(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t.length)return[];for(var i=n.size,r=void 0===i?2:i,o=n.gridResolution,a=void 0===o?10:o,s=n.gridOffset,u=void 0===s?[0,0]:s,c=n.edgeTypes,l=void 0!==c&&c,h=[],p=[{pos:t,types:l&&new Array(t.length/r).fill(1),holes:e||[]}],f=[[],[]],d=[];p.length;){var A=p.shift(),g=A.pos,m=A.types,y=A.holes;P(g,r,y[0]||g.length,f),d=T(f[0],a,u,d);var v=_(f[1],d);if(v){var b=E(g,m,r,0,y[0]||g.length,d,v),w={pos:b[0].pos,types:b[0].types,holes:[]},S={pos:b[1].pos,types:b[1].types,holes:[]};p.push(w,S);for(var M=0;M<y.length;M++)(b=E(g,m,r,y[M],y[M+1]||g.length,d,v))[0]&&(w.holes.push(w.pos.length),w.pos=x(w.pos,b[0].pos),l&&(w.types=x(w.types,b[0].types))),b[1]&&(S.holes.push(S.pos.length),S.pos=x(S.pos,b[1].pos),l&&(S.types=x(S.types,b[1].types)))}else{var C={positions:g};l&&(C.edgeTypes=m),y.length&&(C.holeIndices=y),h.push(C)}}return h}function E(t,e,n,i,r,o,a){for(var s,u,c,l=(r-i)/n,h=[],p=[],f=[],d=[],A=[],_=y(t,l-1,n,i),b=Math.sign(8&a?_[1]-o[3]:_[0]-o[2]),x=e&&e[l-1],w=0,E=0,T=0;T<l;T++)s=y(t,T,n,i,s),u=Math.sign(8&a?s[1]-o[3]:s[0]-o[2]),c=e&&e[i/n+T],u&&b&&b!==u&&(v(_,s,a,o,A),g(h,A)&&f.push(x),g(p,A)&&d.push(x)),u<=0?(g(h,s)&&f.push(c),w-=u):f.length&&(f[f.length-1]=0),u>=0?(g(p,s)&&d.push(c),E+=u):d.length&&(d[d.length-1]=0),m(_,s),b=u,x=c;return[w?{pos:h,types:e&&f}:null,E?{pos:p,types:e&&d}:null]}function T(t,e,n,i){var r=Math.floor((t[0]-n[0])/e)*e+n[0],o=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=o,i[2]=r+e,i[3]=o+e,i}function S(t,e,n){8&n?(t[1]+=e,t[3]+=e):4&n?(t[1]-=e,t[3]-=e):2&n?(t[0]+=e,t[2]+=e):1&n&&(t[0]-=e,t[2]-=e)}function P(t,e,n,i){for(var r=1/0,o=-1/0,a=1/0,s=-1/0,u=0;u<n;u+=e){var c=t[u],l=t[u+1];r=c<r?c:r,o=c>o?c:o,a=l<a?l:a,s=l>s?l:s}return i[0][0]=r,i[0][1]=a,i[1][0]=o,i[1][1]=s,i}function M(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function I(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.size,i=void 0===n?2:n,r=e.startIndex,o=void 0===r?0:r,a=e.endIndex,s=void 0===a?t.length:a,u=e.normalize,c=void 0===u||u,l=t.slice(o,s);k(l,i,0,s-o);var h=b(l,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c){var p,f=M(h);try{for(f.s();!(p=f.n()).done;){var d=p.value;D(d,i)}}catch(t){f.e(t)}finally{f.f()}}return h}function O(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.size,r=void 0===i?2:i,o=n.normalize,a=void 0===o||o,s=n.edgeTypes,u=void 0!==s&&s;e=e||[];for(var c=[],l=[],h=0,p=0,f=0;f<=e.length;f++){for(var d=e[f]||t.length,A=p,g=L(t,r,h,d),m=g;m<d;m++)c[p++]=t[m];for(var y=h;y<g;y++)c[p++]=t[y];k(c,r,A,p),R(c,r,A,p,n.maxLatitude),h=d,l[f]=p}l.pop();var v=w(c,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:u});if(a){var _,b=M(v);try{for(b.s();!(_=b.n()).done;){var x=_.value;D(x.positions,r)}}catch(t){b.e(t)}finally{b.f()}}return v}function L(t,e,n,i){for(var r=-1,o=-1,a=n+1;a<i;a+=e){var s=Math.abs(t[a]);s>r&&(r=s,o=a-1)}return o}function R(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:85.051129,o=t[n],a=t[i-e];if(Math.abs(o-a)>180){var s=y(t,0,e,n);s[0]+=360*Math.round((a-o)/360),g(t,s),s[1]=Math.sign(s[1])*r,g(t,s),s[0]=o,g(t,s)}}function k(t,e,n,i){for(var r,o=t[0],a=n;a<i;a+=e){var s=(r=t[a])-o;(s>180||s<-180)&&(r-=360*Math.round(s/360)),t[a]=o=r}}function D(t,e){for(var n,i=t.length/e,r=0;r<i&&((n=t[r*e])+180)%360==0;r++);var o=360*-Math.round(n/360);if(0!==o)for(var a=0;a<i;a++)t[a*e]+=o}n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return w})),n.d(e,"d",(function(){return b})),n.d(e,"e",(function(){return I})),n.d(e,"c",(function(){return O}))},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var u,c=[],l=!1,h=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var t=s(p);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function A(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=A,r.addListener=A,r.once=A,r.off=A,r.removeListener=A,r.removeAllListeners=A,r.emit=A,r.prependListener=A,r.prependOnceListener=A,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(106),r=n(2);const o=["longitude","latitude","zoom","bearing","pitch"],a=["longitude","latitude","zoom"];class s extends i.a{constructor(t={}){super((Array.isArray(t)?t:t.transitionProps)||{compare:o,extract:o,required:a}),this.opts=t}initializeProps(t,e){const n=super.initializeProps(t,e),{makeViewport:i,around:r}=this.opts;if(i&&r){const o=i(t),a=i(e),s=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:a.project(s),aroundLngLat:s,width:e.width,height:e.height})}return n}interpolateProps(t,e,n){const i={};for(const o of this._propsToExtract)i[o]=Object(r.g)(t[o]||0,e[o]||0,n);if(e.aroundLngLat){const o=this.opts.makeViewport({...e,...i}),[a,s]=o.getMapCenterByLngLatPosition({lngLat:e.aroundLngLat,pos:Object(r.g)(t.around,e.around,n)});i.longitude=a,i.latitude=s}return i}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(0),r=n(15),o=n(33),a=n(27),s=n(77),u=n(99),c=n(13);const l=[9729,9728],h=r.global.WebGLBuffer||function(){};class p extends o.a{static isSupported(t,e={}){const{format:n,linearFiltering:i}=e;let r=!0;return n&&(r=r&&Object(s.d)(t,n),r=r&&(!i||Object(s.e)(t,n))),r}constructor(t,e){const{id:n=Object(u.c)("texture"),handle:i,target:r}=e;super(t,{id:n,handle:i}),this.target=r,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(t={}){let e=t.data;if(e instanceof Promise)return e.then(e=>this.initialize(Object.assign({},t,{pixels:e,data:e}))),this;const n="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:r=null,format:o=6408,border:a=0,recreate:s=!1,parameters:u={},pixelStore:c={},textureUnit:l}=t;e||(e=r);let{width:h,height:p,dataFormat:f,type:d,compressed:A=!1,mipmaps:g=!0}=t;const{depth:m=0}=t;return({width:h,height:p,compressed:A,dataFormat:f,type:d}=this._deduceParameters({format:o,type:d,dataFormat:f,compressed:A,data:e,width:h,height:p})),this.width=h,this.height=p,this.depth=m,this.format=o,this.type=d,this.dataFormat=f,this.border=a,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),g&&this._isNPOT()&&(i.k.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),g=!1,this._updateForNPOT(u)),this.mipmaps=g,this.setImageData({data:e,width:h,height:p,depth:m,format:o,type:d,dataFormat:f,border:a,mipmaps:g,parameters:c,compressed:A}),g&&this.generateMipmap(),this.setParameters(u),s&&(this.data=e),n&&(this._video={video:e,parameters:u,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize({height:t,width:e,mipmaps:n=!1}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(t={}){return this._isNPOT()?(i.k.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(i.o)(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:r=0,format:o=this.format,border:a=this.border,offset:u=0,parameters:l={}}=t;let{data:h=null,type:p=this.type,width:f=this.width,height:d=this.height,dataFormat:A=this.dataFormat,compressed:g=!1}=t;h||(h=n),({type:p,dataFormat:A,compressed:g,width:f,height:d}=this._deduceParameters({format:o,type:p,dataFormat:A,compressed:g,data:h,width:f,height:d}));const{gl:m}=this;m.bindTexture(this.target,this.handle);let y,v=null;if(({data:h,dataType:v}=this._getDataType({data:h,compressed:g})),Object(i.o)(this.gl,l,()=>{switch(v){case"null":m.texImage2D(e,r,o,f,d,a,A,p,h);break;case"typed-array":m.texImage2D(e,r,o,f,d,a,A,p,h,u);break;case"buffer":y=Object(i.a)(m),y.bindBuffer(35052,h.handle||h),y.texImage2D(e,r,o,f,d,a,A,p,u),y.bindBuffer(35052,null);break;case"browser-object":Object(i.j)(m)?m.texImage2D(e,r,o,f,d,a,A,p,h):m.texImage2D(e,r,o,A,p,h);break;case"compressed":for(const[t,n]of h.entries())m.compressedTexImage2D(e,t,n.format,n.width,n.height,a,n.data);break;default:Object(c.a)(!1,"Unknown image data type")}}),h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const t=s.a[this.dataFormat]||4,e=s.c[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:e=null,data:n=null,x:r=0,y:o=0,width:s=this.width,height:u=this.height,level:l=0,format:p=this.format,type:f=this.type,dataFormat:d=this.dataFormat,compressed:A=!1,offset:g=0,border:m=this.border,parameters:y={}}){if(({type:f,dataFormat:d,compressed:A,width:s,height:u}=this._deduceParameters({format:p,type:f,dataFormat:d,compressed:A,data:n,width:s,height:u})),Object(c.a)(0===this.depth,"texSubImage not supported for 3D textures"),n||(n=e),n&&n.data){const t=n;n=t.data,s=t.shape[0],u=t.shape[1]}n instanceof a.a&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Object(i.o)(this.gl,y,()=>{if(A)this.gl.compressedTexSubImage2D(t,l,r,o,s,u,p,n);else if(null===n)this.gl.texSubImage2D(t,l,r,o,s,u,d,f,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,l,r,o,s,u,d,f,n,g);else if(n instanceof h){const e=Object(i.a)(this.gl);e.bindBuffer(35052,n),e.texSubImage2D(t,l,r,o,s,u,d,f,g),e.bindBuffer(35052,null)}else if(Object(i.j)(this.gl)){Object(i.a)(this.gl).texSubImage2D(t,l,r,o,s,u,d,f,n)}else this.gl.texSubImage2D(t,l,r,o,d,f,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return i.k.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType({data:t,compressed:e=!1}){return e?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof a.a?{data:t.handle,dataType:"buffer"}:t instanceof h?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:i,height:r,dataFormat:o,type:a,compressed:u}=t;const c=s.b[e];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],u=u||c&&c.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:o,type:a,compressed:u,width:i,height:r,format:e,data:n}}_deduceImageSize(t,e,n){let i;return i="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement?{width:t.width,height:t.height}:"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},Object(c.a)(i,"Could not deduced texture size"),Object(c.a)(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),Object(c.a)(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Object(c.a)(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!Object(i.j)(this.gl)&&(!(!this.width||!this.height)&&(!Object(u.b)(this.width)||!Object(u.b)(this.height)))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:-1===l.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}},function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"i",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"h",(function(){return c})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return h})),n.d(e,"c",(function(){return p}));var i=n(1);function r(){var t=new i.a(9);return i.a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function o(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function a(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=l*a-s*c,p=-l*o+s*u,f=c*o-a*u,d=n*h+i*p+r*f;return d?(d=1/d,t[0]=h*d,t[1]=(-l*i+r*c)*d,t[2]=(s*i-r*a)*d,t[3]=p*d,t[4]=(l*n-r*u)*d,t[5]=(-s*n+r*o)*d,t[6]=f*d,t[7]=(-c*n+i*u)*d,t[8]=(a*n-i*o)*d,t):null}function s(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*o-a*u)+n*(-c*r+a*s)+i*(u*r-o*s)}function u(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=n[0],f=n[1],d=n[2],A=n[3],g=n[4],m=n[5],y=n[6],v=n[7],_=n[8];return t[0]=p*i+f*a+d*c,t[1]=p*r+f*s+d*l,t[2]=p*o+f*u+d*h,t[3]=A*i+g*a+m*c,t[4]=A*r+g*s+m*l,t[5]=A*o+g*u+m*h,t[6]=y*i+v*a+_*c,t[7]=y*r+v*s+_*l,t[8]=y*o+v*u+_*h,t}function c(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=n[0],f=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=p*i+f*a+c,t[7]=p*r+f*s+l,t[8]=p*o+f*u+h,t}function l(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=Math.sin(n),f=Math.cos(n);return t[0]=f*i+p*a,t[1]=f*r+p*s,t[2]=f*o+p*u,t[3]=f*a-p*i,t[4]=f*s-p*r,t[5]=f*u-p*o,t[6]=c,t[7]=l,t[8]=h,t}function h(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function p(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,u=r+r,c=n*a,l=i*a,h=i*s,p=r*a,f=r*s,d=r*u,A=o*a,g=o*s,m=o*u;return t[0]=1-h-d,t[3]=l-m,t[6]=p+g,t[1]=l+m,t[4]=1-c-d,t[7]=f-A,t[2]=p-g,t[5]=f+A,t[8]=1-c-h,t}},function(t,e,n){"use strict";n.r(e);var i=n(219),r=n(5),o=n(108),a=n(207),s=n(224),u=n(170),c=n(58),l=n(16),h=n(2);const p=new Uint16Array([0,2,1,0,3,2]),f=new Float32Array([0,1,0,0,1,0,1,1]);function d(t,e){if(!e)return function(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[3*n+0]=t[n][0],e[3*n+1]=t[n][1],e[3*n+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:p,texCoords:f}}(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,o=Math.ceil(i/e)+1,a=(r-1)*(o-1)*6,s=new Uint32Array(a),u=new Float32Array(r*o*2),c=new Float64Array(r*o*3);let l=0,h=0;for(let e=0;e<r;e++){const n=e/(r-1);for(let i=0;i<o;i++){const r=i/(o-1),a=A(t,n,r);c[3*l+0]=a[0],c[3*l+1]=a[1],c[3*l+2]=a[2]||0,u[2*l+0]=n,u[2*l+1]=1-r,e>0&&i>0&&(s[h++]=l-o,s[h++]=l-o-1,s[h++]=l-1,s[h++]=l-o,s[h++]=l-1,s[h++]=l),l++}}return{vertexCount:a,positions:c,indices:s,texCoords:u}}function A(t,e,n){return Object(h.g)(Object(h.g)(t[0],t[1],n),Object(h.g)(t[3],t[2],n),e)}var g="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n");const m={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:r.a.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class y extends o.a{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:g,modules:[a.a,s.a]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);t.add({indices:{size:1,isIndexed:!0,update:t=>t.value=this.state.mesh.indices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:t=>t.value=this.state.mesh.positions,noAlloc:!0},texCoords:{size:2,update:t=>t.value=this.state.mesh.texCoords,noAlloc:!0}})}updateState({props:t,oldProps:e,changeFlags:n}){if(n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}const r=this.getAttributeManager();if(t.bounds!==e.bounds){const t=this.state.mesh,e=this._createMesh();this.state.model.setVertexCount(e.vertexCount);for(const n in e)t&&t[n]!==e[n]&&r.invalidate(n);this.setState({mesh:e,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==e._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo({info:t}){const{image:e}=this.props;if(!t.color||!e)return t.bitmap=null,t;const{width:n,height:i}=e;t.index=0;const r=function(t){const[e,n,i]=t;return[(e+(15&i)/16)/256,(n+(240&i)/256)/256]}(t.color),o=[Math.floor(r[0]*n),Math.floor(r[1]*i)];return t.bitmap={size:{width:n,height:i},uv:r,pixel:o},t}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let e=t;return Number.isFinite(t[0])&&(e=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),d(e,this.context.viewport.resolution)}_getModel(t){return t?new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new c.a({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(t){const{uniforms:e,moduleParameters:n}=t,{model:i,coordinateConversion:r,bounds:o,disablePicking:a}=this.state,{image:s,desaturate:u,transparentColor:c,tintColor:l}=this.props;n.pickingActive&&a||s&&i&&i.setUniforms(e).setUniforms({bitmapTexture:s,desaturate:u,transparentColor:c.map(t=>t/255),tintColor:l.slice(0,3).map(t=>t/255),coordinateConversion:r,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:e,DEFAULT:n}=r.a;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:n}=this.props;if(!Number.isFinite(n[0]))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const r=this.context.viewport.resolution?t:e;if(i=i===t?t:e,i===t&&r===e)return{coordinateConversion:-1,bounds:n};if(i===e&&r===t){const t=Object(l.j)([n[0],n[1]]),e=Object(l.j)([n[2],n[3]]);return{coordinateConversion:1,bounds:[t[0],t[1],e[0],e[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}y.layerName="BitmapLayer",y.defaultProps=m;var v=n(6),_=n(227),b=n(196),x=n(116),w=n(281),E=n(206),T=n(45);const S=()=>{},P={10241:9987,10240:9729,10242:33071,10243:33071};function M(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function C(t){return t&&(t.id||t.url)}function I(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:o}=e[i];t[C(r)]={...r,x:o,y:n}}}class O{constructor(t,{onUpdate:e=S,onError:n=S}){this.gl=t,this.onUpdate=e,this.onError=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}finalize(){var t;null===(t=this._texture)||void 0===t||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?C(t):t;return this._mapping[e]||{}}setProps({loadOptions:t,autoPacking:e,iconAtlas:n,iconMapping:i,data:r,getIcon:o}){t&&(this._loadOptions=t),void 0!==e&&(this._autoPacking=e),o&&(this._getIcon=o),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(r||o)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(t){var e;null===(e=this._texture)||void 0===e||e.delete(),this._texture=null,this._externalTexture=t,this.onUpdate()}_updateAutoPacking(t){const e=Object.values(function(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:o}=Object(T.a)(t);for(const t of r){o.index++;const r=e(t,o),a=C(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[a]||n[a]&&r.url===n[a].url||(i[a]={...r,source:t,sourceIndex:o.index})}return i}(t,this._getIcon,this._mapping)||{});if(e.length>0){const{mapping:t,xOffset:n,yOffset:i,rowHeight:r,canvasHeight:o}=function({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:o=0,canvasWidth:a}){let s=[];for(let u=0;u<t.length;u++){const c=t[u];if(!n[C(c)]){const{height:t,width:u}=c;i+u+e>a&&(I(n,s,r),i=0,r=o+r+e,o=0,s=[]),s.push({icon:c,xOffset:i}),i=i+u+e,o=Math.max(o,t)}}return s.length>0&&I(n,s,r),{mapping:n,rowHeight:o,xOffset:i,yOffset:r,canvasWidth:a,canvasHeight:(u=o+r+e,Math.pow(2,Math.ceil(Math.log2(u))))};var u}({icons:e,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=t,this._xOffset=n,this._yOffset=i,this._canvasHeight=o,this._texture||(this._texture=new x.a(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:P})),this._texture.height!==this._canvasHeight&&(this._texture=function(t,e,n,i){const r=e.width,o=e.height,a=Object(_.a)(e,{width:n,height:i});return Object(b.b)(e,a,{targetY:0,width:r,height:o}),e.delete(),a}(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(e)}}_loadIcons(t){const e=this._canvas.getContext("2d");for(const n of t)this._pendingCount++,Object(E.a)(n.url,w.a,this._loadOptions).then(t=>{const i=C(n),{x:r,y:o,width:a,height:s}=this._mapping[i],u=M(e,t,a,s);this._texture.setSubImageData({data:u,x:r,y:o,width:a,height:s}),this._texture.generateMipmap(),this.onUpdate()}).catch(t=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:t})}).finally(()=>{this._pendingCount--})}}const L=[0,0,0,255],R={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:L},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class k extends o.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[a.a,s.a]})}initializeState(){this.state={iconManager:new O(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:L},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:t,props:e,changeFlags:n}){super.updateState({props:e,oldProps:t,changeFlags:n});const i=this.getAttributeManager(),{iconAtlas:r,iconMapping:o,data:a,getIcon:s}=e,{iconManager:u}=this.state;u.setProps({loadOptions:e.loadOptions});let c=!1;if(r||this.internalState.isAsyncPropLoading("iconAtlas")?(t.iconAtlas!==e.iconAtlas&&u.setProps({iconAtlas:r,autoPacking:!1}),t.iconMapping!==e.iconMapping&&(u.setProps({iconMapping:o}),c=!0)):u.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&u.setProps({data:a,getIcon:s}),c&&(i.invalidate("instanceOffsets"),i.invalidate("instanceIconFrames"),i.invalidate("instanceColorModes")),n.extensionsChanged){var l;const{gl:t}=this.context;null===(l=this.state.model)||void 0===l||l.delete(),this.state.model=this._getModel(t),i.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:o,alphaCutoff:a}=this.props,{iconManager:s}=this.state,{viewport:u}=this.context,c=s.getTexture();c&&this.state.model.setUniforms(t).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeScale:e*("pixels"===r?u.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:i,billboard:o,alphaCutoff:a}).draw()}_getModel(t){return new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new c.a({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const{onIconError:e}=this.getCurrentLayer().props;e?e(t):v.a.error(t.error)()}getInstanceOffset(t){const e=this.state.iconManager.getIconMapping(t);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const e=this.state.iconManager.getIconMapping(t);return[e.x||0,e.y||0,e.width||0,e.height||0]}}k.layerName="IconLayer",k.defaultProps=R;var D=n(220),B=n(221),F=n(155),z=n(154),N=n(213),j=n(92),U=n(214),V=n(222),G=n(188);const W=[];class H extends k{getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:e,target:n})=>this.encodePickingColor(e,n)}})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;let{outlineColor:i}=e;i!==n.outlineColor&&(i=i.map(t=>t/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!e.sdf&&e.outlineWidth&&v.a.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(t){const{sdf:e,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state;t.uniforms={...t.uniforms,buffer:.75,outlineBuffer:i?Math.max(n,.75*(1-i)):-1,gamma:n,sdf:Boolean(e),outlineColor:r},super.draw(t)}getInstanceOffset(t){return t?Array.from(t).map(t=>super.getInstanceOffset(t)):W}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).map(t=>super.getInstanceIconFrame(t)):W}}H.layerName="MultiIconLayer",H.defaultProps={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};var q=n(232),X=n.n(q);const Z=[];function Q(t,e,n,i){let r=0;for(let o=e;o<n;o++){const e=t[o];let n=null;const a=i&&i[e];a&&(n=a.width),r+=n}return r}function Y(t,e,n,i,r,o){let a=e,s=0;for(let u=e;u<n;u++){const e=Q(t,u,u+1,r);s+e>i&&(a<u&&o.push(u),a=u,s=0),s+=e}return s}function K(t,e,n,i,r=0,o){void 0===o&&(o=t.length);const a=[];return"break-all"===e?Y(t,r,o,n,i,a):function(t,e,n,i,r,o){let a=e,s=e,u=e,c=0;for(let l=e;l<n;l++)if(" "===t[l]?u=l+1:" "!==t[l+1]&&l+1!==n||(u=l+1),u>s){let e=Q(t,s,u,r);c+e>i&&(a<s&&(o.push(s),a=s,c=0),e>i&&(e=Y(t,s,u,i,r,o),a=o[o.length-1])),s=u,c+=e}}(t,r,o,n,i,a),a}function J(t,e,n,i,r,o){let a=0,s=0;for(let o=e;o<n;o++){const e=t[o],n=i[e];n?(s||(s=n.height),r[o]=a+n.width/2,a+=n.width):(v.a.warn("Missing character: ".concat(e," (").concat(e.codePointAt(0),")"))(),r[o]=a,a+=32)}o[0]=a,o[1]=s}function $(t,e,n,i,r){const o=(t=Array.from(t)).length,a=new Array(o),s=new Array(o),u=new Array(o),c=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,l=[0,0],h=[];let p=0,f=0,d=0;for(let A=0;A<=o;A++){const g=t[A];if("\n"!==g&&A!==o||(d=A),d>f){const o=c?K(t,n,i,r,f,d):Z;for(let n=0;n<=o.length;n++){const i=0===n?f:o[n-1],c=n<o.length?o[n]:d;J(t,i,c,r,a,h);for(let t=i;t<c;t++)s[t]=p+h[1]/2,u[t]=h[0];p+=h[1]*e,l[0]=Math.max(l[0],h[0])}f=d}"\n"===g&&(a[f]=0,s[f]=0,u[f]=0,f++)}return l[1]=p,{x:a,y:s,rowWidth:u,size:l}}const tt=function(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}(),et=new class{constructor(t=5){this.limit=t,this.clear()}clear(){this._cache={},this._order=[]}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(this._deleteCache(t),this._deleteOrder(t))}_deleteCache(t){delete this._cache[t]}_deleteOrder(t){const e=this._order.findIndex(e=>e===t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}(3),nt=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function it(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function rt(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="baseline",t.textAlign="left"}class ot{constructor(){this.props={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:tt,fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return 1.2}setProps(t={}){nt.forEach(e=>{e in t&&(this.props[e]=t[e])});const e=this._key;this._key=this._getKey();const n=function(t,e){const n=et.get(t);if(!n)return e;const i=[],r=n.mapping;let o=Object.keys(r);o=new Set(o);let a=e;return a instanceof Array&&(a=new Set(a)),a.forEach(t=>{o.has(t)||i.push(t)}),i}(this._key,this.props.characterSet),i=et.get(this._key);if(i&&0===n.length)return void(this._key!==e&&(this._atlas=i));const r=this._generateFontAtlas(this._key,n,i);this._atlas=r,et.set(this._key,r)}_generateFontAtlas(t,e,n){const{fontFamily:i,fontWeight:r,fontSize:o,buffer:a,sdf:s,radius:u,cutoff:c}=this.props;let l=n&&n.data;l||(l=document.createElement("canvas"),l.width=1024);const h=l.getContext("2d");rt(h,i,o,r);const{mapping:p,canvasHeight:f,xOffset:d,yOffset:A}=function({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:o={},xOffset:a=0,yOffset:s=0}){let u=0,c=a,l=0;for(const a of t)if(!o[a]){const t=e(a,l++);c+t+2*i>r&&(c=0,u++),o[a]={x:c+i,y:s+u*(n+2*i)+i,width:t,height:n},c+=t+2*i}const h=n+2*i;return{mapping:o,xOffset:c,yOffset:s+u*h,canvasHeight:(p=s+(u+1)*h,Math.pow(2,Math.ceil(Math.log2(p))))};var p}({getFontWidth:t=>h.measureText(t).width,fontHeight:1.2*o,buffer:a,characterSet:e,maxCanvasWidth:1024,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(l.height!==f){const t=h.getImageData(0,0,l.width,l.height);l.height=f,h.putImageData(t,0,0)}if(rt(h,i,o,r),s){const t=new X.a(o,a,u,c,i,r),n=h.getImageData(0,0,t.size,t.size);for(const i of e)it(t.draw(i),n),h.putImageData(n,p[i].x-a,p[i].y+a)}else for(const t of e)h.fillText(t,p[t].x,p[t].y+.9*o);return{xOffset:d,yOffset:A,mapping:p,data:l,width:l.width,height:l.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:n,buffer:i,sdf:r,radius:o,cutoff:a}=this.props;return r?"".concat(t," ").concat(e," ").concat(n," ").concat(i," ").concat(o," ").concat(a):"".concat(t," ").concat(e," ").concat(n," ").concat(i)}}const at={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class st extends o.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec2 padding;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + padding * (positions * 2.0 - 1.0);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[a.a,s.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:o,sizeMaxPixels:a,padding:s,getLineWidth:u}=this.props,c="pixels"===r?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({billboard:n,stroked:Boolean(u),padding:s,sizeScale:i*c,sizeMinPixels:o,sizeMaxPixels:a}).draw()}_getModel(t){return new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new c.a({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}st.layerName="TextBackgroundLayer",st.defaultProps=at;const ut={fontSize:64,buffer:4,sdf:!1,radius:12,cutoff:.25,smoothing:.1},ct={start:1,middle:0,end:-1},lt={top:1,center:0,bottom:-1},ht=[0,0,0,255],pt=["fontSize","buffer","sdf","radius","cutoff"],ft={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ht},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0]},characterSet:tt,fontFamily:"Monaco, monospace",fontWeight:"normal",lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ht},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:ht},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class dt extends G.a{initializeState(){this.state={styleVersion:0,fontAtlasManager:new ot}}updateState({props:t,oldProps:e,changeFlags:n}){const i=this._fontChanged(e,t);i&&this._updateFontAtlas(e,t);const r=i||t.lineHeight!==e.lineHeight||t.wordBreak!==e.wordBreak||t.maxWidth!==e.maxWidth;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),r&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(t,e){const{characterSet:n,fontSettings:i,fontFamily:r,fontWeight:o}=e,{fontAtlasManager:a}=this.state;a.setProps({...ut,...i,characterSet:n,fontFamily:r,fontWeight:o}),this.setNeedsRedraw(!0)}_fontChanged(t,e){if(t.fontFamily!==e.fontFamily||t.characterSet!==e.characterSet||t.fontWeight!==e.fontWeight)return!0;if(t.fontSettings===e.fontSettings)return!1;const n=t.fontSettings||{},i=e.fontSettings||{};return pt.some(t=>n[t]!==i[t])}_updateText(){const{data:t}=this.props,e=t.attributes&&t.attributes.getText;let n,{getText:i}=this.props,{startIndices:r}=t;if(e&&r){const{texts:o,characterCount:a}=function({value:t,length:e,stride:n,offset:i,startIndices:r}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,s=i?i/o:0,u=r[e]||Math.floor((t.length-s-o)/a)+1,c=new Array(e);let l=t;if(a>1||s>0){l=new t.constructor(u);for(let e=0;e<u;e++)l[e]=t[e*a+s]}for(let t=0;t<e;t++){const e=r[t],n=r[t+1]||u;c[t]=String.fromCodePoint.apply(null,l.subarray(e,n))}return{texts:c,characterCount:u}}({...ArrayBuffer.isView(e)?{value:e}:e,length:t.length,startIndices:r});n=a,i=(t,{index:e})=>o[e]}else{const{iterable:e,objectInfo:o}=Object(T.a)(t);r=[0],n=0;for(const t of e){o.index++;const e=i(t,o)||"";n+=Array.from(e).length,r.push(n)}}this.setState({getText:i,startIndices:r,numInstances:n})}getBoundingRect(t,e){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:o,lineHeight:a,getTextAnchor:s,getAlignmentBaseline:u}=this.props,c=i(t,e)||"",{size:[l,h]}=$(c,a,r,o,n);return[(ct["function"==typeof s?s(t,e):s]-1)*l/2,(lt["function"==typeof u?u(t,e):u]-1)*h/2,l,h]}getIconOffsets(t,e){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:o,lineHeight:a,getTextAnchor:s,getAlignmentBaseline:u}=this.props,c=i(t,e)||"",{x:l,y:h,rowWidth:p,size:[f,d]}=$(c,a,r,o,n),A=ct["function"==typeof s?s(t,e):s],g=lt["function"==typeof u?u(t,e):u],m=l.length,y=new Array(2*m);let v=0;for(let t=0;t<m;t++){const e=(1-A)*(f-p[t])/2;y[v++]=(A-1)*f/2+e+l[t],y[v++]=(g-1)*d/2+h[t]}return y}renderLayers(){const{startIndices:t,numInstances:e,getText:n,fontAtlasManager:{scale:i,texture:r,mapping:o},styleVersion:a}=this.state,{data:s,_dataDiff:u,getPosition:c,getColor:l,getSize:h,getAngle:p,getPixelOffset:f,getBackgroundColor:d,getBorderColor:A,getBorderWidth:g,backgroundPadding:m,background:y,billboard:v,fontSettings:_,outlineWidth:b,outlineColor:x,sizeScale:w,sizeUnits:E,sizeMinPixels:T,sizeMaxPixels:S,transitions:P,updateTriggers:M}=this.props,C=this.getSubLayerClass("characters",H),I=this.getSubLayerClass("background",st);return[y&&new I({getFillColor:d,getLineColor:A,getLineWidth:g,padding:m,getPosition:c,getSize:h,getAngle:p,getPixelOffset:f,billboard:v,sizeScale:w/this.state.fontAtlasManager.props.fontSize,sizeUnits:E,sizeMinPixels:T,sizeMaxPixels:S,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getSize:P.getSize,getFillColor:P.getBackgroundColor,getLineColor:P.getBorderColor,getLineWidth:P.getBorderWidth,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:M.getPosition,getAngle:M.getAngle,getSize:M.getSize,getFillColor:M.getBackgroundColor,getLineColor:M.getBorderColor,getLineWidth:M.getBorderWidth,getPixelOffset:M.getPixelOffset,getBoundingRect:{getText:M.getText,getTextAnchor:M.getTextAnchor,getAlignmentBaseline:M.getAlignmentBaseline,styleVersion:a}}}),{data:s.attributes?{length:s.length,attributes:s.attributes.background||{}}:s,_dataDiff:u,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new C({sdf:_.sdf,smoothing:Number.isFinite(_.smoothing)?_.smoothing:ut.smoothing,outlineWidth:b,outlineColor:x,iconAtlas:r,iconMapping:o,getPosition:c,getColor:l,getSize:h,getAngle:p,getPixelOffset:f,billboard:v,sizeScale:w*i,sizeUnits:E,sizeMinPixels:T*i,sizeMaxPixels:S*i,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getColor:P.getColor,getSize:P.getSize,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:M.getText,getPosition:M.getPosition,getAngle:M.getAngle,getColor:M.getColor,getSize:M.getSize,getPixelOffset:M.getPixelOffset,getIconOffsets:{getText:M.getText,getTextAnchor:M.getTextAnchor,getAlignmentBaseline:M.getAlignmentBaseline,styleVersion:a}}}),{data:s,_dataDiff:u,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets.bind(this),getIcon:n})]}}dt.layerName="TextLayer",dt.defaultProps=ft;var At=n(109),gt=n(90);n.d(e,"ArcLayer",(function(){return i.a})),n.d(e,"BitmapLayer",(function(){return y})),n.d(e,"IconLayer",(function(){return k})),n.d(e,"LineLayer",(function(){return D.a})),n.d(e,"PointCloudLayer",(function(){return B.a})),n.d(e,"ScatterplotLayer",(function(){return F.a})),n.d(e,"ColumnLayer",(function(){return z.a})),n.d(e,"GridCellLayer",(function(){return N.a})),n.d(e,"PathLayer",(function(){return j.a})),n.d(e,"PolygonLayer",(function(){return U.a})),n.d(e,"GeoJsonLayer",(function(){return V.a})),n.d(e,"TextLayer",(function(){return dt})),n.d(e,"SolidPolygonLayer",(function(){return At.a})),n.d(e,"_MultiIconLayer",(function(){return H})),n.d(e,"_TextBackgroundLayer",(function(){return st})),n.d(e,"_binaryToFeature",(function(){return gt.a})),n.d(e,"_findIndexBinary",(function(){return gt.d}))},function(t,e,n){"use strict";n.r(e);var i=n(94),r=n(101),o=n(79),a=n(193),s=n(65);const u={dataType:"arraybuffer",nothrow:!0};function c(t,e){return e=function(t={}){return(t=Object.assign({},u,t)).responseType=t.responseType||t.dataType,t}(e),t.startsWith("data:"),e.nothrow||Object(s.a)(!1),null}function l(t,e={}){return t=Object(r.b)(t),!o.c&&a.readFileSync?a.readFileSync(t,e):c(t,e)}var h=n(142);function p(t,e,n){return t=Object(r.b)(t),!o.c&&h.writeFile?h.writeFile(t,e,n):Object(s.a)(!1)}function f(t,e,n){return t=Object(r.b)(t),!o.c&&h.writeFileSync?h.writeFileSync(t,e,n):Object(s.a)(!1)}var d=n(36);function A(t){Object(d.d)(t)}var g=n(103),m=n(107),y=n(74),v=n(42),_=n(85),b=n(84),x=n(59);function w(t,e,n,i){Object(s.a)(!i||"string"!=typeof i,"parseSync no longer accepts final url"),Array.isArray(e)||Object(v.a)(e)||(i=n,n=e,e=null),n=n||{};const r=Object(b.b)(e,i),o=Object(y.b)(t,r,n);if(!o)return null;n=Object(d.c)(n,o,r);const{url:a}=Object(x.b)(t);return function(t,e,n,i){if(e=Object(_.b)(e,t),t.parseTextSync&&"string"==typeof e)return t.parseTextSync(e,n,i,t);if(t.parseSync)return t.parseSync(e,n,i,t);throw new Error("".concat(t.name," loader: 'parseSync' not supported by this loader, use 'parse' instead. ").concat(i.url||""))}(o,t,n,i=Object(b.a)({url:a,parseSync:w,loaders:e},n))}var E=n(150),T=n(210);async function S(t,e,n,i){Object(s.a)(!i||"string"!=typeof i,"parseInBatches no longer accepts final url"),Array.isArray(e)||Object(v.a)(e)||(i=n,n=e,e=null),t=await t,n=n||{};const{url:r}=Object(x.b)(t),o=await Object(y.a)(t,e,n);return o?(n=Object(d.c)(n,o,e,r),i=Object(b.a)({url:r,parseInBatches:S,parse:m.a,loaders:e},n,i),await async function(t,e,n,i){const r=await async function(t,e,n,i){if(t.parseInBatches){const r=function(t,e){let n=t;for(const t of e.transforms||[])n=Object(T.a)(n,t,e);return n}(await Object(_.c)(e),n);return await t.parseInBatches(r,n,i,t)}if(t.parseStreamInBatches){const r=await Object(_.d)(e);if(r)return n.transforms&&console.warn("options.transforms not implemented for loaders that use `parseStreamInBatches`"),t.parseStreamInBatches(r,n,i)}return await async function*(){const r=await Object(_.c)(e),o=await Object(E.a)(r);yield t.parse(o,n,i,t)}()}(t,e,n,i);if(!n.metadata)return r;const o={batchType:"metadata",metadata:{_loader:t,_context:i},data:[],bytesUsed:0};return async function*(t){yield o,yield*t}(r)}(o,t,n,i)):null}var P=n(206);function M(t,e,n){Array.isArray(e)||Object(v.a)(e)||(n=e,e=null);const i=Object(d.a)(n||{});return Array.isArray(t)?t.map(t=>C(t,e,n,i)):C(t,e,n,i)}async function C(t,e,n,i){if("string"==typeof t){const r=t,o=await i(r);return await S(o,e,n)}return await S(t,e,n)}var I=n(62);function O(t){return"/tmp/".concat(t)}async function L(t,e,n,r){if(e.encode)return await e.encode(t,n);if(e.encodeSync)return e.encodeSync(t,n);if(e.encodeText)return(new TextEncoder).encode(await e.encodeText(t,n));if(e.encodeInBatches){const i=D(t,e,n),r=[];for await(const t of i)r.push(t);return await Object(I.b)(...r)}if(!o.c&&e.encodeURLtoURL){const r=O("input");await p(r,t);const o=O("output"),a=await B(r,o,e,n);return(await Object(i.a)(a)).arrayBuffer()}throw new Error("Writer could not encode data")}function R(t,e,n,i){if(e.encodeSync)return e.encodeSync(t,n);throw new Error("Writer could not synchronously encode data")}async function k(t,e,n,i){if(e.text&&e.encodeText)return await e.encodeText(t,n);if(e.text&&(e.encode||e.encodeInBatches)){const i=await L(t,e,n);return(new TextDecoder).decode(i)}throw new Error("Writer could not encode data as text")}function D(t,e,n,i){if(e.encodeInBatches){const i=function(t){return[{table:t,start:0,end:t.length}]}(t);return e.encodeInBatches(i,n)}throw new Error("Writer could not encode data in batches")}async function B(t,e,n,i){if(t=Object(r.b)(t),e=Object(r.b)(e),o.c||!n.encodeURLtoURL)throw new Error;return await n.encodeURLtoURL(t,e,i)}function F(t,e,n,i){return p(e,L(t,n,i))}function z(t,e,n,i){return f(e,R(t,n,i))}var N=n(114),j=n(183),U=n(211),V=n(212);async function G(t,e,n=(()=>{}),i=(()=>{})){if(!(t=await t).ok)return t;const r=t.body;if(!r)return t;const o=t.headers.get("content-length"),a=o&&parseInt(o,10);if(!(o>0))return t;if("undefined"==typeof ReadableStream||!r.getReader)return t;const s=new ReadableStream({start(t){!async function t(e,n,i,r,o,a,s){try{const{done:u,value:c}=await n.read();if(u)return a(),void e.close();i+=c.byteLength;const l=Math.round(i/r*100);o(l,{loadedBytes:i,totalBytes:r}),e.enqueue(c),await t(e,n,i,r,o,a,s)}catch(t){e.error(t),s(t)}}(t,r.getReader(),0,a,e,n,i)}});return new Response(s)}class W{constructor(t,e={}){this._fetch=e.fetch||fetch,this.files={};for(let e=0;e<t.length;++e){const n=t[e];this.files[n.name]=n}this.fetch=this.fetch.bind(this)}async fetch(t,e={}){if(t.includes("://")){return(e.fetch||this._fetch)(t,e)}if(this.files[t]){const e=new Response(this.files[t]);return Object.defineProperty(e,"url",{value:t}),e}return new Response(t,{status:400,statusText:"NOT FOUND"})}async readdir(){const t=[];for(const e in this.files)t.push(e);return t}async stat(t,e){const n=this.files[t];if(!n)throw new Error("No such file: ".concat(t));return{size:n.size}}async unlink(t){delete this.files[t]}async open(t){return this.files[t]}async read(t,{buffer:e=null,offset:n=0,length:i=e.byteLength,position:r=null}){const o=t;return await async function(t,e,n){const i=t.slice(e,n);return await new Promise((t,e)=>{const n=new FileReader;n.onload=e=>t(e.target&&e.target.result),n.onerror=t=>e(t),n.readAsArrayBuffer(i)})}(o,r,r+i)}async close(t){}}var H=n(125),q=n(10);n.d(e,"fetchFile",(function(){return i.a})),n.d(e,"readFileSync",(function(){return l})),n.d(e,"writeFile",(function(){return p})),n.d(e,"writeFileSync",(function(){return f})),n.d(e,"setLoaderOptions",(function(){return A})),n.d(e,"registerLoaders",(function(){return g.c})),n.d(e,"parse",(function(){return m.a})),n.d(e,"parseSync",(function(){return w})),n.d(e,"parseInBatches",(function(){return S})),n.d(e,"selectLoader",(function(){return y.a})),n.d(e,"selectLoaderSync",(function(){return y.b})),n.d(e,"load",(function(){return P.a})),n.d(e,"loadInBatches",(function(){return M})),n.d(e,"encode",(function(){return L})),n.d(e,"encodeSync",(function(){return R})),n.d(e,"encodeInBatches",(function(){return D})),n.d(e,"encodeText",(function(){return k})),n.d(e,"encodeURLtoURL",(function(){return B})),n.d(e,"save",(function(){return F})),n.d(e,"saveSync",(function(){return z})),n.d(e,"makeIterator",(function(){return N.a})),n.d(e,"NullWorkerLoader",(function(){return j.b})),n.d(e,"NullLoader",(function(){return j.a})),n.d(e,"JSONLoader",(function(){return U.a})),n.d(e,"setPathPrefix",(function(){return r.c})),n.d(e,"getPathPrefix",(function(){return r.a})),n.d(e,"resolvePath",(function(){return r.b})),n.d(e,"RequestScheduler",(function(){return V.a})),n.d(e,"_fetchProgress",(function(){return G})),n.d(e,"_BrowserFileSystem",(function(){return W})),n.d(e,"_unregisterLoaders",(function(){return g.a})),n.d(e,"isBrowser",(function(){return o.c})),n.d(e,"isWorker",(function(){return o.d})),n.d(e,"self",(function(){return o.f})),n.d(e,"window",(function(){return o.g})),n.d(e,"global",(function(){return o.b})),n.d(e,"document",(function(){return o.a})),n.d(e,"assert",(function(){return s.a})),n.d(e,"forEach",(function(){return E.b})),n.d(e,"concatenateChunksAsync",(function(){return E.a})),n.d(e,"makeTextDecoderIterator",(function(){return H.c})),n.d(e,"makeTextEncoderIterator",(function(){return H.d})),n.d(e,"makeLineIterator",(function(){return H.a})),n.d(e,"makeNumberedLineIterator",(function(){return H.b})),n.d(e,"isPromise",(function(){return q.g})),n.d(e,"isIterable",(function(){return q.d})),n.d(e,"isAsyncIterable",(function(){return q.a})),n.d(e,"isIterator",(function(){return q.e})),n.d(e,"isResponse",(function(){return q.j})),n.d(e,"isReadableStream",(function(){return q.i})),n.d(e,"isWritableStream",(function(){return q.k}))},function(t,e,n){"use strict";(function(t,i){n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s}));var r=n(46),o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(r.a)(i))&&i},a=o.window||o.self||o.global,s=o.process||{};console}).call(this,n(61),n(48))},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(43);const r={transitionDuration:0},o=t=>1-(1-t)*(1-t),a=["wheel"],s=["panstart","panmove","panend"],u=["pinchstart","pinchmove","pinchend"],c=["tripanstart","tripanmove","tripanend"],l=["doubletap"],h=["keydown"];class p{constructor(t,e={}){this.ControllerState=t,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new i.b(t,{...e,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(e)}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.setProps(this.controllerStateProps)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){const{ControllerState:e}=this;this.controllerState=new e({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});const n=this._eventStartBlocked;switch(t.type){case"panstart":return!n&&this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return!n&&this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return!n&&this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}getCenter(t){const{x:e,y:n}=this.controllerStateProps,{offsetCenter:i}=t;return[i.x-e,i.y-n]}isPointInBounds(t,e){const{width:n,height:i}=this.controllerStateProps;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),"makeViewport"in t&&(this.makeViewport=t.makeViewport),"dragMode"in t&&(this.dragMode=t.dragMode),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:e}=t;!0===e&&(e=300),this.inertia=e;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:p=!0,touchRotate:f=!1,keyboard:d=!0}=t,A=Boolean(this.onViewStateChange);this.toggleEvents(a,A&&n),this.toggleEvents(s,A&&(i||r)),this.toggleEvents(u,A&&(p||f)),this.toggleEvents(c,A&&f),this.toggleEvents(l,A&&o),this.toggleEvents(h,A&&d),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=p,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(t=>{this._events[t]!==e&&(this._events[t]=e,e?this.eventManager.on(t,this.handleEvent):this.eventManager.off(t,this.handleEvent))})}updateViewport(t,e={},n={}){const i={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this._state=t.getState(),this._setInteractionState(n),r){const t=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:t})}}_onTransition(t){this.onViewStateChange&&(t.interactionState=this._interactionState,this.onViewStateChange(t))}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:e});return this._panMove=n,this.updateViewport(i,r,{isDragging:!0}),!0}_onPan(t){return!!this.isDragging()&&(this._panMove?this._onPanMove(t):this._onPanRotate(t))}_onPanEnd(t){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t))}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,r,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:o},{isDragging:!1,isPanning:!0})}else{const t=this.controllerState.panEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),n=this.controllerState.rotate({pos:e});return this.updateViewport(n,r,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const n=this.getCenter(t),i=[n[0]+t.velocityX*e/2,n[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:o},{isDragging:!1,isRotating:!0})}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;t.preventDefault();const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const{speed:n=.01,smooth:i=!1}=this.scrollZoom,{delta:r}=t;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==o&&(o=1/o);const a=this.controllerState.zoom({pos:e,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:e}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.rotateStart({pos:e});return this.updateViewport(n,r,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const n=this.controllerState.rotate({pos:e});return this.updateViewport(n,r,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const n=this.getCenter(t),i=[n[0],n[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:o},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(n,r,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:n}=t,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=t;e=e.rotate({deltaAngleX:this._startPinchRotation-n})}return this.updateViewport(e,r,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e,_lastPinchEvent:n}=this;if(this.touchZoom&&e&&n&&t.scale!==n.scale){const i=this.getCenter(t);let r=this.controllerState.rotateEnd();const a=Math.log2(t.scale),s=(a-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),u=Math.pow(2,a+s*e/2);r=r.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:e,transitionEasing:o},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const t=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(t,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard,{controllerState:a}=this;let s;const u={};switch(t.srcEvent.code){case"Minus":s=e?a.zoomOut(n).zoomOut(n):a.zoomOut(n),u.isZooming=!0;break;case"Equal":s=e?a.zoomIn(n).zoomIn(n):a.zoomIn(n),u.isZooming=!0;break;case"ArrowLeft":e?(s=a.rotateLeft(r),u.isRotating=!0):(s=a.moveLeft(i),u.isPanning=!0);break;case"ArrowRight":e?(s=a.rotateRight(r),u.isRotating=!0):(s=a.moveRight(i),u.isPanning=!0);break;case"ArrowUp":e?(s=a.rotateUp(o),u.isRotating=!0):(s=a.moveUp(i),u.isPanning=!0);break;case"ArrowDown":e?(s=a.rotateDown(o),u.isRotating=!0):(s=a.moveDown(i),u.isPanning=!0);break;default:return!1}return this.updateViewport(s,this._getTransitionProps(),u),!0}_getTransitionProps(){return r}}},function(t,e,n){"use strict";var i=n(35);const r=/([0-9]+\.?[0-9]*)(%|px)/;function o(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=t.match(r);if(e&&e.length>=3){const t="%"===e[2],n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error("Could not parse position string ".concat(t))}}function a(t,e){return t.relative?Math.round(t.position*e):t.position}var s=n(69),u=n(31);n.d(e,"a",(function(){return c}));class c{constructor(t={}){const{id:e=null,x:n=0,y:r=0,width:o="100%",height:a="100%",projectionMatrix:s=null,fovy:c=50,near:l=.1,far:h=1e3,modelMatrix:p=null,viewportInstance:f=null,type:d=i.a}=t;Object(u.a)(!f||f instanceof i.a),this.viewportInstance=f,this.id=e||this.constructor.displayName||"view",this.type=d,this.props={...t,id:this.id,projectionMatrix:s,fovy:c,near:l,far:h,modelMatrix:p},this._parseDimensions({x:n,y:r,width:o,height:a}),this.equals=this.equals.bind(this),Object.seal(this)}equals(t){if(this===t)return!0;if(this.viewportInstance)return t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance);return Object(s.a)(this.props,t.props)}makeViewport({width:t,height:e,viewState:n}){if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const i=this.getDimensions({width:t,height:e});return this._getViewport(n,i)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(t){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const t in this.props.viewState)"id"!==t&&(e[t]=this.props.viewState[t]);return e}return t}getDimensions({width:t,height:e}){return{x:a(this._x,t),y:a(this._y,e),width:a(this._width,t),height:a(this._height,e)}}_getControllerProps(t){let e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),{...t,...e}):null}_getViewport(t,e){const{type:n}=this;return new n({...t,...this.props,...e})}_parseDimensions({x:t,y:e,width:n,height:i}){this._x=o(t),this._y=o(e),this._width=o(n),this._height=o(i)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(99),r=n(13);const o={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class a{static get DRAW_MODE(){return o}constructor(t={}){const{id:e=Object(i.c)("geometry"),drawMode:n=o.TRIANGLES,attributes:r={},indices:a=null,vertexCount:s=null}=t;this.id=e,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(r,a),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const e in t){let n=t[e];n=ArrayBuffer.isView(n)?{value:n}:n,Object(r.a)(ArrayBuffer.isView(n.value),"".concat(this._print(e),": must be typed array or object with value as typed array")),"POSITION"!==e&&"positions"!==e||n.size||(n.size=3),"indices"===e?(Object(r.a)(!this.indices),this.indices=n):this.attributes[e]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const e in t){const i=t[e],{value:r,size:o,constant:a}=i;!a&&r&&o>=1&&(n=Math.min(n,r.length/o))}return Object(r.a)(Number.isFinite(n)),n}}},function(t,e,n){"use strict";var i=n(10);const r=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,o=/^([-\w.]+\/[-\w.+]+)/;function a(t){if("string"!=typeof t)return"";const e=t.match(r);return e?e[1]:""}n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return c}));const s=/\?.*/;function u(t){if(Object(i.j)(t)){const e=function(t){if("string"!=typeof t)return"";const e=t.match(o);return e?e[1]:t}(t.headers.get("content-type")),n=a(t.url);return{url:l(t.url||""),type:e||n||null}}return Object(i.b)(t)?{url:l(t.name||""),type:t.type||""}:"string"==typeof t?{url:l(t),type:a(t)}:{url:"",type:""}}function c(t){return Object(i.j)(t)?t.headers["content-length"]||-1:Object(i.b)(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer?t.byteLength:ArrayBuffer.isView(t)?t.byteLength:-1}function l(t){return t.replace(s,"")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n(78),r=n(13),o=n(197);const a={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},s={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class u{static getBytesPerElement(t){return Object(i.c)(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Object(r.a)(t.size),Object(i.c)(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new u(...[a,...t])}constructor(...t){t.forEach(t=>this._assign(t)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return u.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return u.getBytesPerVertex(this)}_assign(t={}){return void 0!==(t=Object(o.a)("Accessor",t,s)).type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof t.index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return u}));var i=n(65),r=n(192);function o(t){if(r.toArrayBuffer&&(t=r.toArrayBuffer(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}return t&&"object"==typeof t&&t._toArrayBuffer?t._toArrayBuffer():Object(i.a)(!1)}function a(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let t=0;t<i.length;++t)if(i[t]!==r[t])return!1;return!0}function s(...t){const e=t.map(t=>t instanceof ArrayBuffer?new Uint8Array(t):t),n=e.reduce((t,e)=>t+e.byteLength,0),i=new Uint8Array(n);let r=0;for(const t of e)i.set(t,r),r+=t.byteLength;return i.buffer}function u(t,e,n){const i=void 0!==n?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}},function(t,e,n){"use strict";function i(t,e=(()=>!0)){return Array.isArray(t)?function t(e,n,i){let r=-1;for(;++r<e.length;){const o=e[r];Array.isArray(o)?t(o,n,i):n(o)&&i.push(o)}return i}(t,e,[]):e(t)?[t]:[]}function r({target:t,source:e,start:n=0,count:i=1}){const r=e.length,o=i*r;let a=0;for(let i=n;a<r;a++)t[i++]=e[a];for(;a<o;)a<o-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+o-a),a=o);return t}n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";e.a=new class{constructor(t){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(t)}setProps(t){Object.assign(this.props,t)}allocate(t,e,{size:n=1,type:i,padding:r=0,copy:o=!1,initialize:a=!1,maxCount:s}){const u=i||t&&t.constructor||Float32Array,c=e*n+r;if(ArrayBuffer.isView(t)){if(c<=t.length)return t;if(c*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new u(t.buffer,0,c)}let l;s&&(l=s*n+r);const h=this._allocate(u,c,a,l);return t&&o?h.set(t):a||h.fill(0,0,4),this._release(t),h}release(t){this._release(t)}_allocate(t,e,n,i){let r=Math.max(Math.ceil(e*this.props.overAlloc),1);r>i&&(r=i);const o=this._pool,a=t.BYTES_PER_ELEMENT*r,s=o.findIndex(t=>t.byteLength>=a);if(s>=0){const e=new t(o.splice(s,1)[0],0,r);return n&&e.fill(0),e}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,r=e.findIndex(t=>t.byteLength>=i);r<0?e.push(n):(r>0||e.length<this.props.poolSize)&&e.splice(r,0,n),e.length>this.props.poolSize&&e.shift()}}},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"loader assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return p})),n.d(e,"d",(function(){return d}));var i=n(24);const r={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},o=(t,e,n)=>e?t.enable(n):t.disable(n),a=(t,e,n)=>t.hint(n,e),s=(t,e,n)=>t.pixelStorei(n,e);function u(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const c={3042:o,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:o,2885:(t,e)=>t.cullFace(e),2929:o,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:o,35723:a,36006:(t,e)=>{const n=Object(i.e)(t)?36009:36160;return t.bindFramebuffer(n,e)},2886:(t,e)=>t.frontFace(e),33170:a,2849:(t,e)=>t.lineWidth(e),32823:o,32824:"polygonOffset",10752:"polygonOffset",35977:o,32938:"sampleCoverage",32939:"sampleCoverage",3089:o,3088:(t,e)=>t.scissor(...e),2960:o,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:s,3317:s,37440:s,37441:s,37443:s,3330:s,3332:s,3331:s,36010:(t,e)=>t.bindFramebuffer(36008,e),3314:s,32878:s,3316:s,3315:s,32877:s,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=u(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=u(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=u(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=u(e)&&3===e.length?[...e,...e]:e;const[n,i,r,o,a,s]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,o,a,s)},stencilOp:(t,e)=>{e=u(e)&&3===e.length?[...e,...e]:e;const[n,i,r,o,a,s]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,o,a,s)},viewport:(t,e)=>t.viewport(...e)};function l(t,e,n){return void 0!==e[t]?e[t]:n[t]}const h={blendEquation:(t,e,n)=>t.blendEquationSeparate(l(32777,e,n),l(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(l(32969,e,n),l(32968,e,n),l(32971,e,n),l(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(l(32824,e,n),l(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(l(32938,e,n),l(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,l(2962,e,n),l(2967,e,n),l(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,l(34816,e,n),l(36003,e,n),l(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,l(2964,e,n),l(2965,e,n),l(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,l(34817,e,n),l(34818,e,n),l(34819,e,n))},p={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[1028===e?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[1028===e?2962:34816]:n,[1028===e?2967:36003]:i,[1028===e?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[1028===e?2964:34817]:n,[1028===e?2965:34818]:i,[1028===e?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},f=(t,e)=>t.isEnabled(e),d={3042:f,2884:f,2929:f,3024:f,32823:f,32926:f,32928:f,3089:f,2960:f,35977:f}},function(t,e,n){"use strict";(function(t){n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return p}));var i=n(66),r=n(80),o=n(30),a=n(133);function s(t,e){const n=t[e].bind(t);t[e]=function(...e){const i=e[0];return i in t.state.cache||(t.state.cache[i]=n(...e)),t.state.enable?t.state.cache[i]:n(...e)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function u(t,e,n){const i=t[e].bind(t);t[e]=function(...e){const{valueChanged:r,oldValue:o}=n(t.state._updateCache,...e);return r&&i(...e),o},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}class c{constructor(t,{copyState:e=!1,log:n=(()=>{})}={}){this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?Object(r.a)(t):Object.assign({},i.c),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){Object(o.a)(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Object(r.c)(this.gl,t),this.stateStack.pop()}_updateCache(t){let e,n=!1;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const r in t){Object(o.a)(void 0!==r);const s=t[r],u=this.cache[r];Object(a.a)(s,u)||(n=!0,e=u,!i||r in i||(i[r]=u),this.cache[r]=s)}return{valueChanged:n,oldValue:e}}}function l(e,n={}){const{enable:r=!0,copyState:a}=n;if(Object(o.a)(void 0!==a),!e.state){const n=void 0!==t?t:window,{polyfillContext:r}=n;r&&r(e),e.state=new c(e,{copyState:a}),function(t){const e=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(e(n),t.state.program=n)}}(e);for(const t in i.b){u(e,t,i.b[t])}s(e,"getParameter"),s(e,"isEnabled")}return e.state.enable=r,e}function h(t){t.state||l(t,{copyState:!1}),t.state.push()}function p(t){Object(o.a)(t.state),t.state.pop()}}).call(this,n(61))},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(0),r=n(33),o=n(116),a=n(96),s=n(175),u=n(196),c=n(261),l=n(87),h=n(13);class p extends r.a{static isSupported(t,e={}){const{colorBufferFloat:n,colorBufferHalfFloat:i}=e;let r=!0;return n&&(r=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new p(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Object(i.a)(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Object(i.a)(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t,e={}){super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:t=1,height:e=1,attachments:n=null,color:i=!0,depth:r=!0,stencil:o=!1,check:a=!0,readBuffer:s,drawBuffers:u}){if(Object(h.a)(t>=0&&e>=0,"Width and height need to be integers"),this.width=t,this.height=e,n)for(const i in n){const r=n[i];(Array.isArray(r)?r[0]:r).resize({width:t,height:e})}else n=this._createDefaultAttachments(i,r,o,t,e);this.update({clearAttachments:!0,attachments:n,readBuffer:s,drawBuffers:u}),n&&a&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update({attachments:t={},readBuffer:e,drawBuffers:n,clearAttachments:i=!1,resizeAttachments:r=!0}){this.attach(t,{clearAttachments:i,resizeAttachments:r});const{gl:o}=this,a=o.bindFramebuffer(36160,this.handle);return e&&this._setReadBuffer(e),n&&this._setDrawBuffers(n),o.bindFramebuffer(36160,a||null),this}resize(t={}){let{width:e,height:n}=t;if(null===this.handle)return Object(h.a)(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&i.k.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const t in this.attachments)this.attachments[t].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t,{clearAttachments:e=!1,resizeAttachments:n=!0}={}){const i={};e&&Object.keys(this.attachments).forEach(t=>{i[t]=null}),Object.assign(i,t);const r=this.gl.bindFramebuffer(36160,this.handle);for(const t in i){Object(h.a)(void 0!==t,"Misspelled framebuffer binding point?");const e=Number(t),r=i[e];let o=r;if(o)if(o instanceof a.a)this._attachRenderbuffer({attachment:e,renderbuffer:o});else if(Array.isArray(r)){const[t,n=0,i=0]=r;o=t,this._attachTexture({attachment:e,texture:t,layer:n,level:i})}else this._attachTexture({attachment:e,texture:o,layer:0,level:0});else this._unattach(e);n&&o&&o.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,r||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(t=>!this.attachments[t]).forEach(t=>{delete this.attachments[t]})}checkStatus(){const{gl:t}=this,e=this.getStatus();if(36053!==e)throw new Error(function(t){return(p.STATUS||{})[t]||"Framebuffer error ".concat(t)}(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(t={}){const{color:e,depth:n,stencil:i,drawBuffers:r=[]}=t,o=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Object(s.a)(this.gl,{color:e,depth:n,stencil:i}),r.forEach((t,e)=>{Object(s.b)({drawBuffer:e,value:t})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(t={}){return i.k.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(t={}){return i.k.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(t={}){return i.k.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(t={}){return i.k.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(t={}){return i.k.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(t={}){return i.k.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:t=[],x:e=0,y:n=0,width:r,height:o}){const a=Object(i.a)(this.gl),s=a.bindFramebuffer(36008,this.handle);return 0===e&&0===n&&void 0===r&&void 0===o?a.invalidateFramebuffer(36008,t):a.invalidateFramebuffer(36008,t,e,n,r,o),a.bindFramebuffer(36008,s),this}getAttachmentParameter(t,e,n){let i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Object(l.a)(this.gl,i)),i}getAttachmentParameters(t=36064,e,n=this.constructor.ATTACHMENT_PARAMETERS||[]){const i={};for(const r of n){i[e?Object(l.a)(this.gl,r):r]=this.getAttachmentParameter(t,r,e)}return i}getParameters(t=!0){const e=Object.keys(this.attachments),n={};for(const i of e){const e=Number(i);n[t?Object(l.a)(this.gl,e):e]=this.getAttachmentParameters(e,t)}return n}show(){return"undefined"!=typeof window&&window.open(Object(u.a)(this),"luma-debug-texture"),this}log(t=0,e=""){if(t>i.k.level||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);const n=Object(u.a)(this,{targetMaxHeight:100});return i.k.image({logLevel:t,message:e,image:n},e)(),this}bind({target:t=36160}={}){return this.gl.bindFramebuffer(t,this.handle),this}unbind({target:t=36160}={}){return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,i,r){let s=null;return t&&(s=s||{},s[36064]=new o.a(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(s[36064])),e&&n?(s=s||{},s[33306]=new a.a(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(s[33306])):e?(s=s||{},s[36096]=new a.a(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:r}),this.ownResources.push(s[36096])):n&&Object(h.a)(!1),s}_unattach(t){const e=this.attachments[t];e&&(e instanceof a.a?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer({attachment:t=36064,renderbuffer:e}){const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,e.handle),this.attachments[t]=e}_attachTexture({attachment:t=36064,texture:e,layer:n,level:r}){const{gl:o}=this;switch(o.bindTexture(e.target,e.handle),e.target){case 35866:case 32879:Object(i.a)(o).framebufferTextureLayer(36160,t,e.target,r,n);break;case 34067:const a=function(t){return t<34069?t+34069:t}(n);o.framebufferTexture2D(36160,t,a,e.handle,r);break;case 3553:o.framebufferTexture2D(36160,t,3553,e.handle,r);break;default:Object(h.a)(!1,"Illegal texture type")}o.bindTexture(e.target,null),this.attachments[t]=e}_setReadBuffer(t){const e=Object(i.g)(this.gl);e?e.readBuffer(t):Object(h.a)(36064===t||1029===t,"Multiple render targets not supported"),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=Object(i.a)(e);if(n)n.drawBuffers(t);else{const n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):Object(h.a)(1===t.length&&(36064===t[0]||1029===t[0]),"Multiple render targets not supported")}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=Object(c.a)(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}p.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303]},function(t,e,n){"use strict";function i(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const r=t[n],o=e[n];if(!(r===o||Array.isArray(r)&&Array.isArray(o)&&i(r,o)))return!1}return!0}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(){}n.d(e,"a",(function(){return o}));const r={onStart:i,onUpdate:i,onInterrupt:i,onEnd:i};class o{constructor(t){this._inProgress=!1,this._handle=null,this.timeline=t,this.settings={}}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings={...r,...t},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}},function(t,e,n){"use strict";function i(t,e,n){var i=e[0],r=e[1],o=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/o,t[1]=(n[1]*i+n[5]*r)/o,t}function r(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[3]*i+n[7]*r+n[11]*o||1;return t[0]=(n[0]*i+n[4]*r+n[8]*o)/a,t[1]=(n[1]*i+n[5]*r+n[9]*o)/a,t[2]=(n[2]*i+n[6]*r+n[10]*o)/a,t}function o(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function a(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*o,t[1]=n[1]*i+n[4]*r+n[7]*o,t[2]=n[2]*i+n[5]*r+n[8]*o,t[3]=e[3],t}n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return a}))},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));const i="vs",r="fs"},function(t,e,n){"use strict";(function(t,i){n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return u}));const r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},o=r.global||r.self||r.window,a="object"!=typeof i||"[object process]"!==String(i)||i.browser,s="function"==typeof importScripts,u="undefined"!=typeof window&&void 0!==window.orientation,c=void 0!==i&&i.version&&i.version.match(/v([0-9]*)/);c&&parseFloat(c[1])}).call(this,n(61),n(48))},function(t,e,n){"use strict";n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return h}));var i=n(62),r=n(42),o=n(59),a=n(103),s=n(166),u=n(10);const c=/\.([^.]+)$/;async function l(t,e=[],n={},i={}){let r=h(t,e,{...n,nothrow:!0},i);if(r)return r;if(Object(u.b)(t)&&(r=h(t=await Object(s.b)(t,0,10),e,n,i)),!r&&!n.nothrow)throw new Error(p(t));return r}function h(t,e=[],n={},i={}){if(e&&!Array.isArray(e))return Object(r.b)(e);!function(t){for(const e of t)Object(r.b)(e)}(e=[...e||[],...Object(a.b)()]);const{url:s,type:u}=Object(o.b)(t);let l=function(t,e){const n=e&&e.match(c),i=n&&n[1];return i&&function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i)}(e,s||i.url);if(l=l||function(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x.".concat(n.id))return n}return null}(e,u),l=l||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(f(e,n))return n}else if(ArrayBuffer.isView(e)){if(d(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(d(e,0,n))return n}return null}(e,t),!l&&!n.nothrow)throw new Error(p(t));return l}function p(t){const{url:e,type:n}=Object(o.b)(t);let i="No valid loader found";return t&&(i+=' data: "'.concat(function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return A(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return A(t,0,e)}return""}(t),'", contentType: "').concat(n,'"')),e&&(i+=" url: ".concat(e)),i}function f(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some(e=>t.startsWith(e))}function d(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>function(t,e,n,r){if(r instanceof ArrayBuffer)return Object(i.a)(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=A(t,e,r.length);return r===i;default:return!1}}(t,e,n,r))}function A(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(i.getUint8(e+t));return r}},function(t,e,n){"use strict";function i(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function r(t){let e,n={};return r=>{for(const o in r)if(!i(r[o],n[o])){e=t(r),n=r;break}return e}}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));var i=n(13);const r={5126:[5126,1,"float"],35664:[5126,2,"vec2"],35665:[5126,3,"vec3"],35666:[5126,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[5126,1,"bool"],35671:[5126,2,"bvec2"],35672:[5126,3,"bvec3"],35673:[5126,4,"bvec4"],35674:[5126,8,"mat2"],35685:[5126,8,"mat2x3"],35686:[5126,8,"mat2x4"],35675:[5126,12,"mat3"],35687:[5126,12,"mat3x2"],35688:[5126,12,"mat3x4"],35676:[5126,16,"mat4"],35689:[5126,16,"mat4x2"],35690:[5126,16,"mat4x3"]};function o(t){switch(t){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Object(i.a)(!1),0}}function a(t){const e=r[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function s(t,e){switch(t){case 5120:case 5121:case 5122:case 5123:t=5126}for(const n in r){const[i,o,a]=r[n];if(i===t&&o===e)return{glType:n,name:a}}return null}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return u}));var i=n(0);const r={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},o={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},a={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function s(t,e){const n=r[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const o=Object(i.j)(t)&&n.gl2||n.gl1;return"string"==typeof o?t.getExtension(o):o}function u(t,e){const n=r[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return a}));function i(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function r(t,{clamped:e=!0}={}){switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function o({data:t,width:e,height:n,bytesPerPixel:i=4,temp:r}){const o=e*i;r=r||new Uint8Array(o);for(let e=0;e<n/2;++e){const i=e*o,a=(n-e-1)*o;r.set(t.subarray(i,i+o)),t.copyWithin(i,a,a+o),t.set(r,a)}}function a({data:t,width:e,height:n}){const i=Math.round(e/2),r=Math.round(n/2),o=new Uint8Array(i*r*4);for(let n=0;n<r;n++)for(let r=0;r<i;r++)for(let a=0;a<4;a++)o[4*(n*i+r)+a]=t[4*(2*n*e+2*r)+a];return{data:o,width:i,height:r}}},function(t,e,n){"use strict";(function(t,i){n.d(e,"f",(function(){return o})),n.d(e,"g",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return p}));const r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},o=r.self||r.window||r.global,a=r.window||r.self||r.global,s=r.global||r.self||r.window,u=r.document||{},c="object"!=typeof i||"[object process]"!==String(i)||i.browser,l="function"==typeof importScripts,h=void 0!==i&&i.version&&i.version.match(/v([0-9]*)/),p=h&&parseFloat(h[1])||0}).call(this,n(61),n(48))},function(t,e,n){"use strict";n.d(e,"c",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return h}));var i=n(66),r=n(67),o=n(30),a=n(24),s=n(133);function u(t,e){if(Object(o.a)(Object(a.d)(t),"setParameters requires a WebGL context"),Object(s.b)(e))return;const n={};for(const r in e){const o=Number(r),a=i.e[r];a&&("string"==typeof a?n[a]=!0:a(t,e[r],o))}const r=t.state&&t.state.cache;if(r)for(const o in n){(0,i.a[o])(t,e,r)}}function c(t,e){if("number"==typeof(e=e||i.c)){const n=e,r=i.d[n];return r?r(t,n):t.getParameter(n)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const e of n){const n=i.d[e];r[e]=n?n(t,Number(e)):t.getParameter(Number(e))}return r}function l(t){u(t,i.c)}function h(t,e,n){if(Object(s.b)(e))return n(t);const{nocatch:i=!0}=e;let o;if(Object(r.b)(t),u(t,e),i)o=n(t),Object(r.a)(t);else try{o=n(t)}finally{Object(r.a)(t)}return o}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{constructor(t={}){const{id:e="effect"}=t;this.id=e,this.props={...t}}preRender(){}getModuleParameters(){}cleanup(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(165),r=n(0),o=n(175),a=n(6);class s extends i.a{render(t){const e=this.gl;return Object(r.n)(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{viewports:e,views:n,onViewportActive:i,clearCanvas:o=!0}=t,a=this.gl;o&&function(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Object(r.n)(t,{viewport:[0,0,e,n]}),t.clear(16640)}(a);const s=[];for(const r of e){const e=r.viewport||r,o=n&&n[e.id];i(e);const u=this._getDrawLayerParams(e,t);t.view=o;const c=e.subViewports||[e];for(const e of c){t.viewport=e;const n=this._drawLayersInViewport(a,t,u);s.push(n)}}return s}_getDrawLayerParams(t,{layers:e,pass:n="unknown",layerFilter:i,effects:r,moduleParameters:o}){const a=[],s=function t(e=0,n={}){const i={},r=(o,a)=>{const s=o.props._offset,u=o.id,c=o.parent&&o.parent.id;let l;if(!c||c in n||r(o.parent,!1),c in i){const e=i[c]=i[c]||t(n[c],n);l=e(o,a),i[u]=e}else Number.isFinite(s)?(l=s+(n[c]||0),i[u]=null):l=e;return a&&l>=e&&(e=l+1),n[u]=l,l};return r}();for(let u=0;u<e.length;u++){const c=e[u],l=this._shouldDrawLayer(c,t,n,i),h={shouldDrawLayer:l,layerRenderIndex:s(c,l)};l&&(h.moduleParameters=this._getModuleParameters(c,r,n,o),h.layerParameters=this.getLayerParameters(c,u)),a[u]=h}return a}_drawLayersInViewport(t,{layers:e,onError:n,viewport:i,view:s},u){const c=function(t,{viewport:e}){const n=t.canvas?t.canvas.clientHeight||t.canvas.height:100,i=e,o=Object(r.e)(t);return[i.x*o,(n-i.y-i.height)*o,i.width*o,i.height*o]}(t,{viewport:i});if(s&&s.props.clear){const e=!0===s.props.clear?{color:!0,depth:!0}:s.props.clear;Object(r.o)(t,{scissorTest:!0,scissor:c},()=>Object(o.a)(t,e))}const l={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};Object(r.n)(t,{viewport:c});for(let t=0;t<e.length;t++){const r=e[t],{shouldDrawLayer:o,layerRenderIndex:s,moduleParameters:c,layerParameters:h}=u[t];if(o&&r.props.pickable&&l.pickableCount++,r.isComposite)l.compositeCount++;else if(o){l.visibleCount++,c.viewport=i;try{r.drawLayer({moduleParameters:c,uniforms:{layerIndex:s},parameters:h})}catch(t){n?n(t,r):a.a.error("error during drawing of ".concat(r),t)()}}}return l}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e){return t.props.parameters}_shouldDrawLayer(t,e,n,i){let r=this.shouldDrawLayer(t)&&t.props.visible;return r&&i&&(r=i({layer:t,viewport:e,isPicking:n.startsWith("picking"),renderPass:n})),r&&t.activateViewport(e),r}_getModuleParameters(t,e,n,i){const o=Object.assign(Object.create(t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Object(r.e)(this.gl)});if(e)for(const n of e)Object.assign(o,n.getModuleParameters(t));return Object.assign(o,this.getModuleParameters(t,e),i)}}},function(t,e,n){"use strict";n.r(e);const i={batchSize:"auto",convertToObject:!0,optimizeMemoryUsage:!1};class r extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}class o{constructor(){this._values=new r,this._settlers=new r,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const e=this._settlers.dequeue();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,e)=>{this._settlers.enqueue({resolve:t,reject:e})})}}const a={batchSize:100};class s{constructor(t,e,n={}){this.TableBatchType=t,this.schema=e,this.options={...a,...n},this.batch=null,this.batchCount=0,this.bytesUsed=0}addRow(t){if(!this.batch){const{TableBatchType:t}=this;this.batch=new t(this.schema,this.options)}this.batch.addRow(t)}chunkComplete(t){this.bytesUsed+=t.byteLength||t.length||0,this.batch&&this.batch.chunkComplete()}isFull(){return this.batch&&this.batch.isFull()}hasBatch(){return Boolean(this.batch)}getBatch(t={}){if(Number.isFinite(t.bytesUsed)&&(this.bytesUsed=t.bytesUsed),this.batch){const e=this.batch.getBatch();return this.batch=null,e.count=this.batchCount,this.batchCount++,e.bytesUsed=this.bytesUsed,Object.assign(e,t),e}return null}}var u=n(120),c=n.n(u);const{ChunkStreamer:l}=c.a;function h(t){t=t||{},l.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(t){this._input=t;try{for await(const e of t)this.parseChunk(this.getStringChunk(e));this._finished=!0,this.parseChunk("")}catch(t){this._sendError(t)}},this._nextChunk=function(){},this.getStringChunk=function(t){return"string"==typeof t?t:this.textDecoder.decode(t,{stream:!0})}}h.prototype=Object.create(l.prototype),h.prototype.constructor=h;const p={csv:{TableBatch:class{constructor(t,e={}){if(e={...i,...e},this.schema=t,this.batchSize=e.batchSize,this.convertToObject=e.convertToObject,this.optimizeMemoryUsage=e.optimizeMemoryUsage,this.rows=null,this.length=0,this.isChunkComplete=!1,this.cursor=0,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}addRow(t,e=null){this.rows||(this.rows=new Array(this.batchSize),this.length=0),Number.isFinite(e)&&(this.cursor=e);const n=this.convertToObject&&this.schema;this.rows[this.length]=n?function(t,e){if(!t)throw new Error("null row");if(!Array.isArray(t))return t;if(!e)return t;const n={};for(let i=0;i<e.length;i++)n[e[i]]=t[i];return n}(t,this._headers):t,this.optimizeMemoryUsage&&(this.rows[this.length]=JSON.parse(JSON.stringify(this.rows[this.length]))),this.length++}chunkComplete(){this.isChunkComplete=!0}isFull(){return"auto"===this.batchSize?this.isChunkComplete&&this.length>0:this.rows&&this.length>=this.batchSize}getBatch(){if(this.rows){const t=this.rows.slice(0,this.length);return this.rows=null,this.isChunkComplete=!1,{data:t,schema:this.schema,length:t.length,cursor:this.cursor}}return null}},batchSize:10,optimizeMemoryUsage:!1,header:"auto",rowFormat:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!1,delimitersToGuess:[",","\t","|",";"]}},f={id:"csv",name:"CSV",version:"3.0.0-alpha.6",extensions:["csv"],mimeTypes:["text/csv"],category:"table",parse:async(t,e)=>d((new TextDecoder).decode(t),e),parseText:d,parseInBatches:function(t,e){(e={...p,...e}).csv={...p.csv,...e.csv};const{batchSize:n,optimizeMemoryUsage:i}=e.csv,r=e.csv.TableBatch,a=new o,u="object"===e.csv.rowFormat;let l=!0,f=null,d=null,g=null;const m={dynamicTyping:!0,...e.csv,header:!1,download:!1,step(t,o){const c=t.data,h=t.meta.cursor;if(l&&!f){if(A(c,e))return void(f=c)}if(l){if(l=!1,!f){f=[];for(let t=0;t<c.length;t++)f[t]="".concat(e.csv.columnPrefix).concat(t+1)}g=function(t,e){const n=e?{}:[];for(let i=0;i<t.length;i++){const r=e&&e[i]||i;switch(typeof t[i]){case"number":case"boolean":n[r]={name:String(r),index:i,type:Float32Array};break;case"string":default:n[r]={name:String(r),index:i,type:Array}}}return n}(c,f)}d=d||new s(r,g,{batchSize:n,convertToObject:u,optimizeMemoryUsage:i}),d.addRow(c),d.isFull()&&a.enqueue(d.getBatch({bytesUsed:h}))},complete(t,e){const n=t.meta.cursor,i=d.getBatch({bytesUsed:n});i&&a.enqueue(i),a.close()}};return c.a.parse(t,m,h),a},testText:null,options:p};async function d(t,e){(e={...p,...e}).csv={...p.csv,...e.csv};const n=await async function(t,e){if("auto"!==e.csv.header)return Boolean(e.csv.header);return await new Promise((e,n)=>{c.a.parse(t,{download:!1,dynamicTyping:!0,step:(t,n)=>{n.abort();const i=t.data;e(A(i))},error:t=>{n(new Error(t))}})})}(t,e),i={dynamicTyping:!0,...e.csv,header:n,download:!1,error:t=>{throw new Error(t)}};return c.a.parse(t,i).data}function A(t,e){return e&&"auto"!==e.csv.header?Boolean(e.csv.header):t.every(t=>"string"==typeof t)}var g=n(103);let m,y;const v={fontFamily:'"Helvetica Neue", Helvetica, Arial, sans-serif',display:"flex",flex:"wrap",maxWidth:"500px",flexDirection:"column",zIndex:2};function _(){return document.createElement("div")}function b(t){if(!t.picked)return null;if(t.object===m)return y;const e={html:w(t.object),style:v};return y=e,m=t.object,e}const x=new Set(["position","index"]);function w(t){const e=_();for(const n in t){if(x.has(n))continue;const i=_();i.className="header",i.textContent=n;const r=_();r.className="value",r.textContent=T(t[n]);const o=_();E(o,i,r),o.appendChild(i),o.appendChild(r),e.appendChild(o)}return e.innerHTML}function E(t,e,n){Object.assign(e.style,{fontWeight:700,marginRight:"10px",flex:"1 1 0%"}),Object.assign(n.style,{flex:"none",maxWidth:"250px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),Object.assign(t.style,{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"stretch"})}function T(t){let e;if(Array.isArray(t)&&t.length>4)e="Array<".concat(t.length,">");else if("string"==typeof t)e=t;else if("number"==typeof t)e=String(t);else try{e=JSON.stringify(t)}catch(t){e="<Non-Serializable Object>"}return e.length>50&&(e=e.slice(0,50)),e}function S(t,e){let n=t;for(const t in e)n=n.replace("{".concat(t,"}"),e[t]);return n}var P=n(121);const M={};var C=n(37);const I={position:"absolute",top:"0px",left:"0px",width:344,padding:"12px 24px",margin:24,overflowX:"hidden",overflowY:"overlay",outline:"none",maxHeight:"94%",boxSizing:"border-box",backgroundColor:"rgb(255, 255, 255)",fontFamily:'"Fira Sans", sans-serif',zIndex:1};var O=class{constructor({container:t,props:e}){const{description:n}=e,i=document.createElement("div");i.className="deck-json-description-box",Object.assign(i.style,I),this.el=i;const r=document.createElement("div");r.innerHTML=n,i.appendChild(r),t.append(i)}remove(){this.el.remove(),this.description=null}static get stringName(){return"description"}};function L(t={}){const e={},n=Object.keys(t).filter(t=>t.charAt(0)===t.charAt(0).toUpperCase());for(const i of n)e[i]=t[i];return e}n.d(e,"addCustomLibraries",(function(){return D})),n.d(e,"createDeck",(function(){return z})),n.d(e,"updateDeck",(function(){return B})),n.d(e,"jsonConverter",(function(){return k}));const R={classes:L(C),enumerations:{COORDINATE_SYSTEM:C.COORDINATE_SYSTEM,GL:{DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}}};Object(g.c)([f]);const k=new C.JSONConverter({configuration:R});function D(t,e){if(!t)return;const n={};function i(t,i){!function(t,e){const n={classes:L(t)};e.mergeConfiguration(n)}(i,k),n[t]=i,Object.values(n).every(t=>t)&&"function"==typeof e&&e()}t.forEach(({libraryName:t,resourceUri:e})=>{n[t]=!1,t in window?i(t,window[t]):(Object.defineProperty(window,t,{set:e=>i(t,e),get:()=>n[t]}),function(t){if(!M[t]){const e=document.createElement("script");e.type="text/javascript",e.src=t,document.querySelector("head").appendChild(e),M[t]=new Promise(t=>{e.onload=t})}M[t]}(e))})}function B(t,e){const n=k.convert(t);e.setProps(n)}function F({mapProvider:t,props:e,mapboxApiKey:n,googleMapsKey:i,handleEvent:r,getTooltip:o,container:a}){const s={...r?{onClick:t=>r("deck-click-event",t),onHover:t=>r("deck-hover-event",t),onResize:t=>r("deck-resize-event",t),onViewStateChange:({viewState:t,interactionState:e,oldViewState:n})=>{const i=new C.WebMercatorViewport(t);t.nw=i.unproject([0,0]),t.se=i.unproject([i.width,i.height]),r("deck-view-state-change-event",t)}}:null,getTooltip:o,container:a};switch(t){case"mapbox":return C.log.info("Using Mapbox base maps")(),new C.DeckGL({...s,...e,map:P.a,mapboxApiAccessToken:n,onLoad:P.c});case"carto":return C.log.info("Using Carto base maps")(),new C.DeckGL({map:P.a,...s,...e});case"google_maps":return C.log.info("Using Google Maps base maps")(),function({container:t,onClick:e,onComplete:n,getTooltip:i,googleMapsKey:r,layers:o,mapStyle:a="satellite",initialViewState:s={latitude:0,longitude:0,zoom:1}}){if(!r)return C.log.warn("No Google Maps API key set")(),null;const u=new C.GoogleMapsOverlay({layers:o}),c={center:{lat:s.latitude,lng:s.longitude},mapTypeId:a,zoom:s.zoom},l=new window.google.maps.Map(t,c);return u.setMap(l),u}({...s,...e,googleMapsKey:i});default:return C.log.info("No recognized map provider specified")(),new C.DeckGL({...s,...e,map:null,mapboxApiAccessToken:null})}}function z({mapboxApiKey:t,googleMapsKey:e,container:n,jsonInput:i,tooltip:r,handleEvent:o,customLibraries:a}){let s;try{const u=i.layers||[],c=k.convert(i);!function(t,e){const n=document.createElement("div");n.className="deckgl-ui-elements-overlay",n.style.zIndex=1,t.insertAdjacentElement("beforebegin",n);const i=[];for(const t of Object.keys(e))switch(t){case"description":const t=new O({container:n,props:e});i.push(t)}}(n,c);const l=(c.layers||[]).filter(t=>t),h=function(t,e){return t.filter(t=>t&&t.id&&!e.find(e=>e.id===t.id))}(u,l),p=function(t){return t?t.html||t.text?e=>{if(!e.picked)return null;const n={style:t.style||v};return t.html?n.html=S(t.html,e.object):n.text=S(t.text,e.object),n}:b:null}(r),{mapProvider:f}=c;s=F({mapProvider:f,props:c,mapboxApiKey:t,googleMapsKey:e,handleEvent:o,getTooltip:p,container:n}),D(a,()=>{if(h.length){const t=(k.convert({layers:i.layers}).layers||[]).filter(t=>t);t.length>l.length&&s.setProps({layers:t})}})}catch(t){console.error(t)}return s}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var i=n(36);function r(t,e,n=null){return n||(t={fetch:Object(i.a)(e||{},t),...t},Array.isArray(t.loaders)||(t.loaders=null),t)}function o(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}},function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return h}));var i=n(150),r=n(10),o=n(114),a=n(95);const s="Cannot convert supplied data type";function u(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer){const n=t;if(e.text&&!e.binary){return new TextDecoder("utf8").decode(n)}return n}if(ArrayBuffer.isView(t)||Object(r.c)(t)){if(e.text&&!e.binary){return new TextDecoder("utf8").decode(t)}let n=t.buffer;const i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(s)}async function c(t,e){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||n)return u(t,e);if(Object(r.b)(t)&&(t=await Object(a.b)(t)),Object(r.j)(t)){const n=t;return await Object(a.a)(n),e.binary?await n.arrayBuffer():await n.text()}if(Object(r.i)(t)&&(t=Object(o.a)(t)),Object(r.d)(t)||Object(r.a)(t))return Object(i.a)(t);throw new Error(s)}async function l(t){return Object(r.e)(t)?t:Object(r.j)(t)?(await Object(a.a)(t),Object(o.a)(t.body)):Object(r.b)(t)||Object(r.i)(t)?Object(o.a)(t):Object(r.a)(t)?t[Symbol.asyncIterator]():function(t){if(ArrayBuffer.isView(t))return function*(){yield t.buffer}();if(t instanceof ArrayBuffer)return function*(){yield t}();if(Object(r.e)(t))return t;if(Object(r.d)(t))return t[Symbol.iterator]();throw new Error(s)}(t)}async function h(t){if(Object(r.i)(t))return t;if(Object(r.j)(t))return t.body;return(await Object(a.b)(t)).body}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));function i(t){const e=r(t);return function(t){const e=r(t);if(!(e.byteLength>=24&&2303741511===e.getUint32(0,!1)))return null;return{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}(e)||function(t){const e=r(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,!1)&&255===e.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let o=2;for(;o+9<e.byteLength;){const t=e.getUint16(o,!1);if(i.has(t))return{mimeType:"image/jpeg",height:e.getUint16(o+5,!1),width:e.getUint16(o+7,!1)};if(!n.has(t))return null;o+=2,o+=e.getUint16(o,!1)}return null}(e)||function(t){const e=r(t);if(!(e.byteLength>=10&&1195984440===e.getUint32(0,!1)))return null;return{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}}(e)||function(t){const e=r(t);if(!(e.byteLength>=14&&16973===e.getUint16(0,!1)&&e.getUint32(2,!0)===e.byteLength))return null;return{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}(e)}function r(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}));var i=n(13);function r(t,e){if("string"!=typeof e)return e;const n=Number(e);if(!isNaN(n))return n;const r=t[e=e.replace(/^.*\./,"")];return Object(i.a)(void 0!==r,"Accessing undefined constant GL.".concat(e)),r}function o(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}},,,function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return c}));const i=["points","lines","polygons"];function r(t,e){if(!t)return null;const n=t.featureIds.value.indexOf(e);return-1!==n?a(t,e,n):null}function o(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return-1!==n?a(t,i,n):null}function a(t,e,n){const i={properties:{...t.properties[e]}};for(const e in t.numericProps)i.properties[e]=t.numericProps[e].value[n];return i}function s(t,e,n){if(!t)return-1;for(const r of i){const i=u(t,e,n,r);if(-1!==i)return i}return-1}function u(t,e,n,i){if(!t)return-1;if(!(i in t&&t[i].positions.value.length))return-1;let r=-1;if(t[i].numericProps[e])r=t[i].numericProps[e].value.indexOf(n);else{const o=t[i].properties.findIndex(t=>t[e]===n);r=t[i].featureIds.value.indexOf(o)}return r}function c(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].featureIds.value;n[i]=new Uint8ClampedArray(3*r.length);const o=[];for(let t=0;t<r.length;t++)e(r[t],o),n[i][3*t+0]=o[0],n[i][3*t+1]=o[1],n[i][3*t+2]=o[2]}return n}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n(2);const r=[255,255,255],o=1,a=[0,0,-1];let s=0;class u{constructor(t={}){const{color:e=r}=t,{intensity:n=o}=t,{direction:u=a}=t,{_shadow:c=!1}=t;this.id=t.id||"directional-".concat(s++),this.color=e,this.intensity=n,this.type="directional",this.direction=new i.c(u).normalize().toArray(),this.shadow=c}getProjectedLight(){return this}}},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(224),a=n(6),s=n(170),u=n(58),c=n(209),l=n(47);class h extends c.a{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):()=>null}normalizeGeometry(t){return this.normalize?function(t,e,n,i){let r=t;if(Array.isArray(t[0])){const n=t.length*e;r=new Array(n);for(let n=0;n<t.length;n++)for(let i=0;i<e;i++)r[n*e+i]=t[n][i]||0}return n?Object(l.d)(r,{size:e,gridResolution:n}):i?Object(l.e)(r,{size:e}):r}(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}get(t){return this.attributes[t]}getGeometrySize(t){if(Array.isArray(t[0])){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(0!==e.geometrySize)if(t&&Array.isArray(t[0]))for(const n of t){const t=this.getGeometrySize(n);e.geometrySize=t,this.updateGeometryAttributes(n,e),e.vertexStart+=t}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const{segmentTypes:n}=this.attributes,i=this.isClosed(t),{vertexStart:r,geometrySize:o}=e;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}_updatePositions(t,e){const{positions:n}=this.attributes;if(!n)return;const{vertexStart:i,geometrySize:r}=e,o=new Array(3);for(let e=i,a=0;a<r;e++,a++)this.getPointOnPath(t,a,o),n[3*e]=o[0],n[3*e+1]=o[1],n[3*e+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,n=[]){const{positionSize:i}=this;e*i>=t.length&&(e+=1-t.length/i);const r=e*i;return n[0]=t[r],n[1]=t[r+1],n[2]=3===i&&t[r+2]||0,n}isClosed(t){if(!this.normalize)return this.opts.loop;const{positionSize:e}=this,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(2===e||t[2]===t[n+2])}}n.d(e,"a",(function(){return A}));const p=[0,0,0,255],f={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:p},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},d={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class A extends i.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:d,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:d,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:d,defaultValue:p},instancePickingColors:{size:3,type:5121,accessor:(t,{index:e,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,n)}}),this.setState({pathTesselator:new h({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&a.a.removed("getDashArray","PathStyleExtension")()}updateState({oldProps:t,props:e,changeFlags:n}){super.updateState({props:e,oldProps:t,changeFlags:n});const i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:t}=this.state,r=e.data.attributes||{};t.updateGeometry({data:e.data,geometryBuffer:r.getPath,buffers:r,normalize:!e._pathType,loop:"loop"===e._pathType,getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||i.invalidateAll()}if(n.extensionsChanged){var r;const{gl:t}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(t),i.invalidateAll()}}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,{data:i}=this.props;return i[0]&&i[0].__source&&(e.object=i.find(t=>t.__source.index===n)),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else this._disablePickingIndex(t)}draw({uniforms:t}){const{viewport:e}=this.context,{jointRounded:n,capRounded:i,billboard:r,miterLimit:o,widthUnits:a,widthScale:s,widthMinPixels:u,widthMaxPixels:c}=this.props,l="pixels"===a?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthScale:s*l,miterLimit:o,widthMinPixels:u,widthMaxPixels:c}).draw()}_getModel(t){return new s.a(t,{...this.getShaders(),id:this.props.id,geometry:new u.a({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}A.layerName="PathLayer",A.defaultProps=f},function(t,e,n){"use strict";const i={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};var r=n(5);const o=Object.keys(r.a).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(r.a[t],";")).join(""),a=Object.keys(r.c).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(r.c[t],";")).join("");var s="".concat(o,"\n").concat(a,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  );\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy) * WORLD_SCALE,\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n"),u=n(112);const c={};e.a={name:"project",dependencies:[i],vs:s,getUniforms:function(t=c){return t.viewport?Object(u.b)(t):{}}}},function(t,e,n){"use strict";var i=n(101),r=n(95);async function o(t,e={}){if("string"!=typeof t)return await Object(r.b)(t);t=Object(i.b)(t);const n=await fetch(t,e);if(!n.ok&&e.throws)throw new Error(await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{t.headers.get("Content-Type").includes("application/json")?e+=await t.text():e+=t.statusText}catch(t){return e}return e}(n));return n}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a}));var i=n(10),r=n(59);async function o(t){if(Object(i.j)(t))return t;const e={},n=Object(r.a)(t);n>=0&&(e["content-length"]=String(n));const{url:o,type:a}=Object(r.b)(t);a&&(e["content-type"]=a);const s=await async function(t){if("string"==typeof t)return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(t=>{const n=new FileReader;n.onload=e=>t(e.target&&e.target.result),n.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(t.slice(0,5));return"data:base64,".concat(e)}return null}(t);s&&(e["x-first-bytes"]=s),"string"==typeof t&&(t=(new TextEncoder).encode(t));const u=new Response(t,{headers:e});return Object.defineProperty(u,"url",{value:o}),u}async function a(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(60),"..."):e}catch(t){}return e}(t);throw new Error(e)}}},function(t,e,n){"use strict";var i=n(33);const r="EXT_color_buffer_float";var o={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:r,bpp:2},33327:{gl2:r,bpp:4},34842:{gl2:r,bpp:8},33326:{gl2:r,bpp:4},33328:{gl2:r,bpp:8},34836:{gl2:r,bpp:16},35898:{gl2:r,bpp:4}},a=n(0),s=n(13);n.d(e,"a",(function(){return u}));class u extends i.a{static isSupported(t,{format:e}={format:null}){return!e||function(t,e,n){const i=n[e];if(!i)return!1;const r=Object(a.j)(t)&&i.gl2||i.gl1;return"string"==typeof r?t.getExtension(r):r}(t,e,o)}static getSamplesForFormat(t,{format:e}){return t.getInternalformatParameter(36161,e,32937)}constructor(t,e={}){super(t,e),this.initialize(e),Object.seal(this)}initialize({format:t,width:e=1,height:n=1,samples:i=0}){return Object(s.a)(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==i&&Object(a.j)(this.gl)?this.gl.renderbufferStorageMultisample(36161,i,t,e,n):this.gl.renderbufferStorage(36161,t,e,n),this.format=t,this.width=e,this.height=n,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*o[this.format].bpp),this}resize({width:t,height:e}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}},function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var i="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:t,o=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var a={get passive(){return o=!0,!0}};r.addEventListener("test",a,a),r.removeEventListener("test",a,a)}catch(t){}}).call(this,n(61))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return i}));"undefined"!=typeof window&&window,void 0!==t||window;var i="undefined"!=typeof document?document:{}}).call(this,n(61))},function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s}));var i=n(13);const r={};function o(t="id"){r[t]=r[t]||1;const e=r[t]++;return"".concat(t,"-").concat(e)}function a(t){return Object(i.a)("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function s(t){let e=!0;for(const n in t){e=!1;break}return e}},,function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));let i="";const r={};function o(t){i=t}function a(){return i}function s(t){for(const e in r)if(t.startsWith(e)){const n=r[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(i).concat(t)),t}},function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return s}));var i=n(65),r=n(62);function o(t,e){return Object(i.a)(t>=0),Object(i.a)(e>0),t+(e-1)&~(e-1)}function a(t,e,n){return Object(r.c)(t,e,n)}function s(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const e=t.byteOffset,n=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,e,n)}return e.set(i,n),n+o(i.byteLength,4)}},function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u}));var i=n(42),r=n(36);const o=()=>{const t=Object(r.b)();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function a(t){const e=o();t=Array.isArray(t)?t:[t];for(const n of t){const t=Object(i.b)(n);e.find(e=>t===e)||e.unshift(t)}}function s(){return o()}function u(){Object(r.b)().loaderRegistry=[]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(35),r=n(16),o=n(22),a=n(2);class s extends i.a{constructor(t={}){const{latitude:e=0,longitude:n=0,zoom:i=11,pitch:o=0,bearing:s=0,nearZMultiplier:u=.1,farZMultiplier:c=1.01,orthographic:l=!1,repeat:h=!1,worldOffset:p=0}=t;let{width:f,height:d,altitude:A=1.5}=t;const g=Math.pow(2,i);f=f||1,d=d||1,A=Math.max(.75,A);const{fov:m,aspect:y,focalDistance:v,near:_,far:b}=Object(r.h)({width:f,height:d,pitch:o,altitude:A,nearZMultiplier:u,farZMultiplier:c});let x=Object(r.i)({height:d,pitch:o,bearing:s,scale:g,altitude:A});if(p){x=(new a.a).translate([512*p,0,0]).multiplyLeft(x)}super({...t,width:f,height:d,viewMatrix:x,longitude:n,latitude:e,zoom:i,orthographic:l,fovyRadians:m,aspect:y,focalDistance:l?v:1,near:_,far:b}),this.latitude=e,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=A,this.orthographic=l,this._subViewports=h?[]:null,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let t=e;t<=n;t++){const e=t?new s({...this,worldOffset:t}):this;this._subViewports.push(e)}}return this._subViewports}addMetersToLngLat(t,e){return Object(r.a)(t,e)}getMapCenterByLngLatPosition({lngLat:t,pos:e}){const n=Object(r.l)(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),a=o.a([],i,o.d([],n)),s=o.a([],this.center,a);return this.unprojectFlat(s)}getBounds(t={}){const e=Object(r.d)(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:n,height:i}=this,{longitude:o,latitude:a,zoom:u}=Object(r.b)({width:n,height:i,bounds:t,...e});return new s({width:n,height:i,longitude:o,latitude:a,zoom:u})}}s.displayName="WebMercatorViewport"},function(t,e,n){"use strict";n.d(e,"a",(function(){return y})),n.d(e,"b",(function(){return v}));var i=n(2),r=n(56),o=n(113),a=n(16),s=n(31),u=n(49),c=n(43);const l={transitionDuration:300,transitionEasing:t=>t,transitionInterpolator:new u.a,transitionInterruption:c.a.BREAK},h=0,p=0,f=1.5,d=0,A=20,g=0,m=60;class y extends o.a{constructor({makeViewport:t,width:e,height:n,latitude:i,longitude:r,zoom:o,bearing:a=p,pitch:u=h,altitude:c=f,maxZoom:l=A,minZoom:y=d,maxPitch:v=m,minPitch:_=g,startPanLngLat:b,startZoomLngLat:x,startRotatePos:w,startBearing:E,startPitch:T,startZoom:S}={}){Object(s.a)(Number.isFinite(r)),Object(s.a)(Number.isFinite(i)),Object(s.a)(Number.isFinite(o)),super({width:e,height:n,latitude:i,longitude:r,zoom:o,bearing:a,pitch:u,altitude:c,maxZoom:l,minZoom:y,maxPitch:v,minPitch:_}),this._state={startPanLngLat:b,startZoomLngLat:x,startRotatePos:w,startBearing:E,startPitch:T,startZoom:S},this.makeViewport=t}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const n=this._state.startPanLngLat||this._unproject(e);if(!n)return this;const[i,r]=this._calculateNewLngLat({startPanLngLat:n,pos:t});return this._getUpdatedState({longitude:i,latitude:r})}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:o}=this._state;if(!i||!Number.isFinite(r)||!Number.isFinite(o))return this;let a;return a=t?this._calculateNewPitchAndBearing({...this._getRotationParams(t,i),startBearing:r,startPitch:o}):{bearing:r+e,pitch:o+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this._viewportProps.zoom})}zoom({pos:t,startPos:e,scale:n}){let{startZoom:i,startZoomLngLat:r}=this._state;Number.isFinite(i)||(i=this._viewportProps.zoom,r=this._unproject(e)||this._unproject(t));const o=this._calculateNewZoom({scale:n,startZoom:i}),a=this.makeViewport({...this._viewportProps,zoom:o}),[s,u]=a.getMapCenterByLngLatPosition({lngLat:r,pos:t});return this._getUpdatedState({zoom:o,longitude:s,latitude:u})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),n={...this._viewportProps},{bearing:i,longitude:r}=n;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}_zoomFromCenter(t){const{width:e,height:n}=this._viewportProps;return this.zoom({pos:[e/2,n/2],scale:t})}_panFromCenter(t){const{width:e,height:n}=this._viewportProps;return this.pan({startPos:[e/2,n/2],pos:[e/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...t})}_applyConstraints(t){const{maxZoom:e,minZoom:n,zoom:r}=t;t.zoom=Object(i.e)(r,n,e);const{maxPitch:o,minPitch:s,pitch:u}=t;return t.pitch=Object(i.e)(u,s,o),Object.assign(t,Object(a.k)(t)),t}_unproject(t){const e=this.makeViewport(this._viewportProps);return t&&e.unproject(t)}_calculateNewLngLat({startPanLngLat:t,pos:e}){return this.makeViewport(this._viewportProps).getMapCenterByLngLatPosition({lngLat:t,pos:e})}_calculateNewZoom({scale:t,startZoom:e}){const{maxZoom:n,minZoom:r}=this._viewportProps,o=e+Math.log2(t);return Object(i.e)(o,r,n)}_calculateNewPitchAndBearing({deltaScaleX:t,deltaScaleY:e,startBearing:n,startPitch:r}){e=Object(i.e)(e,-1,1);const{minPitch:o,maxPitch:a}=this._viewportProps;let s=r;return e>0?s=r+e*(a-r):e<0&&(s=r-e*(o-r)),{pitch:s,bearing:n+180*t}}_getRotationParams(t,e){const n=t[0]-e[0],i=t[1]-e[1],r=t[1],o=e[1],{width:a,height:s}=this._viewportProps,u=n/a;let c=0;return i>0?Math.abs(s-o)>5&&(c=i/(o-s)*1.2):i<0&&o>5&&(c=1-r/o),c=Math.min(1,Math.max(-1,c)),{deltaScaleX:u,deltaScaleY:c}}}class v extends r.a{constructor(t){t.dragMode=t.dragMode||"pan",super(y,t)}_getTransitionProps(t){return t?{...l,transitionInterpolator:new u.a({...t,makeViewport:this.controllerState.makeViewport})}:l}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(2),r=n(31);class o{constructor(t={}){Array.isArray(t)&&(t={compare:t,extract:t,required:t});const{compare:e,extract:n,required:i}=t;this._propsToCompare=e,this._propsToExtract=n,this._requiredProps=i}arePropsEqual(t,e){for(const n of this._propsToCompare||Object.keys(e))if(!(n in t&&n in e&&Object(i.f)(t[n],e[n])))return!1;return!0}initializeProps(t,e){let n;if(this._propsToExtract){const i={},r={};for(const n of this._propsToExtract)i[n]=t[n],r[n]=e[n];n={start:i,end:r}}else n={start:t,end:e};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}interpolateProps(t,e,n){return e}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const n=t[e];Object(r.a)(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(32),r=n(263),o=n(130),a=n(42),s=n(36),u=n(85),c=n(84),l=n(59),h=n(74);async function p(t,e,n,f){Object(i.a)(!f||"string"!=typeof f,"parse no longer accepts final url"),!e||Array.isArray(e)||Object(a.a)(e)||(f=n,n=e,e=null),t=await t,n=n||{};const{url:d}=Object(l.b)(t),A=Object(c.b)(e,f),g=await Object(h.a)(t,A,n);return g?(n=Object(s.c)(n,g,A,d),f=Object(c.a)({url:d,parse:p,loaders:A},n,f),await async function(t,e,n,a){if(Object(r.b)(t),e=await Object(u.a)(e,t),t.parseTextSync&&"string"==typeof e)return n.dataType="text",t.parseTextSync(e,n,a,t);if(Object(o.a)(t,e,n,a))return await Object(o.b)(t,e,n,a,p);if(t.parseText&&"string"==typeof e)return await t.parseText(e,n,a,t);if(t.parse)return await t.parse(e,n,a,t);return Object(i.a)(!t.parseSync),Object(i.a)(!1)}(g,t,n,f)):null}},function(t,e,n){"use strict";var i=n(5),r=n(153),o=n(41),a=n(2),s=n(70);class u extends s.a{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:r}}=this,o=r(t/i);this._value=Object(a.g)(e,n,o)}}function c(t,e,n,i,r){const o=e-t;return(n-e)*r+-o*i+o+e}function l(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class h extends s.a{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:r=t,_currValue:o=t}=this;let a=function(t,e,n,i,r){if(Array.isArray(n)){const o=[];for(let a=0;a<n.length;a++)o[a]=c(t[a],e[a],n[a],i,r);return o}return c(t,e,n,i,r)}(r,o,e,n,i);const s=l(a,e),u=l(a,o);s<1e-5&&u<1e-5&&(a=e,this.end()),this._prevValue=o,this._currValue=a}}var p=n(6);const f={interpolation:u,spring:h};class d{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:r}=this;if(r.has(t)){const n=r.get(t),{value:i=n.settings.fromValue}=n;e=i,this.remove(t)}if(!(i=Object(o.e)(i)))return;const a=f[i.type];if(!a)return void p.a.error("unsupported transition type '".concat(i.type,"'"))();const s=new a(this.timeline);s.start({...i,fromValue:e,toValue:n}),r.set(t,s)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}var A=n(128),g=n(152),m=n(25),y=n(0),v=n(31),_=n(75),b=n(151),x=n(136),w=n(64),E=n(40),T=n(45),S=n(116);const P={10241:9987,10240:9729,10242:33071,10243:33071},M={};const C={boolean:{validate:(t,e)=>!0,equal:(t,e,n)=>Boolean(t)===Boolean(e)},number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},color:{validate:(t,e)=>e.optional&&!t||R(t)&&(3===t.length||4===t.length),equal:(t,e,n)=>I(t,e)},accessor:{validate(t,e){const n=k(t);return"function"===n||n===k(e.value)},equal:(t,e,n)=>"function"==typeof e||I(t,e)},array:{validate:(t,e)=>e.optional&&!t||R(t),equal:(t,e,n)=>n.compare?I(t,e):t===e},function:{validate:(t,e)=>e.optional&&!t||"function"==typeof t,equal:(t,e,n)=>!n.compare||t===e},data:{transform:(t,e,n)=>{const{dataTransform:i}=n?n.props:{};return i&&t?i(t):t}},image:{transform:(t,e,n)=>function(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof S.a)return e;e.constructor&&"Object"!==e.constructor.name&&(e={data:e});let i=null;e.compressed&&(i={10241:e.data.length>1?9985:9729});const r=new S.a(n,{...e,parameters:{...P,...i,...t.props.textureParameters}});return M[r.id]=!0,r}(n,t),release:t=>{var e;(e=t)&&e instanceof S.a&&M[e.id]&&(e.delete(),delete M[e.id])}}};function I(t,e){if(t===e)return!0;if(!R(t)||!R(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function O(t,e){switch(k(e)){case"object":return L(t,e);case"array":return L(t,{type:"array",value:e,compare:!1});case"boolean":return L(t,{type:"boolean",value:e});case"number":return L(t,{type:"number",value:e});case"function":return L(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function L(t,e){return"type"in e?{name:t,...C[e.type],...e}:"value"in e?{name:t,type:k(e.value),...e}:{name:t,type:"object",value:e}}function R(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function k(t){return R(t)?"array":null===t?"null":typeof t}const{COMPONENT:D,ASYNC_ORIGINAL:B,ASYNC_RESOLVED:F,ASYNC_DEFAULTS:z}=E.b;function N(){const t=this,e=j(t.constructor),n=Object.create(e);n[D]=t,n[B]={},n[F]={};for(let t=0;t<arguments.length;++t){const e=arguments[t];for(const t in e)n[t]=e[t]}return Object.freeze(n),n}function j(t){const e=G(t,"_mergedDefaultProps");return e||(function(t){if(!t.prototype)return;const e=Object.getPrototypeOf(t),n=j(e),i=function(t){const e={},n={},i={};for(const[r,o]of Object.entries(t))if(o&&o.deprecatedFor)i[r]=Array.isArray(o.deprecatedFor)?o.deprecatedFor:[o.deprecatedFor];else{const t=O(r,o);e[r]=t,n[r]=t.value}return{propTypes:e,defaultProps:n,deprecatedProps:i}}(G(t,"defaultProps")||{}),r=function(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=function(t){const e=G(t,"layerName")||G(t,"componentName");e||p.a.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}(i.defaultProps,n,t),o={...e._propTypes,...i.propTypes};!function(t,e){const n={},i={};for(const t in e){const r=e[t],{name:o,value:a}=r;r.async&&(n[o]=a,i[o]=U(o))}t[z]=n,t[B]={},Object.defineProperties(t,i)}(r,o);const a={...e._deprecatedProps,...i.deprecatedProps};(function(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(t){const i="".concat(this.id,": ").concat(n);for(const i of e[n])V(this,i)||(this[i]=t);p.a.deprecated(i,e[n].join("/"))()}})})(r,a),t._mergedDefaultProps=r,t._propTypes=o,t._deprecatedProps=a}(t),t._mergedDefaultProps)}function U(t){return{enumerable:!0,set(e){"string"==typeof e||e instanceof Promise||Object(T.c)(e)?this[B][t]=e:this[F][t]=e},get(){if(this[F]){if(t in this[F]){return this[F][t]||this[z][t]}if(t in this[B]){const e=this[D]&&this[D].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[z][t]}}return this[z][t]}}}function V(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function G(t,e){return V(t,e)&&t[e]}const{ASYNC_ORIGINAL:W,ASYNC_RESOLVED:H,ASYNC_DEFAULTS:q}=E.b,X=Object.freeze({});class Z{constructor(t=null){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=X,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){const e=t[H]||{},n=t[W]||t,i=t[q]||{};for(const t in e){const n=e[t];this._createAsyncPropData(t,i[t]),this._updateAsyncProp(t,n),e[t]=this.getAsyncProp(t)}for(const t in n){const e=n[t];this._createAsyncPropData(t,i[t]),this._updateAsyncProp(t,e)}}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e){const n=this.layer&&this.layer.props.fetch,i=e;n&&(e=n(i,{propName:t,layer:this.layer}))}e instanceof Promise?this._watchPromise(t,e):Object(T.c)(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e)}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e!==n.resolvedValue&&e!==n.lastValue&&(n.lastValue=e,!0)}_setPropValue(t,e){const n=this.asyncProps[t];e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&void 0!==e&&(this.freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];n.pendingLoadCount++;const i=n.pendingLoadCount;e.then(e=>{e=this._postProcessValue(n,e),this._setAsyncPropValue(t,e,i);const r=this.layer&&this.layer.props.onDataLoad;"data"===t&&r&&r(e,{propName:t,layer:this.layer})}).catch(t=>p.a.error(t)())}async _resolveAsyncIterable(t,e){"data"!==t&&this._setPropValue(t,e);const n=this.asyncProps[t];n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],o=0;for await(const n of e){const{dataTransform:e}=this.component?this.component.props:{};r=e?e(n,r):r.concat(n),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(t,r,i)}const a=this.layer&&this.layer.props.onDataLoad;a&&a(r,{propName:t,layer:this.layer})}_postProcessValue(t,e){const n=t.type;return n&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}const{ASYNC_ORIGINAL:Q,ASYNC_RESOLVED:Y,ASYNC_DEFAULTS:K}=E.b;let J=0;class ${constructor(){this.props=N.apply(this,arguments),this.id=this.props.id,this.count=J++,this.lifecycle=E.a.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}clone(t){const{props:e}=this,n={};for(const t in e[K])t in e[Y]?n[t]=e[Y][t]:t in e[Q]&&(n[t]=e[Q][t]);return new this.constructor({...e,...n,...t})}get stats(){return this.internalState.stats}_initState(){this.internalState=new Z({})}}$.componentName="Component",$.defaultProps={};class tt extends Z{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(t){this.component=t}}var et=n(16),nt=n(206);n.d(e,"a",(function(){return st}));const it=Object.freeze([]),rt=Object(_.a)(({oldViewport:t,viewport:e})=>t.equals(e));let ot=new Uint8ClampedArray(0);const at={data:{type:"data",value:it,async:!0},dataComparator:null,_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n})=>{const{resourceManager:i}=n.context,r=n.getLoadOptions(),{loaders:o}=n.props;let a=i.contains(t);return a||r||(i.add({resourceId:t,data:Object(nt.a)(t,o),persistent:!1}),a=!0),a?i.subscribe({resourceId:t,onChange:t=>n.internalState.reloadAsyncProp(e,t),consumerId:n.id,requestId:e}):Object(nt.a)(t,o,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:i.a.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,100*-t],compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class st extends ${toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(t=!0){this.internalState&&(this.internalState.needsRedraw=t)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(t){const{viewport:e}=this.context,n=Object(x.a)(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=Object(et.n)(n,e.pixelProjectionMatrix);return 2===t.length?[i,r]:[i,r,o]}unproject(t){const{viewport:e}=this.context;return e.unproject(t)}projectPosition(t){return Object(x.b)(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===i.a.DEFAULT||t===i.a.LNGLAT||t===i.a.CARTESIAN}onHover(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}onClick(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Object(v.a)(t instanceof Uint8Array);const[e,n,i]=t;return e+256*n+65536*i-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(t){for(const e of this.props.extensions)t=Object(b.a)(t,e.getShaders.call(this,e));return t}shouldUpdateState({oldProps:t,props:e,context:n,changeFlags:i}){return i.propsOrDataChanged}updateState({oldProps:t,props:e,context:n,changeFlags:i}){const r=this.getAttributeManager();if(i.dataChanged&&r){const{dataChanged:t}=i;if(Array.isArray(t))for(const e of t)r.invalidateAll(e);else r.invalidateAll()}const o=t.highlightedObjectIndex>=0||t.pickable,a=e.highlightedObjectIndex>=0||e.pickable;if(o!==a&&r){const{pickingColors:t,instancePickingColors:e}=r.attributes,n=t||e;n&&(a&&n.constant&&(n.constant=!1,r.invalidate(n.id)),n.value||a||(n.constant=!0,n.value=[0,0,0]))}}finalizeState(){for(const t of this.getModels())t.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo({info:t,mode:e}){const{index:n}=t;return n>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[n]),t}activateViewport(t){const e=this.internalState.viewport;this.internalState.viewport=t,e&&rt({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all",e=""){const n=this.getAttributeManager();n&&("all"===t?n.invalidateAll():n.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(t){const e=this.getAttributeManager();if(!e)return;const n=this.getNumInstances(t),i=this.getStartIndices(t);e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this,ignoreUnknownAttributes:!0});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const t in e)Object.defineProperty(n,t,{value:e[t]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const n=ot.length/3;if(this.internalState.usesPickingColorCache=!0,n<e){e>2**24-1&&p.a.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ot=w.a.allocate(ot,e,{size:3,copy:!0,maxCount:Math.max(e,2**24-1)});const t=ot.length/3,i=[];for(let e=n;e<t;e++)this.encodePickingColor(e,i),ot[3*e+0]=i[0],ot[3*e+1]=i[1],ot[3*e+2]=i[2]}t.value=ot.subarray(0,3*e)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},r=n.getShaderAttributes(e,i);t.setAttributes(r)}disablePickingIndex(t){this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n,r=i.getVertexOffset(t),o=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(o-r),offset:r})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;this.internalState.usesPickingColorCache&&n.value.buffer!==ot.buffer&&(n.value=ot.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0})}getNumInstances(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Object(g.a)(t.data)}getStartIndices(t){return void 0!==(t=t||this.props).startIndices?t.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){Object(m.a)("layer.initialize",this),this._initState(),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const t=this.needsUpdate();Object(m.a)("layer.update",this,t),t&&this._updateState()}_updateState(){const t=this.props,e=this.context.viewport,n=this._updateUniformTransition();this.internalState.propsInTransition=n,this.context.viewport=this.internalState.viewport||e,this.props=n;try{const n=this._getUpdateParams(),i=this.getModels();if(this.context.gl)this.updateState(n);else try{this.updateState(n)}catch(t){}for(const t of this.props.extensions)t.updateState.call(this,n,t);const r=this.getModels()[0]!==i[0];this._updateModules(n,r),this.isComposite?this._renderLayers(n):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=e,this.props=t,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){Object(m.a)("layer.finalize",this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,t)}drawLayer({moduleParameters:t=null,uniforms:e={},parameters:n={}}){this._updateAttributeTransition();const i=this.props;this.props=this.internalState.propsInTransition||i;const{opacity:r}=this.props;e.opacity=Math.pow(r,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:r}=this.props,o=r&&r(e)||[0,0];Object(y.n)(this.context.gl,{polygonOffset:o}),Object(y.o)(this.context.gl,n,()=>{const i={moduleParameters:t,uniforms:e,parameters:n,context:this.context};for(const t of this.props.extensions)t.draw.call(this,i,t);this.draw(i)})}finally{this.props=i}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(t){const{changeFlags:e}=this.internalState;for(const n in t)if(t[n]){let i=!1;switch(n){case"dataChanged":Array.isArray(e[n])&&(e[n]=Array.isArray(t[n])?e[n].concat(t[n]):t[n],i=!0);default:e[n]||(e[n]=t[n],i=!0)}i&&Object(m.a)("layer.changeFlag",this,n,t)}const n=e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged;e.propsOrDataChanged=n,e.somethingChanged=n||t.viewportChanged||t.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(t,e){const n=Object(A.b)(t,e);if(n.updateTriggersChanged)for(const t in n.updateTriggersChanged)n.updateTriggersChanged[t]&&this.invalidateAttribute(t);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,e[i],t[i],t.transitions[i]);return this.setChangeFlags(n)}validateProps(){Object(A.c)(this.props)}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}updateAutoHighlight(t){this.props.autoHighlight&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&"function"==typeof n&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_updateModules({props:t,oldProps:e},n){const{autoHighlight:i,highlightedObjectIndex:r,highlightColor:o}=t;if(n||e.autoHighlight!==i||e.highlightedObjectIndex!==r||e.highlightColor!==o){const t={};i||(t.pickingSelectedColor=null),Array.isArray(o)&&(t.pickingHighlightColor=o),Number.isInteger(r)&&(t.pickingSelectedColor=r>=0?this.encodePickingColor(r):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;const n=this.getAttributeManager(),i=n&&n.getNeedsRedraw(t);return e=e||i,e}_getAttributeManager(){return new r.a(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){Object(v.a)(!this.internalState&&!this.state),Object(v.a)(isFinite(this.props.coordinateSystem));const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new tt({attributeManager:t,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(p.a.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),t)}),this.internalState.layer=this,this.internalState.uniformTransitions=new d(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(t){Object(m.a)("layer.matched",this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}st.layerName="Layer",st.defaultProps=at},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(285),a=n(224),s=n(5),u=n(261),c=n(191),l=n(170),h=n(58),p=n(138),f=n(209),d=n(47);class A extends f.a{constructor(t){const{fp64:e,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:e}=this;return"indices"===t?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;e&&(this.vertexCount=(e.value||e).length)}normalizeGeometry(t){if(this.normalize){if(t=p.b(t,this.positionSize),this.opts.resolution)return Object(d.b)(t.positions||t,t.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return Object(d.c)(t.positions||t,t.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return t}getGeometrySize(t){if(Array.isArray(t)&&!Number.isFinite(t[0])){let e=0;for(const n of t)e+=this.getGeometrySize(n);return e}return(t.positions||t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):()=>null}updateGeometryAttributes(t,e){if(Array.isArray(t)&&!Number.isFinite(t[0]))for(const n of t){const t=this.getGeometrySize(n);e.geometrySize=t,this.updateGeometryAttributes(n,e),e.vertexStart+=t,e.indexStart=this.indexStarts[e.geometryIndex+1]}else this._updateIndices(t,e),this._updatePositions(t,e),this._updateVertexValid(t,e)}_updateIndices(t,{geometryIndex:e,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:o,typedArrayManager:a}=this;let s=r.indices;if(!s)return;let u=i;const c=p.a(t,this.positionSize,this.opts.preproject);s=a.allocate(s,i+c.length,{copy:!0});for(let t=0;t<c.length;t++)s[u++]=c[t]+n;o[e+1]=i+c.length,r.indices=s}_updatePositions(t,{vertexStart:e,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i)return;const o=t.positions||t;for(let t=e,a=0;a<n;t++,a++){const e=o[a*r],n=o[a*r+1],s=r>2?o[a*r+2]:0;i[3*t]=e,i[3*t+1]=n,i[3*t+2]=s}}_updateVertexValid(t,{vertexStart:e,geometrySize:n}){const{attributes:{vertexValid:i},positionSize:r}=this,o=t&&t.holeIndices;if(t&&t.edgeTypes?i.set(t.edgeTypes,e):i.fill(1,e,e+n),o)for(let t=0;t<o.length;t++)i[e+o[t]/r-1]=0;i[e+n-1]=0}}var g="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",m="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(g,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),y="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(g,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n");n.d(e,"a",(function(){return x}));const v=[0,0,0,255],_={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:v},getLineColor:{type:"accessor",value:v},material:!0},b={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class x extends i.a{getShaders(t){return super.getShaders({vs:"top"===t?m:y,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[r.a,o.a,a.a]})}get wrapLongitude(){return!1}initializeState(){const{gl:t,viewport:e}=this.context;let{coordinateSystem:n}=this.props;e.isGeospatial&&n===s.a.DEFAULT&&(n=s.a.LNGLAT),this.setState({numInstances:0,polygonTesselator:new A({preproject:n===s.a.LNGLAT&&e.projectFlat,fp64:this.use64bitPositions(),IndexType:!t||Object(u.c)(t,c.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const i=this.getAttributeManager();i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:b,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:b,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:b,accessor:"getFillColor",defaultValue:v,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:b,accessor:"getLineColor",defaultValue:v,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(t,{index:e,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,n),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:n}=e,{data:i}=this.props;return i[0]&&i[0].__source&&(e.object=i.find(t=>t.__source.index===n)),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let n=0;n<e.length;n++)e[n].__source.index===t&&this._disablePickingIndex(n);else this._disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:o,sideModel:a,polygonTesselator:s}=this.state,u={...t,extruded:Boolean(e),elevationScale:r};a&&(a.setInstanceCount(s.instanceCount-1),a.setUniforms(u),i&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),n&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(s.vertexCount),o.setUniforms(u).draw())}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:n,changeFlags:i}=t,r=this.getAttributeManager();var o;(i.extensionsChanged||e.filled!==n.filled||e.extruded!==n.extruded)&&(null===(o=this.state.models)||void 0===o||o.forEach(t=>t.delete()),this.setState(this._getModels(this.context.gl)),r.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:e}=this.state,i=t.data.attributes||{};e.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(t){const{id:e,filled:n,extruded:i}=this.props;let r,o;if(n){const n=this.getShaders("top");n.defines.NON_INSTANCED_MODEL=1,r=new l.a(t,{...n,id:"".concat(e,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(o=new l.a(t,{...this.getShaders("side"),id:"".concat(e,"-side"),geometry:new h.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,r].filter(Boolean),topModel:r,sideModel:o}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}x.layerName="SolidPolygonLayer",x.defaultProps=_},function(t,e,n){"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";var i=n(5),r=n(93),o=n(2),a=n(75),s=n(16);const u=Object(a.a)((function({viewport:t,center:e}){return new o.a(t.viewProjectionMatrix).invert().transform(e)})),c=Object(a.a)((function({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,a=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(t=>function(t,e){const[n,i,r]=t,o=Object(s.l)([n,i,r],e);if(Number.isFinite(r))return o;return[o[0],o[1],0]}(t,i));for(const i of e){const e=i.clone().translate(new o.c(t.center).negate()),r=a.map(t=>e.transform(t)),s=(new o.a).ortho({left:Math.min(...r.map(t=>t[0])),right:Math.max(...r.map(t=>t[0])),bottom:Math.min(...r.map(t=>t[1])),top:Math.max(...r.map(t=>t[1])),near:Math.min(...r.map(t=>-t[2])),far:Math.max(...r.map(t=>-t[2]))});n.push(s.multiplyRight(i))}return n})),l=[0,0,0,1],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];e.a={name:"shadow",dependencies:[r.a],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(t={},e={})=>{if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){const{shadowEnabled:n=!0}=t;return n&&t.shadowMatrices&&t.shadowMatrices.length>0?function(t={},e={}){const n={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||l,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=u({viewport:t.viewport,center:e.project_uCenter}),a=[],s=c({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let n=0;n<t.shadowMatrices.length;n++){const u=s[n],c=u.clone().translate(new o.c(t.viewport.center).negate());e.project_uCoordinateSystem===i.a.LNGLAT&&e.project_uProjectionMode===i.c.WEB_MERCATOR?(s[n]=c,a[n]=r):(s[n]=u.clone().multiplyRight(h),a[n]=c.transform(r))}for(let e=0;e<s.length;e++)n["shadow_uViewProjectionMatrices[".concat(e,"]")]=s[e],n["shadow_uProjectCenters[".concat(e,"]")]=a[e],t.shadowMaps&&t.shadowMaps.length>0?n["shadow_uShadowMap".concat(e)]=t.shadowMaps[e]:n["shadow_uShadowMap".concat(e)]=t.dummyShadowMap;return n}(t,e):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return f})),n.d(e,"b",(function(){return d}));var i=n(8),r=n(19),o=n(5),a=n(75);const s=[0,0,0,0],u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[0,0,0],h=[0,0,0],p=Object(a.a)((function({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:a}){const{projectionCenter:c,viewProjectionMatrix:h,cameraPosCommon:p,shaderCoordinateOrigin:d,geospatialOrigin:A}=function(t,e,n){const{viewMatrixUncentered:o,projectionMatrix:a}=t;let{viewMatrix:c,viewProjectionMatrix:l}=t,h=s,p=t.cameraPosition;const{geospatialOrigin:d,shaderCoordinateOrigin:A,offsetMode:g}=f(t,e,n);if(g){const e=t.projectPosition(d||A);p=[p[0]-e[0],p[1]-e[1],p[2]-e[2]],e[3]=1,h=r.n([],e,l),c=o||c,l=i.h([],a,c),l=i.h([],l,u)}return{viewMatrix:c,viewProjectionMatrix:l,projectionCenter:h,cameraPosCommon:p,shaderCoordinateOrigin:A,geospatialOrigin:d}}(t,n,a),g=t.getDistanceScales(),m=[t.width*e,t.height*e],y={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:d,project_uCenter:c,project_uViewportSize:m,project_uDevicePixelRatio:e,project_uFocalDistance:t.focalDistance||1,project_uCommonUnitsPerMeter:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit:g.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:l,project_uScale:t.scale,project_uViewProjectionMatrix:h,project_uCameraPosition:p};if(A){const e=t.getDistanceScales(A);switch(n){case o.a.METER_OFFSETS:y.project_uCommonUnitsPerWorldUnit=e.unitsPerMeter,y.project_uCommonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case o.a.LNGLAT:case o.a.LNGLAT_OFFSETS:y.project_uCommonUnitsPerWorldUnit=e.unitsPerDegree,y.project_uCommonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case o.a.CARTESIAN:y.project_uCommonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],y.project_uCommonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]]}}return y}));function f(t,e,n=h){let i,r=n,a=!0;switch(i=e===o.a.LNGLAT_OFFSETS||e===o.a.METER_OFFSETS?n:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case o.c.WEB_MERCATOR:e!==o.a.LNGLAT&&e!==o.a.CARTESIAN||(a=!1);break;case o.c.WEB_MERCATOR_AUTO_OFFSET:e===o.a.LNGLAT?r=i:e===o.a.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case o.c.IDENTITY:r=t.position.map(Math.fround);break;case o.c.GLOBE:a=!1,i=null;break;default:a=!1}return r[2]=r[2]||0,{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:a}}function d({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=o.a.DEFAULT,coordinateOrigin:r,autoWrapLongitude:a=!1}={}){i===o.a.DEFAULT&&(i=t.isGeospatial?o.a.LNGLAT:o.a.CARTESIAN);const s=p({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return s.project_uWrapLongitude=a,s.project_uModelMatrix=n||c,s}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{constructor(t){this._viewportProps=this._applyConstraints(t)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(t){return this._viewportProps}_applyConstraints(t){return t}}},function(t,e,n){"use strict";var i=n(166),r=n(65),o=n(79),a=n(62);function s(t){if(o.c||o.e>=10){if("function"==typeof t[Symbol.asyncIterator])return async function*(t){for await(const e of t)yield Object(a.d)(e)}(t);if("function"==typeof t.getIterator)return t.getIterator()}return o.c?async function*(t){const e=t.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield Object(a.d)(n)}}catch(t){e.releaseLock()}}(t):async function*(t){t=await t;for(;;){const e=t.read();if(null===e){if(t._readableState.ended)return;await u(t)}else yield Object(a.d)(e)}}(t)}async function u(t){return new Promise(e=>{t.once("readable",e)})}var c=n(10);function l(t,e={}){return"string"==typeof t?function*(t,e={}){const{chunkSize:n=262144}=e;let i=0;const r=new TextEncoder;for(;i<t.length;){const e=Math.min(t.length-i,n),o=t.slice(i,i+e);i+=e,yield r.encode(o)}}(t,e):t instanceof ArrayBuffer?function*(t,e={}){const{chunkSize:n=262144}=e;let i=0;for(;i<t.byteLength;){const e=Math.min(t.byteLength-i,n),r=new ArrayBuffer(e),o=new Uint8Array(t,i,e);new Uint8Array(r).set(o),i+=e,yield r}}(t,e):Object(c.b)(t)?Object(i.a)(t,e):Object(c.i)(t)?s(t):Object(c.j)(t)?s(t.body):Object(r.a)(!1)}n.d(e,"a",(function(){return l}))},function(t,e,n){"use strict";var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(110);var c=n(173);function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return Object(c.a)(t,arguments,Object(s.a)(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(u.a)(i,t)})(t)}var h=n(3),p=n(44);function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}n.d(e,"a",(function(){return d}));var d=function(t){Object(o.a)(n,t);var e=f(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Object(h.f)(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(h.b)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Object(h.e)(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(h.d)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var i=0;i<this.ELEMENTS;++i){var r=t[i];this[i]=r+n*(e[i]-r)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var o=r[i],a=0;a<this.ELEMENTS;++a)this[a]+=o[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var o=r[i],a=0;a<this.ELEMENTS;++a)this[a]-=o[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(h.b.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"ELEMENTS",get:function(){return Object(p.a)(!1),0}},{key:"RANK",get:function(){return Object(p.a)(!1),0}},{key:"elements",get:function(){return this}}]),n}(l(Array))},function(t,e,n){"use strict";var i=n(0),r=n(50),o=n(13);let a="";n.d(e,"a",(function(){return s}));class s extends r.a{static isSupported(t,e){return r.a.isSupported(t,e)}constructor(t,e={}){var n,r;Object(i.b)(t),(e instanceof Promise||"string"==typeof e)&&(e={data:e}),"string"==typeof e.data&&(e=Object.assign({},e,{data:(n=e.data,Object(o.a)("string"==typeof n),n=a+n,new Promise((t,e)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>e(new Error("Could not load image ".concat(n,"."))),i.crossOrigin=r&&r.crossOrigin||"anonymous",i.src=n}catch(t){e(t)}}))})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MODULE_VERSION",(function(){return i})),n.d(e,"MODULE_NAME",(function(){return r}));const i="8.5.0-alpha.4",r="@deck.gl/jupyter-widget"},function(t,e,n){var i,r,o;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */r=[],void 0===(o="function"==typeof(i=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},i={};function r(t,e){var r,o,s;return e?(s=0<=(t>>>=0)&&t<256)&&(o=i[t])?o:(r=a(t,(0|t)<0?-1:0,!0),s&&(i[t]=r),r):(s=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(r=a(t,t<0?-1:0,!1),s&&(n[t]=r),r)}function o(t,e){if(isNaN(t)||!isFinite(t))return e?A:d;if(e){if(t<0)return A;if(t>=h)return _}else{if(t<=-p)return b;if(t+1>=p)return v}return t<0?o(-t,e).neg():a(t%l|0,t/l|0,e)}function a(e,n,i){return new t(e,n,i)}t.fromInt=r,t.fromNumber=o,t.fromBits=a;var s=Math.pow;function u(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(t.substring(1),e,n).neg();for(var r=o(s(n,8)),a=d,c=0;c<t.length;c+=8){var l=Math.min(8,t.length-c),h=parseInt(t.substring(c,c+l),n);if(l<8){var p=o(s(n,l));a=a.mul(p).add(o(h))}else a=(a=a.mul(r)).add(o(h))}return a.unsigned=e,a}function c(e){return e instanceof t?e:"number"==typeof e?o(e):"string"==typeof e?u(e):a(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=c;var l=4294967296,h=l*l,p=h/2,f=r(1<<24),d=r(0);t.ZERO=d;var A=r(0,!0);t.UZERO=A;var g=r(1);t.ONE=g;var m=r(1,!0);t.UONE=m;var y=r(-1);t.NEG_ONE=y;var v=a(-1,2147483647,!1);t.MAX_VALUE=v;var _=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_;var b=a(0,-2147483648,!1);t.MIN_VALUE=b;var x=t.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},x.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b)){var e=o(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=o(s(t,6),this.unsigned),a=this,u="";;){var c=a.div(r),l=(a.sub(c.mul(r)).toInt()>>>0).toString(t);if((a=c).isZero())return l+u;for(;l.length<6;)l="0"+l;u=""+l+u}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1==(1&this.low)},x.isEven=function(){return 0==(1&this.low)},x.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(b)?b:this.not().add(g)},x.neg=x.negate,x.add=function(t){e(t)||(t=c(t));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,s=t.high>>>16,u=65535&t.high,l=t.low>>>16,h=0,p=0,f=0,d=0;return f+=(d+=o+(65535&t.low))>>>16,p+=(f+=r+l)>>>16,h+=(p+=i+u)>>>16,h+=n+s,a((f&=65535)<<16|(d&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},x.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return d;if(e(t)||(t=c(t)),t.isZero())return d;if(this.eq(b))return t.isOdd()?b:d;if(t.eq(b))return this.isOdd()?b:d;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(f)&&t.lt(f))return o(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,u=t.high>>>16,l=65535&t.high,h=t.low>>>16,p=65535&t.low,A=0,g=0,m=0,y=0;return m+=(y+=s*p)>>>16,g+=(m+=r*p)>>>16,m&=65535,g+=(m+=s*h)>>>16,A+=(g+=i*p)>>>16,g&=65535,A+=(g+=r*h)>>>16,g&=65535,A+=(g+=s*l)>>>16,A+=n*p+i*h+r*l+s*u,a((m&=65535)<<16|(y&=65535),(A&=65535)<<16|(g&=65535),this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?A:d;var n,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return A;if(t.gt(this.shru(1)))return m;r=A}else{if(this.eq(b))return t.eq(g)||t.eq(y)?b:t.eq(b)?g:(n=this.shr(1).div(t).shl(1)).eq(d)?t.isNegative()?g:y:(i=this.sub(t.mul(n)),r=n.add(i.div(t)));if(t.eq(b))return this.unsigned?A:d;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=d}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),u=a<=48?1:s(2,a-48),l=o(n),h=l.mul(t);h.isNegative()||h.gt(i);)h=(l=o(n-=u,this.unsigned)).mul(t);l.isZero()&&(l=g),r=r.add(l),i=i.sub(h)}return r},x.div=x.divide,x.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.not=function(){return a(~this.low,~this.high,this.unsigned)},x.and=function(t){return e(t)||(t=c(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return e(t)||(t=c(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return e(t)||(t=c(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?a(this.low>>>t|n<<32-t,n>>>t,this.unsigned):a(32===t?n:n>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},x.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},x.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){"use strict";n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return h}));var i=n(45),r=n(5);const o=Math.PI/180,a=new Float32Array(16),s=new Float32Array(12);function u(t,e,n){const i=e[0]*o,r=e[1]*o,a=e[2]*o,s=Math.sin(a),u=Math.sin(i),c=Math.sin(r),l=Math.cos(a),h=Math.cos(i),p=Math.cos(r),f=n[0],d=n[1],A=n[2];t[0]=f*p*h,t[1]=f*c*h,t[2]=f*-u,t[3]=d*(-c*l+p*u*s),t[4]=d*(p*l+c*u*s),t[5]=d*h*s,t[6]=A*(c*s+p*u*l),t[7]=A*(-p*s+c*u*l),t[8]=A*h*l}function c(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const l={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:o,getScale:l,getTranslation:h,getTransformMatrix:p}=this.props,f=Array.isArray(p),d=f&&16===p.length,A=Array.isArray(l),g=Array.isArray(o),m=Array.isArray(h),y=d||!f&&Boolean(p(r[0]));t.constant=y?d:g&&A&&m;const v=t.value;if(t.constant){let e;if(y)a.set(p),e=c(a);else{e=s,u(e,o,l),e.set(h,9)}t.value=new Float32Array(e)}else{let f=e*t.size;const{iterable:_,objectInfo:b}=Object(i.a)(r,e,n);for(const t of _){let e;if(b.index++,y)a.set(d?p:p(t,b)),e=c(a);else{e=s,u(e,g?o:o(t,b),A?l:l(t,b)),e.set(m?h:h(t,b),9)}v[f++]=e[0],v[f++]=e[1],v[f++]=e[2],v[f++]=e[3],v[f++]=e[4],v[f++]=e[5],v[f++]=e[6],v[f++]=e[7],v[f++]=e[8],v[f++]=e[9],v[f++]=e[10],v[f++]=e[11]}}}};function h(t,e){return e===r.a.CARTESIAN||e===r.a.METER_OFFSETS||e===r.a.DEFAULT&&!t.isGeospatial}},function(t,e){
/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/
var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i={};function r(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var e=c(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null);this._handle=new a(e),this._handle.streamer=this,this._config=e}.call(this,t),this.parseChunk=function(t,e){if(this.isFirstChunk&&l(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(t);void 0!==n&&(t=n)}this.isFirstChunk=!1;var i=this._partialLine+t;this._partialLine="";var r=this._handle.parse(i,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var o=r.meta.cursor;this._finished||(this._partialLine=i.substring(o-this._baseIndex),this._baseIndex=o),r&&r.data&&(this._rowCount+=r.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(l(this._config.chunk)&&!e){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return;r=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),this._completed||!a||!l(this._config.complete)||r&&r.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),a||r&&r.meta.paused||this._nextChunk(),r}},this._sendError=function(t){l(this._config.error)&&this._config.error(t)}}function o(t){var e;t=t||{},r.call(this,t),this.stream=function(t){return e=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t=this._config.chunkSize,n=t?e.substr(0,t):e;return e=t?e.substr(t):"",this._finished=!e,this.parseChunk(n)}}}function a(t){var e,n,r,o=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,a=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,h=this,p=0,f=0,d=!1,A=!1,g=[],m={data:[],errors:[],meta:{}};if(l(t.step)){var y=t.step;t.step=function(e){if(m=e,b())_();else{if(_(),0===m.data.length)return;p+=e.data.length,t.preview&&p>t.preview?n.abort():y(m,h)}}}function v(e){return"greedy"===t.skipEmptyLines?""===e.join("").trim():1===e.length&&0===e[0].length}function _(){if(m&&r&&(w("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),r=!1),t.skipEmptyLines)for(var e=0;e<m.data.length;e++)v(m.data[e])&&m.data.splice(e--,1);return b()&&function(){if(!m)return;function e(e){l(t.transformHeader)&&(e=t.transformHeader(e)),g.push(e)}if(Array.isArray(m.data[0])){for(var n=0;b()&&n<m.data.length;n++)m.data[n].forEach(e);m.data.splice(0,1)}else m.data.forEach(e)}(),function(){if(!m||!t.header&&!t.dynamicTyping&&!t.transform)return m;function e(e,n){var i,r=t.header?{}:[];for(i=0;i<e.length;i++){var o=i,a=e[i];t.header&&(o=i>=g.length?"__parsed_extra":g[i]),t.transform&&(a=t.transform(a,o)),a=x(o,a),"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(a)):r[o]=a}return t.header&&(i>g.length?w("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+i,f+n):i<g.length&&w("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+i,f+n)),r}var n=1;!m.data[0]||Array.isArray(m.data[0])?(m.data=m.data.map(e),n=m.data.length):m.data=e(m.data,0);t.header&&m.meta&&(m.meta.fields=g);return f+=n,m}()}function b(){return t.header&&0===g.length}function x(e,n){return function(e){return t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping)}(e)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(o.test(n)?parseFloat(n):a.test(n)?new Date(n):""===n?null:n):n}function w(t,e,n,i){m.errors.push({type:t,code:e,message:n,row:i})}this.parse=function(o,a,h){var p=t.quoteChar||'"';if(t.newline||(t.newline=function(t,e){t=t.substr(0,1048576);var n=new RegExp(s(e)+"([^]*?)"+s(e),"gm"),i=(t=t.replace(n,"")).split("\r"),r=t.split("\n"),o=r.length>1&&r[0].length<i[0].length;if(1===i.length||o)return"\n";for(var a=0,u=0;u<i.length;u++)"\n"===i[u][0]&&a++;return a>=i.length/2?"\r\n":"\r"}(o,p)),r=!1,t.delimiter)l(t.delimiter)&&(t.delimiter=t.delimiter(o),m.meta.delimiter=t.delimiter);else{var f=function(e,n,r,o,a){var s,c,l;a=a||[",","\t","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var h=0;h<a.length;h++){var p=a[h],f=0,d=0,A=0;l=void 0;for(var g=new u({comments:o,delimiter:p,newline:n,preview:10}).parse(e),m=0;m<g.data.length;m++)if(r&&v(g.data[m]))A++;else{var y=g.data[m].length;d+=y,void 0!==l?y>1&&(f+=Math.abs(y-l),l=y):l=0}g.data.length>0&&(d/=g.data.length-A),(void 0===c||f>c)&&d>1.99&&(c=f,s=p)}return t.delimiter=s,{successful:!!s,bestDelimiter:s}}(o,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);f.successful?t.delimiter=f.bestDelimiter:(r=!0,t.delimiter=i.DefaultDelimiter),m.meta.delimiter=t.delimiter}var A=c(t);return t.preview&&t.header&&A.preview++,e=o,n=new u(A),m=n.parse(e,a,h),_(),d?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return d},this.pause=function(){d=!0,n.abort(),e=e.substr(n.getCharIndex())},this.resume=function(){d=!1,h.streamer.parseChunk(e,!0)},this.aborted=function(){return A},this.abort=function(){A=!0,n.abort(),m.meta.aborted=!0,l(t.complete)&&t.complete(m),e=""}}function s(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function u(t){var e,n=(t=t||{}).delimiter,r=t.newline,o=t.comments,a=t.step,u=t.preview,c=t.fastMode,h=e=void 0===t.quoteChar?'"':t.quoteChar;if(void 0!==t.escapeChar&&(h=t.escapeChar),("string"!=typeof n||i.BAD_DELIMITERS.indexOf(n)>-1)&&(n=","),o===n)throw new Error("Comment character same as delimiter");!0===o?o="#":("string"!=typeof o||i.BAD_DELIMITERS.indexOf(o)>-1)&&(o=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var p=0,f=!1;this.parse=function(t,i,d){if("string"!=typeof t)throw new Error("Input must be a string");var A=t.length,g=n.length,m=r.length,y=o.length,v=l(a);p=0;var _=[],b=[],x=[],w=0;if(!t)return B();if(c||!1!==c&&-1===t.indexOf(e)){for(var E=t.split(r),T=0;T<E.length;T++){if(x=E[T],p+=x.length,T!==E.length-1)p+=r.length;else if(d)return B();if(!o||x.substr(0,y)!==o){if(v){if(_=[],L(x.split(n)),F(),f)return B()}else L(x.split(n));if(u&&T>=u)return _=_.slice(0,u),B(!0)}}return B()}for(var S,P=t.indexOf(n,p),M=t.indexOf(r,p),C=new RegExp(s(h)+s(e),"g");;)if(t[p]!==e)if(o&&0===x.length&&t.substr(p,y)===o){if(-1===M)return B();p=M+m,M=t.indexOf(r,p),P=t.indexOf(n,p)}else if(-1!==P&&(P<M||-1===M))x.push(t.substring(p,P)),p=P+g,P=t.indexOf(n,p);else{if(-1===M)break;if(x.push(t.substring(p,M)),D(M+m),v&&(F(),f))return B();if(u&&_.length>=u)return B(!0)}else for(S=p,p++;;){if(-1===(S=t.indexOf(e,S+1)))return d||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:p}),k();if(S===A-1)return k(t.substring(p,S).replace(C,e));if(e!==h||t[S+1]!==h){if(e===h||0===S||t[S-1]!==h){var I=R(-1===M?P:Math.min(P,M));if(t[S+1+I]===n){x.push(t.substring(p,S).replace(C,e)),p=S+1+I+g,P=t.indexOf(n,p),M=t.indexOf(r,p);break}var O=R(M);if(t.substr(S+1+O,m)===r){if(x.push(t.substring(p,S).replace(C,e)),D(S+1+O+m),P=t.indexOf(n,p),v&&(F(),f))return B();if(u&&_.length>=u)return B(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:p}),S++}}else S++}return k();function L(t){_.push(t),w=p}function R(e){var n=0;if(-1!==e){var i=t.substring(S+1,e);i&&""===i.trim()&&(n=i.length)}return n}function k(e){return d?B():(void 0===e&&(e=t.substr(p)),x.push(e),p=A,L(x),v&&F(),B())}function D(e){p=e,L(x),x=[],M=t.indexOf(r,p)}function B(t,e){return{data:e||!1?_[0]:_,errors:b,meta:{delimiter:n,linebreak:r,aborted:f,truncated:!!t,cursor:w+(i||0)}}}function F(){a(B(void 0,!0)),_=[],b=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return p}}function c(t){if("object"!=typeof t||null===t)return t;var e=Array.isArray(t)?[]:{};for(var n in t)e[n]=c(t[n]);return e}function l(t){return"function"==typeof t}t.exports=i,i.parse=function(t,e,n){var r=(e=e||{}).dynamicTyping||!1;l(r)&&(e.dynamicTypingFunction=r,r={});if(e.dynamicTyping=r,e.transform=!!l(e.transform)&&e.transform,e.worker&&i.WORKERS_SUPPORTED){var a=newWorker();return a.userStep=e.step,a.userChunk=e.chunk,a.userComplete=e.complete,a.userError=e.error,e.step=l(e.step),e.chunk=l(e.chunk),e.complete=l(e.complete),e.error=l(e.error),delete e.worker,void a.postMessage({input:t,config:e,workerId:a.id})}var s=null;"string"==typeof t&&(s=new o(e));s||(s=new n(e));return s.stream(t)},i.unparse=function(t,e){var n=!1,r=!0,o=",",a="\r\n",u='"',c=u+u,l=!1,h=null;!function(){if("object"!=typeof e)return;"string"!=typeof e.delimiter||i.BAD_DELIMITERS.filter((function(t){return-1!==e.delimiter.indexOf(t)})).length||(o=e.delimiter);("boolean"==typeof e.quotes||Array.isArray(e.quotes))&&(n=e.quotes);"boolean"!=typeof e.skipEmptyLines&&"string"!=typeof e.skipEmptyLines||(l=e.skipEmptyLines);"string"==typeof e.newline&&(a=e.newline);"string"==typeof e.quoteChar&&(u=e.quoteChar);"boolean"==typeof e.header&&(r=e.header);if(Array.isArray(e.columns)){if(0===e.columns.length)throw new Error("Option columns is empty");h=e.columns}void 0!==e.escapeChar&&(c=e.escapeChar+u)}();var p=new RegExp(s(u),"g");"string"==typeof t&&(t=JSON.parse(t));if(Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return d(null,t,l);if("object"==typeof t[0])return d(h||f(t[0]),t,l)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:f(t.data[0])),Array.isArray(t.data[0])||"object"==typeof t.data[0]||(t.data=[t.data])),d(t.fields||[],t.data||[],l);throw new Error("Unable to serialize unrecognized input");function f(t){if("object"!=typeof t)return[];var e=[];for(var n in t)e.push(n);return e}function d(t,e,n){var i="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var s=Array.isArray(t)&&t.length>0,u=!Array.isArray(e[0]);if(s&&r){for(var c=0;c<t.length;c++)c>0&&(i+=o),i+=A(t[c],c);e.length>0&&(i+=a)}for(var l=0;l<e.length;l++){var h=s?t.length:e[l].length,p=!1,f=s?0===Object.keys(e[l]).length:0===e[l].length;if(n&&!s&&(p="greedy"===n?""===e[l].join("").trim():1===e[l].length&&0===e[l][0].length),"greedy"===n&&s){for(var d=[],g=0;g<h;g++){var m=u?t[g]:g;d.push(e[l][m])}p=""===d.join("").trim()}if(!p){for(var y=0;y<h;y++){y>0&&!f&&(i+=o);var v=s&&u?t[y]:y;i+=A(e[l][v],y)}l<e.length-1&&(!n||h>0&&!f)&&(i+=a)}}return i}function A(t,e){return null==t?"":t.constructor===Date?JSON.stringify(t).slice(1,25):(t=t.toString().replace(p,c),"boolean"==typeof n&&n||Array.isArray(n)&&n[e]||function(t,e){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>-1)return!0;return!1}(t,i.BAD_DELIMITERS)||t.indexOf(o)>-1||" "===t.charAt(0)||" "===t.charAt(t.length-1)?u+t+u:t)}},i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="\ufeff",i.BAD_DELIMITERS=["\r","\n",'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!1,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=u,i.ParserHandle=a,i.ChunkStreamer=r,i.StringStreamer=o,o.prototype=Object.create(o.prototype),o.prototype.constructor=o},function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a}));var i=n(169);let r;t.browser&&(r=n(253));function o(t="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.css"){Object(i.b)(t)}function a(){const t=["mapboxgl-missing-css"];for(const e of t){const t=document.getElementsByClassName(e)[0];t&&t.style&&(t.style.display="none")}}e.a=r}).call(this,n(48))},function(t,e,n){"use strict";var i=n(30),r=n(24);const o=t=>Object(r.e)(t)?void 0:0,a={3074:t=>Object(r.e)(t)?void 0:36064,35723:t=>Object(r.e)(t)?void 0:4352,35977:o,32937:o,36795:(t,e)=>{const n=Object(r.e)(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},37445:(t,e)=>{const n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(t,e)=>{const n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(t,e)=>{const n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:o,35071:o,37447:o,36063:(t,e)=>{if(!Object(r.e)(t)){const n=t.getExtension("WEBGL_draw_buffers");return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:o,35374:o,35377:o,34852:t=>{if(!Object(r.e)(t)){const e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension("OES_element_index")?2147483647:65535,33001:t=>t.getExtension("OES_element_index")?16777216:65535,33e3:t=>16777216,37157:o,35373:o,35657:o,36183:o,37137:o,34045:o,35978:o,35979:o,35968:o,35376:o,35375:o,35659:o,37154:o,35371:o,35658:o,35076:o,35077:o,35380:o};n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u}));const s={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(i.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Object(i.a)(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(i.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(i.a)(!1)},deleteQuery:()=>{Object(i.a)(!1)},beginQuery:()=>{Object(i.a)(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},u={readBuffer:(t,e,n)=>{Object(r.e)(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:o,ext:a}=function(t,e){return{webgl2:Object(r.e)(t),ext:t.getExtension(e)}}(t,"ANGLE_instanced_arrays");let s;switch(i){case 35069:s=!!o&&void 0;break;case 35070:s=o||a?void 0:0}return void 0!==s?s:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Object(r.e)(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,o)=>{if(!Object(r.e)(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,o)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:e}=t.luma,n=e.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,i)},getParameter:function(t,e,n){const i=a[n],r="function"==typeof i?i(t,e,n):i;return void 0!==r?r:e(n)},hint:(t,e,n,i)=>e(n,i)}},,function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){"use strict";async function*i(t,e){const n=new TextDecoder(e);for await(const e of t)yield"string"==typeof e?e:n.decode(e,{stream:!0})}async function*r(t,e){const n=new TextEncoder;for await(const e of t)yield"string"==typeof e?n.encode(e):e}async function*o(t){let e="";for await(const n of t){let t;for(e+=n;(t=e.indexOf("\n"))>=0;){const n=e.slice(0,t+1);e=e.slice(t+1),yield n}}e.length>0&&(yield e)}async function*a(t){let e=1;for await(const n of t)yield{counter:e,line:n},e++}n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}))},function(t,e,n){"use strict";function i(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return r(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return r(t,0,e)}return""}function r(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(i.getUint8(e+t));return r}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";(function(t){function i(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==t&&t.hrtime){var n=t.hrtime();e=1e3*n[0]+n[1]/1e6}else e=Date.now();return e}n.d(e,"a",(function(){return i}))}).call(this,n(48))},function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return u}));var i=n(40);const{COMPONENT:r}=i.b;function o(t){const e=p(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function a(t,e){const n=u({newProps:t,oldProps:e,propTypes:p(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";let n=null;const{dataComparator:i,_dataDiff:r}=t;i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied");n&&r&&(n=r(t.data,e.data)||n);return n}(t,e);let r=!1;return i||(r=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){if(h(t,e,"all"))return{all:!0}}const n={};let i=!1;for(const r in t.updateTriggers)if("all"!==r){h(t,e,r)&&(n[r]=!0,i=n)}return i}(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:l(t,e),transitionsChanged:s(t,e)}}function s(t,e){if(!t.transitions)return null;const n={},i=p(t);for(const r in t.transitions){const o=i[r],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&c(t[r],e[r],o)&&(n[r]=!0)}return n}function u({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}={}){if(e===t)return null;if("object"!=typeof t||null===t)return"".concat(r," changed shallowly");if("object"!=typeof e||null===e)return"".concat(r," changed shallowly");for(const o of Object.keys(t))if(!(o in n)){if(!(o in e))return"".concat(r,".").concat(o," added");const n=c(t[o],e[o],i[o]);if(n)return"".concat(r,".").concat(o," ").concat(n)}for(const o of Object.keys(e))if(!(o in n)){if(!(o in t))return"".concat(r,".").concat(o," dropped");if(!Object.hasOwnProperty.call(t,o)){const n=c(t[o],e[o],i[o]);if(n)return"".concat(r,".").concat(o," ").concat(n)}}return null}function c(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)?"changed deeply":i||(i=t&&e&&t.equals,!i||i.call(t,e))?i||e===t?null:"changed shallowly":"changed deeply"}function l(t,e){if(null===e)return"oldProps is null, initial diff";const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(i.length!==n.length)return!0;for(let t=0;t<i.length;t++)if(!i[t].equals(n[t]))return!0;return!1}function h(t,e,n){let i=t.updateTriggers[n];i=null==i?{}:i;let r=e.updateTriggers[n];return r=null==r?{}:r,u({oldProps:r,newProps:i,triggerName:n})}function p(t){const e=t[r],n=e&&e.constructor;return n?n._propTypes:{}}},function(t,e,n){"use strict";(function(t){function i(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==t&&t.hrtime){var n=t.hrtime();e=1e3*n[0]+n[1]/1e6}else e=Date.now();return e}n.d(e,"a",(function(){return i}))}).call(this,n(48))},function(t,e,n){"use strict";var i=n(73),r=n(32);const o=new Map;function a({source:t,url:e}){Object(r.a)(t&&!e||!t&&e);let n=o.get(t||e);return n||(e&&(n=function(t){if(!t.startsWith("http"))return t;return s((e=t,"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var e}(e),o.set(e,n)),t&&(n=s(t),o.set(t,n))),Object(r.a)(n),n}function s(t){Object(r.a)("string"==typeof t,"worker source");const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function u(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const c=t=>{};class l{static isSupported(){return"undefined"!=typeof Worker}constructor(t){const{name:e,source:n,url:i}=t;Object(r.a)(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=c,this.onError=t=>console.log(t),this.terminated=!1,this.worker=this._createBrowserWorker()}destroy(){this.onMessage=c,this.onError=c,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||function t(e,n=!0,i){const r=i||new Set;if(e){if(u(e))r.add(e);else if(u(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(n&&"object"==typeof e)for(const i in e)t(e[i],n,r)}else;return void 0===i?Array.from(r):[]}(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=a({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError("No data received")},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}}class h{constructor(t,e){this.name=t,this.workerThread=e,this.isRunning=!0,this.result=new Promise((t,e)=>{this._resolve=t,this._reject=e})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Object(r.a)(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Object(r.a)(this.isRunning),this.isRunning=!1,this._reject(t)}}class p{constructor({source:t,url:e,name:n="unnamed",maxConcurrency:i=1,onMessage:o,onDebug:a=(()=>{}),reuseWorkers:s=!0}){Object(r.a)(t||e),this.source=t,this.url=e,this.name=n,this.maxConcurrency=i,this.onMessage=o,this.onDebug=a,this.reuseWorkers=s,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}async startJob(t,e=((t,e,n)=>t.done(n)),n=((t,e)=>t.error(e))){const i=new Promise(i=>{this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:i})});return this._startQueuedJob(),i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",jobName:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new h(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed?t.destroy():(this.reuseWorkers?this.idleQueue.push(t):(t.destroy(),this.count--),this._startQueuedJob())}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.maxConcurrency){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new l({name:t,source:this.source,url:this.url})}return null}}const f={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};let d=null;class A{static isSupported(){return l.isSupported()}static getWorkerFarm(t={}){return d=d||new A({}),d.setProps(t),d}constructor(t){this.props={...f},this.setProps(t),this.workerPools=new Map}destroy(){this.workerPools.forEach(t=>t.destroy())}setProps(t){this.props={...this.props,...t}}getWorkerPool({name:t,source:e,url:n}){let r=this.workerPools.get(t);return r||(r=new p({name:t,source:e,url:n,maxConcurrency:i.c?this.props.maxMobileConcurrency:this.props.maxConcurrency,onDebug:this.props.onDebug,reuseWorkers:this.props.reuseWorkers}),this.workerPools.set(t,r)),r}}var g=n(263);function m(t,e,n,i){return!!A.isSupported()&&(!(!t.worker||!n.worker)&&(!t.useWorker||t.useWorker(n)))}async function y(t,e,n,i,r){const o=t.id,a=Object(g.a)(t,n),s=A.getWorkerFarm(n).getWorkerPool({name:o,url:a});n=JSON.parse(JSON.stringify(n));const u=await s.startJob("process-on-worker",v.bind(null,r));u.postMessage("process",{input:e,options:n});const c=await u.result;return await c.result}async function v(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(i.error);break;case"process":const{id:r,input:o,options:a}=i;try{const n=await t(o,a);e.postMessage("done",{id:r,result:n})}catch(t){e.postMessage("error",{id:r,error:t.message})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return y}))},function(t,e,n){"use strict";var i=n(234),r=n(116),o=n(148),a=n(91),s=n(81),u=n(2),c=n(82),l=n(96),h=n(68),p=n(0);class f extends c.a{constructor(t,e){super(t,e),this.shadowMap=new r.a(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new l.a(t,{format:33189,width:1,height:1}),this.fbo=new h.a(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Object(p.o)(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const n=t.viewports[0],i=Object(p.e)(this.gl),r=n.width*i,o=n.height*i;r===e.width&&o===e.height||e.resize({width:r,height:o}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return!1!==t.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}var d=n(111);n.d(e,"a",(function(){return y}));const A={color:[255,255,255],intensity:1},g=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],m=[0,0,0,200/255];class y extends s.a{constructor(t){super(t),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=m,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const e in t){const n=t[e];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow)}preRender(t,{layers:e,layerFilter:n,viewports:o,onViewportActive:a,views:s}){if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=i.a.getDefaultProgramManager(t),d.a&&this.programManager.addDefaultModule(d.a)),this.dummyShadowMap||(this.dummyShadowMap=new r.a(t,{width:1,height:1}));for(let t=0;t<this.shadowPasses.length;t++){this.shadowPasses[t].render({layers:e,layerFilter:n,viewports:o,onViewportActive:a,views:s,moduleParameters:{shadowLightId:t,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(e=>e.getProjectedLight({layer:t})),pointLights:this.pointLights.map(e=>e.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(d.a),this.programManager=null)}_createLightMatrix(){const t=[];for(const e of this.directionalLights){const n=(new u.a).lookAt({eye:new u.c(e.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const n=new f(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:n}=this;t||0!==e.length||0!==n.length||(this.ambientLight=new o.a(A),this.directionalLights.push(new a.a(g[0]),new a.a(g[1])))}}},function(e,n){e.exports=t},function(t,e,n){"use strict";function i(t){for(const e in t)return!1;return!0}function r(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return h}));var i=n(5),r=n(112),o=n(104),a=n(19),s=n(12),u=n(16);function c(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof o.a){const[n,r,o=0]=t,a=e.getDistanceScales([n,r]);i[2]=o*a.unitsPerMeter[2]}return i}function l(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:o,offsetMode:s}){let[l,h,p=0]=t;switch(n&&([l,h,p]=a.n([],[l,h,p,1],n)),r){case i.a.LNGLAT:return c([l,h,p],e,s);case i.a.LNGLAT_OFFSETS:return c([l+o[0],h+o[1],p+(o[2]||0)],e,s);case i.a.METER_OFFSETS:return c(Object(u.a)(o,[l,h,p]),e,s);case i.a.CARTESIAN:default:return e.isGeospatial?[l+o[0],h+o[1],p+o[2]]:e.projectPosition([l,h,p])}}function h(t,e){const{viewport:n,coordinateSystem:o,coordinateOrigin:a,modelMatrix:u,fromCoordinateSystem:c,fromCoordinateOrigin:h}=function(t){const e={...t};let{coordinateSystem:n}=t;const{viewport:r,coordinateOrigin:o,fromCoordinateSystem:a,fromCoordinateOrigin:s}=t;return n===i.a.DEFAULT&&(n=r.isGeospatial?i.a.LNGLAT:i.a.CARTESIAN),void 0===a&&(e.fromCoordinateSystem=n),void 0===s&&(e.fromCoordinateOrigin=o),e.coordinateSystem=n,e}(e),{geospatialOrigin:p,shaderCoordinateOrigin:f,offsetMode:d}=Object(r.a)(n,o,a),A=l(t,{viewport:n,modelMatrix:u,coordinateSystem:c,coordinateOrigin:h,offsetMode:d});if(d){const t=n.projectPosition(p||f);s.o(A,A,t)}return A}},function(t,e,n){"use strict";(function(t,i){n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));const r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},o=r.global||r.self||r.window,a="object"!=typeof i||"[object process]"!==String(i)||i.browser,s=void 0!==i&&i.version&&i.version.match(/v([0-9]*)/);s&&parseFloat(s[1])}).call(this,n(61),n(48))},function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return p}));var i=n(231),r=n.n(i),o=n(47);const a=o.a.CLOCKWISE,s=o.a.COUNTER_CLOCKWISE,u={isClosed:!0};function c(t,e,n,i,r){let a=e;const s=n.length;for(let e=0;e<s;e++)for(let r=0;r<i;r++)t[a++]=n[e][r]||0;if(!function(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}(n))for(let e=0;e<i;e++)t[a++]=n[0][e]||0;return u.start=e,u.end=a,u.size=i,Object(o.f)(t,r,u),a}function l(t,e,n,i,r=0,a,s){const c=(a=a||n.length)-r;if(c<=0)return e;let l=e;for(let e=0;e<c;e++)t[l++]=n[r+e];if(!function(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}(n,i,r,a))for(let e=0;e<i;e++)t[l++]=n[r+e];return u.start=e,u.end=l,u.size=i,Object(o.f)(t,s,u),l}function h(t,e){!function(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}(t);const n=[],i=[];if(t.positions){const{positions:r,holeIndices:o}=t;if(o){let t=0;for(let u=0;u<=o.length;u++)t=l(n,t,r,e,o[u-1],o[u],0===u?a:s),i.push(t);return i.pop(),{positions:n,holeIndices:i}}t=r}if(Number.isFinite(t[0]))return l(n,0,t,e,0,n.length,a),n;if(!function(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}(t)){let r=0;for(const[o,u]of t.entries())r=c(n,r,u,e,0===o?a:s),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return c(n,0,t,e,a),n}function p(t,e,n){let i=null;t.holeIndices&&(i=t.holeIndices.map(t=>t/e));let o=t.positions||t;if(n){const t=o.length;o=o.slice();const i=[];for(let r=0;r<t;r+=e){i[0]=o[r],i[1]=o[r+1];const t=n(i);o[r]=t[0],o[r+1]=t[1]}}return r()(o,i,e)}},function(t,e,n){"use strict";var i="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n";n.d(e,"a",(function(){return a}));const r={lightSources:{}};function o({color:t=[0,0,0],intensity:e=1}={}){return t.map(t=>t*e/255)}const a={name:"lights",vs:i,fs:i,getUniforms:function t(e=r){if("lightSources"in e){const{ambientLight:t,pointLights:n,directionalLights:i}=e.lightSources||{};return t||n&&n.length>0||i&&i.length>0?Object.assign({},function({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};return i["lighting_uAmbientLight.color"]=t?o(t):[0,0,0],e.forEach((t,e)=>{i["lighting_uPointLight[".concat(e,"].color")]=o(t),i["lighting_uPointLight[".concat(e,"].position")]=t.position,i["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((t,e)=>{i["lighting_uDirectionalLight[".concat(e,"].color")]=o(t),i["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),i.lighting_uDirectionalLightCount=n.length,i}({ambientLight:t,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const n={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":n.ambientLight=t;break;case"directional":n.directionalLights.push(t);break;case"point":n.pointLights.push(t)}return t({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(0),r=n(265),o=n(15);const a="8.5.0-alpha.1";const s=new class{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new r.a({id:t})),this.stats.get(t)}};if(o.global.luma&&o.global.luma.VERSION!==a)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(o.global.luma.VERSION," vs ").concat(a));o.global.luma||(Object(o.isBrowser)()&&i.k.log(1,"luma.gl ".concat(a," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),o.global.luma=o.global.luma||{VERSION:a,version:a,log:i.k,stats:s,globals:{modules:{},nodeIO:{}}});o.global.luma},function(t,e,n){var i;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(r,o,a,s){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],l=o.createElement("div"),h=Math.round,p=Math.abs,f=Date.now;function d(t,e,n){return setTimeout(b(t,n),e)}function A(t,e,n){return!!Array.isArray(t)&&(g(t,n[e],n),!0)}function g(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(void 0!==t.length)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function m(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var y=m((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&void 0===t[i[r]])&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),v=m((function(t,e){return y(t,e,!0)}),"merge","Use `assign`.");function _(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&u(i,n)}function b(t,e){return function(){return t.apply(e,arguments)}}function x(t,e){return"function"==typeof t?t.apply(e&&e[0]||void 0,e):t}function w(t,e){return void 0===t?e:t}function E(t,e,n){g(M(e),(function(e){t.addEventListener(e,n,!1)}))}function T(t,e,n){g(M(e),(function(e){t.removeEventListener(e,n,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function M(t){return t.trim().split(/\s+/g)}function C(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function I(t){return Array.prototype.slice.call(t,0)}function O(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];C(r,a)<0&&i.push(t[o]),r[o]=a,o++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function L(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),o=0;o<c.length;){if((i=(n=c[o])?n+r:e)in t)return i;o++}}var R=1;function k(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var D="ontouchstart"in r,B=void 0!==L(r,"PointerEvent"),F=D&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z=["x","y"],N=["clientX","clientY"];function j(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){x(t.options.enable,[t])&&n.handler(e)},this.init()}function U(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=1&e&&i-r==0,a=12&e&&i-r==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=V(e));r>1&&!n.firstMultiple?n.firstMultiple=V(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=e.center=G(i);e.timeStamp=f(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=X(s,u),e.distance=q(s,u),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=H(e.deltaX,e.deltaY);var c=W(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=p(c.x)>p(c.y)?c.x:c.y,e.scale=a?(l=a.pointers,h=i,q(h[0],h[1],N)/q(l[0],l[1],N)):1,e.rotation=a?function(t,e){return X(e[1],e[0],N)+X(t[1],t[0],N)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,o,a=t.lastInterval||e,s=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(s>25||void 0===a.velocity)){var u=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,l=W(s,u,c);i=l.x,r=l.y,n=p(l.x)>p(l.y)?l.x:l.y,o=H(u,c),t.lastInterval=e}else n=a.velocity,i=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=o}(n,e);var l,h;var d=t.element;S(e.srcEvent.target,d)&&(d=e.srcEvent.target);e.target=d}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function V(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:h(t.pointers[n].clientX),clientY:h(t.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:e,center:G(e),deltaX:t.deltaX,deltaY:t.deltaY}}function G(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:h(n/e),y:h(i/e)}}function W(t,e,n){return{x:e/t||0,y:n/t||0}}function H(t,e){return t===e?1:p(t)>=p(e)?t<0?2:4:e<0?8:16}function q(t,e,n){n||(n=z);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function X(t,e,n){n||(n=z);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}j.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(k(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(k(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function Q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,j.apply(this,arguments)}_(Q,j,{handler:function(t){var e=Z[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Y={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},K={2:"touch",3:"pen",4:"mouse",5:"kinect"},J="pointerdown",$="pointermove pointerup pointercancel";function tt(){this.evEl=J,this.evWin=$,j.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(J="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel"),_(tt,j,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=Y[i],o=K[t.pointerType]||t.pointerType,a="touch"==o,s=C(e,t.pointerId,"pointerId");1&r&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):12&r&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function nt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,j.apply(this,arguments)}function it(t,e){var n=I(t.touches),i=I(t.changedTouches);return 12&e&&(n=O(n.concat(i),"identifier",!0)),[n,i]}_(nt,j,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var n=it.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var rt={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ot(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},j.apply(this,arguments)}function at(t,e){var n=I(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,a=I(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return S(t.target,u)})),1===e)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<a.length;)i[a[r].identifier]&&s.push(a[r]),12&e&&delete i[a[r].identifier],r++;return s.length?[O(o.concat(s),"identifier",!0),s]:void 0}_(ot,j,{handler:function(t){var e=rt[t.type],n=at.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});function st(){j.apply(this,arguments);var t=b(this.handler,this);this.touch=new ot(this.manager,t),this.mouse=new Q(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function ut(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ct.call(this,e)):12&t&&ct.call(this,e)}function ct(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),2500)}}function lt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),a=Math.abs(n-r.y);if(o<=25&&a<=25)return!0}return!1}_(st,j,{handler:function(t,e,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)ut.call(this,e,n);else if(r&&lt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ht=L(l.style,"touchAction"),pt=void 0!==ht,ft=function(){if(!pt)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||r.CSS.supports("touch-action",n)})),t}();function dt(t,e){this.manager=t,this.set(e)}dt.prototype={set:function(t){"compute"==t&&(t=this.compute()),pt&&this.manager.element.style&&ft[t]&&(this.manager.element.style[ht]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return g(this.manager.recognizers,(function(e){x(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(P(t,"none"))return"none";var e=P(t,"pan-x"),n=P(t,"pan-y");if(e&&n)return"none";if(e||n)return e?"pan-x":"pan-y";if(P(t,"manipulation"))return"manipulation";return"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=P(i,"none")&&!ft.none,o=P(i,"pan-y")&&!ft["pan-y"],a=P(i,"pan-x")&&!ft["pan-x"];if(r){var s=1===t.pointers.length,u=t.distance<2,c=t.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return r||o&&6&n||a&&24&n?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function At(t){this.options=u({},this.defaults,t||{}),this.id=R++,this.manager=null,this.options.enable=w(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function gt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function mt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function yt(t,e){var n=e.manager;return n?n.get(t):t}function vt(){At.apply(this,arguments)}function _t(){vt.apply(this,arguments),this.pX=null,this.pY=null}function bt(){vt.apply(this,arguments)}function xt(){At.apply(this,arguments),this._timer=null,this._input=null}function wt(){vt.apply(this,arguments)}function Et(){vt.apply(this,arguments)}function Tt(){At.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function St(t,e){return(e=e||{}).recognizers=w(e.recognizers,St.defaults.preset),new Pt(t,e)}At.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(A(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=yt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return A(t,"dropRecognizeWith",this)?this:(t=yt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(A(t,"requireFailure",this))return this;var e=this.requireFail;return-1===C(e,t=yt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(A(t,"dropRequireFailure",this))return this;t=yt(t,this);var e=C(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+gt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+gt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!x(this.options.enable,[this,e]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(vt,At,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(8&n||!r)?16|e:i||r?4&n?8|e:2&e?4|e:2:32}}),_(_t,vt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push("pan-y"),24&t&&e.push("pan-x"),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,a=t.deltaY;return r&e.direction||(6&e.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===a?1:a<0?8:16,n=a!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return vt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=mt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),_(bt,vt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),_(xt,At,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||12&t.eventType&&!r)this.reset();else if(1&t.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),_(wt,vt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),_(Et,vt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return _t.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&p(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=mt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_(Tt,At,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||q(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),St.VERSION="2.0.7",St.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[wt,{enable:!1}],[bt,{enable:!1},["rotate"]],[Et,{direction:6}],[_t,{direction:6},["swipe"]],[Tt],[Tt,{event:"doubletap",taps:2},["tap"]],[xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Pt(t,e){var n;this.options=u({},St.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(B?tt:F?ot:D?st:Q))(n,U),this.touchAction=new dt(this,this.options.touchAction),Mt(this,!0),g(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Mt(t,e){var n,i=t.element;i.style&&(g(t.options.cssProps,(function(r,o){n=L(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Pt.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof At)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(A(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(A(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=C(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(void 0!==t&&void 0!==e){var n=this.handlers;return g(M(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(void 0!==t){var n=this.handlers;return g(M(t),(function(t){e?n[t]&&n[t].splice(C(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&Mt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(St,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Pt,Input:j,TouchAction:dt,TouchInput:ot,MouseInput:Q,PointerEventInput:tt,TouchMouseInput:st,SingleTouchInput:nt,Recognizer:At,AttrRecognizer:vt,Tap:Tt,Pan:_t,Swipe:Et,Pinch:bt,Rotate:wt,Press:xt,on:E,off:T,each:g,merge:v,extend:y,assign:u,inherit:_,bindFn:b,prefixed:L}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=St,void 0===(i=function(){return St}.call(e,n,e,t))||(t.exports=i)}(window,document)},function(t,e){},function(t,e){},,function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var i=n(171),r=n(34),o=n(28),a=n(3),s=n(147),u=n(12),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.phi,i=void 0===n?0:n,o=e.theta,a=void 0===o?0:o,s=e.radius,u=void 0===s?1:s,c=e.bearing,l=void 0===c?void 0:c,h=e.pitch,p=void 0===h?void 0:h,f=e.altitude,d=void 0===f?void 0:f,A=e.radiusScale,g=void 0===A?6371e3:A;Object(r.a)(this,t),this.phi=i,this.theta=a,this.radius=u||d||1,this.radiusScale=g||1,void 0!==l&&(this.bearing=l),void 0!==p&&(this.pitch=p),this.check()}return Object(o.a)(t,[{key:"toString",value:function(){return this.formatString(a.b)}},{key:"formatString",value:function(t){var e=t.printTypes,n=void 0!==e&&e,i=a.e;return"".concat(n?"Spherical":"","[rho:").concat(i(this.radius),",theta:").concat(i(this.theta),",phi:").concat(i(this.phi),"]")}},{key:"equals",value:function(t){return Object(a.d)(this.radius,t.radius)&&Object(a.d)(this.theta,t.theta)&&Object(a.d)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this.check()}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],o=e[2];this.radius=1+o/this.radiusScale,this.phi=Object(a.h)(r),this.theta=Object(a.h)(n)}},{key:"fromVector3",value:function(t){return this.radius=u.g(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(a.a)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new s.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(a.c)(this.phi)},set:function(t){this.phi=Math.PI-Object(a.h)(t)}},{key:"pitch",get:function(){return Object(a.c)(this.theta)},set:function(t){this.theta=Object(a.h)(t)}},{key:"longitude",get:function(){return Object(a.c)(this.phi)}},{key:"latitude",get:function(){return Object(a.c)(this.theta)}},{key:"lng",get:function(){return Object(a.c)(this.phi)}},{key:"lat",get:function(){return Object(a.c)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(163),c=n(3),l=n(11),h=n(12),p=n(71);function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var d=[0,0,0],A={},g=function(t){Object(o.a)(n,t);var e=f(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(i.a)(this,n),t=e.call(this,-0,-0,-0),1===arguments.length&&Object(c.f)(r)?t.copy(r):(c.b.debug&&(Object(l.a)(r),Object(l.a)(o),Object(l.a)(a)),t[0]=r,t[1]=o,t[2]=a),t}return Object(r.a)(n,null,[{key:"ZERO",get:function(){return A.ZERO=A.ZERO||Object.freeze(new n(0,0,0,0))}}]),Object(r.a)(n,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return c.b.debug&&(Object(l.a)(t.x),Object(l.a)(t.y),Object(l.a)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return h.a(this,t)}},{key:"cross",value:function(t){return h.c(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return h.k(this,this,i,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return h.l(this,this,i,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?d:n;return h.m(this,this,i,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return h.q(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(p.c)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return h.p(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return Object(p.b)(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return h.r(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Object(l.a)(t)}}]),n}(u.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));const i=[255,255,255],r=1;let o=0;class a{constructor(t={}){const{color:e=i}=t,{intensity:n=r}=t;this.id=t.id||"ambient-".concat(o++),this.color=e,this.intensity=n,this.type="ambient"}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(57),r=n(104),o=n(105);class a extends i.a{constructor(t){super({...t,type:r.a})}get controller(){return this._getControllerProps({type:o.b})}}a.displayName="MapView"},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a}));var i=n(62),r=n(65);async function o(t,e){for(;;){const{done:n,value:i}=await t.next();if(n)return void t.return();if(e(i))return}}async function a(t){const e=[],n=[];for await(const i of t)"string"==typeof i?n.push(i):e.push(i);return n.length>0?(Object(r.a)(0===e.length),n.join("")):Object(i.b)(...e)}},function(t,e,n){"use strict";function i(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(t=>"project64"===t.name))){const t=n.modules.findIndex(t=>"project32"===t.name);t>=0&&n.modules.splice(t,1)}if("inject"in e)if(t.inject){const i={...t.inject};for(const t in e.inject)i[t]=(i[t]||"")+e.inject[t];n.inject=i}else n.inject=e.inject;return n}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));function i(t){if(null===(e=t)||"object"!=typeof e)throw new Error("count(): argument not an object");var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"==typeof t&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}},function(t,e,n){"use strict";var i=n(261),r=n(191),o=n(27);class a{constructor(t,e){this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const t=e.elementOffset||0;for(let e=0;e<i;++e)r[e]=n[t+e]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}var s=n(64),u=n(29),c=n(6);function l(t){return t.stride||t.size*t.bytesPerElement}function h(t,e){e.offset&&c.a.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=l(t),i=("vertexOffset"in e?e.vertexOffset:t.vertexOffset||0)*n+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}var p=n(31),f=n(45),d=n(63);const A=[],g=[[0,1/0]];var m=n(41);class y extends class{constructor(t,e){this.gl=t,this.id=e.id,this.size=e.size;const n=e.logicalType||e.type,o=5130===n;let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0),e.defaultValue=a;let s=n;o?s=5126:!s&&e.isIndexed?s=t&&Object(i.b)(t,r.a.ELEMENT_INDEX_UINT32)?5125:5123:s||(s=5126),e.logicalType=n,e.type=s;let u=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(n||s||5126);this.shaderAttributes={},this.doublePrecision=o,o&&!1===e.fp64&&(u=Float32Array),e.bytesPerElement=u.BYTES_PER_ELEMENT,this.defaultType=u,this.value=null,this.settings=e,this.state={externalBuffer:null,bufferAccessor:e,allocatedValue:null,constant:!1},this._buffer=null,this.setData(e)}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new o.a(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*l(t):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),s.a.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(t,e){const n=h(t,e);return{high:n,low:{...n,offset:n.offset+4*t.size}}}(this.getAccessor(),e||{});return n[t]=new a(this,r.high),n["".concat(t,"64Low")]=i?new a(this,r.low):new Float32Array(this.size),n}if(e){const n=h(this.getAccessor(),e);return{[t]:new a(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(t){const{state:e}=this;ArrayBuffer.isView(t)?t={value:t}:t instanceof o.a&&(t={buffer:t});const n={...this.settings,...t};if(e.bufferAccessor=n,t.constant){let n=t.value;if(n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this._normalizeConstant(n)),!(!e.constant||!this._areValuesEqual(n,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=n}else if(t.buffer){const i=t.buffer;e.externalBuffer=i,e.constant=!1,this.value=t.value;const r=t.value instanceof Float64Array;n.type=t.type||i.accessor.type,n.bytesPerElement=i.accessor.BYTES_PER_ELEMENT*(r?2:1),n.stride=l(n)}else if(t.value){this._checkExternalBuffer(t);let i=t.value;e.externalBuffer=null,e.constant=!1,this.value=i,n.bytesPerElement=i.BYTES_PER_ELEMENT,n.stride=l(n);const{buffer:r,byteOffset:o}=this;this.doublePrecision&&i instanceof Float64Array&&(i=Object(u.f)(i,n));const a=i.byteLength+o+2*n.stride;r.byteLength<a&&r.reallocate(a),r.setAccessor(null),r.subData({data:i,offset:o}),n.type=t.type||r.accessor.type}return!0}updateSubBuffer(t={}){const{value:e}=this,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?Object(u.f)(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate({numInstances:t,copy:e=!1}){const{state:n}=this,i=n.allocatedValue,r=s.a.allocate(i,t+1,{size:this.size,type:this.defaultType,copy:e});this.value=r;const{buffer:o,byteOffset:a}=this;return o.byteLength<r.byteLength+a&&(o.reallocate(r.byteLength+a),e&&i&&o.subData({data:i instanceof Float64Array?Object(u.f)(i,this):i,offset:a})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!t.constant&&e){const n=this.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.settings.normalized||"normalized"in t||c.a.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(t).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(t).map(t=>t/255);case 5123:return new Float32Array(t).map(t=>t/65535);default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t)return e[n]=i[0],e;switch(r){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let o=r;for(;--o>=0;)e[n+o]=Number.isFinite(t[o])?t[o]:i[o]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}{constructor(t,e={}){super(t,e);const{transition:n=!1,noAlloc:i=!1,update:r=null,accessor:o=null,transform:a=null,startIndices:s=null}=e;Object.assign(this.settings,{transition:n,noAlloc:i,update:r||o&&this._autoUpdater,accessor:o,transform:a}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:g,startIndices:s}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!=typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find(e=>t[e])]:t[e];return Object(m.e)(i,n)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:n=1/0}=e;this.state.updateRanges=function(t,e){if(t===g)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;const n=[],i=t.length;let r=0;for(let o=0;o<i;o++){const i=t[o];i[1]<e[0]?(n.push(i),r=o+1):i[0]>e[1]?n.push(i):e=[Math.min(i[0],e[0]),Math.max(i[1],e[1])]}return n.splice(r,0,e),n}(this.state.updateRanges,[t,n])}else this.state.updateRanges=g}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=A}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}update(t){this.setData(t)}allocate(t){const{state:e,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate({numInstances:t,copy:e.updateRanges!==g}),!0))}updateBuffer({numInstances:t,data:e,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:a}}=this;let s=!0;if(o){for(const[a,s]of r)o.call(i,this,{data:e,startRow:a,endRow:s,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant});else for(const[e,n]of r){const i=Number.isFinite(e)?this.getVertexOffset(e):0,r=Number.isFinite(n)?this.getVertexOffset(n):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else s=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),s}setConstantValue(t){if(void 0===t||"function"==typeof t)return!1;return this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t),!0)):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),ArrayBuffer.isView(t)&&(t={value:t}),i.transform||e!==this.startIndices){Object(p.a)(ArrayBuffer.isView(t.value),"invalid ".concat(i.accessor));const r=t.size&&t.size!==this.size;return n.binaryAccessor=Object(f.b)(t.value,{size:t.size||this.size,stride:t.stride,offset:t.offset,startIndices:e,nested:r}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?e[t]:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,{data:e,startRow:n,endRow:i,props:r,numInstances:o}){if(t.constant)return;const{settings:a,state:s,value:u,size:c,startIndices:l}=t,{accessor:h,transform:A}=a,g=s.binaryAccessor||("function"==typeof h?h:r[h]);Object(p.a)("function"==typeof g,'accessor "'.concat(h,'" is not a function'));let m=t.getVertexOffset(n);const{iterable:y,objectInfo:v}=Object(f.a)(e,n,i);for(const e of y){v.index++;let n=g(e,v);if(A&&(n=A.call(this,n)),l){const e=(v.index<l.length-1?l[v.index+1]:o)-l[v.index];if(n&&Array.isArray(n[0])){let e=m;for(const i of n)t._normalizeValue(i,u,e),e+=c}else n&&n.length>c?u.set(n,m):(t._normalizeValue(n,v.target,0),Object(d.a)({target:u,source:v.target,start:m,count:e}));m+=e*c}else t._normalizeValue(n,u,m),m+=c}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||"function"==typeof t.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}var v=n(25),_=n(283),b=n(70);var x=n(196),w=n(116),E=n(68);const T={interpolation:class{constructor({gl:t,attribute:e,timeline:n}){this.gl=t,this.type="interpolation",this.transition=new b.a(n),this.attribute=e,this.attributeInTransition=new y(t,e.settings),this.currentStartIndices=e.startIndices,this.currentLength=0,this.transform=function(t,e){const n=Object(m.c)(e.size);return new _.a(t,{vs:"\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(t,e);const i={byteLength:0,usage:35050};this.buffers=[new o.a(t,i),new o.a(t,i)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0)return void this.transition.cancel();const{gl:n,buffers:i,attribute:r}=this;Object(m.a)(i);const o={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const t of i)Object(m.f)({buffer:t,...o});this.currentStartIndices=r.startIndices,this.currentLength=Object(m.b)(r,e),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:Object(m.d)(n,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{time:t,settings:{duration:e,easing:n}}=this.transition,i=n(t/e);this.transform.run({uniforms:{time:i}})}return t}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}},spring:class{constructor({gl:t,attribute:e,timeline:n}){this.gl=t,this.type="spring",this.transition=new b.a(n),this.attribute=e,this.attributeInTransition=new y(t,{...e.settings,normalized:!1}),this.currentStartIndices=e.startIndices,this.currentLength=0,this.texture=function(t){return new w.a(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(t),this.framebuffer=function(t,e){return new E.a(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}(t,this.texture),this.transform=function(t,e,n){const i=Object(m.c)(e.size);return new _.a(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(t,e,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new o.a(t,i),new o.a(t,i),new o.a(t,i)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:r}=this,o={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const t of i)Object(m.f)({buffer:t,...o});this.currentStartIndices=r.startIndices,this.currentLength=Object(m.b)(r,e),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:Object(m.d)(n,r)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;return!!i.update()&&(e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:i.settings.stiffness,damping:i.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Object(m.a)(t),this.attributeInTransition.update({buffer:t[1],value:this.attribute.value}),Object(x.c)(n)[0]>0||i.end(),!0)}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}};class S{constructor(t,{id:e,timeline:n}){this.id=e,this.gl=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=_.a.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:n}){this.numInstances=n||1;for(const n in t){const i=t[n],r=i.getTransitionSetting(e);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=t[n];i&&i.getTransitionSetting(e)||this._removeTransition(n)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void c.a.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();i&&this._removeTransition(t);const o=T[n.type];o?this.transitions[t]=new o({attribute:e,timeline:this.timeline,gl:this.gl}):(c.a.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}n.d(e,"a",(function(){return P}));class P{constructor(t,{id:e="attribute-manager",stats:n,timeline:i}={}){this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new S(t,{id:"".concat(e,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(t=!0){return this.needsRedraw=!0,this}add(t,e){this._add(t,e)}addInstanced(t,e){this._add(t,e,{instanced:1})}remove(t){for(let e=0;e<t.length;e++){const n=t[e];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}invalidate(t,e){const n=this._invalidateTrigger(t,e);Object(v.a)("attributeManager.invalidate",this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Object(v.a)("attributeManager.invalidate",this,"all")}update({data:t,numInstances:e,startIndices:n=null,transitions:i,props:r={},buffers:o={},context:a={}}={}){let s=!1;Object(v.a)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const u=this.attributes[i],l=u.settings.accessor;u.startIndices=n,r[i]&&c.a.removed("props.".concat(i),"data.attributes.".concat(i))(),u.setExternalBuffer(o[i])||u.setBinaryValue(o[l],t.startIndices)||!o[l]&&u.setConstantValue(r[l])||u.needsUpdate()&&(s=!0,this._updateAttribute({attribute:u,numInstances:e,data:t,props:r,context:a})),this.needsRedraw|=u.needsRedraw()}s&&Object(v.a)("attributeManager.updateEnd",this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:i})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in e){const o=e[r];o.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getShaderAttributes(t,e={}){t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}getAccessors(){return this.updateTriggers}_add(t,e,n={}){e&&c.a.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const e in t){const i=t[e];this.attributes[e]=this._createAttribute(e,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||n.instanced?1:e.divisor};return new y(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes){this.attributes[e].getUpdateTriggers().forEach(n=>{t[n]||(t[n]=[]),t[n].push(e)})}this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,r=i[t];return r&&r.forEach(t=>{const i=n[t];i&&i.setNeedsUpdate(i.id,e)}),r}_updateAttribute(t){const{attribute:e,numInstances:n}=t;Object(v.a)("attribute.updateStart",e),e.allocate(n)&&Object(v.a)("attribute.allocate",e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,Object(v.a)("attribute.updateEnd",e,n))}}},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(285),a=n(224),s=n(170),u=n(6),c=n(58),l=n(99),h=n(47);class p extends c.a{constructor(t={}){const{id:e=Object(l.c)("column-geometry")}=t,{indices:n,attributes:i}=function(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(u.a.assert(r.length>=i),r=r.flatMap(t=>[t[0],t[1]]),Object(h.f)(r,h.a.COUNTER_CLOCKWISE));const o=n>0,a=i+1,s=o?3*a+1:i,c=2*Math.PI/i,l=new Uint16Array(o?3*i*2:0),p=new Float32Array(3*s),f=new Float32Array(3*s);let d=0;if(o){for(let t=0;t<a;t++){const o=t*c,a=t%i,s=Math.sin(o),u=Math.cos(o);for(let t=0;t<2;t++)p[d+0]=r?r[2*a]:u*e,p[d+1]=r?r[2*a+1]:s*e,p[d+2]=(.5-t)*n,f[d+0]=r?r[2*a]:u,f[d+1]=r?r[2*a+1]:s,d+=3}p[d+0]=p[d-3],p[d+1]=p[d-2],p[d+2]=p[d-1],d+=3}for(let t=o?0:1;t<a;t++){const o=Math.floor(t/2)*Math.sign(.5-t%2),a=o*c,s=(o+i)%i,u=Math.sin(a),l=Math.cos(a);p[d+0]=r?r[2*s]:l*e,p[d+1]=r?r[2*s+1]:u*e,p[d+2]=n/2,f[d+2]=1,d+=3}if(o){let t=0;for(let e=0;e<i;e++)l[t++]=2*e+0,l[t++]=2*e+2,l[t++]=2*e+0,l[t++]=2*e+1,l[t++]=2*e+1,l[t++]=2*e+3}return{indices:l,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:f}}}}(t);super({...t,id:e,indices:n,attributes:i})}}n.d(e,"a",(function(){return A}));const f=[0,0,0,255],d={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:f},getLineColor:{type:"accessor",value:f},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class A extends i.a{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a,a.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:f},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:f},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:t,oldProps:e,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=n.extensionsChanged;if(i){var r;const{gl:t}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}(i||t.diskResolution!==e.diskResolution||t.vertices!==e.vertices||(t.extruded||t.stroked)!==(e.extruded||e.stroked))&&this._updateGeometry(t)}getGeometry(t,e,n){const i=new p({radius:1,height:n?2:0,vertices:e,nradial:t});let r=0;if(e)for(let n=0;n<t;n++){const i=e[n];r+=Math.sqrt(i[0]*i[0]+i[1]*i[1])/t}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*r}),i}_getModel(t){return new s.a(t,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:t,vertices:e,extruded:n,stroked:i}){const r=this.getGeometry(t,e,n||i);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}draw({uniforms:t}){const{viewport:e}=this.context,{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:o,elevationScale:a,extruded:s,filled:u,stroked:c,wireframe:l,offset:h,coverage:p,radius:f,angle:d}=this.props,{model:A,fillVertexCount:g,wireframeVertexCount:m,edgeDistance:y}=this.state,v="pixels"===n?e.metersPerPixel:1;A.setUniforms(t).setUniforms({radius:f,angle:d/180*Math.PI,offset:h,extruded:s,coverage:p,elevationScale:a,edgeDistance:y,widthScale:i*v,widthMinPixels:r,widthMaxPixels:o}),s&&l&&(A.setProps({isIndexed:!0}),A.setVertexCount(m).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(A.setProps({isIndexed:!1}),A.setVertexCount(g).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!s&&c&&(A.setProps({isIndexed:!1}),A.setVertexCount(2*g/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}A.layerName="ColumnLayer",A.defaultProps=d},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(224),a=n(170),s=n(58);n.d(e,"a",(function(){return l}));const u=[0,0,0,255],c={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:u},getLineColor:{type:"accessor",value:u},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class l extends i.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:o,stroked:a,filled:s,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:l,lineWidthMaxPixels:h}=this.props,p="pixels"===n?e.metersPerPixel:1,f="pixels"===u?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({stroked:a?1:0,filled:s,radiusScale:i*p,radiusMinPixels:r,radiusMaxPixels:o,lineWidthScale:c*f,lineWidthMinPixels:l,lineWidthMaxPixels:h}).draw()}_getModel(t){return new a.a(t,{...this.getShaders(),id:this.props.id,geometry:new s.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}l.layerName="ScatterplotLayer",l.defaultProps=c},function(t,e,n){"use strict";var i=n(279),r=n(108),o=n(40),a=n(6),s=n(25),u=n(63),c=n(265),l=n(206);class h{constructor(t,e,n){this.id=t,this.context=n,this._loadCount=0,this._subscribers=new Set,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const n=++this._loadCount;let i=t;"string"==typeof t&&(i=Object(l.a)(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=null,this._content=t)}).catch(t=>{this._loadCount===n&&(this.isLoaded=!0,this._error=t||!0)})):(this.isLoaded=!0,this._error=null,this._content=t);for(const t of this._subscribers)t.onChange(this.getData())}}class p{constructor({gl:t,protocol:e}){this.protocol=e||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return!!t.startsWith(this.protocol)||t in this._resources}add({resourceId:t,data:e,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[t];r?r.setData(e,n):(r=new h(t,e,this._context),this._resources[t]=r),r.persistent=i}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const t in e){const n=e[t];n.resource&&n.resource.unsubscribe(n)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:o}=this;t.startsWith(o)&&(r[t=t.replace(o,"")]||this.add({resourceId:t,data:null,persistent:!1}));const a=r[t];if(this._track(n,i,a,e),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,n,i){const r=this._consumers,o=r[t]=r[t]||{},a=o[e]||{};a.resource&&(a.resource.unsubscribe(a),a.resource=null,this.prune()),n&&(o[e]=a,a.onChange=i,a.resource=n,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];e.persistent||e.inUse()||(e.delete(),delete this._resources[t])}}}var f=n(35),d=n(157);n.d(e,"a",(function(){return m}));const A=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),g=t=>t instanceof r.a?"".concat(t):t?"invalid":"null";class m{constructor(t,{deck:e,stats:n,viewport:r,timeline:o}={}){this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new p({gl:t,protocol:"deck://"}),this.context={...A,layerManager:this,gl:t,deck:e,programManager:t&&Object(d.a)(t),stats:n||new c.a({id:"deck.gl"}),viewport:r||new f.a({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new i.a,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this._onError=null,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(t);e=e||i}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t=null}={}){return t?this.layers.filter(e=>t.find(t=>0===e.id.indexOf(t))):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this._onError=t.onError)}setLayers(t,e){Object(s.a)("layerManager.setLayers",this,e,t),this.lastRenderedLayers=t,t=Object(u.b)(t,Boolean);for(const e of t)e.context=this.context;return this._updateLayers(this.layers,t),this}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this.lastRenderedLayers,t)),this._nextLayers=null}activateViewport(t){return Object(s.a)("layerManager.activateViewport",this,t),t&&(this.context.viewport=t),this}_handleError(t,e,n){this._onError?this._onError(e,n):a.a.error("error during ".concat(t," of ").concat(g(n)),e)()}_updateLayers(t,e){const n={};for(const e of t)n[e.id]?a.a.warn("Multiple old layers with same id ".concat(g(e)))():n[e.id]=e;const i=[];this._updateSublayersRecursively(e,n,i),this._finalizeOldLayers(n);let r=!1;for(const t of i)if(t.hasUniformTransition()){r=!0;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(t,e,n){for(const i of t){i.context=this.context;const t=e[i.id];null===t&&a.a.warn("Multiple new layers with same id ".concat(g(i)))(),e[i.id]=null;let r=null;try{this._debug&&t!==i&&i.validateProps(),t?(this._transferLayerState(t,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite&&i.getSubLayers()}catch(t){this._handleError("matching",t,i)}r&&this._updateSublayersRecursively(r,e,n)}}_finalizeOldLayers(t){for(const e in t){const n=t[e];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=o.a.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=o.a.MATCHED,e!==t&&(t.lifecycle=o.a.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(g(t)),t.lifecycle=o.a.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=o.a.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}},function(t,e,n){"use strict";var i=n(234);var r={name:"geometry",vs:"\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry;\n",fs:"\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n"},o=n(93);n.d(e,"a",(function(){return u}));const a=[r,o.a],s=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function u(t){const e=i.a.getDefaultProgramManager(t);for(const t of a)e.addDefaultModule(t);for(const t of s)e.addShaderHook(t);return e}},function(t,e,n){"use strict";var i=n(25),r=n(82);class o extends r.a{}var a=n(167),s=n(68);n.d(e,"a",(function(){return u}));class u{constructor(t){this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new o(t),this.pickLayersPass=new a.a(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null,this._onError=null}setProps(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed"),"onError"in t&&(this._onError=t.onError)}renderLayers(t){const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=this.layerFilter,t.onError=this._onError,t.effects=t.effects||[],t.target=t.target||s.a.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);const n=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,r=e.render({...t,target:n});this._postRender(t.effects,t),this.renderCount++,Object(i.a)("deckRenderer.renderLayers",this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){let n=null;for(const i of t)i.preRender(this.gl,e),i.postRender&&(n=i);n&&this._resizeRenderBuffers(),this.lastPostProcessEffect=n}_resizeRenderBuffers(){const{renderBuffers:t}=this;0===t.length&&t.push(new s.a(this.gl),new s.a(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:n}=this,i={inputBuffer:n[0],swapBuffer:n[1],target:null};for(const r of t)if(r.postRender){if(r===this.lastPostProcessEffect){i.target=e.target,r.postRender(this.gl,i);break}const t=r.postRender(this.gl,i);i.inputBuffer=t,i.swapBuffer=t===n[0]?n[1]:n[0]}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const i={onIninitialize:t=>t,onFinalize:t=>t,onMessage:null};class r{static setCallbacks({onInitialize:t,onFinalize:e,onMessage:n}){t&&(i.onInitialize=t),e&&(i.onFinalize=e),n&&(i.onMessage=n)}constructor(t="Transport"){this.name=t,this._messageQueue=[],this.userData={}}getRootDOMElement(){return"undefined"!=typeof document?document.body:null}sendJSONMessage(){console.error("Back-channel not implemented for this transport")}sendBinaryMessage(){console.error("Back-channel not implemented for this transport")}_initialize(t={}){const e={transport:this,...t};i.onInitialize(e)}_finalize(t={}){const e={transport:this,...t};i.onFinalize(e),this._destroyed=!0}_messageReceived(t={}){t={transport:this,...t},console.debug("Delivering transport message",t),i.onMessage(t)}static _stringifyJSONSafe(t){const e=new Set;return JSON.stringify(t,(t,n)=>{if("object"==typeof n&&null!==n){if(e.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}e.add(n)}return n})}}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var i=n(46),r=n(161);function o(){return!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(r.a)()}}).call(this,n(48))},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r}));var i=n(46);function r(e){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(i.a)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=e||n;return!!(r&&r.indexOf("Electron")>=0)}}).call(this,n(48))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(135);function r(t,e){if(t){if("string"==typeof t)return Object(i.a)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(i.a)(t,e):void 0}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(115),c=n(11),l=n(44);function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var p=function(t){Object(o.a)(n,t);var e=h(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"copy",value:function(t){return Object(l.a)(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var i=this[n]-t[n];e+=i*i}return Object(c.a)(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Object(c.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var o=r[i],a=0;a<this.ELEMENTS;++a)this[a]*=o[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++)for(var o=r[i],a=0;a<this.ELEMENTS;++a)this[a]/=o[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Object(l.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(c.a)(this[t])}},{key:"setComponent",value:function(t,e){return Object(l.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Object(c.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Object(c.a)(t)}}]),n}(u.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(115),c=n(11),l=n(3);function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var p=function(t){Object(o.a)(n,t);var e=h(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"toString",value:function(){var t="[";if(l.b.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var i=0;i<this.ELEMENTS;++i)t+=" ".concat(this[i])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=Object(c.a)(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,i=0;i<this.RANK;++i)e[i]=this[n+i];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,i=0;i<this.RANK;++i)this[n+i]=e[i];return this}}]),n}(u.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{constructor(t,e={}){const{id:n="pass"}=e;this.id=n,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(){}cleanup(){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));async function*i(t,e={}){const n=e.chunkSize||1048576;let i=0;for(;i<t.size;){const e=i+n,o=await r(t,i,e);i=e,yield o}}async function r(t,e,n){return await new Promise((i,r)=>{const o=t.slice(e,n),a=new FileReader;a.onload=t=>i(t.target&&t.target.result),a.onerror=t=>r(t),a.readAsArrayBuffer(o)})}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(82),r=n(0);const o={blendFunc:[1,0,32771,0],blendEquation:32774};class a extends i.a{render(t){t.pickingFBO?(this.useAlpha=!0,this._drawPickingBuffer(t)):(this.useAlpha=!1,super.render(t))}_drawPickingBuffer({layers:t,layerFilter:e,views:n,viewports:i,onViewportActive:a,pickingFBO:s,deviceRect:{x:u,y:c,width:l,height:h},pass:p="picking",redrawReason:f,pickZ:d}){const A=this.gl;return this.pickZ=d,Object(r.o)(A,{scissorTest:!0,scissor:[u,c,l,h],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...o,blend:!d},()=>{super.render({target:s,layers:t,layerFilter:e,views:n,viewports:i,onViewportActive:a,pass:p,redrawReason:f})})}shouldDrawLayer(t){return t.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e){const n=this.pickZ?{blend:!1}:{...o,blend:!0,blendColor:[0,0,0,this.useAlpha?(e+1)/255:1]};return{...t.props.parameters,...n}}}},function(t,e,n){"use strict";function i({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:o=1/0}=n,a=t.length;let s=a,u=a;for(let n=0;n<a;n++){const i=e(t[n]);if(s>n&&i>=r&&(s=n),i>=o){u=n;break}}let c=s;const l=u-s!==i.length,h=l&&t.slice(u);for(let e=0;e<i.length;e++)t[c++]=i[e];if(l){for(let e=0;e<h.length;e++)t[c++]=h[e];t.length=c}return{startRow:s,endRow:s+i.length}}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function i(t){const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}function r(t,e){const n=document.createElement("div");return n.style.width=Number.isFinite(t)?"".concat(t,"px"):t,n.style.height="".concat(e,"px"),n.style.position="relative",n}n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";var i=n(0),r=n(234),o=n(99),a=n(13),s=n(175),u=n(282),c=n(60),l=n(27),h=n(33);let p=null;function f(t,e){var n;return new t((n=t.BYTES_PER_ELEMENT*e,(!p||p.byteLength<n)&&(p=new ArrayBuffer(n)),p),0,e)}var d=n(55),A=n(160),g=n(161);class m extends h.a{static isSupported(t,e={}){return!e.constantAttributeZero||(Object(i.j)(t)||"Chrome"===function(t){if(!t&&!Object(A.a)())return"Node";if(Object(g.a)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},n=t||e.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":d.b.chrome?"Chrome":d.b.safari?"Safari":d.b.mozInnerScreenX?"Firefox":"Unknown"}())}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new m(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return m.MAX_ATTRIBUTES=m.MAX_ATTRIBUTES||t.getParameter(34921),m.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:m._setConstantFloatArray(t,e,n);break;case Int32Array:m._setConstantIntArray(t,e,n);break;case Uint32Array:m._setConstantUintArray(t,e,n);break;default:Object(a.a)(!1)}}constructor(t,e={}){const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return m.getMaxAttributes(this.gl)}initialize(t={}){return this.setProps(t)}setProps(t){return this}setElementBuffer(t=null,e={}){return Object(a.a)(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);const{size:r,type:o,stride:s,offset:u,normalized:c,integer:l,divisor:h}=n,{gl:p,gl2:f}=this;return t=Number(t),this.bind(()=>{p.bindBuffer(34962,e.handle),l?(Object(a.a)(Object(i.j)(p)),f.vertexAttribIPointer(t,r,o,s,u)):p.vertexAttribPointer(t,r,o,c,s,u),p.enableVertexAttribArray(t),f.vertexAttribDivisor(t,h||0)}),this}enable(t,e=!0){return!e&&0===t&&!m.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),i=n.byteLength*t,r=n.length*t;let o=!this.buffer;if(this.buffer=this.buffer||new l.a(this.gl,i),o=o||this.buffer.reallocate(i),o=o||!this._compareConstantArrayValues(n,this.bufferValue),o){const t=f(e.constructor,r);!function({target:t,source:e,start:n=0,count:i=1}){const r=e.length,o=i*r;let a=0;for(let i=n;a<r;a++)t[i++]=e[a];for(;a<o;)a<o-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+o-a),a=o)}({target:t,source:n,start:0,count:r}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:Object(a.a)(!1)}}static _setConstantIntArray(t,e,n){switch(Object(a.a)(Object(i.j)(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:Object(a.a)(!1)}}static _setConstantUintArray(t,e,n){switch(Object(a.a)(Object(i.j)(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:Object(a.a)(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,{location:e}){return Object(a.a)(Number.isFinite(e)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(e,t);default:return this.gl.getVertexAttrib(e,t)}})}}var y=n(260);const v=/^(.+)__LOCATION_([0-9]+)$/,_=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class b{constructor(t,e={}){const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new m(t),Object(y.a)(this,"VertexArray","v6.0",_),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(t={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(t=null,e={}){return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e,n={}){if(34963===e.target)return this.setElementBuffer(e,n);const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return i>=0&&(this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,r)),this}setConstant(t,e,n={}){const{location:i,accessor:r}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return i>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[i]=e,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new l.a(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof l.a&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof l.a&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,n){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),i=n()}),i}_resolveLocationAndAccessor(t,e,n,r){const o={location:-1,accessor:null},{location:s,name:u}=this._getAttributeIndex(t);if(!Number.isFinite(s)||s<0)return this.unused[t]=e,i.k.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),o;const l=this._getAttributeInfo(u||s);if(!l)return o;const h=this.accessors[s]||{},p=c.a.resolve(l.accessor,h,n,r),{size:f,type:d}=p;return Object(a.a)(Number.isFinite(f)&&Number.isFinite(d)),{location:s,accessor:p}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=v.exec(t),i=n?n[1]:t,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}_setAttribute(t,e){if(e instanceof l.a)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof l.a){const n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else{if(!(e.buffer instanceof l.a))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=e;this.setBuffer(t,n.buffer,n)}}}_setConstantAttributes(t,e){const n=Math.max(0|t,0|e);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let t=1;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)i=this.values[t],ArrayBuffer.isView(i)&&this._setConstantAttribute(t,i)}_setConstantAttributeZero(t,e){if(m.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){m.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],i=this.accessors[e];if(!n)return;const{divisor:r}=i,o=r>0;if(t.isInstanced=t.isInstanced||o,n instanceof l.a){const e=n;if(o){const n=e.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,n)}else{const n=e.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,n)}}}setElements(t=null,e={}){return i.k.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}var x=n(278),w=n(87),E=n(76);function T(t,e={}){const{isInteger:n=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i==0?" ":"")),r+=T(t[o],e);const o=t.length>n?"...":"]";return"".concat(r).concat(o)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return n?"0":"0.";if(n)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function S(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let o,a,s,u="NOT PROVIDED",c=1,h=0,p=0;if(n&&(u=n.type,c=n.size,u=String(u).replace("Array",""),o=-1!==u.indexOf("nt")),e instanceof l.a){const t=e,{data:l,changed:f}=t.getDebugData();let d;if(a=f?"*":"",s=l,p=t.byteLength,h=p/l.BYTES_PER_ELEMENT/c,n){const t=n.divisor>0;d="".concat(t?"I ":"P "," ").concat(h," (x").concat(c,"=").concat(p," bytes ").concat(Object(w.a)(r,u),")")}else o=!0,d="".concat(p," bytes");return{[i]:"".concat(a).concat(T(s,{size:c,isInteger:o})),"Format ":d}}return s=e,c=e.length,u=String(e.constructor.name).replace("Array",""),o=-1!==u.indexOf("nt"),{[i]:"".concat(T(s,{size:c,isInteger:o})," (constant)"),"Format ":"".concat(c,"x").concat(u," (constant)")}}function P(t,e){const{type:n,size:i}=e,r=Object(E.b)(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function M({header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}){Object(a.a)(e);const r=e._uniformSetters,o={},s=Object.keys(r).sort();let u=0;for(const e of s)e.match(".*_.*")||e.match(".*Matrix")||C({table:o,header:t,uniforms:n,uniformName:e,undefinedOnly:i})&&u++;for(const e of s)e.match(".*Matrix")&&C({table:o,header:t,uniforms:n,uniformName:e,undefinedOnly:i})&&u++;for(const e of s)o[e]||C({table:o,header:t,uniforms:n,uniformName:e,undefinedOnly:i})&&u++;let c=0;const l={};if(!i)for(const e in n){const i=n[e];o[e]||(c++,l[e]={Type:"NOT USED: ".concat(i),[t]:T(i)})}return{table:o,count:u,unusedTable:l,unusedCount:c}}function C({table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:r}){const o=n[i],a=function(t){return null!=t}(o);return(!r||!a)&&(t[i]={[e]:a?T(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0)}function I(t){const{type:e,size:n}=t.accessor,i=Object(E.b)(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const O={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function L(t,e){const{attributeMap:n=O}=e||{};return n&&n[t]||t}function R(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}Object(a.a)(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}n.d(e,"a",(function(){return B}));const k=()=>{},D={};class B{constructor(t,e={}){const{id:n=Object(o.c)("model")}=e;Object(a.a)(Object(i.i)(t)),this.id=n,this.gl=t,this.id=e.id||Object(o.c)("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||r.a.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:i,modules:o,defines:s,inject:u,varyings:c,bufferMode:l,transpileToGLSL100:h}=t;this.programProps={program:e,vs:n,fs:i,modules:o,defines:s,inject:u,varyings:c,bufferMode:l,transpileToGLSL100:h},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Object(a.a)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:i,modules:r,defines:o,inject:a,varyings:s,bufferMode:u,transpileToGLSL100:c}=t;this.programProps={program:e,vs:n,fs:i,modules:r,defines:o,inject:a,varyings:s,bufferMode:u,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Object(a.a)(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Object(a.a)(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){const i={};let r=e.indices;for(const o in e.attributes){const a=e.attributes[o],s=L(o,n);if("indices"===o)r=a;else if(a.constant)i[s]=a.value;else{const e=a.value,n={...a};delete n.value,i[s]=[new l.a(t,e),n],R(o,n)}}if(r){const e=r.value||r;Object(a.a)(e instanceof Uint16Array||e instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new l.a(t,{data:e,target:34963}),n]}return i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(t={}){if(Object(o.a)(t))return this;const e={};for(const n in t){const i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}setUniforms(t={}){return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return Object(s.a)(this.program.gl,t),this}draw(t={}){this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:r={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:s={},vertexArray:u=this.vertexArray}=t;let c;this.setAttributes(o),this.updateModuleSettings(e),this.setUniforms(r),i.k.priority>=2&&(c=this._logDrawCallStart(2));const l=this.vertexArray.getDrawParams(),{isIndexed:h=l.isIndexed,indexType:p=l.indexType,indexOffset:f=l.indexOffset,vertexArrayInstanced:d=l.isInstanced}=this.props;d&&!this.isInstanced&&i.k.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:A,instanceCount:g}=this,{onBeforeRender:m=k,onAfterRender:y=k}=this.props;m(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(D,t,{logPriority:c,uniforms:null,framebuffer:n,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:u,transformFeedback:a,isIndexed:h,indexType:p,isInstanced:A,instanceCount:g,offset:h?f:0}));return y(),i.k.priority>=2&&this._logDrawCallEnd(c,u,n),v}transform(t={}){const{discard:e=!0,feedbackBuffers:n,unbindModels:i=[]}=t;let{parameters:r}=t;n&&this._setFeedbackBuffers(n),e&&(r=Object.assign({},r,{35977:e})),i.forEach(t=>t.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:r}))}finally{i.forEach(t=>t.vertexArray.bindBuffers())}return this}render(t={}){return i.k.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:n,modules:i,inject:r,defines:o,varyings:a,bufferMode:s,transpileToGLSL100:u}=this.programProps;t=this.programManager.get({vs:e,fs:n,modules:i,inject:r,defines:o,varyings:a,bufferMode:s,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Object(a.a)(t instanceof u.a,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new b(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof l.a&&e.delete()}}_setAnimationProps(t){this.animated&&Object(a.a)(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(t={}){if(Object(o.a)(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new x.a(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:1e4;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),i.k.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:i.k.level<=2})(),t}_logDrawCallEnd(t,e,n,r){if(void 0===t)return;const o=function({vertexArray:t,header:e="Attributes"}){if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=S(t,t.elements,null,e));const i=t.values;for(const r in i){const o=t._getAttributeInfo(r);if(o){let a="".concat(r,": ").concat(o.name);const s=t.accessors[o.location];s&&(a="".concat(r,": ").concat(P(o.name,s))),n[a]=S(t,i[r],s,e)}}return n}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:s,unusedCount:u}=M({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:c,count:l}=M({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});l>0&&i.k.log("MISSING UNIFORMS",Object.keys(c))(),u>0&&i.k.log("UNUSED UNIFORMS",Object.keys(s))();const h=function(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const t=I(i);e["in ".concat(t)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const t=I(i);e["out ".concat(t)]={[n]:JSON.stringify(i.accessor)}}return e}(this.vertexArray.configuration);i.k.table(t,o)(),i.k.table(t,a)(),i.k.table(t+1,h)(),r&&r.log({logLevel:2,message:"Rendered to ".concat(r.id)}),i.k.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}},function(t,e,n){"use strict";var i=n(162);function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||Object(i.a)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";var i=n(17),r=n(18),o=n(129),a=function(){function t(e,n){Object(i.a)(this,t),this.name=e,this.type=n,this.sampleSize=1,this.reset()}return Object(r.a)(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(o.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(o.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),s=function(){function t(e){var n=e.id,r=e.stats;Object(i.a)(this,t),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return Object(r.a)(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,n=t.type;return this.stats[e]||(this.stats[e]=t instanceof a?t:new a(e,n)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();n.d(e,"a",(function(){return s}))},function(t,e,n){"use strict";var i=n(110);function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,n){return(o=r()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&Object(i.a)(o,n.prototype),o}).apply(null,arguments)}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));var i=n(0),r=n(13);function o(t,{framebuffer:e=null,color:n=null,depth:o=null,stencil:a=null}={}){const s={};e&&(s.framebuffer=e);let u=0;n&&(u|=16384,!0!==n&&(s.clearColor=n)),o&&(u|=256,!0!==o&&(s.clearDepth=o)),a&&(u|=1024,!0!==o&&(s.clearStencil=o)),Object(r.a)(0!==u,"clear: bad arguments"),Object(i.o)(t,s,()=>{t.clear(u)})}function a(t,{framebuffer:e=null,buffer:n=6144,drawBuffer:o=0,value:a=[0,0,0,0]}={}){Object(i.a)(t),Object(i.o)(t,{framebuffer:e},()=>{switch(n){case 6144:switch(a.constructor){case Int32Array:t.clearBufferiv(n,o,a);break;case Uint32Array:t.clearBufferuiv(n,o,a);break;case Float32Array:default:t.clearBufferfv(n,o,a)}break;case 6145:t.clearBufferfv(6145,0,[a]);break;case 6146:t.clearBufferiv(6146,0,[a]);break;case 34041:const[e,i]=a;t.clearBufferfi(34041,0,e,i);break;default:Object(r.a)(!1,"clear: bad arguments")}})}},function(t,e,n){"use strict";var i=n(72),r=n(174);n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return h}));const o={[i.b]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[i.a]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},a="__LUMA_INJECT_DECLARATIONS__",s=/void\s+main\s*\([^)]*\)\s*\{\n?/,u=/}\n?[^{}]*$/,c=[];function l(t,e,n,r=!1){const l=e===i.b;for(const e in n){const i=n[e];i.sort((t,e)=>t.order-e.order),c.length=i.length;for(let t=0,e=i.length;t<e;++t)c[t]=i[t].injection;const r="".concat(c.join("\n"),"\n");switch(e){case"vs:#decl":l&&(t=t.replace(a,r));break;case"vs:#main-start":l&&(t=t.replace(s,t=>t+r));break;case"vs:#main-end":l&&(t=t.replace(u,t=>r+t));break;case"fs:#decl":l||(t=t.replace(a,r));break;case"fs:#main-start":l||(t=t.replace(s,t=>t+r));break;case"fs:#main-end":l||(t=t.replace(u,t=>r+t));break;default:t=t.replace(e,t=>t+r)}}return t=t.replace(a,""),r&&(t=t.replace(/\}\s*$/,t=>t+o[e])),t}function h(t){const e={};return Object(r.a)(Array.isArray(t)&&t.length>1),t.forEach(t=>{for(const n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]}),e}},,,,,,function(t,e,n){"use strict";(function(t){var i=n(124);Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if("undefined"!=typeof window&&"object"===(0,r.default)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===(0,r.default)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":(0,r.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||n;if(i&&i.indexOf("Electron")>=0)return!0;return!1};var r=i(n(145))}).call(this,n(48))},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));const i={name:"Null loader",id:"null",module:"loader-utils",version:"3.0.0-alpha.6",worker:!0,mimeTypes:["application/x.empty"],extensions:["null"],tests:[()=>!1],options:{null:{}}},r={...i,parse:async(t,e)=>t,parseSync:(t,e)=>t,parseInBatches:async(t,e)=>async function*(){yield*t}()}},function(t,e,n){"use strict";function i(t){if(!t||!t.POSITION)return null;let e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;const s=t.POSITION.value,u=s&&s.length;if(!u)return null;for(let t=0;t<u;t+=3){const u=s[t],c=s[t+1],l=s[t+2];e=u<e?u:e,n=c<n?c:n,i=l<i?l:i,r=u>r?u:r,o=c>o?c:o,a=l>a?l:a}return[[e,n,i],[r,o,a]]}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.r(e);var i=n(223);n.d(e,"SimpleMeshLayer",(function(){return i.a}));var r=n(218);n.d(e,"ScenegraphLayer",(function(){return r.a}))},function(t,e,n){"use strict";function i(t,e=""){if(!t)throw new Error("JSON conversion error ".concat(e))}function r(t,e){const n=function(t){if("string"==typeof t){let e=a[t];return e||(e=t.split("."),a[t]=e),e}return Array.isArray(t)?t:[t]}(e);let i=t;for(const t of n)i=o(i)?i[t]:void 0;return i}function o(t){return null!==t&&"object"==typeof t}n.r(e);const a={};var s=n(194),u=n.n(s);const c={"-":t=>t};function l(t,e){if(t in c)return c[t];let n;const i=u.a.parse(t);return i.right||i.left||"Identifier"!==i.type?(!function t(e,n){if(Array.isArray(e))e.forEach(e=>t(e,n));else if(e&&"object"==typeof e){e.type&&n(e);for(const i in e)t(e[i],n)}}(i,t=>{if("CallExpression"===t.type)throw new Error("Function calls not allowed in JSON expressions")}),n=t=>u.a.eval(i,t)):n=e=>r(e,t),c[t]=n,n}const h=t=>t&&"object"==typeof t;class p{constructor(...t){this.typeKey="@@type",this.functionKey="@@function",this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.convertFunction=l,this.preProcessClassProps=(t,e)=>e,this.postProcessConvertedJson=t=>t;for(const e of t)this.merge(e)}merge(t){for(const e in t)switch(e){case"layers":case"views":Object.assign(this.classes,t[e]);break;default:if(e in this){const n=t[e];this[e]=h(this[e])?Object.assign(this[e],n):n}}}validate(t){return i(!this.typeKey||"string"==typeof this.typeKey),i(h(this.classes)),!0}}function f(t){return t.replace("@@=","")}function d(t,e){const n={};for(const e in t){let r=t[e];"string"==typeof(i=r)&&i.startsWith("@@=")&&(r=f(r),r=l(r)),n[e]=r}var i;return n}function A(t,e,n){const i=n.classes[t],r=n.reactComponents[t];if(!i&&!r){const{log:i}=n,r=JSON.stringify(e,null,0).slice(0,40);return i&&i.warn("JSON converter: No registered class of type ".concat(t,"(").concat(r,"...)  ")),null}return i?function(t,e,n){n.preProcessClassProps&&(e=n.preProcessClassProps(t,e,n));return e=d(e),new t(e)}(i,e,n):function(t,e,n){const{React:i}=n,{children:r=[]}=e;delete e.children,n.preProcessClassProps&&(e=n.preProcessClassProps(t,e,n));return e=d(e),i.createElement(t,e,r)}(r,e,n)}const g=t=>t&&"object"==typeof t;class m{constructor(t){this.log=console,this.configuration={},this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof p?t.configuration:new p(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;let e=function(t,e){return e=new p(e),y(t,"",e)}(function(t){return"string"==typeof t?JSON.parse(t):t}(t),this.configuration);return e=this.configuration.postProcessConvertedJson(e),this.convertedJson=e,e}convertJson(t){return this.convert(t)}}function y(t,e,n){return Array.isArray(t)?t.map((t,e)=>y(t,String(e),n)):function(t,e){const{typeKey:n}=e;return g(t)&&Boolean(t[n])}(t,n)?function(t,e){const{typeKey:n}=e,i=t[n];let r={...t};return delete r[n],r=v(r,e),A(i,r,e)}(t,n):g(t)?"@@function"in t?function(t,e){const{functionKey:n}=e;let r={...t};delete r[n],r=v(r,e);const o=t[n],a=e.functions[o];return i(a,"Function ".concat(o," not found.")),a(r)}(t,n):v(t,n):"string"==typeof t?function(t,e,n){if(t.startsWith("@@=")&&n.convertFunction)return t=t.replace("@@=",""),n.convertFunction(t,n);if(t.startsWith("@@#")){if(t=t.replace("@@#",""),n.constants[t])return n.constants[t];const[e,i]=t.split(".");return n.enumerations[e][i]}return t}(t,0,n):t}function v(t,e){i(g(t));const n={};for(const i in t){const r=t[i];n[i]=y(r,0,e)}return n}var _=n(159);function b(t,e){if(t===e)return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!(n in e)||t[n]!==e[n])return!1;for(const n in e)if(!(n in t))return!1;return!0}n.d(e,"JSONConverter",(function(){return m})),n.d(e,"JSONConfiguration",(function(){return p})),n.d(e,"Transport",(function(){return _.a})),n.d(e,"_convertFunctions",(function(){return d})),n.d(e,"_parseExpressionString",(function(){return l})),n.d(e,"_shallowEqualObjects",(function(){return b}))},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r}));var i=n(159);class r extends i.a{constructor(){super("Jupyter Transport (JavaScript <=> Jupyter Kernel)"),this.jupyterModel=null,this.jupyterView=null}getRootDOMElement(){return this.jupyterView.el}sendJSONMessage(t,e){const n=i.a._stringifyJSONSafe({type:t,data:e});this.jupyterModel.send(n)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(108),r=n(25),o=n(63);class a extends i.a{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}shouldRenderSubLayer(t,e){const{_subLayerProps:n}=this.props;return e&&e.length||n&&n[t]}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if("function"==typeof t){const e={data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:s,highlightColor:u,coordinateSystem:c,coordinateOrigin:l,wrapLongitude:h,positionFormat:p,modelMatrix:f,extensions:d,_subLayerProps:A}=this.props,g={opacity:e,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:s,highlightColor:u,coordinateSystem:c,coordinateOrigin:l,wrapLongitude:h,positionFormat:p,modelMatrix:f,extensions:d},m=A&&A[t.id],y=m&&m.updateTriggers,v=t.id||"sublayer";if(m){const t=this.constructor._propTypes;for(const e in m){const n=t[e];n&&"accessor"===n.type&&(m[e]=this.getSubLayerAccessor(m[e]))}}Object.assign(g,t,m),g.id="".concat(this.props.id,"-").concat(v),g.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,...y};for(const t of d){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(g,e,{updateTriggers:Object.assign(g.updateTriggers,e.updateTriggers)})}return g}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=Object(o.b)(t,Boolean),this.internalState.subLayers=t),Object(r.a)("compositeLayer.renderLayers",this,e,t);for(const e of t)e.parent=this}}a.layerName="CompositeLayer"},function(t,e,n){"use strict";var i=n(156),r=n(69),o=n(6),a=n(63);class s{constructor(t={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return"string"==typeof t?this.views.find(e=>e.id===t):t}getViewState(t){const e=this.getView(t),n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,e){const n=this.getViewports(),i={x:t[0],y:t[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(i)){const n=t.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,e)}}return null}setProps(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Object(a.b)(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){if(t){!Object(r.a)(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t}else o.a.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}_createController(t,e){return new(0,e.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:e=>t._getViewport(e,{width:e.width,height:e.height}),...e})}_updateController(t,e,n,i){let r=t.controller;return r?(r={...e,...t.props,...r,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height},i?i.setProps(r):i=this._createController(t,r),i):null}_rebuildViewports(){const{width:t,height:e,views:n}=this,i=this.controllers;this._viewports=[],this.controllers={};for(let r=n.length;r--;){const o=n[r],a=this.getViewState(o),s=o.makeViewport({width:t,height:e,viewState:a});this.controllers[o.id]=this._updateController(o,a,s,i[o.id]),this._viewports.unshift(s)}for(const t in i)i[t]&&!this.controllers[t]&&i[t].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length||t.some((n,i)=>!t[i].equals(e[i]))}}var u=n(149),c=n(131);const l=new c.a;class h{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(t){"effects"in t&&(t.effects.length===this.effects.length&&Object(r.a)(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(t=[]){this.cleanup(),this.effects=t,this._createInternalEffects()}cleanup(){for(const t of this.effects)t.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some(t=>t instanceof c.a)||this._internalEffects.push(l)}}var p=n(81),f=n(158),d=n(68),A=n(116),g=n(0),m=n(196),y=n(167);const v={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function _({pickedColors:t,layers:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:a}){if(t){const{x:s,y:u,width:c,height:l}=a;let h=r*r,p=-1,f=0;for(let e=0;e<l;e++){const r=e+u-i,o=r*r;if(o>h)f+=4*c;else for(let e=0;e<c;e++){if(t[f+3]-1>=0){const t=e+s-n,i=t*t+o;i<=h&&(h=i,p=f)}f+=4}}if(p>=0){const n=t[p+3]-1,i=t.slice(p,p+4),r=e[n];if(r){const t=r.decodePickingColor(i),e=Math.floor(p/4/c);return{pickedColor:i,pickedLayer:r,pickedObjectIndex:t,pickedX:s+(p/4-e*c),pickedY:u+e}}o.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return v}function b({pickInfo:t,mode:e,viewports:n,layerFilter:i,pixelRatio:r,x:o,y:a,z:s}){const u=t&&t.pickedLayer,c=function(t,e,n){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e)&&(!n||n(r)))return r}return t[0]}(n,{x:o,y:a},i&&u&&(t=>i({layer:u,viewport:t,isPicking:!0,renderPass:"picking:".concat(e)}))),l=c&&c.unproject([o-c.x,a-c.y],{targetZ:s});return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:o,y:a,pixel:[o,a],coordinate:l,devicePixel:t&&[t.pickedX,t.pickedY],pixelRatio:r}}function x(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:o,pickedLayer:a,pickedObjectIndex:s}=e,u=a?[a]:[];if("hover"===i){const t=n.index,e=n.layerId,i=a&&a.props.id;if(i!==e||s!==t){if(i!==e){const t=r.find(t=>t.props.id===e);t&&u.unshift(t)}n.layerId=i,n.index=s,n.info=null}}const c=b(t),l=new Map;return l.set(null,c),u.forEach(t=>{let e={...c};t===a&&(e.color=o,e.index=s,e.picked=!0),e=w({layer:t,info:e,mode:i}),t===a&&"hover"===i&&(n.info=e),l.set(e.layer.id,e),"hover"===i&&e.layer.updateAutoHighlight(e)}),l}function w({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}class E{constructor(t){this.gl=t,this.pickingFBO=null,this.pickLayersPass=new y.a(t),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null},this._onError=null}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"onError"in t&&(this._onError=t.onError),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:n,viewports:i},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,a=r&&r.viewport&&r.viewport.id,s=o?n.find(t=>t.id===o):null,u=a&&i.find(t=>t.id===a)||i[0],c=u&&u.unproject([t-u.x,e-u.y]),l={x:t,y:e,viewport:u,coordinate:c,layer:s};return s?{...r,...l}:Object.assign(l,{color:null,object:null,index:-1})}_resizeBuffer(){const{gl:t}=this;return this.pickingFBO||(this.pickingFBO=new d.a(t),d.a.isSupported(t,{colorBufferFloat:!0})&&(this.depthFBO=new d.a(t),this.depthFBO.attach({36064:new A.a(t,{format:Object(g.j)(t)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}_getPickable(t){if(!1===this._pickable)return null;const e=t.filter(t=>t.isPickable()&&!t.isComposite);return e.length>255?(o.a.warn("Too many pickable layers, only picking the first 255")(),e.slice(0,255)):e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:n,x:i,y:r,radius:o=0,depth:a=1,mode:s="query",unproject3D:u,onViewportActive:c}){if(!(t=this._getPickable(t)))return{result:[],emptyInfo:b({viewports:n,x:i,y:r})};this._resizeBuffer();const l=Object(g.e)(this.gl),h=Object(g.d)(this.gl,[i,r],!0),p=[h.x+Math.floor(h.width/2),h.y+Math.floor(h.height/2)],f=Math.round(o*l),{width:d,height:A}=this.pickingFBO,m=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceWidth:d,deviceHeight:A});let y;const v=[],w={};for(let o=0;o<a;o++){const h=_({pickedColors:m&&this._drawAndSample({layers:t,views:e,viewports:n,onViewportActive:c,deviceRect:m,pass:"picking:".concat(s),redrawReason:s}),layers:t,deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceRect:m});let d;if(h.pickedLayer&&u&&this.depthFBO){d=this._drawAndSample({layers:[h.pickedLayer],views:e,viewports:n,onViewportActive:c,deviceRect:{x:h.pickedX,y:h.pickedY,width:1,height:1},pass:"picking:".concat(s),redrawReason:"pick-z",pickZ:!0})[0]*n[0].distanceScales.metersPerUnit[2]+n[0].position[2]}if(h.pickedColor&&o+1<a){const e=h.pickedColor[3]-1;w[e]=!0,t[e].disablePickingIndex(h.pickedObjectIndex)}y=x({pickInfo:h,lastPickedInfo:this.lastPickedInfo,mode:s,layers:t,layerFilter:this.layerFilter,viewports:n,x:i,y:r,z:d,pixelRatio:l});for(const t of y.values())t.layer&&v.push(t);if(!h.pickedColor)break}for(const e in w)t[e].restorePickingColors();return{result:v,emptyInfo:y&&y.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:n,x:i,y:r,width:a=1,height:s=1,mode:u="query",maxObjects:c=null,onViewportActive:l}){if(!(t=this._getPickable(t)))return[];this._resizeBuffer();const h=Object(g.e)(this.gl),p=Object(g.d)(this.gl,[i,r],!0),f=p.x,d=p.y+p.height,A=Object(g.d)(this.gl,[i+a,r+s],!0),m=A.x+A.width,y=A.y,v={x:f,y:y,width:m-f,height:d-y},_=function({pickedColors:t,layers:e}){const n=new Map;if(t)for(let i=0;i<t.length;i+=4){const r=t[i+3]-1;if(r>=0){const a=t.slice(i,i+4),s=a.join(",");if(!n.has(s)){const t=e[r];t?n.set(s,{pickedColor:a,pickedLayer:t,pickedObjectIndex:t.decodePickingColor(a)}):o.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}({pickedColors:this._drawAndSample({layers:t,views:e,viewports:n,onViewportActive:l,deviceRect:v,pass:"picking:".concat(u),redrawReason:u}),layers:t}),b=new Map,x=Number.isFinite(c);for(let t=0;t<_.length&&!(x&&b.size>=c);t++){const e=_[t];let n={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,width:a,height:s,pixelRatio:h};n=w({layer:e.pickedLayer,info:n,mode:u}),b.has(n.object)||b.set(n.object,n)}return Array.from(b.values())}_drawAndSample({layers:t,views:e,viewports:n,onViewportActive:i,deviceRect:r,pass:o,redrawReason:a,pickZ:s}){if(t.length<1)return null;const u=s?this.depthFBO:this.pickingFBO;this.pickLayersPass.render({layers:t,layerFilter:this.layerFilter,onError:this._onError,views:e,viewports:n,onViewportActive:i,pickingFBO:u,deviceRect:r,pass:o,redrawReason:a,pickZ:s});const{x:c,y:l,width:h,height:p}=r,f=new(s?Float32Array:Uint8Array)(h*p*4);return Object(m.c)(u,{sourceX:c,sourceY:l,sourceWidth:h,sourceHeight:p,target:f}),f}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const o=Math.max(0,t-n),a=Math.max(0,e-n),s=Math.min(i,t+n+1)-o,u=Math.min(r,e+n+1)-a;return s<=0||u<=0?null:{x:o,y:a,width:s,height:u}}}const T={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class S{constructor(t){const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,T),e.appendChild(this.el)),this.isVisible=!1}setTooltip(t,e,n){const i=this.el;if("string"==typeof t)i.innerText=t;else{if(!t)return this.isVisible=!1,void(i.style.display="none");"text"in t&&(i.innerText=t.text),"html"in t&&(i.innerHTML=t.html),"className"in t&&(i.className=t.className),Object.assign(i.style,t.style)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(e,"px, ").concat(n,"px)")}remove(){this.el&&this.el.remove()}}var P=n(64),M=n(190),C=n(15),I=n(140),O=n(13),L=n(33),R=n(261),k=n(191);class D extends L.a{static isSupported(t,e=[]){const n=Object(g.j)(t),i=Object(R.c)(t,k.a.TIMER_QUERY);let r=n||i;for(const t of e)switch(t){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:Object(O.a)(!1)}return r}constructor(t,e={}){super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery({conservative:t=!1}={}){return this.begin(t?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}_createHandle(){return D.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}function B(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}const F=Object(C.isBrowser)()&&"undefined"!=typeof document;let z=0;class N{constructor(t={}){const{onCreateContext:e=(t=>Object(g.c)(t)),onAddHTML:n=null,onInitialize:i=(()=>{}),onRender:r=(()=>{}),onFinalize:o=(()=>{}),onError:a,gl:s=null,glOptions:u={},debug:c=!1,createFramebuffer:l=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:p=!0,stats:f=I.a.get("animation-loop-".concat(z++))}=t;let{useDevicePixels:d=!0}=t;"useDevicePixelRatio"in t&&(g.k.deprecated("useDevicePixelRatio","useDevicePixels")(),d=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:i,onRender:r,onFinalize:o,onError:a,gl:s,glOptions:u,debug:c,createFramebuffer:l},this.gl=s,this.needsRedraw=null,this.timeline=null,this.stats=f,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:p,useDevicePixels:d}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Object(O.a)("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(t={}){if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=D.isSupported(this.gl,["timers"])?new D(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(t=>{this._running&&(this._addCallbackData(t||{}),!1!==t&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),B(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...t){return this.props.onCreateContext(...t)}onInitialize(...t){return this.props.onInitialize(...t)}onRender(...t){return this.props.onRender(...t)}onFinalize(...t){return this.props.onFinalize(...t)}getHTMLControlValue(t,e=1){const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return g.k.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};B(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=F?new Promise((t,e)=>{F&&"complete"===document.readyState?t(document):window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(t){var e;this.display&&this.display.requestAnimationFrame(t)||(e=t,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60))}_renderFrame(...t){this.display?this.display._renderFrame(...t):this.onRender(...t)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();t===this.animationProps.width&&e===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){"object"==typeof t&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Object(g.h)(this.props.gl,t):this.onCreateContext(t),!Object(g.i)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(g.l)(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&Object(g.m)(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new d.a(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}var j=n(279),U=n(265);function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var G,W,H=n(17),q=n(18),X=n(141),Z=n.n(X),Q={mousedown:1,mousemove:2,mouseup:4};G=Z.a.PointerEventInput,W=G.prototype.handler,G.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(e,(function(e){return e.pointerId===t.pointerId}))||e.push(t)),W.call(this,t)},Z.a.MouseInput.prototype.handler=function(t){var e=Q[t.type];1&e&&t.button>=0&&(this.pressed=!0),2&e&&0===t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))};var Y=Z.a.Manager,K=Z.a,J=K?[[K.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[K.Rotate,{enable:!1}],[K.Pinch,{enable:!1}],[K.Swipe,{enable:!1}],[K.Pan,{threshold:0,enable:!1}],[K.Press,{enable:!1}],[K.Tap,{event:"doubletap",taps:2,enable:!1}],[K.Tap,{event:"anytap",enable:!1}],[K.Tap,{enable:!1}]]:null,$={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},tt={doubletap:["tap"]},et={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},nt=["keydown","keyup"],it=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],rt=["wheel","mousewheel","DOMMouseScroll"],ot={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},at={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},st=n(97),ut=-1!==st.b.indexOf("firefox"),ct=rt,lt=function(){function t(e,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(H.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},r),this.events=ct.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent,!!st.a&&{passive:!1})}))}return Object(q.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;st.c.WheelEvent&&(ut&&t.deltaMode===st.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=st.c.devicePixelRatio),t.deltaMode===st.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var n={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,n)}}},{key:"_onWheel",value:function(t,e,n){this.callback({type:"wheel",center:n,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),ht=it,pt=function(){function t(e,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(H.a)(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},r),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=ht.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent)}))}return Object(q.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),ft=nt,dt=function(){function t(e,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(H.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},r),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=ft.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=r.tabIndex||0,e.style.outline="none",this.events.forEach((function(t){return e.addEventListener(t,i.handleEvent)}))}return Object(q.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),At=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(H.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(q.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),gt=n(46),mt={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};var yt={srcElement:"root",priority:0},vt=function(){function t(e){Object(H.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}return Object(q.a)(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.handlers,a=this.handlersByElement;n&&("object"!==Object(gt.a)(n)||n.addEventListener)&&(n={srcElement:n}),n=n?Object.assign({},yt,n):yt;var s=a.get(n.srcElement);s||(s=[],a.set(n.srcElement,s));var u={type:t,handler:e,srcElement:n.srcElement,priority:n.priority};i&&(u.once=!0),r&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;for(var c=s.length-1;c>=0&&!(s[c].priority>=u.priority);)c--;s.splice(c+1,0,u)}},{key:"remove",value:function(t,e){for(var n=this.handlers,i=this.handlersByElement,r=n.length-1;r>=0;r--){var o=n[r];if(o.type===t&&o.handler===e){n.splice(r,1);var a=i.get(o.srcElement);a.splice(a.indexOf(o),1),0===a.length&&i.delete(o.srcElement)}}this._active=n.some((function(t){return!t.passive}))}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),n=t.srcEvent.target;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var n=this.handlersByElement.get(e);if(n){for(var i=!1,r=function(){t.handled=!0},o=function(){t.handled=!0,i=!0},a=[],s=0;s<n.length;s++){var u=n[s],c=u.type,l=u.handler,h=u.once;if(l(Object.assign({},t,{type:c,stopPropagation:r,stopImmediatePropagation:o})),h&&a.push(n[s]),i)break}for(var p=0;p<a.length;p++){var f=a[p],d=f.type,A=f.handler;this.remove(d,A)}}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=mt[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,i=n.buttons,r=n.button,o=n.which,a=!1,s=!1,u=!1;return 4===e||2===e&&!Number.isFinite(i)?(a=1===o,s=2===o,u=3===o):2===e?(a=Boolean(1&i),s=Boolean(4&i),u=Boolean(2&i)):1===e&&(a=0===r,s=1===r,u=2===r),{leftButton:a,middleButton:s,rightButton:u}}(t),function(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var i=t.center||{x:n.clientX,y:n.clientY},r=e.getBoundingClientRect(),o=r.width/e.offsetWidth,a=r.height/e.offsetHeight;return{center:i,offsetCenter:{x:(i.x-r.left-e.clientLeft)/o,y:(i.y-r.top-e.clientTop)/a}}}(t,e),{handled:!1,rootElement:e})}}]),t}();function _t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var xt={events:null,recognizers:null,recognizerOptions:{},Manager:Y,touchAction:"none",tabIndex:0},wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(H.a)(this,t),this.options=Object.assign({},xt,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var i=n.events;i&&this.on(i)}return Object(q.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var n=this.options,i=n.Manager;for(var r in this.manager=new i(t,{touchAction:n.touchAction,recognizers:n.recognizers||J}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys($).forEach((function(t){var n=e.manager.get(t);n&&$[t].forEach((function(t){n.recognizeWith(t)}))})),n.recognizerOptions){var o=this.manager.get(r);if(o){var a=n.recognizerOptions[r];delete a.enable,o.set(a)}}this.wheelInput=new lt(t,this._onOtherEvent,{enable:!1}),this.moveInput=new pt(t,this._onOtherEvent,{enable:!1}),this.keyInput=new dt(t,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new At(t,this._onOtherEvent,{enable:!1});var s,u=_t(this.events);try{for(u.s();!(s=u.n()).done;){var c=V(s.value,2),l=c[0],h=c[1];h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(l,h.handleEvent))}}catch(t){u.e(t)}finally{u.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,n){this._addEventHandler(t,e,n,!1)}},{key:"once",value:function(t,e,n){this._addEventHandler(t,e,n,!0)}},{key:"watch",value:function(t,e,n){this._addEventHandler(t,e,n,!1,!0)}},{key:"off",value:function(t,e){this._removeEventHandler(t,e)}},{key:"_toggleRecognizer",value:function(t,e){var n=this.manager;if(n){var i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});var r=tt[t];r&&!this.options.recognizers&&r.forEach((function(r){var o=n.get(r);e?(o.requireFailure(t),i.dropRequireFailure(r)):o.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,n,i,r){if("string"==typeof t){var o=this.manager,a=this.events,s=at[t]||t,u=a.get(s);u||(u=new vt(this),a.set(s,u),u.recognizerName=ot[s]||s,o&&o.on(s,u.handleEvent)),u.add(t,e,n,i,r),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}else for(var c in n=e,t)this._addEventHandler(c,t[c],n,i,r)}},{key:"_removeEventHandler",value:function(t,e){if("string"==typeof t){var n=this.events,i=at[t]||t,r=n.get(i);if(r&&(r.remove(t,e),r.isEmpty())){var o,a=r.recognizerName,s=!1,u=_t(n.values());try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c.recognizerName===a&&!c.isEmpty()){s=!0;break}}}catch(t){u.e(t)}finally{u.f()}s||this._toggleRecognizer(a,!1)}}else for(var l in t)this._removeEventHandler(l,t[l])}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,n=et[e.type];n&&this.manager.emit(n,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}(),Et=n(31),Tt=n(5);function St(){}n.d(e,"a",(function(){return Mt}));const Pt={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:St,onResize:St,onViewStateChange:St,onInteractionStateChange:St,onBeforeRender:St,onAfterRender:St,onLoad:St,onError:null,_onMetrics:null,getCursor:({isDragging:t})=>t?"grabbing":"grab",debug:!1,drawPickingColors:!1};class Mt{constructor(t){t={...Pt,...t},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractionStateChange=this._onInteractionStateChange.bind(this),t.viewState&&t.initialViewState&&o.a.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===Object(C.getBrowser)()&&o.a.warn("IE 11 support will be deprecated in v8.0")(),t.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new U.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&P.a.setProps(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&o.a.removed("onLayerHover","onHover")(),"onLayerClick"in t&&o.a.removed("onLayerClick","onClick")(),t.initialViewState&&!Object(r.a)(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return e=e||n||i||r||o,e}redraw(t){if(!this.layerManager)return;const e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}getViews(){return this.viewManager.views}getViewports(t){return this.viewManager.getViewports(t)}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_pick(t,e,n){const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,...n});return i.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;if("string"==typeof e&&(e=document.getElementById(e),Object(Et.a)(e)),!e){e=document.createElement("canvas"),(t.parent||document.body).appendChild(e)}const{id:n,style:i}=t;return e.id=n,Object.assign(e.style,i),e}_setCanvasSize(t){if(!this.canvas)return;let{width:e,height:n}=t;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:t,height:e}=this;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:t}=this;if(!t)return!1;const e=t.clientWidth||t.width,n=t.clientHeight||t.height;return(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,!0)}_createAnimationLoop(t){const{width:e,height:n,gl:i,glOptions:r,debug:o,useDevicePixels:a,autoResizeDrawingBuffer:s}=t;return new N({width:e,height:n,useDevicePixels:a,autoResizeDrawingBuffer:s,autoResizeViewport:!1,gl:i,onCreateContext:t=>Object(g.c)({...r,...t,canvas:this.canvas,debug:o}),onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender,onError:t.onError})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new u.a({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onPointerMove(t){const{_pickRequest:e}=this;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;e.x=n.x,e.y=n.y,e.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t,e.mode="hover"}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.interactiveState.isHovering=e.length>0;let i=n,r=!1;for(const n of e)i=n,r=n.layer.onHover(n,t.event);if(!r&&this.props.onHover&&this.props.onHover(i,t.event),this.props.getTooltip){const t=this.props.getTooltip(i);this.tooltip.setTooltip(t,i.x,i.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,Object(g.h)(t,{enable:!0,copyState:!0})),this.tooltip=new S(this.canvas),Object(g.n)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new j.a;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new wt(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const t in Tt.b)this.eventManager.on(t,this._onEvent);this.viewManager=new s({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractionStateChange:this._onInteractionStateChange,views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new i.a(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new h,this.deckRenderer=new f.a(t),this.deckPicker=new E(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:n}=this.layerManager.context;Object(g.n)(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:n})}_onRendererInitialized({gl:t}){this._setGLContext(t)}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),o.a.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.interactiveState.isDragging=t.isDragging,this.props.onInteractionStateChange(t)}_onEvent(t){const e=Tt.b[t.type],n=t.offsetCenter;if(!e||!n)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=r,a=o&&(o[e.handler]||o.props[e.handler]),s=this.props[e.handler];let u=!1;a&&(u=a.call(o,r,t)),!u&&s&&s(r,t)}_onPointerDown(t){const e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y,radius:this.props.pickingRadius})}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const n=I.a.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}Mt.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(p.a)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,eventRecognizerOptions:t.object,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onInteractionStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}},Mt.defaultProps=Pt,Mt.VERSION=M.a.VERSION},function(t,e,n){"use strict";var i=n(103),r=n(281),o=n(15),a=n(6),s=n(25);var u={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(t){const e=t[0],n=t[t.length-1];return"{"===e&&"}"===n||"["===e&&"]"===n},parseTextSync:JSON.parse};const c="8.5.0-alpha.4",l=o.global.deck&&o.global.deck.VERSION;if(l&&l!==c)throw new Error("deck.gl - multiple versions detected: ".concat(l," vs ").concat(c));l||(o.global.deck=Object.assign(o.global.deck||{},{VERSION:c,version:c,log:a.a,_registerLoggers:s.b}),Object(i.c)([u,[r.a,{imagebitmap:{premultiplyAlpha:"none"}}]]));e.a=o.global.deck},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(68),r=n(116);const o={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};e.b={[o.WEBGL2]:[!1,!0],[o.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[o.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[o.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[o.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[o.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[o.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[o.FLOAT_BLEND]:["EXT_float_blend"],[o.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[o.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[o.TEXTURE_FLOAT]:["OES_texture_float",!0],[o.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[o.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[o.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[o.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[o.COLOR_ATTACHMENT_RGBA32F]:[function(t){const e=new r.a(t,{format:6408,type:5126,dataFormat:6408}),n=new i.a(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),o=n.getStatus();return e.delete(),n.delete(),36053===o},"EXT_color_buffer_float"],[o.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[o.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[o.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[o.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[o.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[o.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]}},function(t,e){},function(t,e){},function(t,e,n){const i=n(252),r={"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e}},o={"-":function(t){return-t},"+":function(t){return+t},"~":function(t){return~t},"!":function(t){return!t}};function a(t,e){return t.map((function(t){return l(t,e)}))}async function s(t,e){return await Promise.all(t.map(t=>h(t,e)))}function u(t,e){const n=l(t.object,e);return t.computed?[n,n[l(t.property,e)]]:[n,n[t.property.name]]}async function c(t,e){const n=await h(t.object,e);return t.computed?[n,n[await h(t.property,e)]]:[n,n[t.property.name]]}function l(t,e){switch(t.type){case"ArrayExpression":return a(t.elements,e);case"BinaryExpression":return r[t.operator](l(t.left,e),l(t.right,e));case"CallExpression":let n,i,s;if("MemberExpression"===t.callee.type?(s=u(t.callee,e),n=s[0],i=s[1]):i=l(t.callee,e),"function"!=typeof i)return;return i.apply(n,a(t.arguments,e));case"ConditionalExpression":return l(t.test,e)?l(t.consequent,e):l(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":return"||"===t.operator?l(t.left,e)||l(t.right,e):"&&"===t.operator?l(t.left,e)&&l(t.right,e):r[t.operator](l(t.left,e),l(t.right,e));case"MemberExpression":return u(t,e)[1];case"ThisExpression":return e;case"UnaryExpression":return o[t.operator](l(t.argument,e));default:return}}async function h(t,e){switch(t.type){case"ArrayExpression":return await s(t.elements,e);case"BinaryExpression":{const[n,i]=await Promise.all([h(t.left,e),h(t.right,e)]);return r[t.operator](n,i)}case"CallExpression":let n,i,a;if("MemberExpression"===t.callee.type?(a=await c(t.callee,e),n=a[0],i=a[1]):i=await h(t.callee,e),"function"!=typeof i)return;return await i.apply(n,await s(t.arguments,e));case"ConditionalExpression":return await h(t.test,e)?await h(t.consequent,e):await h(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":{if("||"===t.operator)return await h(t.left,e)||await h(t.right,e);if("&&"===t.operator)return await h(t.left,e)&&await h(t.right,e);const[n,i]=await Promise.all([h(t.left,e),h(t.right,e)]);return r[t.operator](n,i)}case"MemberExpression":return(await c(t,e))[1];case"ThisExpression":return e;case"UnaryExpression":return o[t.operator](await h(t.argument,e));default:return}}t.exports={parse:i,eval:l,evalAsync:h,compile:function(t){return l.bind(null,i(t))},compileAsync:function(t){return h.bind(null,i(t))}}},function(t,e,n){"use strict";var i=n(174);const r={number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},array:{validate:(t,e)=>Array.isArray(t)||ArrayBuffer.isView(t)}};function o(t){let e=a(t);return"object"===e?t?"type"in t?Object.assign({},t,r[t.type]):"value"in t?(e=a(t.value),Object.assign({type:e},t,r[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},r[e])}function a(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return u}));class s{constructor({name:t,vs:e,fs:n,dependencies:r=[],uniforms:a,getUniforms:s,deprecations:u=[],defines:c={},inject:l={},vertexShader:h,fragmentShader:p}){Object(i.a)("string"==typeof t),this.name=t,this.vs=e||h,this.fs=n||p,this.getModuleUniforms=s,this.dependencies=r,this.deprecations=this._parseDeprecationDefinitions(u),this.defines=c,this.injections=function(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);"string"==typeof i&&(i={order:0,injection:i}),e[r][n]=i}return e}(l),a&&(this.uniforms=function(t){const e={};for(const n in t){const i=o(t[n]);e[n]=i}return e}(a))}getModuleSource(t){let e;switch(t){case"vs":e=this.vs||"";break;case"fs":e=this.fs||"";break;default:Object(i.a)(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),t}_defaultGetUniforms(t={}){const e={},n=this.uniforms;for(const r in n){const o=n[r];r in t&&!o.private?(o.validate&&Object(i.a)(o.validate(t[r],o),"".concat(this.name,": invalid ").concat(r)),e[r]=t[r]):e[r]=o.value}return e}}function u(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){const e=new s(t);t.getUniforms=e.getUniforms.bind(e)}return t}},function(t,e,n){"use strict";var i=n(27),r=n(68),o=n(50),a=n(0),s=n(78),u=n(13);function c(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Object(u.a)(!1),0}}var l=n(227);function h(t,e={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:l,sourceHeight:h,sourceType:p}=e;const{framebuffer:f,deleteFramebuffer:d}=A(t);Object(u.a)(f);const{gl:g,handle:m,attachments:y}=f;l=l||f.width,h=h||f.height,36064===o&&null===m&&(o=1028),Object(u.a)(y[o]),p=p||y[o].type,a=function(t,e,n,i,r){if(t)return t;e=e||5121;const o=Object(s.c)(e,{clamped:!1}),a=c(n);return new o(i*r*a)}(a,p,r,l,h),p=p||Object(s.b)(a);const v=g.bindFramebuffer(36160,m);return g.readPixels(n,i,l,h,r,p,a),g.bindFramebuffer(36160,v||null),d&&f.delete(),a}function p(t,{sourceX:e=0,sourceY:n=0,sourceFormat:r=6408,target:o=null,targetByteOffset:s=0,sourceWidth:l,sourceHeight:h,sourceType:p}){const{framebuffer:f,deleteFramebuffer:d}=A(t);Object(u.a)(f),l=l||f.width,h=h||f.height;const g=Object(a.a)(f.gl);if(p=p||(o?o.type:5121),!o){const t=c(r),e=function(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Object(u.a)(!1),0}}(p),n=s+l*h*t*e;o=new i.a(g,{byteLength:n,accessor:{type:p,size:t}})}return o.bind({target:35051}),Object(a.o)(g,{framebuffer:f},()=>{g.readPixels(e,n,l,h,r,p,s)}),o.unbind({target:35051}),d&&f.delete(),o}function f(t,{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=h(t,{sourceAttachment:e}),{width:r,height:o}=t;for(;o>n;)({data:i,width:r,height:o}=Object(s.d)({data:i,width:r,height:o}));Object(s.a)({data:i,width:r,height:o});const a=document.createElement("canvas");a.width=r,a.height=o;const u=a.getContext("2d"),c=u.createImageData(r,o);return c.data.set(i),u.putImageData(c,0,0),a.toDataURL()}function d(t,e,n={}){const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:c=6408}=n;let{targetX:l,targetY:h,targetZ:p,width:f,height:d}=n;const{framebuffer:g,deleteFramebuffer:m}=A(t);Object(u.a)(g);const{gl:y,handle:v}=g,_=void 0!==l||void 0!==h||void 0!==p;l=l||0,h=h||0,p=p||0;const b=y.bindFramebuffer(36160,v);Object(u.a)(e);let x=null;if(e instanceof o.a&&(x=e,f=Number.isFinite(f)?f:x.width,d=Number.isFinite(d)?d:x.height,x.bind(0),e=x.target),_)switch(e){case 3553:case 34067:y.copyTexSubImage2D(e,s,l,h,i,r,f,d);break;case 35866:case 32879:Object(a.a)(y).copyTexSubImage3D(e,s,l,h,p,i,r,f,d)}else y.copyTexImage2D(e,s,c,i,r,f,d,0);return x&&x.unbind(),y.bindFramebuffer(36160,b||null),m&&g.delete(),x}function A(t){return t instanceof r.a?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Object(l.b)(t),deleteFramebuffer:!0}}n.d(e,"c",(function(){return h})),n.d(e,"d",(function(){return p})),n.d(e,"a",(function(){return f})),n.d(e,"b",(function(){return d}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);function r(t,e,n){const{removedProps:r={},deprecatedProps:o={},replacedProps:a={}}=n;for(const n in r)if(n in e){const e=r[n]?"".concat(t,".").concat(r[n]):"N/A";i.k.removed("".concat(t,".").concat(n),e)()}for(const n in o)if(n in e){const e=o[n];i.k.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(e))()}let s=null;for(const n in a)if(n in e){const r=a[n];i.k.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(r))(),s=s||Object.assign({},e),s[r]=e[n],delete s[n]}return s||e}},,,,function(t,e,n){"use strict";(function(t){var e=n(226),i=n(30),r=n(122);function o(t,{extension:e,target:n,target2:o}){const a=r.b[e];Object(i.a)(a);const{meta:s={}}=a,{suffix:u=""}=s,c=t.getExtension(e);for(const e of Object.keys(a)){const i="".concat(e).concat(u);let r=null;"meta"===e||"function"==typeof t[e]||(c&&"function"==typeof c[i]?r=(...t)=>c[i](...t):"function"==typeof a[e]&&(r=a[e].bind(n))),r&&(n[e]=r,o[e]=r)}}(void 0!==t?t:window).polyfillContext=function(t){t.luma=t.luma||{};const{luma:n}=t;return n.polyfilled||(Object(e.a)(t),function(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}(t),function(t,e){for(const n of Object.getOwnPropertyNames(e))"overrides"!==n&&o(t,{extension:n,target:t.luma,target2:t})}(t,r.b),function(t,{target:e,target2:n}){Object.keys(r.a).forEach(i=>{if("function"==typeof r.a[i]){const o=t[i]?t[i].bind(t):()=>{},a=r.a[i].bind(null,t,o);e[i]=a,n[i]=a}})}(t,{target:n,target2:t}),n.polyfilled=!0),t}}).call(this,n(61))},function(t,e,n){"use strict";(function(t,i){var r=n(124);Object.defineProperty(e,"__esModule",{value:!0}),e.console=e.process=e.document=e.global=e.window=e.self=void 0;var o=r(n(145)),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":(0,o.default)(i))&&i},s=a.self||a.window||a.global;e.self=s;var u=a.window||a.self||a.global;e.window=u;var c=a.global||a.self||a.window;e.global=c;var l=a.document||{};e.document=l;var h=a.process||{};e.process=h;var p=console;e.console=p}).call(this,n(61),n(48))},function(t,e,n){"use strict";(function(t){var i=n(124);Object.defineProperty(e,"__esModule",{value:!0}),e.default=a,e.isBrowserMainThread=function(){return a()&&"undefined"!=typeof document};var r=i(n(145)),o=i(n(182));function a(){return!("object"===(void 0===t?"undefined":(0,r.default)(t))&&"[object process]"===String(t)&&!t.browser)||(0,o.default)()}}).call(this,n(48))},function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(163),c=n(3),l=n(11),h=n(22),p=n(71);function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var d=function(t){Object(o.a)(n,t);var e=f(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(i.a)(this,n),t=e.call(this,2),Object(c.f)(r)&&1===arguments.length?t.copy(r):(c.b.debug&&(Object(l.a)(r),Object(l.a)(o)),t[0]=r,t[1]=o),t}return Object(r.a)(n,[{key:"set",value:function(t,e){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return c.b.debug&&(Object(l.a)(t.x),Object(l.a)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return h.j(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(p.a)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return h.i(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){return h.h(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return h.g(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),n}(u.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var i=n(171),r=n(34),o=n(28),a=n(38),s=n(39),u=n(21),c=n(11),l=n(164),h=n(71),p=n(8),f=n(22),d=n(12),A=n(19);function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(u.a)(t);if(e){var r=Object(u.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(s.a)(this,n)}}var m=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),y=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),v=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),_={},b=function(t){Object(a.a)(n,t);var e=g(n);function n(t){var i;return Object(r.a)(this,n),i=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?i.copy(t):i.identity(),i}return Object(o.a)(n,[{key:"INDICES",get:function(){return v}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return _.IDENTITY=_.IDENTITY||Object.freeze(new n(m)),_.IDENTITY}},{key:"ZERO",get:function(){return _.ZERO=_.ZERO||Object.freeze(new n(y)),_.ZERO}}]),Object(o.a)(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=c,this[10]=l,this[11]=h,this[12]=p,this[13]=f,this[14]=d,this[15]=A,this.check()}},{key:"setRowMajor",value:function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A){return this[0]=t,this[1]=r,this[2]=u,this[3]=p,this[4]=e,this[5]=o,this[6]=c,this[7]=f,this[8]=n,this[9]=a,this[10]=l,this[11]=d,this[12]=i,this[13]=s,this[14]=h,this[15]=A,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(m)}},{key:"fromQuaternion",value:function(t){return p.c(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,i=t.right,r=t.bottom,o=t.top,a=t.near,s=t.far;return s===1/0?n._computeInfinitePerspectiveOffCenter(this,e,i,r,o,a):p.d(this,e,i,r,o,a,s),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var i=t;t=i.eye,e=i.center,n=i.up}return e=e||[0,0,0],n=n||[0,1,0],p.g(this,t,e,n),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,i=t.bottom,r=t.top,o=t.near,a=void 0===o?.1:o,s=t.far,u=void 0===s?500:s;return p.i(this,e,n,i,r,a,u),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,i=void 0===e?45*Math.PI/180:e,r=t.aspect,o=void 0===r?1:r,a=t.focalDistance,s=void 0===a?1:a,u=t.near,c=void 0===u?.1:u,l=t.far,h=void 0===l?500:l;if(i>2*Math.PI)throw Error("radians");var p=i/2,f=s*Math.tan(p),d=f*o;return(new n).ortho({left:-d,right:d,bottom:-f,top:f,near:c,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=void 0===e?void 0:e,i=t.fov,r=void 0===i?45*Math.PI/180:i,o=t.aspect,a=void 0===o?1:o,s=t.near,u=void 0===s?.1:s,c=t.far,l=void 0===c?500:c;if((n=n||r)>2*Math.PI)throw Error("radians");return p.j(this,n,a,u,l),this.check()}},{key:"determinant",value:function(){return p.a(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),i=1/n[0],r=1/n[1],o=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),i=1/n[0],r=1/n[1],o=1/n[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*o,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*o,t}},{key:"transpose",value:function(){return p.q(this,this),this.check()}},{key:"invert",value:function(){return p.f(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return p.h(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return p.h(this,this,t),this.check()}},{key:"rotateX",value:function(t){return p.l(this,this,t),this.check()}},{key:"rotateY",value:function(t){return p.m(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return p.n(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],o=e[2];return this.rotateX(n).rotateY(r).rotateZ(o)}},{key:"rotateAxis",value:function(t,e){return p.k(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?p.o(this,this,t):p.o(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return p.p(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(e=A.n(e||[-0,-0,-0,-0],t,this),Object(c.b)(e,4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=f.j(e||[-0,-0],t,this);break;case 3:e=d.q(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=Object(h.a)(e||[-0,-0],t,this);break;case 3:e=Object(h.c)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return Object(c.c)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Object(c.c)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Object(c.c)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,i,r,o){var a=2*o/(n-e),s=2*o/(r-i),u=(n+e)/(n-e),c=(r+i)/(r-i),l=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}}]),n}(l.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(10),r=n(42),o=n(36),a=n(107);async function s(t,e,n){Array.isArray(e)||Object(r.a)(e)||(n=e,e=null);const s=Object(o.a)(n||{});let u=t;return"string"==typeof t?u=await s(t):t=null,Object(i.b)(t)&&(u=await s(t),t=null),await Object(a.a)(u,e,n)}},function(t,e,n){"use strict";var i=n(93);e.a={name:"project32",dependencies:[i.a],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(69);class r{constructor(t={}){this.opts=t}equals(t){return this===t||this.constructor===t.constructor&&Object(i.a)(this.opts,t.opts)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e={}}=t.constructor,n={updateTriggers:{}};for(const t in e)if(t in this.props){const i=e[t],r=this.props[t];n[t]=r,i&&"accessor"===i.type&&(n.updateTriggers[t]=this.props.updateTriggers[t],"function"==typeof r&&(n[t]=this.getSubLayerAccessor(r,!0)))}return n}initializeState(t,e){}updateState(t,e){}draw(t,e){}finalizeState(t){}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(45),r=n(64),o=n(31),a=n(27);class s{constructor(t={}){const{attributes:e={}}=t;this.typedArrayManager=r.a,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t),Object.seal(this)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:a,dataChanged:s,normalize:u=!0}=this.opts;if(this.data=e,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===a?2:3),this.buffers=n,this.normalize=u,r&&(Object(o.a)(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),u||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(s))for(const t of s)this._rebuildGeometry(t);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}normalizeGeometry(t){return t}updateGeometryAttributes(t,e,n){throw new Error("Not implemented")}getGeometrySize(t){throw new Error("Not implemented")}getGeometryFromBuffer(t){const e=t.value||t;return Object(o.a)(ArrayBuffer.isView(e)),Object(i.b)(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices})}_allocate(t,e){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:o}=this;for(const a in r)if(a in i)o.release(n[a]),n[a]=null;else{const i=r[a];i.copy=e,n[a]=o.allocate(n[a],t,i)}}_forEachGeometry(t,e,n){const{data:r,getGeometry:o}=this,{iterable:a,objectInfo:s}=Object(i.a)(r,e,n);for(const e of a){s.index++,t(o(e,s),s.index)}}_rebuildGeometry(t){if(!this.data||!this.getGeometry)return;let{indexStarts:e,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:o}=this,{startRow:s=0,endRow:u=1/0}=t||{},c={};if(t||(e=[0],n=[0]),this.normalize||!o)this._forEachGeometry((t,e)=>{t=this.normalizeGeometry(t),c[e]=t,n[e+1]=n[e]+this.getGeometrySize(t)},s,u),i=n[n.length-1];else if(o.buffer instanceof a.a){const t=o.stride||4*this.positionSize;n=r.startIndices,i=n[r.length]||o.buffer.byteLength/t}else{const t=o.value||o,e=o.stride/t.BYTES_PER_ELEMENT||this.positionSize;n=r.startIndices,i=n[r.length]||t.length/e}this._allocate(i,Boolean(t)),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=i;const l={};this._forEachGeometry((t,r)=>{t=c[r]||t,l.vertexStart=n[r],l.indexStart=e[r];const o=r<n.length-1?n[r+1]:i;l.geometrySize=o-n[r],l.geometryIndex=r,this.updateGeometryAttributes(t,l)},s,u),this.vertexCount=e[e.length-1]}}},function(t,e,n){"use strict";async function*i(t,e,n){const i=new e(n);for await(const e of t){const t=await i.write(e);t&&(yield t)}const r=await i.end();r&&(yield r)}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));const i={name:"JSON",id:"json",module:"json",version:"3.0.0-alpha.6",extensions:["json","geojson"],mimeTypes:["application/json"],category:"json",text:!0,parseTextSync:function(t,e){return JSON.parse(t)},options:{}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(172);const r={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class o{constructor(t={}){this.props={...r,...t},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new i.a({id:t.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,getPriority:e},i=new Promise(t=>(n.resolve=t,n));return this.requestQueue.push(n),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:n}=t;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this._deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e)if(this.requestQueue.length>0){const t=this.requestQueue.shift();this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((t,e)=>t.priority-e.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(262),r=n(154);class o extends r.a{getGeometry(t){return new i.a}draw({uniforms:t}){const{elevationScale:e,extruded:n,offset:i,coverage:r,cellSize:o,angle:a}=this.props;this.state.model.setUniforms(t).setUniforms({radius:o/2,angle:a,offset:i,extruded:n,coverage:r,elevationScale:e,edgeDistance:1,isWireframe:!1}).draw()}}o.layerName="GridCellLayer",o.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var i=n(188),r=n(6),o=n(45),a=n(109),s=n(92),u=n(138),c=n(168);const l=[0,0,0,255],h={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:l},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class p extends i.a{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&r.a.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:t,props:e,changeFlags:n}){const i=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon);if(i&&Array.isArray(n.dataChanged)){const t=this.state.paths.slice(),e=n.dataChanged.map(e=>Object(c.a)({data:t,getIndex:t=>t.__source.index,dataRange:e,replace:this._getPaths(e)}));this.setState({paths:t,pathsDiff:e})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:e,getPolygon:n,positionFormat:i,_normalize:r}=this.props,a=[],s="XY"===i?2:3,{startRow:c,endRow:l}=t,{iterable:h,objectInfo:p}=Object(o.a)(e,c,l);for(const t of h){p.index++;let e=n(t,p);r&&(e=u.b(e,s));const{holeIndices:i}=e,o=e.positions||e;if(i)for(let e=0;e<=i.length;e++){const n=o.slice(i[e-1]||0,i[e]||o.length);a.push(this.getSubLayerRow({path:n},t,p.index))}else a.push(this.getSubLayerRow({path:o},t,p.index))}return a}renderLayers(){const{data:t,_dataDiff:e,stroked:n,filled:i,extruded:r,wireframe:o,_normalize:u,_windingOrder:c,elevationScale:h,transitions:p,positionFormat:f}=this.props,{lineWidthUnits:d,lineWidthScale:A,lineWidthMinPixels:g,lineWidthMaxPixels:m,lineJointRounded:y,lineMiterLimit:v,lineDashJustified:_}=this.props,{getFillColor:b,getLineColor:x,getLineWidth:w,getLineDashArray:E,getElevation:T,getPolygon:S,updateTriggers:P,material:M}=this.props,{paths:C,pathsDiff:I}=this.state,O=this.getSubLayerClass("fill",a.a),L=this.getSubLayerClass("stroke",s.a),R=this.shouldRenderSubLayer("fill",C)&&new O({_dataDiff:e,extruded:r,elevationScale:h,filled:i,wireframe:o,_normalize:u,_windingOrder:c,getElevation:T,getFillColor:b,getLineColor:r&&o?x:l,material:M,transitions:p},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:P.getPolygon,getElevation:P.getElevation,getFillColor:P.getFillColor,lineColors:r&&o,getLineColor:P.getLineColor}}),{data:t,positionFormat:f,getPolygon:S});return[!r&&R,!r&&n&&this.shouldRenderSubLayer("stroke",C)&&new L({_dataDiff:I&&(()=>I),widthUnits:d,widthScale:A,widthMinPixels:g,widthMaxPixels:m,jointRounded:y,miterLimit:v,dashJustified:_,_pathType:"loop",transitions:p&&{getWidth:p.getLineWidth,getColor:p.getLineColor,getPath:p.getPolygon},getColor:this.getSubLayerAccessor(x),getWidth:this.getSubLayerAccessor(w),getDashArray:this.getSubLayerAccessor(E)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:P.getLineWidth,getColor:P.getLineColor,getDashArray:P.getLineDashArray}}),{data:C,positionFormat:f,getPath:t=>t.path}),r&&R]}}p.layerName="PolygonLayer",p.defaultProps=h},function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(164),c=n(11),l=n(71),h=n(52),p=n(22),f=n(12);function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var A=Object.freeze([1,0,0,0,1,0,0,0,1]),g=Object.freeze([0,0,0,0,0,0,0,0,0]),m=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),y={},v=function(t){Object(o.a)(n,t);var e=d(n);function n(t){var r;return Object(i.a)(this,n),r=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return Object(r.a)(n,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return m}}],[{key:"IDENTITY",get:function(){return y.IDENTITY=y.IDENTITY||Object.freeze(new n(A)),y.IDENTITY}},{key:"ZERO",get:function(){return y.ZERO=y.ZERO||Object.freeze(new n(g)),y.ZERO}}]),Object(r.a)(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,n,i,r,o,a,s,u){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,n,i,r,o,a,s,u){return this[0]=t,this[1]=i,this[2]=a,this[3]=e,this[4]=r,this[5]=s,this[6]=n,this[7]=o,this[8]=u,this.check()}},{key:"determinant",value:function(){return h.b(this)}},{key:"identity",value:function(){return this.copy(A)}},{key:"fromQuaternion",value:function(t){return h.c(this,t),this.check()}},{key:"transpose",value:function(){return h.i(this,this),this.check()}},{key:"invert",value:function(){return h.d(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return h.e(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return h.e(this,this,t),this.check()}},{key:"rotate",value:function(t){return h.f(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?h.g(this,this,t):h.g(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return h.h(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=p.i(e||[-0,-0],t,this);break;case 3:e=f.p(e||[-0,-0,-0],t,this);break;case 4:e=Object(l.d)(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(c.b)(e,t.length),e}},{key:"transformVector",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return Object(c.c)("Matrix3.transformVector"),this.transform(t,e)}}]),n}(u.a)},function(t,e,n){"use strict";e.a={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(126);function r(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(Object(i.a)(t),'"'))}}},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(224),a=n(6),s=n(0);const u={name:"pbr",vs:"uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n\nvarying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)\n# error PBR fragment shader: Texture LOD is not available\n#endif\n\n#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)\n# error PBR fragment shader: Derivatives are not available\n#endif\n\n\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\nuniform bool pbr_uUnlit;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n  vec3 n;\n  vec3 v;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\n  return vec4(linOut,srgbIn.w);;\n#else\n  return srgbIn;\n#endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);\n  vec3 h = normalize(l+v);\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 color = vec3(0, 0, 0);\n\n  if(pbr_uUnlit){\n    color.rgb = baseColor.rgb;\n  }\n  else{\n\n\n    float perceptualRoughness = u_MetallicRoughnessValues.y;\n    float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n#endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    vec3 n = getNormal();\n    vec3 v = normalize(u_Camera - pbr_vPosition);\n\n    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    PBRInfo pbrInputs = PBRInfo(\n      0.0,\n      NdotV,\n      0.0,\n      0.0,\n      0.0,\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n#ifdef USE_LIGHTS\n    PBRInfo_setAmbientLight(pbrInputs);\n    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n      if (i < lighting_uDirectionalLightCount) {\n        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n      }\n    }\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n      if (i < lighting_uPointLightCount) {\n        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n      }\n    }\n#endif\n#ifdef USE_IBL\n    color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n    color += emissive;\n#endif\n\n#ifdef PBR_DEBUG\n\n\n\n\n\n    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  }\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[n(139).a]};var c=n(147),l=n(205),h=n(99),p=n(13);class f{constructor(t={}){const{id:e}=t;this.id=e||Object(h.c)(this.constructor.name),this.display=!0,this.position=new c.a,this.rotation=new c.a,this.scale=new c.a(1,1,1),this.matrix=new l.a,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}setPosition(t){return Object(p.a)(3===t.length,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Object(p.a)(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Object(p.a)(3===t.length,"setScale requires vector argument"),this.scale=t,this}setMatrix(t,e=!0){e?this.matrix.copy(t):this.matrix=t}setMatrixComponents({position:t,rotation:e,scale:n,update:i=!0}){return t&&this.setPosition(t),e&&this.setRotation(e),n&&this.setScale(n),i&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(t={}){const{position:e,rotation:n,scale:i}=t;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(t,e){Object(p.a)(t),e=e||this.matrix;const n=new l.a(t).multiplyRight(e),i=n.invert(),r=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}var d=n(27),A=n(60);class g extends f{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;s.k.assert(e.every(t=>t instanceof f),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(...t){for(const e of t)Array.isArray(e)?this.add(...e):this.children.push(e);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}traverse(t,{worldMatrix:e=new l.a}={}){const n=new l.a(e).multiplyRight(this.matrix);for(const e of this.children)e instanceof g?e.traverse(t,{worldMatrix:n}):t(e,{worldMatrix:n})}}var m=n(225);const y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},v={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function _(t){if(!t._animation){const e=v[t.componentType],n=y[t.type],i=n*t.count,{buffer:r,byteOffset:o}=t.bufferView.data,a=new e(r,o+(t.byteOffset||0),i);if(1===n)t._animation=Array.from(a);else{const e=[];for(let t=0;t<a.length;t+=n)e.push(Array.from(a.slice(t,t+n)));t._animation=e}}return t._animation}const b=new l.a;const x=new m.a;function w(t,{input:e,interpolation:n,output:i},r,o){const a=t%e[e.length-1],u=e.findIndex(t=>t>=a),c=Math.max(0,u-1);if(!Array.isArray(r[o]))switch(o){case"translation":r[o]=[0,0,0];break;case"rotation":r[o]=[0,0,0,1];break;case"scale":r[o]=[1,1,1];break;default:s.k.warn("Bad animation path ".concat(o))()}Object(p.a)(r[o].length===i[c].length);const l=e[c],h=e[u];switch(n){case"STEP":!function(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}(r,o,i[c]);break;case"LINEAR":if(h>l){const t=(a-l)/(h-l);!function(t,e,n,i,r){if("rotation"===e){x.slerp({start:n,target:i,ratio:r});for(let n=0;n<x.length;n++)t[e][n]=x[n]}else for(let o=0;o<n.length;o++)t[e][o]=r*i[o]+(1-r)*n[o]}(r,o,i[c],i[u],t)}break;case"CUBICSPLINE":if(h>l){const t=(a-l)/(h-l),e=h-l;!function(t,e,{p0:n,outTangent0:i,inTangent1:r,p1:o,tDiff:a,ratio:s}){for(let u=0;u<t[e].length;u++){const c=i[u]*a,l=r[u]*a;t[e][u]=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*n[u]+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(-2*Math.pow(s,3)+3*Math.pow(s,2))*o[u]+(Math.pow(s,3)-Math.pow(s,2))*l}}(r,o,{p0:i[3*c+1],outTangent0:i[3*c+2],inTangent1:i[3*u+0],p1:i[3*u+1],tDiff:e,ratio:t})}break;default:s.k.warn("Interpolation ".concat(n," not supported"))()}}class E{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:t,target:n,path:i})=>{w(e,t,n,i),function(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=b.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}(n,n._node)})}}class T{constructor(t){this.animations=t.animations.map((e,n)=>{const i=e.name||"Animation-".concat(n),r=e.samplers.map(({input:e,interpolation:n="LINEAR",output:i})=>({input:_(t.accessors[e]),interpolation:n,output:_(t.accessors[i])})),o=e.channels.map(({sampler:e,target:n})=>({sampler:r[e],target:t.nodes[n.node],path:n.path}));return new E({name:i,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}var S=n(170);class P extends f{constructor(t,e={}){super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof S.a?(this.model=t,this._setModelNodeProps(e)):this.model=new S.a(t,e),this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(...t){return this.model.draw(...t)}setUniforms(...t){return this.model.setUniforms(...t),this}setAttributes(...t){return this.model.setAttributes(...t),this}updateModuleSettings(...t){return this.model.updateModuleSettings(...t),this}_setModelNodeProps(t){this.model.setProps(t)}}var M=n(261),C=n(191),I=n(116);class O{constructor(t,{attributes:e,material:n,pbrDebug:i,imageBasedLightingEnvironment:r,lights:o,useTangents:a}){this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Object(M.b)(t,C.a.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],r&&(this.uniforms.u_DiffuseEnvSampler=r.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=r.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=r.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),i&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(e.NORMAL,"HAS_NORMALS"),this.defineIfPresent(e.TANGENT&&a,"HAS_TANGENTS"),this.defineIfPresent(e.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(r,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(i,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e,n=null){const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},r=new I.a(this.gl,{id:t.name||t.id,parameters:i,pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},data:t.texture.source.image});this.uniforms[e]=r,this.defineIfPresent(n,n),this.generatedTextures.push(r)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),"MASK"===t.alphaMode){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else"BLEND"===t.alphaMode&&(s.k.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}}function L(t,e){return Object(s.j)(t)?"#version 300 es\n".concat(e):e}const R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class D{constructor(t,e={}){this.gl=t,this.options=Object.assign({},k,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(t=>this.createScene(t))}createAnimator(){return Array.isArray(this.gltf.animations)?new T(this.gltf):null}createScene(t){const e=(t.nodes||[]).map(t=>this.createNode(t));return new g({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map(t=>this.createNode(t));t.mesh&&e.push(this.createMesh(t.mesh));const n=new g({id:t.name||t.id,children:e});if(t.matrix)n.setMatrix(t.matrix);else{if(n.matrix.identity(),t.translation&&n.matrix.translate(t.translation),t.rotation){const e=(new l.a).fromQuaternion(t.rotation);n.matrix.multiplyRight(e)}t.scale&&n.matrix.scale(t.scale)}t._node=n}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map((e,n)=>this.createPrimitive(e,n,t)),n=new g({id:t.name||t.id,children:e});t._mesh=n}return t._mesh}getVertexCount(t){s.k.warn("getVertexCount() not found")()}createPrimitive(t,e,n){return function(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:o,modelOptions:a}=e,c=new O(t,e);s.k.info(4,"createGLTFModel defines: ",c.defines)();const l=[];l.push(...c.generatedTextures),l.push(...Object.values(o).map(t=>t.buffer));const h=new P(t,Object.assign({id:n,drawMode:i,vertexCount:r,modules:[u],defines:c.defines,parameters:c.parameters,vs:L(t,"\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n"),fs:L(t,"\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n"),managedResources:l},a));return h.setProps({attributes:o}),h.setUniforms(c.uniforms),h}(this.gl,Object.assign({id:t.name||"".concat(n.name||n.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options))}createAttributes(t,e){const n={};return Object.keys(t).forEach(e=>{n[e]=this.createAccessor(t[e],this.createBuffer(t[e],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),s.k.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new d.a(this.gl,{id:"from-".concat(n.id),data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new A.a({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:R[t.type]})}createSampler(t){return t}needsPOT(){return!1}}var B=n(280);async function F(t){const e=[];return t.scenes.forEach(t=>{t.traverse(t=>{Object.values(t.model.getUniforms()).forEach(t=>{!1===t.loaded&&e.push(t)})})}),await async function(t){for(;t();)await new Promise(t=>requestAnimationFrame(t))}(()=>e.some(t=>!t.loaded))}var z=n(119);n.d(e,"a",(function(){return U}));const N=[255,255,255,255],j={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?"object"==typeof t.scene?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:N},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[B.a]};class U extends i.a{getShaders(){const t=[r.a,o.a];return"pbr"===this.props._lighting&&t.push(u),{vs:"#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      pbr_vNormal = project_normal(instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz);\n      geometry.normal = pbr_vNormal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n",modules:t}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:N,transition:!0},instanceModelMatrix:z.a})}updateState(t){super.updateState(t);const{props:e,oldProps:n}=t;e.scenegraph!==n.scenegraph?this._updateScenegraph(e):e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(){super.finalizeState(),this._deleteScenegraph()}_updateScenegraph(t){const{gl:e}=this.context;let n=null;if(t.scenegraph instanceof f)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const i=t.scenegraph,r=function(t,e,n){const i=new D(t,n);return{scenes:i.instantiate(e),animator:i.createAnimator()}}(e,i,this._getModelOptions());n={gltf:i,...r},F(r).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(a.a.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);const i={layer:this,gl:e},r=t.getScene(n,i),o=t.getAnimator(n,i);r instanceof f?(this._deleteScenegraph(),this._applyAllAttributes(r),this._applyAnimationsProp(r,o,t._animations),this.setState({scenegraph:r,animator:o})):null!==r&&a.a.warn("invalid scenegraph:",r)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(t=>{this._setModelAttributes(t.model,e)})}}_applyAnimationsProp(t,e,n){if(!t||!e||!n)return;const i=e.getAnimations();Object.keys(n).sort().forEach(t=>{const e=n[t];if("*"===t)i.forEach(t=>{Object.assign(t,e)});else if(Number.isFinite(Number(t))){const n=Number(t);n>=0&&n<i.length?Object.assign(i[n],e):a.a.warn("animation ".concat(t," not found"))()}else{const n=i.find(({name:e})=>e===t);n?Object.assign(n,e):a.a.warn("animation ".concat(t," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof f&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!Object(s.j)(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw({moduleParameters:t=null,parameters:e={},context:n}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a,opacity:s,coordinateSystem:u}=this.props,c=this.getNumInstances();this.state.scenegraph.traverse((n,{worldMatrix:l})=>{n.model.setInstanceCount(c),n.updateModuleSettings(t),n.draw({parameters:e,uniforms:{sizeScale:r,opacity:s,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:Object(z.b)(i,u),sceneModelMatrix:l,u_Camera:n.model.getUniforms().project_uCameraPosition}})})}}U.layerName="ScenegraphLayer",U.defaultProps=j},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(224),a=n(170),s=n(58);n.d(e,"a",(function(){return l}));const u=[0,0,0,255],c={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:u},getTargetColor:{type:"accessor",value:u},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class l extends i.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  if (dh == 0.0) {\n    return sourceZ + deltaZ * ratio;\n  }\n  float unitZ = deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n  vec3 source;\n  vec3 target;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source_world = instanceSourcePositions;\n    vec3 target_world = instanceTargetPositions;\n    if (useShortestPath) {\n      source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n      target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n\n      float deltaLng = target_world.x - source_world.x;\n      if (deltaLng > 180.) target_world.x -= 360.;\n      if (deltaLng < -180.) source_world.x -= 360.;\n    }\n    source = project_position(source_world, instanceSourcePositions64Low);\n    target = project_position(target_world, instanceTargetPositions64Low);\n    float antiMeridianX = 0.0;\n\n    if (useShortestPath) {\n      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n      }\n      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\n\n      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\n        isValid = 0.0;\n        indexDir = sign(segmentRatio - thresholdRatio);\n        segmentRatio = thresholdRatio;\n      }\n    }\n\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n\n    if (useShortestPath) {\n      if (nextPos.x < antiMeridianX) {\n        currPos.x += TILE_SIZE;\n        nextPos.x += TILE_SIZE;\n      }\n    }\n\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:u},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:u},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:o,greatCircle:a,wrapLongitude:s}=this.props,u="pixels"===n?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({greatCircle:a,widthScale:i*u,widthMinPixels:r,widthMaxPixels:o,useShortestPath:s}).draw()}_getModel(t){let e=[];for(let t=0;t<50;t++)e=e.concat([t,1,0,t,-1,0]);const n=new a.a(t,{...this.getShaders(),id:this.props.id,geometry:new s.a({drawMode:5,attributes:{positions:new Float32Array(e)}}),isInstanced:!0});return n.setUniforms({numSegments:50}),n}}l.layerName="ArcLayer",l.defaultProps=c},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(224),a=n(170),s=n(58);n.d(e,"a",(function(){return c}));const u={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class c extends i.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float useShortestPath;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvec3 splitLine(vec3 a, vec3 b, float x) {\n  float t = (x - a.x) / (b.x - a.x);\n  return vec3(x, mix(a.yz, b.yz, t));\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  vec3 source_world = instanceSourcePositions;\n  vec3 target_world = instanceTargetPositions;\n  vec3 source_world_64low = instanceSourcePositions64Low;\n  vec3 target_world_64low = instanceTargetPositions64Low;\n\n  if (useShortestPath > 0.5 || useShortestPath < -0.5) {\n    source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n    target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n    float deltaLng = target_world.x - source_world.x;\n\n    if (deltaLng * useShortestPath > 180.) {\n      source_world.x += 360. * useShortestPath;\n      source_world = splitLine(source_world, target_world, 180. * useShortestPath);\n      source_world_64low = vec3(0.0);\n    } else if (deltaLng * useShortestPath < -180.) {\n      target_world.x += 360. * useShortestPath;\n      target_world = splitLine(source_world, target_world, 180. * useShortestPath);\n      target_world_64low = vec3(0.0);\n    } else if (useShortestPath < 0.) {\n      gl_Position = vec4(0.);\n      return;\n    }\n  }\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:o,wrapLongitude:a}=this.props,s="pixels"===n?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({widthScale:i*s,widthMinPixels:r,widthMaxPixels:o,useShortestPath:a?1:0}).draw(),a&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(t){return new a.a(t,{...this.getShaders(),id:this.props.id,geometry:new s.a({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0})}}c.layerName="LineLayer",c.defaultProps=u},function(t,e,n){"use strict";var i=n(108),r=n(207),o=n(285),a=n(224),s=n(170),u=n(58);n.d(e,"a",(function(){return p}));const c=[0,0,0,255],l=[0,0,1],h={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:l},getColor:{type:"accessor",value:c},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};class p extends i.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * radiusPixels, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.a,o.a,a.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:l},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:c}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){var i;const{gl:t}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}n.dataChanged&&function(t){const{header:e,attributes:n}=t;e&&n&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}(t.data)}draw({uniforms:t}){const{viewport:e}=this.context,{pointSize:n,sizeUnits:i}=this.props,r="meters"===i?1/e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({radiusPixels:n*r}).draw()}_getModel(t){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(2*Math.cos(n),2*Math.sin(n),0)}return new s.a(t,{...this.getShaders(),id:this.props.id,geometry:new u.a({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}p.layerName="PointCloudLayer",p.defaultProps=h},function(t,e,n){"use strict";var i=n(188),r=n(6),o=n(155),a=n(92),s=n(109),u=n(168),c=n(90);function l(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:a=t.length}=n;for(let n=o;n<a;n++){const o=t[n];r.a.assert(o&&o.geometry,"GeoJSON does not have geometry");const{geometry:a}=o;if("GeometryCollection"===a.type){r.a.assert(Array.isArray(a.geometries),"GeoJSON does not have geometries array");const{geometries:t}=a;for(let r=0;r<t.length;r++){h(t[r],i,e,o,n)}}else h(a,i,e,o,n)}return i}function h(t,e,n,i,o){const{type:a,coordinates:s}=t,{pointFeatures:u,lineFeatures:c,polygonFeatures:l,polygonOutlineFeatures:h}=e;if(function(t,e){let n=p[t];r.a.assert(n,"Unknown GeoJSON type ".concat(t));for(;e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}(a,s))switch(a){case"Point":u.push(n({geometry:t},i,o));break;case"MultiPoint":s.forEach(t=>{u.push(n({geometry:{type:"Point",coordinates:t}},i,o))});break;case"LineString":c.push(n({geometry:t},i,o));break;case"MultiLineString":s.forEach(t=>{c.push(n({geometry:{type:"LineString",coordinates:t}},i,o))});break;case"Polygon":l.push(n({geometry:t},i,o)),s.forEach(t=>{h.push(n({geometry:{type:"LineString",coordinates:t}},i,o))});break;case"MultiPolygon":s.forEach(t=>{l.push(n({geometry:{type:"Polygon",coordinates:t}},i,o)),t.forEach(t=>{h.push(n({geometry:{type:"LineString",coordinates:t}},i,o))})})}else r.a.warn("".concat(a," coordinates are malformed"))()}const p={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function f(t){return t.geometry.coordinates}n.d(e,"a",(function(){return g}));const d=[0,0,0,255],A={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineCapRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusUnits:"meters",pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:{type:"accessor",value:d},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class g extends i.a{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&r.a.removed("getLineDashArray","PathStyleExtension")()}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const n=function(t,e,n){const i={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:r,lines:o,polygons:a}=t,s=Object(c.c)(t,e,n);return i.points.data={length:r.positions.value.length/r.positions.size,attributes:{getPosition:r.positions,pickingColors:{size:3,value:s.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{getPath:o.positions,pickingColors:{size:3,value:s.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.lines._pathType="open",i.polygons.data={length:a.primitivePolygonIndices.value.length,startIndices:a.primitivePolygonIndices.value,attributes:{getPolygon:a.positions,pickingColors:{size:3,value:s.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},i.polygons._normalize=!1,i.polygonsOutline.data={length:a.primitivePolygonIndices.value.length,startIndices:a.primitivePolygonIndices.value,attributes:{getPath:a.positions,instancePickingColors:{size:3,value:s.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},i.polygonsOutline._pathType="open",i}(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:e}){const n=function(t){if(Array.isArray(t))return t;switch(r.a.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return r.a.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(t.data),i=this.getSubLayerRow.bind(this);let o={};const a={};if(Array.isArray(e.dataChanged)){const t=this.state.features;for(const e in t)o[e]=t[e].slice(),a[e]=[];for(const r of e.dataChanged){const e=l(n,i,r);for(const n in t)a[n].push(Object(u.a)({data:o[n],getIndex:t=>t.__source.index,dataRange:r,replace:e[n]}))}}else o=l(n,i);const s=function(t,e){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:a}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=f,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=f,n.polygons.data=o,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=f,n.polygonsOutline.data=a,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=f,n}(o,a);this.setState({features:o,featuresDiff:a,layerProps:s})}_updateAutoHighlight(t){const e=t.sourceLayer.id.endsWith("points");for(const n of this.getSubLayers())n.id.endsWith("points")===e&&n.updateAutoHighlight(t)}renderLayers(){const{stroked:t,filled:e,extruded:n,wireframe:i,material:r,transitions:u}=this.props,{lineWidthUnits:c,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:p,lineJointRounded:f,lineCapRounded:A,lineMiterLimit:g,pointRadiusUnits:m,pointRadiusScale:y,pointRadiusMinPixels:v,pointRadiusMaxPixels:_,elevationScale:b,lineDashJustified:x}=this.props,{getLineColor:w,getFillColor:E,getRadius:T,getLineWidth:S,getLineDashArray:P,getElevation:M,updateTriggers:C}=this.props,I=this.getSubLayerClass("polygons-fill",s.a),O=this.getSubLayerClass("polygons-stroke",a.a),L=this.getSubLayerClass("line-strings",a.a),R=this.getSubLayerClass("points",o.a),{layerProps:k}=this.state,D=this.shouldRenderSubLayer("polygons-fill",k.polygons.data)&&new I({extruded:n,elevationScale:b,filled:e,wireframe:i,material:r,getElevation:this.getSubLayerAccessor(M),getFillColor:this.getSubLayerAccessor(E),getLineColor:this.getSubLayerAccessor(n&&i?w:d),transitions:u&&{getPolygon:u.geometry,getElevation:u.getElevation,getFillColor:u.getFillColor,getLineColor:u.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:C.getElevation,getFillColor:C.getFillColor,lineColors:n&&i,getLineColor:C.getLineColor}}),k.polygons);return[!n&&D,!n&&t&&this.shouldRenderSubLayer("polygons-stroke",k.polygonsOutline.data)&&new O({widthUnits:c,widthScale:l,widthMinPixels:h,widthMaxPixels:p,jointRounded:f,miterLimit:g,dashJustified:x,getColor:this.getSubLayerAccessor(w),getWidth:this.getSubLayerAccessor(S),getDashArray:this.getSubLayerAccessor(P),transitions:u&&{getPath:u.geometry,getColor:u.getLineColor,getWidth:u.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:C.getLineColor,getWidth:C.getLineWidth,getDashArray:C.getLineDashArray}}),k.polygonsOutline),this.shouldRenderSubLayer("linestrings",k.lines.data)&&new L({widthUnits:c,widthScale:l,widthMinPixels:h,widthMaxPixels:p,jointRounded:f,capRounded:A,miterLimit:g,dashJustified:x,getColor:this.getSubLayerAccessor(w),getWidth:this.getSubLayerAccessor(S),getDashArray:this.getSubLayerAccessor(P),transitions:u&&{getPath:u.geometry,getColor:u.getLineColor,getWidth:u.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:C.getLineColor,getWidth:C.getLineWidth,getDashArray:C.getLineDashArray}}),k.lines),this.shouldRenderSubLayer("points",k.points.data)&&new R({stroked:t,filled:e,radiusUnits:m,radiusScale:y,radiusMinPixels:v,radiusMaxPixels:_,lineWidthUnits:c,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:p,getFillColor:this.getSubLayerAccessor(E),getLineColor:this.getSubLayerAccessor(w),getRadius:this.getSubLayerAccessor(T),getLineWidth:this.getSubLayerAccessor(S),transitions:u&&{getPosition:u.geometry,getFillColor:u.getFillColor,getLineColor:u.getLineColor,getRadius:u.getRadius,getLineWidth:u.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:C.getFillColor,getLineColor:C.getLineColor,getRadius:C.getRadius,getLineWidth:C.getLineWidth}}),{...k.points,highlightedObjectIndex:this._getHighlightedIndex(k.points.data)}),n&&D]}_getHighlightedIndex(t){const{highlightedObjectIndex:e}=this.props,{binary:n}=this.state;return n?e:Number.isFinite(e)?t.findIndex(t=>t.__source.index===e):null}getSubLayerAccessor(t){const{binary:e}=this.state;return e&&"function"==typeof t?(e,n)=>{const{data:i,index:r}=n,o=Object(c.b)(i,r);return t(o,n)}:super.getSubLayerAccessor(t)}}g.layerName="GeoJsonLayer",g.defaultProps=A},function(t,e,n){"use strict";var i=n(6),r=n(108),o=n(207),a=n(285),s=n(224),u=n(58),c=n(0),l=n(116),h=n(170),p=n(261),f=n(191),d=n(119);function A(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),i.a.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function g(t,e){if(t.attributes)return A(t.attributes,e),t instanceof u.a?t:new u.a(t);if(t.positions||t.POSITION)return A(t,e),new u.a({attributes:t});throw Error("Invalid mesh")}n.d(e,"a",(function(){return y}));const m={mesh:{value:null,type:"object",async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}};class y extends r.a{getShaders(){const t=!Object(c.j)(this.context.gl),e={};return Object(p.b)(this.context.gl,f.a.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n  geometry.normal = normals_commonspace;\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n  }\n\n  geometry.position = position_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.a,a.b,s.a],transpileToGLSL100:t,defines:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:d.a}),this.setState({emptyTexture:new l.a(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),t.mesh!==e.mesh||n.extensionsChanged){var i;if(null===(i=this.state.model)||void 0===i||i.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const e=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==e.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(){super.finalizeState(),this.state.emptyTexture.delete()}draw({uniforms:t}){if(!this.state.model)return;const{viewport:e}=this.context,{sizeScale:n,coordinateSystem:i,_instanced:r}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!r||Object(d.b)(e,i),flatShading:!this.state.hasNormals}).draw()}getModel(t){const e=new h.a(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:g(t,this.props._useMeshColors),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:n||i,hasTexture:Boolean(n)}),e}setTexture(t){const{emptyTexture:e,model:n}=this.state;null==n||n.setUniforms({sampler:t||e,hasTexture:Boolean(t)})}}y.layerName="SimpleMeshLayer",y.defaultProps=m},function(t,e,n){"use strict";const i={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};const r={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(t=i){const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,t=>t/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}};e.a={inject:{"vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  // for picking depth values\n  picking_setPickingAttribute(geometry.position.z);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...r}},function(t,e,n){"use strict";var i=n(34),r=n(28),o=n(38),a=n(39),s=n(21),u=n(115),c=n(11),l=n(44),h=n(1),p=n(52),f=n(12),d=n(19);function A(){var t=new h.a(4);return h.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function g(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function m(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=i*l+a*s+r*c-o*u,t[1]=r*l+a*u+o*s-i*c,t[2]=o*l+a*c+i*u-r*s,t[3]=a*l-i*s-r*u-o*c,t}function y(t,e,n,i){var r,o,a,s,u,c=e[0],l=e[1],p=e[2],f=e[3],d=n[0],A=n[1],g=n[2],m=n[3];return(o=c*d+l*A+p*g+f*m)<0&&(o=-o,d=-d,A=-A,g=-g,m=-m),1-o>h.b?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-i)*r)/a,u=Math.sin(i*r)/a):(s=1-i,u=i),t[0]=s*c+u*d,t[1]=s*l+u*A,t[2]=s*p+u*g,t[3]=s*f+u*m,t}function v(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*a+a]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+r]+e[3*r+o])*n,t[a]=(e[3*a+r]+e[3*r+a])*n}return t}d.b,d.g,d.c,d.l;var _,b,x,w,E,T,S=d.a,P=d.k,M=d.d,C=d.i,I=d.h,O=d.m,L=d.j,R=(d.f,d.e,_=f.b(),b=f.e(1,0,0),x=f.e(0,1,0),function(t,e,n){var i=f.d(e,n);return i<-.999999?(f.c(_,b,e),f.f(_)<1e-6&&f.c(_,x,e),f.j(_,_),g(t,_,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(f.c(_,e,n),t[0]=_[0],t[1]=_[1],t[2]=_[2],t[3]=1+i,L(t,t))});w=A(),E=A(),T=p.a();function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(s.a)(t);if(e){var r=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}n.d(e,"a",(function(){return B}));var D=[0,0,0,1],B=function(t){Object(o.a)(n,t);var e=k(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(i.a)(this,n),t=e.call(this,-0,-0,-0,-0),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,o,a,s),t}return Object(r.a)(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,n,i){return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this.check()}},{key:"fromMatrix3",value:function(t){return v(this,t),this.check()}},{key:"identity",value:function(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.check()}},{key:"fromAxisRotation",value:function(t,e){return g(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return I(this)}},{key:"lengthSquared",value:function(){return O(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return M(this,t)}},{key:"rotationTo",value:function(t,e){return R(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return S(this,this,t),this.check()}},{key:"calculateW",value:function(){var t,e,n,i,r;return t=this,n=(e=this)[0],i=e[1],r=e[2],t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),this.check()}},{key:"conjugate",value:function(){var t,e;return e=this,(t=this)[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],this.check()}},{key:"invert",value:function(){var t,e,n,i,r,o,a,s;return t=this,n=(e=this)[0],i=e[1],r=e[2],o=e[3],s=(a=n*n+i*i+r*r+o*o)?1/a:0,t[0]=-n*s,t[1]=-i*s,t[2]=-r*s,t[3]=o*s,this.check()}},{key:"lerp",value:function(t,e,n){return C(this,t,e,n),this.check()}},{key:"multiplyRight",value:function(t,e){return Object(l.a)(!e),m(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return Object(l.a)(!e),m(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=i*u+a*s,t[1]=r*u+o*s,t[2]=o*u-r*s,t[3]=a*u-i*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=i*u-o*s,t[1]=r*u+a*s,t[2]=o*u+i*s,t[3]=a*u-r*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=i*u+r*s,t[1]=r*u-i*s,t[2]=o*u+a*s,t[3]=a*u-o*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return P(this,this,t),this.check()}},{key:"slerp",value:function(t,e,n){switch(arguments.length){case 1:var i=arguments[0],r=i.start;t=void 0===r?D:r,e=i.target,n=i.ratio;break;case 2:var o=Array.prototype.slice.call(arguments);e=o[0],n=o[1],t=this}return y(this,t,e,n),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return d.o(e,t,this),Object(c.b)(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Object(c.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Object(c.a)(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Object(c.a)(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=Object(c.a)(t)}}]),n}(u.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n(15);const r={};function o(t,e){var n;r[t]=!0,void 0!==e&&(n=e,i.global.console&&i.global.console.error&&i.global.console.error(n))}const a=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let e=0;e<this.attribs.length;e++){const i=new t.VertexAttrib(n);this.attribs[e]=i}this.maxAttrib=0};(a.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const s=function(t){const e=this;this.gl=t,function(t){const e=t.getError;t.getError=function(){let n;do{n=e.apply(t),0!==n&&(r[n]=!0)}while(0!==n);for(n in r)if(r[n])return delete r[n],parseInt(n,10);return 0}}(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);const r=i.attribs[t];return r.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){const i=e.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,t);const r=i.attribs[t];return r.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,i){switch(t){case 34962:e.currentArrayBuffer=i;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,i){const r=e.currentVertexArrayObject,o=r.attribs[t];switch(i){case 34975:return o.buffer;case 34338:return o.enabled;case 34339:return o.size;case 34340:return o.stride;case 34341:return o.type;case 34922:return o.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,i,r,o,a,s){const u=e.currentVertexArrayObject;u.maxAttrib=Math.max(u.maxAttrib,t);const c=u.attribs[t];return c.buffer=e.currentArrayBuffer,c.size=i,c.type=r,c.normalized=o,c.stride=a,c.offset=s,c.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",()=>{var t;t="OESVertexArrayObject emulation library context restored",i.global.console&&i.global.console.log&&i.global.console.log(t),e.reset_()},!0),this.reset_()};function u(t){if("function"==typeof t.createVertexArray)return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};const n=t.getExtension;t.getExtension=function(e){const i=n.call(this,e);return i||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new s(this)),this.__OESVertexArrayObject))}}s.prototype.VERTEX_ARRAY_BINDING_OES=34229,s.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new a(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},s.prototype.createVertexArrayOES=function(){const t=new a(this);return this.vertexArrayObjects.push(t),t},s.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},s.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof a&&t.hasBeenBound&&t.ext===this)},s.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive)return void o(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const r=this.currentVertexArrayObject;if(i===r)return;i&&r.elementArrayBuffer===i.elementArrayBuffer||n.bindBuffer.call(e,34963,r.elementArrayBuffer);let a=this.currentArrayBuffer;const s=Math.max(i?i.maxAttrib:0,r.maxAttrib);for(let t=0;t<=s;t++){const o=r.attribs[t],s=i?i.attribs[t]:null;if(i&&o.enabled===s.enabled||(o.enabled?n.enableVertexAttribArray.call(e,t):n.disableVertexAttribArray.call(e,t)),o.enabled){let r=!1;i&&o.buffer===s.buffer||(a!==o.buffer&&(n.bindBuffer.call(e,34962,o.buffer),a=o.buffer),r=!0),(r||o.cached!==s.cached)&&n.vertexAttribPointer.call(e,t,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!==a&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return c}));var i=n(116),r=n(228),o=n(229),a=n(68),s=n(13);function u(t,e){Object(s.a)(t instanceof i.a||t instanceof r.a||t instanceof o.a);const n=t.constructor,{gl:a,width:u,height:c,format:l,type:h,dataFormat:p,border:f,mipmaps:d}=t;return new n(a,Object.assign({width:u,height:c,format:l,type:h,dataFormat:p,border:f,mipmaps:d},e))}function c(t,e){const{gl:n,width:i,height:r,id:o}=t;return new a.a(n,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:i,height:r,attachments:{36064:t}}))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(0),r=n(50);const o=[34069,34070,34071,34072,34073,34074];class a extends r.a{constructor(t,e={}){Object(i.b)(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(t={}){const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)}),this}subImage({face:t,data:e,x:n=0,y:i=0,mipmapLevel:r=0}){return this._subImage({target:t,data:e,x:n,y:i,mipmapLevel:r})}async setCubeMapImageData({width:t,height:e,pixels:n,data:r,border:a=0,format:s=6408,type:u=5121}){const{gl:c}=this,l=n||r,h=await Promise.all(o.map(t=>{const e=l[t];return Promise.all(Array.isArray(e)?e:[e])}));this.bind(),o.forEach((n,r)=>{h[r].length>1&&!1!==this.opts.mipmaps&&i.k.warn("".concat(this.id," has mipmap and multiple LODs."))(),h[r].forEach((i,r)=>{t&&e?c.texImage2D(n,r,s,t,e,a,s,u,i):c.texImage2D(n,r,s,s,u,i)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:i,pixels:r,data:o,border:a=0,format:s=6408,type:u=5121}=t,{gl:c}=this,l=r||o;return this.bind(),l instanceof Promise?l.then(n=>this.setImageDataForFace(Object.assign({},t,{face:e,data:n,pixels:n}))):this.width||this.height?c.texImage2D(e,0,s,n,i,a,s,u,l):c.texImage2D(e,0,s,s,u,l),this}}a.FACES=o},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(0),r=n(50),o=n(77),a=n(27);class s extends r.a{static isSupported(t){return Object(i.j)(t)}constructor(t,e={}){Object(i.a)(t),super(t,e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1})),this.initialize(e),Object.seal(this)}setImageData({level:t=0,dataFormat:e=6408,width:n,height:r,depth:s=1,border:u=0,format:c,type:l=5121,offset:h=0,data:p,parameters:f={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(i.o)(this.gl,f,()=>{ArrayBuffer.isView(p)&&this.gl.texImage3D(this.target,t,e,n,r,s,u,c,l,p),p instanceof a.a&&(this.gl.bindBuffer(35052,p.handle),this.gl.texImage3D(this.target,t,e,n,r,s,u,c,l,h))}),p&&p.byteLength)this._trackAllocatedMemory(p.byteLength,"Texture");else{const t=o.a[this.dataFormat]||4,e=o.c[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return p}));var i=n(17),r=n(18),o=n(51),a=n(20),s=n.n(a),u=n(98);var c={container:s.a.object,gl:s.a.object,mapboxApiAccessToken:s.a.string,mapboxApiUrl:s.a.string,attributionControl:s.a.bool,preserveDrawingBuffer:s.a.bool,reuseMaps:s.a.bool,transformRequest:s.a.func,mapOptions:s.a.object,mapStyle:s.a.oneOfType([s.a.string,s.a.object]),visible:s.a.bool,asyncRender:s.a.bool,onLoad:s.a.func,onError:s.a.func,width:s.a.number,height:s.a.number,viewState:s.a.object,longitude:s.a.number,latitude:s.a.number,zoom:s.a.number,bearing:s.a.number,pitch:s.a.number,altitude:s.a.number},l={container:u.a.body,mapboxApiAccessToken:function(){var e=null;if("undefined"!=typeof window&&window.location){var n=window.location.search.match(/access_token=([^&\/]*)/);e=n&&n[1]}e||void 0===t||(e=e||t.env.MapboxAccessToken||t.env.REACT_APP_MAPBOX_ACCESS_TOKEN);return e||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:function(){},onError:function(t){t&&console.error(t.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component";t.debug&&s.a.checkPropTypes(c,t,"prop",e)}var p=function(){function t(e){var n=this;if(Object(i.a)(this,t),Object(o.a)(this,"mapboxgl",void 0),Object(o.a)(this,"props",l),Object(o.a)(this,"_map",null),Object(o.a)(this,"width",0),Object(o.a)(this,"height",0),Object(o.a)(this,"_fireLoadEvent",(function(){n.props.onLoad({type:"load",target:n._map})})),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Object(r.a)(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(t){var e=this;h(t=Object.assign({},l,t),"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||l.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t.container;Object.defineProperty(n,"offsetWidth",{get:function(){return e.width}}),Object.defineProperty(n,"clientWidth",{get:function(){return e.width}}),Object.defineProperty(n,"offsetHeight",{get:function(){return e.height}}),Object.defineProperty(n,"clientHeight",{get:function(){return e.height}});var i=this._map.getCanvas();i&&(i.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,e){if(this._map){h(e=Object.assign({},this.props,e),"Mapbox");var n=this._updateMapViewport(t,e),i=this._updateMapSize(t,e);e.asyncRender||!n&&!i||this.redraw(),this.props=e}}},{key:"_updateMapSize",value:function(t,e){var n=t.width!==e.width||t.height!==e.height;return n&&(this.width=e.width,this.height=e.height,this.resize()),n}},{key:"_updateMapViewport",value:function(t,e){var n=this._getViewState(t),i=this._getViewState(e),r=i.latitude!==n.latitude||i.longitude!==n.longitude||i.zoom!==n.zoom||i.pitch!==n.pitch||i.bearing!==n.bearing||i.altitude!==n.altitude;return r&&(this._map.jumpTo(this._viewStateToMapboxProps(i)),i.altitude!==n.altitude&&(this._map.transform.altitude=i.altitude)),r}},{key:"_getViewState",value:function(t){var e=t.viewState||t,n=e.longitude,i=e.latitude,r=e.zoom,o=e.pitch,a=void 0===o?0:o,s=e.bearing,u=void 0===s?0:s,c=e.altitude;return{longitude:n,latitude:i,zoom:r,pitch:a,bearing:u,altitude:void 0===c?1.5:c}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==u.a)try{var e=u.a.createElement("div");e.className="mapboxgl-map",e.style.display="none",u.a.body.append(e);var n="static"!==window.getComputedStyle(e).position;if(!n){var i=u.a.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),u.a.head.append(i)}}catch(t){}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),t}();Object(o.a)(p,"initialized",!1),Object(o.a)(p,"propTypes",c),Object(o.a)(p,"defaultProps",l),Object(o.a)(p,"savedMap",null)}).call(this,n(48))},function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,s,u,c,l,f,d,g=e&&e.length,m=g?e[0]*n:t.length,y=r(t,0,m,n,!0),v=[];if(!y||y.next===y.prev)return v;if(g&&(y=function(t,e,n,i){var a,s,u,c,l,f=[];for(a=0,s=e.length;a<s;a++)u=e[a]*i,c=a<s-1?e[a+1]*i:t.length,(l=r(t,u,c,i,!1))===l.next&&(l.steiner=!0),f.push(A(l));for(f.sort(h),a=0;a<f.length;a++)p(f[a],n),n=o(n,n.next);return n}(t,e,y,n)),t.length>80*n){i=u=t[0],s=c=t[1];for(var _=n;_<m;_+=n)(l=t[_])<i&&(i=l),(f=t[_+1])<s&&(s=f),l>u&&(u=l),f>c&&(c=f);d=0!==(d=Math.max(u-i,c-s))?1/d:0}return a(y,v,n,i,s,d),v}function r(t,e,n,i,r){var o,a;if(r===M(t,e,n,i)>0)for(o=e;o<n;o+=i)a=T(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=T(o,t[o],t[o+1],a);return a&&v(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!v(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(S(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function a(t,e,n,i,r,h,p){if(t){!p&&h&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=d(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<c&&(s++,i=i.nextZ);e++);for(u=c;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,h);for(var f,A,g=t;t.prev!==t.next;)if(f=t.prev,A=t.next,h?u(t,i,r,h):s(t))e.push(f.i/n),e.push(t.i/n),e.push(A.i/n),S(t),t=A.next,g=A.next;else if((t=A)===g){p?1===p?a(t=c(o(t),e,n),e,n,i,r,h,2):2===p&&l(t,e,n,i,r,h):a(o(t),e,n,i,r,h,1);break}}}function s(t){var e=t.prev,n=t,i=t.next;if(y(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(g(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function u(t,e,n,i){var r=t.prev,o=t,a=t.next;if(y(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,u=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,l=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=d(s,u,e,n,i),p=d(c,l,e,n,i),f=t.prevZ,A=t.nextZ;f&&f.z>=h&&A&&A.z<=p;){if(f!==t.prev&&f!==t.next&&g(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,A!==t.prev&&A!==t.next&&g(r.x,r.y,o.x,o.y,a.x,a.y,A.x,A.y)&&y(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&g(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;A&&A.z<=p;){if(A!==t.prev&&A!==t.next&&g(r.x,r.y,o.x,o.y,a.x,a.y,A.x,A.y)&&y(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function c(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!v(r,a)&&_(r,i,i.next,a)&&w(r,a)&&w(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),S(i),S(i.next),i=t=a),i=i.next}while(i!==t);return o(i)}function l(t,e,n,i,r,s){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&m(u,c)){var l=E(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,i,r,s),void a(l,e,n,i,r,s)}c=c.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n;var u,c=n,l=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&g(o<h?r:a,o,l,h,o<h?a:r,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(r-i.x),w(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&f(n,i)))&&(n=i,p=u)),i=i.next}while(i!==c);return n}(t,e)){var n=E(e,t);o(n,n.next)}}function f(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function d(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function A(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function g(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&_(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||v(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,n,i){var r=x(y(t,e,n)),o=x(y(t,e,i)),a=x(y(n,i,t)),s=x(y(n,i,e));return r!==o&&a!==s||(!(0!==r||!b(t,n,e))||(!(0!==o||!b(t,i,e))||(!(0!==a||!b(n,t,i))||!(0!==s||!b(n,e,i)))))}function b(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function x(t){return t>0?1:t<0?-1:0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function E(t,e){var n=new P(t.i,t.x,t.y),i=new P(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function T(t,e,n,i){var r=new P(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}t.exports=i,t.exports.default=i,i.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,a=Math.abs(M(t,0,o,n));if(r)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(M(t,c,l,n))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,f=i[s+1]*n,d=i[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[r][o][a]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n}},function(t,e,n){"use strict";t.exports=i,t.exports.default=i;function i(t,e,n,i,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(t,e,n,i,r,a,s){for(var u=0;u<e;u++){for(var c=0;c<n;c++)i[c]=t[c*e+u];for(o(i,r,a,s,n),c=0;c<n;c++)t[c*e+u]=r[c]}for(c=0;c<n;c++){for(u=0;u<e;u++)i[u]=t[c*e+u];for(o(i,r,a,s,e),u=0;u<e;u++)t[c*e+u]=Math.sqrt(r[u])}}function o(t,e,n,i,r){n[0]=0,i[0]=-1e20,i[1]=1e20;for(var o=1,a=0;o<r;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=i[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,i[a]=s,i[a+1]=1e20}for(o=0,a=0;o<r;o++){for(;i[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}i.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var o=e.data[4*i+3]/255;this.gridOuter[i]=1===o?0:0===o?1e20:Math.pow(Math.max(0,.5-o),2),this.gridInner[i]=1===o?1e20:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(r(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),r(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++){var a=this.gridOuter[i]-this.gridInner[i];n[i]=Math.max(0,Math.min(255,Math.round(255-255*(a/this.radius+this.cutoff))))}return n}},function(t,e,n){"use strict";t.exports=r;var i=n(251);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var o="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function a(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function u(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function c(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function h(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function A(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function v(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=y(this.buf,this.pos)+4294967296*y(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=y(this.buf,this.pos)+4294967296*_(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(r=o[n.pos++],i=(112&r)>>4,r<128)return s(t,i,e);if(r=o[n.pos++],i|=(127&r)<<3,r<128)return s(t,i,e);if(r=o[n.pos++],i|=(127&r)<<10,r<128)return s(t,i,e);if(r=o[n.pos++],i|=(127&r)<<17,r<128)return s(t,i,e);if(r=o[n.pos++],i|=(127&r)<<24,r<128)return s(t,i,e);if(r=o[n.pos++],i|=(1&r)<<31,r<128)return s(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&o?function(t,e,n){return o.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var i="",r=e;for(;r<n;){var o,a,s,u=t[r],c=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l>n)break;1===l?u<128&&(c=u):2===l?128==(192&(o=t[r+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=t[r+1],a=t[r+2],s=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=l}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var n=a(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&u(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&u(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,r.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,A,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e,n){"use strict";var i=n(72),r=n(195),o=n(174);function a(t){return s(function t(e,n){return e.map(e=>e instanceof r.a?e:(Object(o.a)("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Object(o.a)(e.name,"shader module has no name"),(e=new r.a(e)).dependencies=t(e.dependencies),e))}(t))}function s(t){const e={},n={};return u({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((t,e)=>n[e]-n[t]).map(t=>e[t])}function u({modules:t,level:e,moduleMap:n,moduleDepth:i}){if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)n[r.name]=r,(void 0===i[r.name]||i[r.name]<e)&&(i[r.name]=e);for(const r of t)r.dependencies&&u({modules:r.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}const c={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},l={};Object.keys(c).forEach(t=>{l[t]=t});const h={};function p(t,e,n={}){const i=c[e];if(Object(o.a)(i,e),!function(t={}){const e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(e in h)return h[e];const r=i[0],a=n.behavior||"enable",s="#extension GL_".concat(r," : ").concat(a,"\nvoid main(void) {}"),u=t.createShader(35633);t.shaderSource(u,s),t.compileShader(u);const l=t.getShaderParameter(u,35713);return t.deleteShader(u),h[e]=l,l}function f(t,e){const n=c[e];Object(o.a)(n,e);const i=function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}(t)&&n[1]||n[0],r="string"==typeof i?Boolean(t.getExtension(i)):i;return Object(o.a)(!1===r||!0===r),r}function d(t,e){return(e=Array.isArray(e)?e:[e]).every(e=>f(t,e))}var A=n(176);const g=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],m=[...g,[/^[ \t]*attribute[ \t]+(.+;)/gm,"in $1"],[/^[ \t]*varying[ \t]+(.+;)/gm,"out $1"]],y=[...g,[/^[ \t]*varying[ \t]+(.+;)/gm,"in $1"]],v=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],_=[...v,[/^[ \t]*in[ \t]+(.+;)/gm,"attribute $1"],[/^[ \t]*out[ \t]+(.+;)/gm,"varying $1"]],b=[...v,[/^[ \t]*in[ \t]+/gm,"varying "]],x=/^[ \t]*out[ \t]+vec4[ \t]+(\w+)[ \t]*;\s+/m;function w(t,e,n){switch(e){case 300:return E(t,n?m:y);case 100:return n?E(t,_):function(t){const e=(t=E(t,b)).match(x);if(e){const n=e[1];t=t.replace(x,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),"gl_FragColor")}return t}(t);default:throw new Error("unknown GLSL version ".concat(e))}}function E(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}const T="\n\n".concat(A.a,"\n\n"),S={[i.b]:"vertex",[i.a]:"fragment"};function P(t,{id:e,source:n,type:r,modules:a,defines:s={},hookFunctions:u=[],inject:c={},transpileToGLSL100:h=!1,prologue:f=!0,log:g}){Object(o.a)("string"==typeof n,"shader source must be a string");const m=r===i.b,y=n.split("\n");let v=100,_="",b=n;0===y[0].indexOf("#version ")?(v=300,_=y[0],b=y.slice(1).join("\n")):_="#version ".concat(v);const x={};a.forEach(t=>{Object.assign(x,t.getDefines())}),Object.assign(x,s);let E=f?"".concat(_,"\n").concat(function({id:t,source:e,type:n}){return t&&"string"==typeof t&&-1===e.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(t,"_").concat(S[n],"\n\n"):""}({id:e,source:n,type:r}),"\n").concat(function({type:t}){return"\n#define SHADER_TYPE_".concat(S[t].toUpperCase(),"\n")}({type:r}),"\n").concat(function(t){switch(function(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||7936),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||7937);return{gpuVendor:function(t,e){if(t.match(/NVIDIA/i)||e.match(/NVIDIA/i))return"NVIDIA";if(t.match(/INTEL/i)||e.match(/INTEL/i))return"INTEL";if(t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i))return"AMD";return"UNKNOWN GPU"}(n,i),vendor:n,renderer:i,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(t),"\n").concat(function(t,e,n){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return d(t,l.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),d(t,l.GLSL_DERIVATIVES)&&p(t,l.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),d(t,l.GLSL_FRAG_DATA)&&p(t,l.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),d(t,l.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(t),"\n").concat(function(t={}){let e=0,n="";for(const i in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}0===e&&(n+="\n");return n}(x),"\n").concat(m?"":"precision highp float;\n\n","\n"):"".concat(_,"\n");const P=function(t){const e={vs:{},fs:{}};return t.forEach(t=>{let n;"string"!=typeof t?(n=t,t=n.hook):n={},t=t.trim();const[i,r]=t.split(":"),o=t.replace(/\(.+/,"");e[i][o]=Object.assign(n,{signature:r})}),e}(u),M={},C={},I={};for(const t in c){const e="string"==typeof c[t]?{injection:c[t],order:0}:c[t],n=t.match(/^(v|f)s:(#)?([\w-]+)$/);if(n){const i=n[2],r=n[3];i?"decl"===r?C[t]=[e]:I[t]=[e]:M[t]=[e]}else I[t]=[e]}for(const t of a){g&&t.checkDeprecations(b,g),E+=t.getModuleSource(r,v);const e=t.injections[r];for(const t in e){const n=t.match(/^(v|f)s:#([\w-]+)$/);if(n){const i="decl"===n[2]?C:I;i[t]=i[t]||[],i[t].push(e[t])}else M[t]=M[t]||[],M[t].push(e[t])}}return E+=T,E=Object(A.c)(E,r,C),E+=function(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature," {\n"),r.header&&(n+="  ".concat(r.header)),e[i]){const t=e[i];t.sort((t,e)=>t.order-e.order);for(const e of t)n+="  ".concat(e.injection,"\n")}r.footer&&(n+="  ".concat(r.footer)),n+="}\n"}return n}(P[r],M),E+=b,E=Object(A.c)(E,r,I),E=w(E,h?100:v,m),E}function M(t){return function(e){const n={};for(const i of t){const t=i.getUniforms(e,n);Object.assign(n,t)}return n}}var C=n(282);n.d(e,"a",(function(){return I}));class I{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new I(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e="string"==typeof t?t:t.name;this._defaultModules=this._defaultModules.filter(t=>t.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(t={}){const{vs:e="",fs:n="",defines:r={},inject:o={},varyings:s=[],bufferMode:u=35981,transpileToGLSL100:c=!1}=t,l=this._getModuleList(t.modules),h=this._getHash(e),p=this._getHash(n),f=l.map(t=>this._getHash(t.name)).sort(),d=s.map(t=>this._getHash(t)),A=Object.keys(r).sort(),g=Object.keys(o).sort(),m=[],y=[];for(const t of A)m.push(this._getHash(t)),m.push(this._getHash(r[t]));for(const t of g)y.push(this._getHash(t)),y.push(this._getHash(o[t]));const v="".concat(h,"/").concat(p,"D").concat(m.join("/"),"M").concat(f.join("/"),"I").concat(y.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(u).concat(c?"T":"");if(!this._programCache[v]){const t=function(t,e){const{vs:n,fs:r}=e,o=a(e.modules||[]);return{gl:t,vs:P(t,Object.assign({},e,{source:n,type:i.b,modules:o})),fs:P(t,Object.assign({},e,{source:r,type:i.a,modules:o})),getUniforms:M(o)}}(this.gl,{vs:e,fs:n,modules:l,inject:o,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:c});this._programCache[v]=new C.a(this.gl,{hash:v,vs:t.vs,fs:t.fs,varyings:s,bufferMode:u}),this._getUniforms[v]=t.getUniforms||(t=>{}),this._useCounts[v]=0}return this._useCounts[v]++,this._programCache[v]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),n={};let i=0;for(let t=0,r=this._defaultModules.length;t<r;++t){const r=this._defaultModules[t],o=r.name;e[i++]=r,n[o]=!0}for(let r=0,o=t.length;r<o;++r){const o=t[r],a=o.name;n[a]||(e[i++]=o,n[a]=!0)}return e.length=i,e}}},,,,,,,function(t,e,n){const i=document.body&&document.body.getAttribute("data-base-url");i&&(window.__webpack_public_path__="".concat(i,"nbextensions/pydeck/nb_extension"));const{jupyterTransport:r}=n(187).default;let o=null,a=null;try{o=n(258).default,a=n(242).default}catch(t){}const{MODULE_VERSION:s,MODULE_NAME:u}=n(117),{createDeck:c,updateDeck:l}=n(83),{initPlayground:h}=n(259);h(),t.exports={jupyterTransport:r,MODULE_VERSION:s,MODULE_NAME:u,JupyterTransportModel:o,JupyterTransportView:a,initPlayground:h,createDeck:c,updateDeck:l}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return o}));var i=n(132),r=n(187);class o extends i.DOMWidgetView{initialize(){this.listenTo(this.model,"destroy",this.remove),this.transport=new r.default,this.transport.jupyterModel=this.model,this.transport.jupyterView=this,this.transport._initialize(),super.initialize.apply(this,arguments)}remove(){this.transport&&(this.transport._finalize(),this.transport.jupyterModel=null,this.transport.jupyterView=null,this.transport=null)}render(){super.render(),this.model.on("change:json_input",this.onJsonChanged.bind(this)),this.model.on("change:data_buffer",this.onDataBufferChanged.bind(this)),this.onDataBufferChanged()}onJsonChanged(){const t=JSON.parse(this.model.get("json_input"));this.transport._messageReceived({type:"json",json:t})}onDataBufferChanged(){const t=this.model.get("json_input"),e=this.model.get("data_buffer");t&&e?this.transport._messageReceived({type:"json-with-binary",json:t,binary:e}):this.transport._messageReceived({type:"json",json:t})}}},function(t,e,n){(function(e){const i=n(256),r=n(4),o=n(248).default,{registerLoaders:a,load:s,parse:u,fetchFile:c}=n(54),l="undefined"==typeof window?e:window;l.deck=l.deck||{},l.luma=l.luma||{},l.loaders=l.loaders||{},Object.assign(l.deck,r,{DeckGL:o}),Object.assign(l.luma,i),Object.assign(l.loaders,{registerLoaders:a,load:s,parse:u,fetchFile:c}),t.exports=l.deck}).call(this,n(61))},function(t,e){},function(t,e,n){"use strict";var i=n(124),r=n(246);Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return o.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return o.window}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return o.global}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return o.document}}),Object.defineProperty(e,"process",{enumerable:!0,get:function(){return o.process}}),Object.defineProperty(e,"console",{enumerable:!0,get:function(){return o.console}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"isBrowserMainThread",{enumerable:!0,get:function(){return a.isBrowserMainThread}}),Object.defineProperty(e,"getBrowser",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return s.isMobile}}),Object.defineProperty(e,"isElectron",{enumerable:!0,get:function(){return u.default}});var o=n(202),a=r(n(203)),s=r(n(247)),u=i(n(182))},function(t,e,n){var i=n(145);function r(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}t.exports=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==i(t)&&"function"!=typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}},function(t,e,n){"use strict";var i=n(124);Object.defineProperty(e,"__esModule",{value:!0}),e.isMobile=function(){return void 0!==r.window.orientation},e.default=function(t){if(!t&&!(0,o.default)())return"Node";if((0,a.default)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},n=t||e.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var i=-1!==n.indexOf("MSIE "),s=-1!==n.indexOf("Trident/");if(i||s)return"IE";if(r.window.chrome)return"Chrome";if(r.window.safari)return"Safari";if(r.window.mozInnerScreenX)return"Firefox";return"Unknown"};var r=n(202),o=i(n(203)),a=i(n(182))},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return a}));var i=n(230),r=n(189);const o={position:"absolute",left:0,top:0,width:"100%",height:"100%"};class a extends r.a{constructor(t={}){if("undefined"==typeof document)throw Error("Deck can only be used in the browser");const{mapCanvas:e,deckCanvas:n}=function(t){let{container:e=document.body}=t;if("string"==typeof e&&(e=document.getElementById(e)),!e)throw Error("Deck: container not found");"static"===window.getComputedStyle(e).position&&(e.style.position="relative");const n=document.createElement("div");e.appendChild(n),Object.assign(n.style,o);const i=document.createElement("canvas");return e.appendChild(i),Object.assign(i.style,o),{container:e,mapCanvas:n,deckCanvas:i}}(t),r=t.viewState||t.initialViewState,a=Number.isFinite(r&&r.latitude),{map:s=window.mapboxgl}=t;super({canvas:n,...t}),s&&s.Map?this._map=a&&new i.a({...t,viewState:r,container:e,mapboxgl:s}):this._map=s,this._onBeforeRender=t=>{if(this.onBeforeRender(t),this._map){const t=this.getViewports()[0];this._map.setProps({width:t.width,height:t.height,viewState:t})}}}getMapboxMap(){return this._map&&this._map.getMap()}finalize(){this._map&&this._map.finalize(),super.finalize()}setProps(t){"onBeforeRender"in t&&this._onBeforeRender&&t.onBeforeRender!==this._onBeforeRender&&(this.onBeforeRender=t.onBeforeRender,t.onBeforeRender=this._onBeforeRender),"mapStyle"in t&&this._map&&this._map._map.setStyle(t.mapStyle),super.setProps(t)}}},function(t,e,n){"use strict";var i=n(250);function r(){}function o(){}o.resetWarningCache=r,t.exports=function(){function t(t,e,n,r,o,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e){e.read=function(t,e,n,i,r){var o,a,s=8*r-i-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+t[e+h],h+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=i;l>0;a=256*a+t[e+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=c}return(f?-1:1)*a*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var a,s,u,c=8*o-r-1,l=(1<<c)-1,h=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*u-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;t[n+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;t[n+f]=255&a,f+=d,a/=256,c-=8);t[n+f-d]|=128*A}},function(t,e,n){!function(n){"use strict";var i=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},r={"-":!0,"!":!0,"~":!0,"+":!0},o={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},a=function(t){var e,n=0;for(var i in t)(e=i.length)>n&&t.hasOwnProperty(i)&&(n=e);return n},s=a(r),u=a(o),c={true:!0,false:!1,null:null},l=function(t){return o[t]||0},h=function(t,e,n){return{type:"||"===t||"&&"===t?"LogicalExpression":"BinaryExpression",operator:t,left:e,right:n}},p=function(t){return t>=48&&t<=57},f=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!o[String.fromCharCode(t)]},d=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!o[String.fromCharCode(t)]},A=function(t){for(var e,n,a=0,A=t.charAt,g=t.charCodeAt,m=function(e){return A.call(t,e)},y=function(e){return g.call(t,e)},v=t.length,_=function(){for(var t=y(a);32===t||9===t||10===t||13===t;)t=y(++a)},b=function(){var t,e,n=w();return _(),63!==y(a)?n:(a++,(t=b())||i("Expected expression",a),_(),58===y(a)?(a++,(e=b())||i("Expected expression",a),{type:"ConditionalExpression",test:n,consequent:t,alternate:e}):void i("Expected :",a))},x=function(){_();for(var e=t.substr(a,u),n=e.length;n>0;){if(o.hasOwnProperty(e)&&(!f(y(a))||a+e.length<t.length&&!d(y(a+e.length))))return a+=n,e;e=e.substr(0,--n)}return!1},w=function(){var t,e,n,r,o,s,u,c;if(s=E(),!(e=x()))return s;for(o={value:e,prec:l(e)},(u=E())||i("Expected expression after "+e,a),r=[s,o,u];(e=x())&&0!==(n=l(e));){for(o={value:e,prec:n};r.length>2&&n<=r[r.length-2].prec;)u=r.pop(),e=r.pop().value,s=r.pop(),t=h(e,s,u),r.push(t);(t=E())||i("Expected expression after "+e,a),r.push(o,t)}for(t=r[c=r.length-1];c>1;)t=h(r[c-1].value,r[c-2],t),c-=2;return t},E=function(){var e,n,i;if(_(),e=y(a),p(e)||46===e)return T();if(39===e||34===e)return S();if(91===e)return O();for(i=(n=t.substr(a,s)).length;i>0;){if(r.hasOwnProperty(n)&&(!f(y(a))||a+n.length<t.length&&!d(y(a+n.length))))return a+=i,{type:"UnaryExpression",operator:n,argument:E(),prefix:!0};n=n.substr(0,--i)}return!(!f(e)&&40!==e)&&C()},T=function(){for(var t,e,n="";p(y(a));)n+=m(a++);if(46===y(a))for(n+=m(a++);p(y(a));)n+=m(a++);if("e"===(t=m(a))||"E"===t){for(n+=m(a++),"+"!==(t=m(a))&&"-"!==t||(n+=m(a++));p(y(a));)n+=m(a++);p(y(a-1))||i("Expected exponent ("+n+m(a)+")",a)}return e=y(a),f(e)?i("Variable names cannot start with a number ("+n+m(a)+")",a):46===e&&i("Unexpected period",a),{type:"Literal",value:parseFloat(n),raw:n}},S=function(){for(var t,e="",n=m(a++),r=!1;a<v;){if((t=m(a++))===n){r=!0;break}if("\\"===t)switch(t=m(a++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return r||i('Unclosed quote after "'+e+'"',a),{type:"Literal",value:e,raw:n+e+n}},P=function(){var e,n=y(a),r=a;for(f(n)?a++:i("Unexpected "+m(a),a);a<v&&(n=y(a),d(n));)a++;return e=t.slice(r,a),c.hasOwnProperty(e)?{type:"Literal",value:c[e],raw:e}:"this"===e?{type:"ThisExpression"}:{type:"Identifier",name:e}},M=function(t){for(var e,n,r=[],o=!1;a<v;){if(_(),(e=y(a))===t){o=!0,a++;break}44===e?a++:((n=b())&&"Compound"!==n.type||i("Expected comma",a),r.push(n))}return o||i("Expected "+String.fromCharCode(t),a),r},C=function(){var t,e;for(e=40===(t=y(a))?I():P(),_(),t=y(a);46===t||91===t||40===t;)a++,46===t?(_(),e={type:"MemberExpression",computed:!1,object:e,property:P()}):91===t?(e={type:"MemberExpression",computed:!0,object:e,property:b()},_(),93!==(t=y(a))&&i("Unclosed [",a),a++):40===t&&(e={type:"CallExpression",arguments:M(41),callee:e}),_(),t=y(a);return e},I=function(){a++;var t=b();if(_(),41===y(a))return a++,t;i("Unclosed (",a)},O=function(){return a++,{type:"ArrayExpression",elements:M(93)}},L=[];a<v;)59===(e=y(a))||44===e?a++:(n=b())?L.push(n):a<v&&i('Unexpected "'+m(a)+'"',a);return 1===L.length?L[0]:{type:"Compound",body:L}};A.version="0.3.4",A.toString=function(){return"JavaScript Expression Parser (JSEP) v"+A.version},A.addUnaryOp=function(t){return s=Math.max(t.length,s),r[t]=!0,this},A.addBinaryOp=function(t,e){return u=Math.max(t.length,u),o[t]=e,this},A.addLiteral=function(t,e){return c[t]=e,this},A.removeUnaryOp=function(t){return delete r[t],t.length===s&&(s=a(r)),this},A.removeAllUnaryOps=function(){return r={},s=0,this},A.removeBinaryOp=function(t){return delete o[t],t.length===u&&(u=a(o)),this},A.removeAllBinaryOps=function(){return o={},u=0,this},A.removeLiteral=function(t){return delete c[t],this},A.removeAllLiterals=function(){return c={},this},t.exports?e=t.exports=A:e.parse=A}()},function(t,e,n){t.exports=function(){"use strict";var t,e,n;function i(i,r){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),(n=r(a)).workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else e=r;else t=r}return i(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=i;function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=o;function o(t,e){this.x=t,this.y=e}function a(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!a(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!a(t[i],e[i]))return!1;return!0}return t===e}function s(t,e,i,r){var o=new n(t,e,i,r);return function(t){return o.solve(t)}}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var u=s(.25,.1,.25,1);function c(t,e,n){return Math.min(n,Math.max(e,t))}function l(t,e,n){var i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function h(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var o=r[i];for(var a in o)t[a]=o[a]}return t}var p=1;function f(){return p++}function d(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function A(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function g(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function m(t,e){return-1!==t.indexOf(e,t.length-e.length)}function y(t,e,n){var i={};for(var r in t)i[r]=e.call(n||this,t[r],r,t);return i}function v(t,e,n){var i={};for(var r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function _(t){return Array.isArray(t)?t.map(_):"object"==typeof t&&t?y(t,_):t}var b={};function x(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function w(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function E(t){for(var e=0,n=0,i=t.length,r=i-1,o=void 0,a=void 0;n<i;r=n++)o=t[n],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e}function T(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function S(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,i,r){var o=i||r;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var P=null;function M(t){if(null==P){var e=t.navigator?t.navigator.userAgent:null;P=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return P}function C(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var I,O,L,R,k=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),D=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,B=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,F={now:k,frame:function(t){var e=D(t);return{cancel:function(){return B(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=self.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return I||(I=self.document.createElement("a")),I.href=t,I.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},get prefersReducedMotion(){return!!self.matchMedia&&(null==O&&(O=self.matchMedia("(prefers-reduced-motion: reduce)")),O.matches)}},z={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},N={supported:!1,testSupport:function(t){!j&&R&&(U?V(t):L=t)}},j=!1,U=!1;function V(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,R),t.isContextLost())return;N.supported=!0}catch(t){}t.deleteTexture(e),j=!0}self.document&&((R=self.document.createElement("img")).onload=function(){L&&V(L),L=null,U=!0},R.onerror=function(){j=!0,L=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var G="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function H(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",G,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!H(t))return t;var n=Q(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!H(t))return t;var n=Q(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!H(t))return t;var n=Q(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,n,i){var r=Q(t);return H(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+n,this._makeAPIURL(r,this._customAccessToken||i)):(r.path+=""+e+n,Y(r))},W.prototype.normalizeTileURL=function(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),!e||!H(e))return t;var i=Q(t),r=F.devicePixelRatio>=2||512===n?"@2x":"",o=N.supported?".webp":"$1";return i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,""+r+o),i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/v4"+i.path,z.REQUIRE_ACCESS_TOKEN&&(z.ACCESS_TOKEN||this._customAccessToken)&&this._skuToken&&i.params.push("sku="+this._skuToken),this._makeAPIURL(i,this._customAccessToken)},W.prototype.canonicalizeTileURL=function(t){var e=Q(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=e.path.replace("/v4/","");var i=e.params.filter((function(t){return!t.match(/^access_token=/)}));return i.length&&(n+="?"+i.join("&")),n},W.prototype.canonicalizeTileset=function(t,e){if(!H(e))return t.tiles||[];for(var n=[],i=0,r=t.tiles;i<r.length;i+=1){var o=r[i],a=this.canonicalizeTileURL(o);n.push(a)}return n},W.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=Q(z.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"/"!==i.path&&(t.path=""+i.path+t.path),!z.REQUIRE_ACCESS_TOKEN)return Y(t);if(!(e=e||z.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),Y(t)};var q=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function X(t){return q.test(t)}var Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(t){var e=t.match(Z);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Y(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function K(t){if(!t)return null;var e,n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse((e=n[1],decodeURIComponent(self.atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(t){return null}}var J=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};J.prototype.getStorageKey=function(t){var e,n=K(z.ACCESS_TOKEN),i="";return n&&n.u?(e=n.u,i=self.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))})))):i=z.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+i:"mapbox.eventData:"+i},J.prototype.fetchEventData=function(){var t=C("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var i=self.localStorage.getItem(e);i&&(this.eventData=JSON.parse(i));var r=self.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){x("Unable to read from LocalStorage")}},J.prototype.saveEventData=function(){var t=C("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){x("Unable to write to LocalStorage")}},J.prototype.processRequests=function(t){},J.prototype.postEvent=function(t,e,n,i){var r=this;if(z.EVENTS_URL){var o=Q(z.EVENTS_URL);o.params.push("access_token="+(i||z.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.6.1",skuId:G,userId:this.anonId},s=e?h(a,e):a,u={url:Y(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=_t(u,(function(t){r.pendingRequest=null,n(t),r.saveEventData(),r.processRequests(i)}))}},J.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var $,tt,et=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,i){this.skuToken=n,(z.EVENTS_URL&&i||z.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||X(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},i)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),i=n.id,r=n.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),A(this.anonId)||(this.anonId=d()),this.postEvent(r,{skuToken:this.skuToken},(function(t){t||i&&(e.success[i]=!0)}),t))}},e}(J),nt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postTurnstileEvent=function(t,e){z.EVENTS_URL&&z.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||X(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=K(z.ACCESS_TOKEN),i=n?n.u:z.ACCESS_TOKEN,r=i!==this.eventData.tokenU;A(this.anonId)||(this.anonId=d(),r=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;r=r||u>=1||u<-1||a.getDate()!==s.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=i)}),t)}},e}(J)),it=nt.postTurnstileEvent.bind(nt),rt=new et,ot=rt.postMapLoadEvent.bind(rt),at="mapbox-tiles",st=500,ut=50;function ct(){self.caches&&!$&&($=self.caches.open(at))}function lt(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht=1/0,pt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(pt);var ft=function(t){function e(e,n,i){401===n&&X(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=i,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),dt=T()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===self.location.protocol?self.parent:self).location.href};function At(t,e){var n,i=new self.AbortController,r=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:dt(),signal:i.signal}),o=!1,a=!1,s=(n=r.url).indexOf("sku=")>0&&X(n);"json"===t.type&&r.headers.set("Accept","application/json");var u=function(n,i,o){if(!a){if(n&&"SecurityError"!==n.message&&x(n),i&&o)return c(i);var u=Date.now();self.fetch(r).then((function(n){if(n.ok){var i=s?n.clone():null;return c(n,i,u)}return e(new ft(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,i,s){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){a||(i&&s&&function(t,e,n){if(ct(),$){var i={status:e.status,statusText:e.statusText,headers:new self.Headers};e.headers.forEach((function(t,e){return i.headers.set(e,t)}));var r=S(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===tt)try{new Response(new ReadableStream),tt=!0}catch(t){tt=!1}tt?e(t.body):t.blob().then(e)}(e,(function(e){var n=new self.Response(e,i);ct(),$&&$.then((function(e){return e.put(lt(t.url),n)})).catch((function(t){return x(t.message)}))})))}}(r,i,s),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){a||e(new Error(t.message))}))};return s?function(t,e){if(ct(),!$)return e(null);var n=lt(t.url);$.then((function(t){t.match(n).then((function(i){var r=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=S(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(i);t.delete(n),r&&t.put(n,i.clone()),e(null,i,r)})).catch(e)})).catch(e)}(r,u):u(null,null),{cancel:function(){a=!0,o||i.abort()}}}var gt,mt,yt=function(t,e){if(n=t.url,!(/^file:/.test(n)||/^file:/.test(dt())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return At(t,e);if(T()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new self.XMLHttpRequest;for(var i in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new ft(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},vt=function(t,e){return yt(h(t,{type:"arrayBuffer"}),e)},_t=function(t,e){return yt(h(t,{method:"POST"}),e)};gt=[],mt=0;var bt=function(t,e){if(N.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mt>=z.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return gt.push(n),n}mt++;var i=!1,r=function(){if(!i)for(i=!0,mt--;gt.length&&mt<z.MAX_PARALLEL_IMAGE_REQUESTS;){var t=gt.shift(),e=t.requestParameters,n=t.callback;t.cancelled||(t.cancel=bt(e,n).cancel)}},o=vt(t,(function(t,n,i,o){if(r(),t)e(t);else if(n){var a=new self.Image;a.onload=function(){e(null,a),self.URL.revokeObjectURL(a.src)},a.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new self.Blob([new Uint8Array(n)],{type:"image/png"});a.cacheControl=i,a.expires=o,a.src=n.byteLength?self.URL.createObjectURL(s):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}));return{cancel:function(){o.cancel(),r()}}};function xt(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function wt(t,e,n){if(n&&n[t]){var i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}var Et=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},Tt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",h({error:e},n))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Et),St=function(){};St.prototype.on=function(t,e){return this._listeners=this._listeners||{},xt(t,e,this._listeners),this},St.prototype.off=function(t,e){return wt(t,e,this._listeners),wt(t,e,this._oneTimeListeners),this},St.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},xt(t,e,this._oneTimeListeners),this},St.prototype.fire=function(t,e){"string"==typeof t&&(t=new Et(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var i=0,r=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];i<r.length;i+=1)r[i].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];wt(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Tt&&console.error(t.error);return this},St.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},St.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Mt=function(t,e,n,i){this.message=(t?t+": ":"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function Ct(t){var e=t.key,n=t.value;return n?[new Mt(e,n,"constants have been deprecated as of v8")]:[]}function It(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var o=r[i];for(var a in o)t[a]=o[a]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Lt(t[n]);return e}return Ot(t)}var Rt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),kt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,i=e;n<i.length;n+=1){var r=i[n],o=r[0],a=r[1];this.bindings[o]=a}};kt.prototype.concat=function(t){return new kt(this,t)},kt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},kt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Dt={kind:"null"},Bt={kind:"number"},Ft={kind:"string"},zt={kind:"boolean"},Nt={kind:"color"},jt={kind:"object"},Ut={kind:"value"},Vt={kind:"collator"},Gt={kind:"formatted"},Wt={kind:"resolvedImage"};function Ht(t,e){return{kind:"array",itemType:t,N:e}}function qt(t){if("array"===t.kind){var e=qt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Xt=[Dt,Bt,Ft,zt,Nt,Gt,jt,Ht(Ut),Wt];function Zt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Zt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,i=Xt;n<i.length;n+=1)if(!Zt(i[n],e))return null}return"Expected "+qt(t)+" but found "+qt(e)+" instead."}var Qt=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function a(t){return"%"===t[t.length-1]?r(parseFloat(t)/100):r(parseFloat(t))}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in n)return n[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=r.indexOf("("),c=r.indexOf(")");if(-1!==u&&c+1===r.length){var l=r.substr(0,u),h=r.substr(u+1,c-(u+1)).split(","),p=1;switch(l){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),A=a(h[2]),g=A<=.5?A*(d+1):A+d-A*d,m=2*A-g;return[i(255*s(m,g,f+1/3)),i(255*s(m,g,f)),i(255*s(m,g,f-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,Yt=function(t,e,n,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=n,this.a=i};Yt.parse=function(t){if(t){if(t instanceof Yt)return t;if("string"==typeof t){var e=Qt(t);if(e)return new Yt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Yt.prototype.toString=function(){var t=this.toArray(),e=t[0],n=t[1],i=t[2],r=t[3];return"rgba("+Math.round(e)+","+Math.round(n)+","+Math.round(i)+","+r+")"},Yt.prototype.toArray=function(){var t=this.r,e=this.g,n=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]},Yt.black=new Yt(0,0,0,1),Yt.white=new Yt(1,1,1,1),Yt.transparent=new Yt(0,0,0,0),Yt.red=new Yt(1,0,0,1);var Kt=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Kt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Kt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Jt=function(t,e,n,i,r){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r},$t=function(t){this.sections=t};$t.fromString=function(t){return new $t([new Jt(t,null,null,null,null)])},$t.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},$t.factory=function(t){return t instanceof $t?t:$t.fromString(t)},$t.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},$t.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];if(i.image)t.push(["image",i.image.name]);else{t.push(i.text);var r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(r)}}return t};var te=function(t){this.name=t.name,this.available=t.available};function ee(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,n,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ne(t){if(null===t)return Dt;if("string"==typeof t)return Ft;if("boolean"==typeof t)return zt;if("number"==typeof t)return Bt;if(t instanceof Yt)return Nt;if(t instanceof Kt)return Vt;if(t instanceof $t)return Gt;if(t instanceof te)return Wt;if(Array.isArray(t)){for(var e,n=t.length,i=0,r=t;i<r.length;i+=1){var o=ne(r[i]);if(e){if(e===o)continue;e=Ut;break}e=o}return Ht(e||Ut,n)}return jt}function ie(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Yt||t instanceof $t||t instanceof te?t.toString():JSON.stringify(t)}te.prototype.toString=function(){return this.name},te.fromString=function(t){return new te({name:t,available:!1})},te.prototype.serialize=function(){return["image",this.name]};var re=function(t,e){this.type=t,this.value=e};re.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Yt)return!0;if(e instanceof Kt)return!0;if(e instanceof $t)return!0;if(e instanceof te)return!0;if(Array.isArray(e)){for(var n=0,i=e;n<i.length;n+=1)if(!t(i[n]))return!1;return!0}if("object"==typeof e){for(var r in e)if(!t(e[r]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var n=t[1],i=ne(n),r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new re(i,n)},re.prototype.evaluate=function(){return this.value},re.prototype.eachChild=function(){},re.prototype.possibleOutputs=function(){return[this.value]},re.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Yt?["rgba"].concat(this.value.toArray()):this.value instanceof $t?this.value.serialize():this.value};var oe=function(t){this.name="ExpressionEvaluationError",this.message=t};oe.prototype.toJSON=function(){return this.message};var ae={string:Ft,number:Bt,boolean:zt,object:jt},se=function(t,e){this.type=t,this.args=e};se.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,i=1,r=t[0];if("array"===r){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ae)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ae[s],i++}else o=Ut;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}n=Ht(o,a)}else n=ae[r];for(var u=[];i<t.length;i++){var c=e.parse(t[i],i,Ut);if(!c)return null;u.push(c)}return new se(n,u)},se.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Zt(this.type,ne(n)))return n;if(e===this.args.length-1)throw new oe("Expected value to be of type "+qt(this.type)+", but found "+qt(ne(n))+" instead.")}return null},se.prototype.eachChild=function(t){this.args.forEach(t)},se.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},se.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var ue=function(t){this.type=Gt,this.sections=t};ue.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var i=[],r=!1,o=1;o<=t.length-1;++o){var a=t[o];if(r&&"object"==typeof a&&!Array.isArray(a)){r=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Bt)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,Ht(Ft))))return null;var c=null;if(a["text-color"]&&!(c=e.parse(a["text-color"],1,Nt)))return null;var l=i[i.length-1];l.scale=s,l.font=u,l.textColor=c}else{var h=e.parse(t[o],1,Ut);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:h,scale:null,font:null,textColor:null})}}return new ue(i)},ue.prototype.evaluate=function(t){return new $t(this.sections.map((function(e){var n=e.content.evaluate(t);return ne(n)===Wt?new Jt("",n,null,null,null):new Jt(ie(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},ue.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}},ue.prototype.possibleOutputs=function(){return[void 0]},ue.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t.push(i.content.serialize());var r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),t.push(r)}return t};var ce=function(t){this.type=Wt,this.input=t};ce.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Ft);return n?new ce(n):e.error("No image name provided.")},ce.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=!1;return t.availableImages&&t.availableImages.indexOf(e)>-1&&(n=!0),new te({name:e,available:n})},ce.prototype.eachChild=function(t){t(this.input)},ce.prototype.possibleOutputs=function(){return[void 0]},ce.prototype.serialize=function(){return["image",this.input.serialize()]};var le={"to-boolean":zt,"to-color":Nt,"to-number":Bt,"to-string":Ft},he=function(t,e){this.type=t,this.args=e};he.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var i=le[n],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Ut);if(!a)return null;r.push(a)}return new he(i,r)},he.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,i=0,r=this.args;i<r.length;i+=1){if(n=null,(e=r[i].evaluate(t))instanceof Yt)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ee(e[0],e[1],e[2],e[3])))return new Yt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new oe(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var c=Number(a);if(!isNaN(c))return c}throw new oe("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?$t.fromString(ie(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?te.fromString(ie(this.args[0].evaluate(t))):ie(this.args[0].evaluate(t))},he.prototype.eachChild=function(t){this.args.forEach(t)},he.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},he.prototype.serialize=function(){if("formatted"===this.type.kind)return new ue([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ce(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var pe=["Unknown","Point","LineString","Polygon"],fe=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null};fe.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fe.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?pe[this.feature.type]:this.feature.type:null},fe.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fe.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Yt.parse(t)),e};var de=function(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i};de.prototype.evaluate=function(t){return this._evaluate(t,this.args)},de.prototype.eachChild=function(t){this.args.forEach(t)},de.prototype.possibleOutputs=function(){return[void 0]},de.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},de.parse=function(t,e){var n,i=t[0],r=de.definitions[i];if(!r)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,c=0,l=s;c<l.length;c+=1){var h=l[c],p=h[0],f=h[1];u=new _e(e.registry,e.path,null,e.scope);for(var d=[],A=!1,g=1;g<t.length;g++){var m=t[g],y=Array.isArray(p)?p[g-1]:p.type,v=u.parse(m,1+d.length,y);if(!v){A=!0;break}d.push(v)}if(!A)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var _=0;_<d.length;_++){var b=Array.isArray(p)?p[_]:p.type,x=d[_];u.concat(_+1).checkSubtype(b,x.type)}if(0===u.errors.length)return new de(i,o,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var w=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(qt).join(", ")+")":"("+qt(e.type)+"...)"})).join(" | "),E=[],T=1;T<t.length;T++){var S=e.parse(t[T],1+E.length);if(!S)return null;E.push(qt(S.type))}e.error("Expected arguments of type "+w+", but found ("+E.join(", ")+") instead.")}return null},de.register=function(t,e){for(var n in de.definitions=e,e)t[n]=de};var Ae=function(t,e,n){this.type=Vt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function ge(t){if(t instanceof de){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild((function(t){e&&!ge(t)&&(e=!1)})),e}function me(t){if(t instanceof de&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!me(t)&&(e=!1)})),e}function ye(t,e){if(t instanceof de&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!ye(t,e)&&(n=!1)})),n}Ae.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,zt);if(!i)return null;var r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,zt);if(!r)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Ft))?null:new Ae(i,r,o)},Ae.prototype.evaluate=function(t){return new Kt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Ae.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Ae.prototype.possibleOutputs=function(){return[void 0]},Ae.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ve=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};ve.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new ve(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},ve.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ve.prototype.eachChild=function(){},ve.prototype.possibleOutputs=function(){return[void 0]},ve.prototype.serialize=function(){return["var",this.name]};var _e=function(t,e,n,i,r){void 0===e&&(e=[]),void 0===i&&(i=new kt),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=i,this.errors=r,this.expectedType=n};function be(t,e){for(var n,i,r=t.length-1,o=0,a=r,s=0;o<=a;)if(n=t[s=Math.floor((o+a)/2)],i=t[s+1],n<=e){if(s===r||e<i)return s;o=s+1}else{if(!(n>e))throw new oe("Input is not a number.");a=s-1}return 0}_e.prototype.parse=function(t,e,n,i,r){return void 0===r&&(r={}),e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)},_e.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new se(e,[t]):"coerce"===n?new he(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+typeof i+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var r=this.registry[i];if(r){var o=r.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof re)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof ve)return t(e.boundExpression);if(e instanceof de&&"error"===e.name)return!1;if(e instanceof Ae)return!1;var n=e instanceof he||e instanceof se,i=!0;return e.eachChild((function(e){i=n?i&&t(e):i&&e instanceof re})),!!i&&ge(e)&&ye(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new fe;try{o=new re(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},_e.prototype.concat=function(t,e,n){var i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new _e(this.registry,i,e||null,r,this.errors)},_e.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var i=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Rt(i,t))},_e.prototype.checkSubtype=function(t,e){var n=Zt(t,e);return n&&this.error(n),n};var xe=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,r=n;i<r.length;i+=1){var o=r[i],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};function we(t,e,n){return t*(1-n)+e*n}xe.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var i=[],r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,c=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var l=e.parse(s,c,r);if(!l)return null;r=r||l.type,i.push([a,l])}return new xe(r,n,i)},xe.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[be(e,i)].evaluate(t)},xe.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},xe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()})))},xe.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Ee=Object.freeze({__proto__:null,number:we,color:function(t,e,n){return new Yt(we(t.r,e.r,n),we(t.g,e.g,n),we(t.b,e.b,n),we(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,i){return we(t,e[i],n)}))}}),Te=6/29,Se=3*Te*Te,Pe=Math.PI/180,Me=180/Math.PI;function Ce(t){return t>.008856451679035631?Math.pow(t,1/3):t/Se+4/29}function Ie(t){return t>Te?t*t*t:Se*(t-4/29)}function Oe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Le(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Re(t){var e=Le(t.r),n=Le(t.g),i=Le(t.b),r=Ce((.4124564*e+.3575761*n+.1804375*i)/.95047),o=Ce((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Ce((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function ke(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Ie(e),n=.95047*Ie(n),i=1.08883*Ie(i),new Yt(Oe(3.2404542*n-1.5371385*e-.4985314*i),Oe(-.969266*n+1.8760108*e+.041556*i),Oe(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function De(t,e,n){var i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}var Be={forward:Re,reverse:ke,interpolate:function(t,e,n){return{l:we(t.l,e.l,n),a:we(t.a,e.a,n),b:we(t.b,e.b,n),alpha:we(t.alpha,e.alpha,n)}}},Fe={forward:function(t){var e=Re(t),n=e.l,i=e.a,r=e.b,o=Math.atan2(r,i)*Me;return{h:o<0?o+360:o,c:Math.sqrt(i*i+r*r),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Pe,n=t.c;return ke({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:De(t.h,e.h,n),c:we(t.c,e.c,n),l:we(t.l,e.l,n),alpha:we(t.alpha,e.alpha,n)}}},ze=Object.freeze({__proto__:null,lab:Be,hcl:Fe}),Ne=function(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(var o=0,a=r;o<a.length;o+=1){var s=a[o],u=s[0],c=s[1];this.labels.push(u),this.outputs.push(c)}};function je(t,e,n,i){var r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}Ne.interpolationFactor=function(t,e,i,r){var o=0;if("exponential"===t.name)o=je(e,t.base,i,r);else if("linear"===t.name)o=je(e,1,i,r);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(je(e,1,i,r))}return o},Ne.parse=function(t,e){var n=t[0],i=t[1],r=t[2],o=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var a=i[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:a}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var s=i.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,2,Bt)))return null;var u=[],c=null;"interpolate-hcl"===n||"interpolate-lab"===n?c=Nt:e.expectedType&&"value"!==e.expectedType.kind&&(c=e.expectedType);for(var l=0;l<o.length;l+=2){var h=o[l],p=o[l+1],f=l+3,d=l+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var A=e.parse(p,d,c);if(!A)return null;c=c||A.type,u.push([h,A])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new Ne(c,n,i,r,u):e.error("Type "+qt(c)+" is not interpolatable.")},Ne.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);var o=be(e,i),a=e[o],s=e[o+1],u=Ne.interpolationFactor(this.interpolation,i,a,s),c=n[o].evaluate(t),l=n[o+1].evaluate(t);return"interpolate"===this.operator?Ee[this.type.kind.toLowerCase()](c,l,u):"interpolate-hcl"===this.operator?Fe.reverse(Fe.interpolate(Fe.forward(c),Fe.forward(l),u)):Be.reverse(Be.interpolate(Be.forward(c),Be.forward(l),u))},Ne.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ne.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()})))},Ne.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var Ue=function(t,e){this.type=t,this.args=e};Ue.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,i=e.expectedType;i&&"value"!==i.kind&&(n=i);for(var r=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],u=e.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!u)return null;n=n||u.type,r.push(u)}var c=i&&r.some((function(t){return Zt(i,t.type)}));return new Ue(c?Ut:n,r)},Ue.prototype.evaluate=function(t){for(var e,n=null,i=0,r=0,o=this.args;r<o.length&&(i++,(n=o[r].evaluate(t))&&n instanceof te&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null===n);r+=1);return n},Ue.prototype.eachChild=function(t){this.args.forEach(t)},Ue.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},Ue.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Ve=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Ve.prototype.evaluate=function(t){return this.result.evaluate(t)},Ve.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},Ve.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],i=1;i<t.length-1;i+=2){var r=t[i];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var o=e.parse(t[i+1],i+1);if(!o)return null;n.push([r,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new Ve(n,a):null},Ve.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Ve.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];t.push(r,o.serialize())}return t.push(this.result.serialize()),t};var Ge=function(t,e,n){this.type=t,this.index=e,this.input=n};Ge.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Bt),i=e.parse(t[2],2,Ht(e.expectedType||Ut));if(!n||!i)return null;var r=i.type;return new Ge(r.itemType,n,i)},Ge.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new oe("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new oe("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new oe("Array index must be an integer, but found "+e+" instead.");return n[e]},Ge.prototype.eachChild=function(t){t(this.index),t(this.input)},Ge.prototype.possibleOutputs=function(){return[void 0]},Ge.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var We=function(t,e){this.type=zt,this.needle=t,this.haystack=e};We.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n,i=e.parse(t[1],1,Ut),r=e.parse(t[2],2,Ut);return i&&r?"boolean"!==(n=i.type).kind&&"string"!==n.kind&&"number"!==n.kind&&"null"!==n.kind&&"value"!==n.kind?e.error("Expected first argument to be of type boolean, string, number or null, but found "+qt(i.type)+" instead"):new We(i,r):null},We.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!e||!n)return!1;if(!function(t){return"boolean"==typeof t||"string"==typeof t||"number"==typeof t}(e))throw new oe("Expected first argument to be of type boolean, string or number, but found "+qt(ne(e))+" instead.");if(!function(t){return Array.isArray(t)||"string"==typeof t}(n))throw new oe("Expected second argument to be of type array or string, but found "+qt(ne(n))+" instead.");return n.indexOf(e)>=0},We.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},We.prototype.possibleOutputs=function(){return[!0,!1]},We.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var He=function(t,e,n,i,r,o){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o};He.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var c=e.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(var l=0,h=s;l<h.length;l+=1){var p=h[l];if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,ne(p)))return null}else n=ne(p);if(void 0!==r[String(p)])return c.error("Branch labels must be unique.");r[String(p)]=o.length}var f=e.parse(u,a,i);if(!f)return null;i=i||f.type,o.push(f)}var d=e.parse(t[1],1,Ut);if(!d)return null;var A=e.parse(t[t.length-1],t.length-1,i);return A?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new He(n,i,d,r,o,A):null},He.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(ne(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},He.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},He.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()}))).concat(this.otherwise.possibleOutputs())},He.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],i={},r=0,o=Object.keys(this.cases).sort();r<o.length;r+=1){var a=o[r];void 0===(h=i[this.cases[a]])?(i[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,c=n;u<c.length;u+=1){var l=c[u],h=l[0],p=l[1];1===p.length?e.push(s(p[0])):e.push(p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var qe=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};function Xe(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ze(t,e,n,i){return 0===i.compare(e,n)}function Qe(t,e,n){var i="=="!==t&&"!="!==t;return function(){function r(t,e,n){this.type=zt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Ut);if(!o)return null;if(!Xe(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+qt(o.type)+"'.");var a=e.parse(t[2],2,Ut);if(!a)return null;if(!Xe(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+qt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+qt(o.type)+"' and '"+qt(a.type)+"'.");i&&("value"===o.type.kind&&"value"!==a.type.kind?o=new se(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new se(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Vt)))return null}return new r(o,a,s)},r.prototype.evaluate=function(r){var o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){var s=ne(o),u=ne(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new oe('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!i&&this.hasUntypedArgument){var c=ne(o),l=ne(a);if("string"!==c.kind||"string"!==l.kind)return e(r,o,a)}return this.collator?n(r,o,a,this.collator.evaluate(r)):e(r,o,a)},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},r.prototype.possibleOutputs=function(){return[!0,!1]},r.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},r}()}qe.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i=[],r=1;r<t.length-1;r+=2){var o=e.parse(t[r],r,zt);if(!o)return null;var a=e.parse(t[r+1],r+1,n);if(!a)return null;i.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new qe(n,i,s):null},qe.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];if(r.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},qe.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],o=i[1];t(r),t(o)}t(this.otherwise)},qe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map((function(t){return t[0],t[1].possibleOutputs()}))).concat(this.otherwise.possibleOutputs())},qe.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Ye=Qe("==",(function(t,e,n){return e===n}),Ze),Ke=Qe("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!Ze(0,e,n,i)})),Je=Qe("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),$e=Qe(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),tn=Qe("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),en=Qe(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0})),nn=function(t,e,n,i,r){this.type=Ft,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r};nn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");var r=null;if(i.locale&&!(r=e.parse(i.locale,1,Ft)))return null;var o=null;if(i.currency&&!(o=e.parse(i.currency,1,Ft)))return null;var a=null;if(i["min-fraction-digits"]&&!(a=e.parse(i["min-fraction-digits"],1,Bt)))return null;var s=null;return i["max-fraction-digits"]&&!(s=e.parse(i["max-fraction-digits"],1,Bt))?null:new nn(n,r,o,a,s)},nn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},nn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},nn.prototype.possibleOutputs=function(){return[void 0]},nn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var rn=function(t){this.type=Bt,this.input=t};rn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+qt(n.type)+" instead."):new rn(n):null},rn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new oe("Expected value to be of type string or array, but found "+qt(ne(e))+" instead.")},rn.prototype.eachChild=function(t){t(this.input)},rn.prototype.possibleOutputs=function(){return[void 0]},rn.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var on={"==":Ye,"!=":Ke,">":$e,"<":Je,">=":en,"<=":tn,array:se,at:Ge,boolean:se,case:qe,coalesce:Ue,collator:Ae,format:ue,image:ce,in:We,interpolate:Ne,"interpolate-hcl":Ne,"interpolate-lab":Ne,length:rn,let:Ve,literal:re,match:He,number:se,"number-format":nn,object:se,step:xe,string:se,"to-boolean":he,"to-color":he,"to-number":he,"to-string":he,var:ve};function an(t,e){var n=e[0],i=e[1],r=e[2],o=e[3];n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);var a=o?o.evaluate(t):1,s=ee(n,i,r,a);if(s)throw new oe(s);return new Yt(n/255*a,i/255*a,r/255*a,a)}function sn(t,e){return t in e}function un(t,e){var n=e[t];return void 0===n?null:n}function cn(t){return{type:t}}function ln(t){return{result:"success",value:t}}function hn(t){return{result:"error",value:t}}function pn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function fn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function dn(t){return!!t.expression&&t.expression.interpolated}function An(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function gn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function mn(t){return t}function yn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function vn(t,e,n,i,r){return yn(typeof n===r?i[n]:void 0,t.default,e.default)}function _n(t,e,n){if("number"!==An(n))return yn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var r=be(t.stops.map((function(t){return t[0]})),n);return t.stops[r][1]}function bn(t,e,n){var i=void 0!==t.base?t.base:1;if("number"!==An(n))return yn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var o=be(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,i){var r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],c=Ee[e.type]||mn;if(t.colorSpace&&"rgb"!==t.colorSpace){var l=ze[t.colorSpace];c=function(t,e){return l.reverse(l.interpolate(l.forward(t),l.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return c(n,i,a)}}:c(s,u,a)}function xn(t,e,n){return"color"===e.type?n=Yt.parse(n):"formatted"===e.type?n=$t.fromString(n.toString()):"resolvedImage"===e.type?n=te.fromString(n.toString()):An(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),yn(n,t.default,e.default)}de.register(on,{error:[{kind:"error"},[Ft],function(t,e){var n=e[0];throw new oe(n.evaluate(t))}],typeof:[Ft,[Ut],function(t,e){return qt(ne(e[0].evaluate(t)))}],"to-rgba":[Ht(Bt,4),[Nt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Nt,[Bt,Bt,Bt],an],rgba:[Nt,[Bt,Bt,Bt,Bt],an],has:{type:zt,overloads:[[[Ft],function(t,e){return sn(e[0].evaluate(t),t.properties())}],[[Ft,jt],function(t,e){var n=e[0],i=e[1];return sn(n.evaluate(t),i.evaluate(t))}]]},get:{type:Ut,overloads:[[[Ft],function(t,e){return un(e[0].evaluate(t),t.properties())}],[[Ft,jt],function(t,e){var n=e[0],i=e[1];return un(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[Ut,[Ft],function(t,e){return un(e[0].evaluate(t),t.featureState||{})}],properties:[jt,[],function(t){return t.properties()}],"geometry-type":[Ft,[],function(t){return t.geometryType()}],id:[Ut,[],function(t){return t.id()}],zoom:[Bt,[],function(t){return t.globals.zoom}],"heatmap-density":[Bt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Bt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Ut,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Bt,cn(Bt),function(t,e){for(var n=0,i=0,r=e;i<r.length;i+=1)n+=r[i].evaluate(t);return n}],"*":[Bt,cn(Bt),function(t,e){for(var n=1,i=0,r=e;i<r.length;i+=1)n*=r[i].evaluate(t);return n}],"-":{type:Bt,overloads:[[[Bt,Bt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)-i.evaluate(t)}],[[Bt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Bt,[Bt,Bt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)/i.evaluate(t)}],"%":[Bt,[Bt,Bt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)%i.evaluate(t)}],ln2:[Bt,[],function(){return Math.LN2}],pi:[Bt,[],function(){return Math.PI}],e:[Bt,[],function(){return Math.E}],"^":[Bt,[Bt,Bt],function(t,e){var n=e[0],i=e[1];return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[Bt,[Bt],function(t,e){var n=e[0];return Math.sqrt(n.evaluate(t))}],log10:[Bt,[Bt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN10}],ln:[Bt,[Bt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))}],log2:[Bt,[Bt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN2}],sin:[Bt,[Bt],function(t,e){var n=e[0];return Math.sin(n.evaluate(t))}],cos:[Bt,[Bt],function(t,e){var n=e[0];return Math.cos(n.evaluate(t))}],tan:[Bt,[Bt],function(t,e){var n=e[0];return Math.tan(n.evaluate(t))}],asin:[Bt,[Bt],function(t,e){var n=e[0];return Math.asin(n.evaluate(t))}],acos:[Bt,[Bt],function(t,e){var n=e[0];return Math.acos(n.evaluate(t))}],atan:[Bt,[Bt],function(t,e){var n=e[0];return Math.atan(n.evaluate(t))}],min:[Bt,cn(Bt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Bt,cn(Bt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Bt,[Bt],function(t,e){var n=e[0];return Math.abs(n.evaluate(t))}],round:[Bt,[Bt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Bt,[Bt],function(t,e){var n=e[0];return Math.floor(n.evaluate(t))}],ceil:[Bt,[Bt],function(t,e){var n=e[0];return Math.ceil(n.evaluate(t))}],"filter-==":[zt,[Ft,Ut],function(t,e){var n=e[0],i=e[1];return t.properties()[n.value]===i.value}],"filter-id-==":[zt,[Ut],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[zt,[Ft],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[zt,[Ft,Ut],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[zt,[Ut],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[zt,[Ft,Ut],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[zt,[Ut],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[zt,[Ft,Ut],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[zt,[Ut],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[zt,[Ft,Ut],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[zt,[Ut],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[zt,[Ut],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[zt,[],function(t){return null!==t.id()}],"filter-type-in":[zt,[Ht(Ft)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[zt,[Ht(Ut)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[zt,[Ft,Ht(Ut)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[zt,[Ft,Ht(Ut)],function(t,e){var n=e[0],i=e[1];return function(t,e,n,i){for(;n<=i;){var r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:zt,overloads:[[[zt,zt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)&&i.evaluate(t)}],[cn(zt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(!i[n].evaluate(t))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)||i.evaluate(t)}],[cn(zt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(i[n].evaluate(t))return!0;return!1}]]},"!":[zt,[zt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[zt,[Ft],function(t,e){var n=e[0],i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[Ft,[Ft],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Ft,[Ft],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Ft,cn(Ut),function(t,e){return e.map((function(e){return ie(e.evaluate(t))})).join("")}],"resolved-locale":[Ft,[Vt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new fe,this._defaultValue=e?function(t){return"color"===t.type&&gn(t.default)?new Yt(0,0,0,0):"color"===t.type?Yt.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function En(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in on}function Tn(t,e){var n=new _e(on,[],e?function(t){var e={color:Nt,string:Ft,number:Bt,enum:Ft,boolean:zt,formatted:Gt,resolvedImage:Wt};return"array"===t.type?Ht(e[t.value]||Ut,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?ln(new wn(i,e)):hn(n.errors)}wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=r,this.expression.evaluate(this._evaluator)},wn.prototype.evaluate=function(t,e,n,i,r){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=r||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new oe("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Sn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!me(e.expression)};Sn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r)},Sn.prototype.evaluate=function(t,e,n,i,r){return this._styleExpression.evaluate(t,e,n,i,r)};var Pn=function(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!me(e.expression),this.interpolationType=i};function Mn(t,e){if("error"===(t=Tn(t,e)).result)return t;var n=t.value.expression,i=ge(n);if(!i&&!pn(e))return hn([new Rt("","data expressions not supported")]);var r=ye(n,["zoom"]);if(!r&&!fn(e))return hn([new Rt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof Ve)n=t(e.result);else if(e instanceof Ue)for(var i=0,r=e.args;i<r.length;i+=1){var o=r[i];if(n=t(o))break}else(e instanceof xe||e instanceof Ne)&&e.input instanceof de&&"zoom"===e.input.name&&(n=e);return n instanceof Rt?n:(e.eachChild((function(e){var i=t(e);i instanceof Rt?n=i:!n&&i?n=new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&i&&n!==i&&(n=new Rt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n)}(n);if(!o&&!r)return hn([new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Rt)return hn([o]);if(o instanceof Ne&&!dn(e))return hn([new Rt("",'"interpolate" expressions cannot be used with this property')]);if(!o)return ln(new Sn(i?"constant":"source",t.value));var a=o instanceof Ne?o.interpolation:void 0;return ln(new Pn(i?"camera":"composite",t.value,o.labels,a))}Pn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r)},Pn.prototype.evaluate=function(t,e,n,i,r){return this._styleExpression.evaluate(t,e,n,i,r)},Pn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?Ne.interpolationFactor(this.interpolationType,t,e,n):0};var Cn=function(t,e){this._parameters=t,this._specification=e,It(this,function t(e,n){var i,r,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,c=s||!u,l=e.type||(dn(n)?"exponential":"interval");if(a&&((e=It({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],Yt.parse(t[1])]}))),e.default?e.default=Yt.parse(e.default):e.default=Yt.parse(n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ze[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)i=bn;else if("interval"===l)i=_n;else if("categorical"===l){i=vn,r=Object.create(null);for(var h=0,p=e.stops;h<p.length;h+=1){var f=p[h];r[f[0]]=f[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');i=xn}if(s){for(var d={},A=[],g=0;g<e.stops.length;g++){var m=e.stops[g],y=m[0].zoom;void 0===d[y]&&(d[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},A.push(y)),d[y].stops.push([m[0].value,m[1]])}for(var v=[],_=0,b=A;_<b.length;_+=1){var x=b[_];v.push([d[x].zoom,t(d[x],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:Ne.interpolationFactor.bind(void 0,w),zoomStops:v.map((function(t){return t[0]})),evaluate:function(t,i){var r=t.zoom;return bn({stops:v,base:e.base},n,r).evaluate(r,i)}}}if(c){var E="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ne.interpolationFactor.bind(void 0,E),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){var a=t.zoom;return i(e,n,a,r,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?yn(e.default,n.default):i(e,n,s,r,o)}}}(this._parameters,this._specification))};function In(t){var e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=An(n);if("object"!==u)return[new Mt(e,n,"object expected, "+u+" found")];for(var c in n){var l=c.split(".")[0],h=i[l]||i["*"],p=void 0;if(r[l])p=r[l];else if(i[l])p=ti;else if(r["*"])p=r["*"];else{if(!i["*"]){s.push(new Mt(e,n[c],'unknown property "'+c+'"'));continue}p=ti}s=s.concat(p({key:(e?e+".":e)+c,value:n[c],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:c},n))}for(var f in i)r[f]||i[f].required&&void 0===i[f].default&&void 0===n[f]&&s.push(new Mt(e,n,'missing required property "'+f+'"'));return s}function On(t){var e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,o=t.key,a=t.arrayElementValidator||ti;if("array"!==An(e))return[new Mt(o,e,"array expected, "+An(e)+" found")];if(n.length&&e.length!==n.length)return[new Mt(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new Mt(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};r.$version<7&&(s.function=n.function),"object"===An(n.value)&&(s=n.value);for(var u=[],c=0;c<e.length;c++)u=u.concat(a({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:i,styleSpec:r,key:o+"["+c+"]"}));return u}function Ln(t){var e=t.key,n=t.value,i=t.valueSpec,r=An(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new Mt(e,n,"number expected, "+r+" found")]:"minimum"in i&&n<i.minimum?[new Mt(e,n,n+" is less than the minimum value "+i.minimum)]:"maximum"in i&&n>i.maximum?[new Mt(e,n,n+" is greater than the maximum value "+i.maximum)]:[]}function Rn(t){var e,n,i,r=t.valueSpec,o=Ot(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,c="array"===An(t.value.stops)&&"array"===An(t.value.stops[0])&&"object"===An(t.value.stops[0][0]),l=In({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Mt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(On({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===An(n)&&0===n.length&&e.push(new Mt(t.key,n,"array must have at least one stop")),e},default:function(t){return ti({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&l.push(new Mt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||l.push(new Mt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!dn(t.valueSpec)&&l.push(new Mt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!pn(t.valueSpec)?l.push(new Mt(t.key,t.value,"property functions not supported")):s&&!fn(t.valueSpec)&&l.push(new Mt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!c||void 0!==t.value.property||l.push(new Mt(t.key,t.value,'"property" property is required')),l;function h(t){var e=[],o=t.value,s=t.key;if("array"!==An(o))return[new Mt(s,o,"array expected, "+An(o)+" found")];if(2!==o.length)return[new Mt(s,o,"array length 2 expected, length "+o.length+" found")];if(c){if("object"!==An(o[0]))return[new Mt(s,o,"object expected, "+An(o[0])+" found")];if(void 0===o[0].zoom)return[new Mt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Mt(s,o,"object stop key must have value")];if(i&&i>Ot(o[0].zoom))return[new Mt(s,o[0].zoom,"stop zoom values must appear in ascending order")];Ot(o[0].zoom)!==i&&(i=Ot(o[0].zoom),n=void 0,a={}),e=e.concat(In({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Ln,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return En(Lt(o[1]))?e.concat([new Mt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(ti({key:s+"[1]",value:o[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function p(t,i){var s=An(t.value),u=Ot(t.value),c=null!==t.value?t.value:i;if(e){if(s!==e)return[new Mt(t.key,c,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Mt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var l="number expected, "+s+" found";return pn(r)&&void 0===o&&(l+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(t.key,c,l)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new Mt(t.key,c,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new Mt(t.key,c,"stop domain values must be unique")]:(a[u]=!0,[])):[new Mt(t.key,c,"integer expected, found "+u)]}}function kn(t){var e=("property"===t.expressionContext?Mn:Tn)(Lt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Mt(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==n.possibleOutputs().indexOf(void 0))return[new Mt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!me(n))return[new Mt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!me(n))return[new Mt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ye(n,["zoom","feature-state"]))return[new Mt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ge(n))return[new Mt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dn(t){var e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ot(n))&&r.push(new Mt(e,n,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(i.values).indexOf(Ot(n))&&r.push(new Mt(e,n,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(n)+" found")),r}function Bn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&Array.isArray(t[2]);case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var i=n[e];if(!Bn(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Cn.deserialize=function(t){return new Cn(t._parameters,t._specification)},Cn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Fn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zn(t){if(null==t)return function(){return!0};Bn(t)||(t=jn(t));var e=Tn(t,Fn);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return function(t,n){return e.value.evaluate(t,n)}}function Nn(t,e){return t<e?-1:t>e?1:0}function jn(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?Un(t[1],t[2],"=="):"!="===n?Wn(Un(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?Un(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(jn))):"all"===n?["all"].concat(t.slice(1).map(jn)):"none"===n?["all"].concat(t.slice(1).map(jn).map(Wn)):"in"===n?Vn(t[1],t.slice(2)):"!in"===n?Wn(Vn(t[1],t.slice(2))):"has"===n?Gn(t[1]):"!has"!==n||Wn(Gn(t[1]))}function Un(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function Vn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(Nn)]]:["filter-in-small",t,["literal",e]]}}function Gn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Wn(t){return["!",t]}function Hn(t){return Bn(Lt(t.value))?kn(It({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,i=e.key;if("array"!==An(n))return[new Mt(i,n,"array expected, "+An(n)+" found")];var r,o=e.styleSpec,a=[];if(n.length<1)return[new Mt(i,n,"filter array must have at least 1 element")];switch(a=a.concat(Dn({key:i+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ot(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Ot(n[1])&&a.push(new Mt(i,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new Mt(i,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(r=An(n[1]))&&a.push(new Mt(i+"[1]",n[1],"string expected, "+r+" found"));for(var s=2;s<n.length;s++)r=An(n[s]),"$type"===Ot(n[1])?a=a.concat(Dn({key:i+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new Mt(i+"["+s+"]",n[s],"string, number, or boolean expected, "+r+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:i+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=An(n[1]),2!==n.length?a.push(new Mt(i,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==r&&a.push(new Mt(i+"[1]",n[1],"string expected, "+r+" found"))}return a}(t)}function qn(t,e){var n=t.key,i=t.style,r=t.styleSpec,o=t.value,a=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return ti({key:n,value:o,valueSpec:r.transition,style:i,styleSpec:r});var c,l=t.valueSpec||s[a];if(!l)return[new Mt(n,o,'unknown property "'+a+'"')];if("string"===An(o)&&pn(l)&&!l.tokens&&(c=/^{([^}]+)}$/.exec(o)))return[new Mt(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&i&&!i.glyphs&&h.push(new Mt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&gn(Lt(o))&&"identity"===Ot(o.type)&&h.push(new Mt(n,o,'"text-font" does not support identity functions'))),h.concat(ti({key:t.key,value:o,valueSpec:l,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:a}))}function Xn(t){return qn(t,"paint")}function Zn(t){return qn(t,"layout")}function Qn(t){var e=[],n=t.value,i=t.key,r=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Mt(i,n,'either "type" or "ref" is required'));var a,s=Ot(n.type),u=Ot(n.ref);if(n.id)for(var c=Ot(n.id),l=0;l<t.arrayIndex;l++){var h=r.layers[l];Ot(h.id)===c&&e.push(new Mt(i,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new Mt(i,n[t],'"'+t+'" is prohibited for ref layers'))})),r.layers.forEach((function(t){Ot(t.id)===u&&(a=t)})),a?a.ref?e.push(new Mt(i,n.ref,"ref cannot reference another ref layer")):s=Ot(a.type):e.push(new Mt(i,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=r.sources&&r.sources[n.source],f=p&&Ot(p.type);p?"vector"===f&&"raster"===s?e.push(new Mt(i,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Mt(i,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Mt(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new Mt(i,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Mt(i,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new Mt(i,n.source,'source "'+n.source+'" not found'))}else e.push(new Mt(i,n,'missing required property "source"'));return e=e.concat(In({key:i,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ti({key:i+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:Hn,layout:function(t){return In({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Zn(It({layerType:s},t))}}})},paint:function(t){return In({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Xn(It({layerType:s},t))}}})}}}))}function Yn(t){var e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new Mt(n,e,'"type" is required')];var o,a=Ot(e.type);switch(a){case"vector":case"raster":case"raster-dem":return In({key:n,value:e,valueSpec:i["source_"+a.replace("-","_")],style:t.style,styleSpec:i});case"geojson":if(o=In({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],c=u[0],l=u[1],h="string"==typeof c?[c,["accumulated"],["get",s]]:c;o.push.apply(o,kn({key:n+"."+s+".map",value:l,expressionContext:"cluster-map"})),o.push.apply(o,kn({key:n+"."+s+".reduce",value:h,expressionContext:"cluster-reduce"}))}return o;case"video":return In({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return In({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Mt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dn({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function Kn(t){var e=t.value,n=t.styleSpec,i=n.light,r=t.style,o=[],a=An(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Mt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=u&&i[u[1]]&&i[u[1]].transition?o.concat(ti({key:s,value:e[s],valueSpec:n.transition,style:r,styleSpec:n})):i[s]?o.concat(ti({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new Mt(s,e[s],'unknown property "'+s+'"')])}return o}function Jn(t){var e=t.value,n=t.key,i=An(e);return"string"!==i?[new Mt(n,e,"string expected, "+i+" found")]:[]}var $n={"*":function(){return[]},array:On,boolean:function(t){var e=t.value,n=t.key,i=An(e);return"boolean"!==i?[new Mt(n,e,"boolean expected, "+i+" found")]:[]},number:Ln,color:function(t){var e=t.key,n=t.value,i=An(n);return"string"!==i?[new Mt(e,n,"color expected, "+i+" found")]:null===Qt(n)?[new Mt(e,n,'color expected, "'+n+'" found')]:[]},constants:Ct,enum:Dn,filter:Hn,function:Rn,layer:Qn,object:In,source:Yn,light:Kn,string:Jn,formatted:function(t){return 0===Jn(t).length?[]:kn(t)},resolvedImage:function(t){return 0===Jn(t).length?[]:kn(t)}};function ti(t){var e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&gn(Ot(e))?Rn(t):n.expression&&En(Lt(e))?kn(t):n.type&&$n[n.type]?$n[n.type](t):In(It({},t,{valueSpec:n.type?i[n.type]:n}))}function ei(t){var e=t.value,n=t.key,i=Jn(t);return i.length?i:(-1===e.indexOf("{fontstack}")&&i.push(new Mt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Mt(n,e,'"glyphs" url must include a "{range}" token')),i)}function ni(t,e){void 0===e&&(e=Pt);var n=[];return n=n.concat(ti({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ei,"*":function(){return[]}}})),t.constants&&(n=n.concat(Ct({key:"constants",value:t.constants,style:t,styleSpec:e}))),ii(n)}function ii(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function ri(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return ii(t.apply(this,e))}}ni.source=ri(Yn),ni.light=ri(Kn),ni.layer=ri(Qn),ni.filter=ri(Hn),ni.paintProperty=ri(Xn),ni.layoutProperty=ri(Zn);var oi=ni,ai=oi.light,si=oi.paintProperty,ui=oi.layoutProperty;function ci(t,e){var n=!1;if(e&&e.length)for(var i=0,r=e;i<r.length;i+=1){var o=r[i];t.fire(new Tt(new Error(o.message))),n=!0}return n}var li=hi;function hi(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],e=r[1],n=r[2],this.d=e+2*n;for(var o=0;o<this.d*this.d;o++){var a=r[3+o],s=r[3+o+1];i.push(a===s?null:r.subarray(a,s))}var u=r[3+i.length],c=r[3+i.length+1];this.keys=r.subarray(u,c),this.bboxes=r.subarray(c),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var h=n/e*t;this.min=-h,this.max=t+h}hi.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},hi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},hi.prototype._insertCell=function(t,e,n,i,r,o){this.cells[r].push(o)},hi.prototype.query=function(t,e,n,i,r){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,i,this._queryCell,s,{},r),s},hi.prototype._queryCell=function(t,e,n,i,r,o,a,s){var u=this.cells[r];if(null!==u)for(var c=this.keys,l=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(l[f+0],l[f+1],l[f+2],l[f+3]):t<=l[f+2]&&e<=l[f+3]&&n>=l[f+0]&&i>=l[f+1])?(a[p]=!0,o.push(c[p])):a[p]=!1}}},hi.prototype._forEachCell=function(t,e,n,i,r,o,a,s){for(var u=this._convertToCellCoord(t),c=this._convertToCellCoord(e),l=this._convertToCellCoord(n),h=this._convertToCellCoord(i),p=u;p<=l;p++)for(var f=c;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&r.call(this,t,e,n,i,d,o,a,s))return}},hi.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},hi.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},hi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];r[3+a]=o,r.set(s,o),o+=s.length}return r[3+t.length]=o,r.set(this.keys,o),o+=this.keys.length,r[3+t.length+1]=o,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var pi=self.ImageData,fi={};function di(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),fi[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Ai in di("Object",Object),li.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},li.deserialize=function(t){return new li(t.buffer)},di("Grid",li),di("Color",Yt),di("Error",Error),di("ResolvedImage",te),di("StylePropertyFunction",Cn),di("StyleExpression",wn,{omit:["_evaluator"]}),di("ZoomDependentExpression",Pn),di("ZoomConstantExpression",Sn),di("CompoundExpression",de,{omit:["_evaluate"]}),on)on[Ai]._classRegistryKey||di("Expression_"+Ai,on[Ai]);function gi(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function mi(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(gi(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof pi)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],r=0,o=t;r<o.length;r+=1){var a=o[r];i.push(mi(a,e))}return i}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var c=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(fi[u].omit.indexOf(l)>=0)){var h=t[l];c[l]=fi[u].shallow.indexOf(l)>=0?h:mi(h,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(c.$name=u),c}throw new Error("can't serialize object of type "+typeof t)}function yi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||gi(t)||ArrayBuffer.isView(t)||t instanceof pi)return t;if(Array.isArray(t))return t.map(yi);if("object"==typeof t){var e=t.$name||"Object",n=fi[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var i=Object.create(n.prototype),r=0,o=Object.keys(t);r<o.length;r+=1){var a=o[r];if("$name"!==a){var s=t[a];i[a]=fi[e].shallow.indexOf(a)>=0?s:yi(s)}}return i}throw new Error("can't deserialize object of type "+typeof t)}var vi=function(){this.first=!0};vi.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var _i={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function bi(t){for(var e=0,n=t;e<n.length;e+=1)if(wi(n[e].charCodeAt(0)))return!0;return!1}function xi(t){return!(_i.Arabic(t)||_i["Arabic Supplement"](t)||_i["Arabic Extended-A"](t)||_i["Arabic Presentation Forms-A"](t)||_i["Arabic Presentation Forms-B"](t))}function wi(t){return!(746!==t&&747!==t&&(t<4352||!(_i["Bopomofo Extended"](t)||_i.Bopomofo(t)||_i["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||_i["CJK Compatibility Ideographs"](t)||_i["CJK Compatibility"](t)||_i["CJK Radicals Supplement"](t)||_i["CJK Strokes"](t)||!(!_i["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||_i["CJK Unified Ideographs Extension A"](t)||_i["CJK Unified Ideographs"](t)||_i["Enclosed CJK Letters and Months"](t)||_i["Hangul Compatibility Jamo"](t)||_i["Hangul Jamo Extended-A"](t)||_i["Hangul Jamo Extended-B"](t)||_i["Hangul Jamo"](t)||_i["Hangul Syllables"](t)||_i.Hiragana(t)||_i["Ideographic Description Characters"](t)||_i.Kanbun(t)||_i["Kangxi Radicals"](t)||_i["Katakana Phonetic Extensions"](t)||_i.Katakana(t)&&12540!==t||!(!_i["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!_i["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||_i["Unified Canadian Aboriginal Syllabics"](t)||_i["Unified Canadian Aboriginal Syllabics Extended"](t)||_i["Vertical Forms"](t)||_i["Yijing Hexagram Symbols"](t)||_i["Yi Syllables"](t)||_i["Yi Radicals"](t))))}function Ei(t){return!(wi(t)||function(t){return!!(_i["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||_i["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||_i["Letterlike Symbols"](t)||_i["Number Forms"](t)||_i["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||_i["Control Pictures"](t)&&9251!==t||_i["Optical Character Recognition"](t)||_i["Enclosed Alphanumerics"](t)||_i["Geometric Shapes"](t)||_i["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_i["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_i["CJK Symbols and Punctuation"](t)||_i.Katakana(t)||_i["Private Use Area"](t)||_i["CJK Compatibility Forms"](t)||_i["Small Form Variants"](t)||_i["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Ti(t){return t>=1424&&t<=2303||_i["Arabic Presentation Forms-A"](t)||_i["Arabic Presentation Forms-B"](t)}function Si(t,e){return!(!e&&Ti(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||_i.Khmer(t))}function Pi(t){for(var e=0,n=t;e<n.length;e+=1)if(Ti(n[e].charCodeAt(0)))return!0;return!1}var Mi="deferred",Ci="loading",Ii="loaded",Oi=null,Li="unavailable",Ri=null,ki=function(t){Oi&&Oi(t)};function Di(){Bi.fire(new Et("pluginStateChange",{pluginStatus:Li,pluginURL:Ri}))}var Bi=new St,Fi=function(){return Li},zi=function(){if(Li!==Mi||!Ri)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Li=Ci,Di(),Ri&&vt({url:Ri},(function(t){t?ki(t):(Li=Ii,Di())}))},Ni={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Li===Ii||null!=Ni.applyArabicShaping},isLoading:function(){return Li===Ci},setState:function(t){Li=t.pluginStatus,Ri=t.pluginURL},isParsed:function(){return null!=Ni.applyArabicShaping&&null!=Ni.processBidirectionalText&&null!=Ni.processStyledBidirectionalText},getPluginURL:function(){return Ri}},ji=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vi,this.transition={})};ji.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,i=t;n<i.length;n+=1)if(!Si(i[n].charCodeAt(0),e))return!1;return!0}(t,Ni.isLoaded())},ji.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ji.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var Ui=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(gn(t))return new Cn(t,e);if(En(t)){var n=Mn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=Yt.parse(t)),{kind:"constant",evaluate:function(){return i}}}(void 0===e?t.specification.default:e,t.specification)};Ui.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Ui.prototype.possiblyEvaluate=function(t,e){return this.property.possiblyEvaluate(this,t,e)};var Vi=function(t){this.property=t,this.value=new Ui(t,void 0)};Vi.prototype.transitioned=function(t,e){return new Wi(this.property,this.value,e,h({},t.transition,this.transition),t.now)},Vi.prototype.untransitioned=function(){return new Wi(this.property,this.value,null,{},0)};var Gi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Gi.prototype.getValue=function(t){return _(this._values[t].value.value)},Gi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Vi(this._values[t].property)),this._values[t].value=new Ui(this._values[t].property,null===e?void 0:_(e))},Gi.prototype.getTransition=function(t){return _(this._values[t].transition)},Gi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Vi(this._values[t].property)),this._values[t].transition=_(e)||void 0},Gi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r);var o=this.getTransition(i);void 0!==o&&(t[i+"-transition"]=o)}return t},Gi.prototype.transitioned=function(t,e){for(var n=new Hi(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var o=r[i];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},Gi.prototype.untransitioned=function(){for(var t=new Hi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e];t._values[i]=this._values[i].untransitioned()}return t};var Wi=function(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)};Wi.prototype.possiblyEvaluate=function(t,e){var n=t.now||0,i=this.value.possiblyEvaluate(t,e),r=this.prior;if(r){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return r.possiblyEvaluate(t,e);var o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(r.possiblyEvaluate(t,e),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(o))}return i};var Hi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Hi.prototype.possiblyEvaluate=function(t,e){for(var n=new Zi(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var o=r[i];n._values[o]=this._values[o].possiblyEvaluate(t,e)}return n},Hi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var n=e[t];if(this._values[n].prior)return!0}return!1};var qi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};qi.prototype.getValue=function(t){return _(this._values[t].value)},qi.prototype.setValue=function(t,e){this._values[t]=new Ui(this._values[t].property,null===e?void 0:_(e))},qi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r)}return t},qi.prototype.possiblyEvaluate=function(t,e){for(var n=new Zi(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var o=r[i];n._values[o]=this._values[o].possiblyEvaluate(t,e)}return n};var Xi=function(t,e,n){this.property=t,this.value=e,this.parameters=n};Xi.prototype.isConstant=function(){return"constant"===this.value.kind},Xi.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Xi.prototype.evaluate=function(t,e,n){return this.property.evaluate(this.value,this.parameters,t,e,n)};var Zi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Zi.prototype.get=function(t){return this._values[t]};var Qi=function(t){this.specification=t};Qi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Qi.prototype.interpolate=function(t,e,n){var i=Ee[this.specification.type];return i?i(t,e,n):t};var Yi=function(t,e){this.specification=t,this.overrides=e};Yi.prototype.possiblyEvaluate=function(t,e,n){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Xi(this,{kind:"constant",value:t.expression.evaluate(e,null,{},n)},e):new Xi(this,t.expression,e)},Yi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Xi(this,{kind:"constant",value:void 0},t.parameters);var i=Ee[this.specification.type];return i?new Xi(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t},Yi.prototype.evaluate=function(t,e,n,i,r){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r)};var Ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(t,e,n){if(void 0===t.value)return new Xi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n),r="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,o=this._calculate(r,r,r,e);return new Xi(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var a=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Xi(this,{kind:"constant",value:a},e)}return new Xi(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,i,r){if("source"===t.kind){var o=t.evaluate(e,n,i,r);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value},e.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(Yi),Ji=function(t){this.specification=t};Ji.prototype.possiblyEvaluate=function(t,e,n){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new ji(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ji(Math.floor(e.zoom),e)),t.expression.evaluate(new ji(Math.floor(e.zoom+1),e)),e)}},Ji.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},Ji.prototype.interpolate=function(t){return t};var $i=function(t){this.specification=t};$i.prototype.possiblyEvaluate=function(t,e,n){return!!t.expression.evaluate(e,null,{},n)},$i.prototype.interpolate=function(){return!1};var tr=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var i=this.defaultPropertyValues[e]=new Ui(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new Vi(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}};di("DataDrivenProperty",Yi),di("DataConstantProperty",Qi),di("CrossFadedDataDrivenProperty",Ki),di("CrossFadedProperty",Ji),di("ColorRampProperty",$i);var er=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(e=e,this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new qi(n.layout)),n.paint)){for(var i in this._transitionablePaint=new Gi(n.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var i="layers."+this.id+".layout."+t;if(this._validate(ui,i,t,e,n))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e},e.prototype.getPaintProperty=function(t){return m(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var i="layers."+this.id+".paint."+t;if(this._validate(si,i,t,e,n))return!1}if(m(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],o="cross-faded-data-driven"===r.property.specification["property-type"],a=r.value.isDataDriven(),s=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var u=this._transitionablePaint._values[t].value;return u.isDataDriven()||a||o||this._handleOverridablePaintPropertyUpdate(t,s,u)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,i,r){return void 0===r&&(r={}),(!r||!1!==r.validate)&&ci(this,t.call(oi,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Xi&&pn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(St),nr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ir=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},rr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function or(t,e){void 0===e&&(e=1);var n=0,i=0;return{members:t.map((function(t){var r,o=(r=t.type,nr[r].BYTES_PER_ELEMENT),a=n=ar(n,Math.max(e,o)),s=t.components||1;return i=Math.max(i,o),n+=o*s,{name:t.name,type:t.type,components:s,offset:a}})),size:ar(n,Math.max(i,e)),alignment:e}}function ar(t,e){return Math.ceil(t/e)*e}rr.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},rr.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},rr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},rr.prototype.clear=function(){this.length=0},rr.prototype.resize=function(t){this.reserve(t),this.length=t},rr.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},rr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var sr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t},e}(rr);sr.prototype.bytesPerElement=4,di("StructArrayLayout2i4",sr);var ur=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,t},e}(rr);ur.prototype.bytesPerElement=8,di("StructArrayLayout4i8",ur);var cr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r,o)},e.prototype.emplace=function(t,e,n,i,r,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(rr);cr.prototype.bytesPerElement=12,di("StructArrayLayout2i4i12",cr);var lr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r,o)},e.prototype.emplace=function(t,e,n,i,r,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=i,this.uint8[u+5]=r,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(rr);lr.prototype.bytesPerElement=8,di("StructArrayLayout2i4ub8",lr);var hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,o,a,s)},e.prototype.emplace=function(t,e,n,i,r,o,a,s,u){var c=8*t;return this.uint16[c+0]=e,this.uint16[c+1]=n,this.uint16[c+2]=i,this.uint16[c+3]=r,this.uint16[c+4]=o,this.uint16[c+5]=a,this.uint16[c+6]=s,this.uint16[c+7]=u,t},e}(rr);hr.prototype.bytesPerElement=16,di("StructArrayLayout8ui16",hr);var pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,u,c,l,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,i,r,o,a,s,u,c,l,h)},e.prototype.emplace=function(t,e,n,i,r,o,a,s,u,c,l,h,p){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.uint16[f+4]=o,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=c,this.int16[f+9]=l,this.int16[f+10]=h,this.int16[f+11]=p,t},e}(rr);pr.prototype.bytesPerElement=24,di("StructArrayLayout4i4ui4i24",pr);var fr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t},e}(rr);fr.prototype.bytesPerElement=12,di("StructArrayLayout3f12",fr);var dr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint32[n+0]=e,t},e}(rr);dr.prototype.bytesPerElement=4,di("StructArrayLayout1ul4",dr);var Ar=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,u,c,l){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,n,i,r,o,a,s,u,c,l)},e.prototype.emplace=function(t,e,n,i,r,o,a,s,u,c,l,h){var p=12*t,f=6*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.int16[p+4]=o,this.int16[p+5]=a,this.uint32[f+3]=s,this.uint16[p+8]=u,this.uint16[p+9]=c,this.int16[p+10]=l,this.int16[p+11]=h,t},e}(rr);Ar.prototype.bytesPerElement=24,di("StructArrayLayout6i1ul2ui2i24",Ar);var gr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r,o)},e.prototype.emplace=function(t,e,n,i,r,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(rr);gr.prototype.bytesPerElement=12,di("StructArrayLayout2i2i2i12",gr);var mr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=i,this.float32[a+2]=r,t},e}(rr);mr.prototype.bytesPerElement=12,di("StructArrayLayout2ub2f12",mr);var yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g){var m=this.length;return this.resize(m+1),this.emplace(m,t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g)},e.prototype.emplace=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g,m){var y=24*t,v=12*t,_=48*t;return this.int16[y+0]=e,this.int16[y+1]=n,this.uint16[y+2]=i,this.uint16[y+3]=r,this.uint32[v+2]=o,this.uint32[v+3]=a,this.uint32[v+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=c,this.uint16[y+12]=l,this.float32[v+7]=h,this.float32[v+8]=p,this.uint8[_+36]=f,this.uint8[_+37]=d,this.uint8[_+38]=A,this.uint32[v+10]=g,this.int16[y+22]=m,t},e}(rr);yr.prototype.bytesPerElement=48,di("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yr);var vr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x,w,E,T){var S=this.length;return this.resize(S+1),this.emplace(S,t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x,w,E,T)},e.prototype.emplace=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x,w,E,T,S){var P=30*t,M=15*t;return this.int16[P+0]=e,this.int16[P+1]=n,this.int16[P+2]=i,this.int16[P+3]=r,this.int16[P+4]=o,this.int16[P+5]=a,this.int16[P+6]=s,this.int16[P+7]=u,this.uint16[P+8]=c,this.uint16[P+9]=l,this.uint16[P+10]=h,this.uint16[P+11]=p,this.uint16[P+12]=f,this.uint16[P+13]=d,this.uint16[P+14]=A,this.uint16[P+15]=g,this.uint16[P+16]=m,this.uint16[P+17]=y,this.uint16[P+18]=v,this.uint16[P+19]=_,this.uint16[P+20]=b,this.uint16[P+21]=x,this.uint32[M+11]=w,this.float32[M+12]=E,this.float32[M+13]=T,this.float32[M+14]=S,t},e}(rr);vr.prototype.bytesPerElement=60,di("StructArrayLayout8i14ui1ul3f60",vr);var _r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.float32[n+0]=e,t},e}(rr);_r.prototype.bytesPerElement=4,di("StructArrayLayout1f4",_r);var br=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t},e}(rr);br.prototype.bytesPerElement=6,di("StructArrayLayout3i6",br);var xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=2*t,o=4*t;return this.uint32[r+0]=e,this.uint16[o+2]=n,this.uint16[o+3]=i,t},e}(rr);xr.prototype.bytesPerElement=8,di("StructArrayLayout1ul2ui8",xr);var wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t},e}(rr);wr.prototype.bytesPerElement=6,di("StructArrayLayout3ui6",wr);var Er=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t},e}(rr);Er.prototype.bytesPerElement=4,di("StructArrayLayout2ui4",Er);var Tr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint16[n+0]=e,t},e}(rr);Tr.prototype.bytesPerElement=2,di("StructArrayLayout1ui2",Tr);var Sr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t},e}(rr);Sr.prototype.bytesPerElement=8,di("StructArrayLayout2f8",Sr);var Pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,t},e}(rr);Pr.prototype.bytesPerElement=16,di("StructArrayLayout4f16",Pr);var Mr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.radius.get=function(){return this._structArray.int16[this._pos2+10]},n.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},n.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},n.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},n.anchorPoint.get=function(){return new r(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(ir);Mr.prototype.size=24;var Cr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Mr(this,t)},e}(Ar);di("CollisionBoxArray",Cr);var Ir=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},n.associatedIconIndex.set=function(t){this._structArray.int16[this._pos2+22]=t},Object.defineProperties(e.prototype,n),e}(ir);Ir.prototype.size=48;var Or=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Ir(this,t)},e}(yr);di("PlacedSymbolArray",Or);var Lr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.placedIconSymbolIndex.set=function(t){this._structArray.int16[this._pos2+6]=t},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.verticalPlacedIconSymbolIndex.set=function(t){this._structArray.int16[this._pos2+7]=t},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.key.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.verticalTextBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+13]=t},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+14]=t},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+15]=t},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.verticalIconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+16]=t},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.featureIndex.set=function(t){this._structArray.uint16[this._pos2+17]=t},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+18]=t},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+19]=t},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+20]=t},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.numVerticalIconVertices.set=function(t){this._structArray.uint16[this._pos2+21]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+11]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+11]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+12]},n.textBoxScale.set=function(t){this._structArray.float32[this._pos4+12]=t},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.set=function(t){this._structArray.float32[this._pos4+13]=t},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.set=function(t){this._structArray.float32[this._pos4+14]=t},Object.defineProperties(e.prototype,n),e}(ir);Lr.prototype.size=60;var Rr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Lr(this,t)},e}(vr);di("SymbolInstanceArray",Rr);var kr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={offsetX:{configurable:!0}};return n.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},n.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,n),e}(ir);kr.prototype.size=4;var Dr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new kr(this,t)},e}(_r);di("GlyphOffsetArray",Dr);var Br=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return n.x.get=function(){return this._structArray.int16[this._pos2+0]},n.x.set=function(t){this._structArray.int16[this._pos2+0]=t},n.y.get=function(){return this._structArray.int16[this._pos2+1]},n.y.set=function(t){this._structArray.int16[this._pos2+1]=t},n.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},n.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,n),e}(ir);Br.prototype.size=6;var Fr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new Br(this,t)},e}(br);di("SymbolLineVertexArray",Fr);var zr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,n),e}(ir);zr.prototype.size=8;var Nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new zr(this,t)},e}(xr);di("FeatureIndexArray",Nr);var jr=or([{name:"a_pos",components:2,type:"Int16"}],4).members,Ur=function(t){void 0===t&&(t=[]),this.segments=t};function Vr(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}Ur.prototype.prepareSegment=function(t,e,n,i){var r=this.segments[this.segments.length-1];return t>Ur.MAX_VERTEX_ARRAY_LENGTH&&x("Max vertices per segment is "+Ur.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!r||r.vertexLength+t>Ur.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r},Ur.prototype.get=function(){return this.segments},Ur.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var i in n.vaos)n.vaos[i].destroy()}},Ur.simpleSegment=function(t,e,n,i){return new Ur([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])},Ur.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,di("SegmentVector",Ur);var Gr=function(){this.ids=[],this.positions=[],this.indexed=!1};function Wr(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}Gr.prototype.add=function(t,e,n,i){this.ids.push(t),this.positions.push(e,n,i)},Gr.prototype.getPositions=function(t){for(var e=0,n=this.ids.length-1;e<n;){var i=e+n>>1;this.ids[i]>=t?n=i:e=i+1}for(var r=[];this.ids[e]===t;){var o=this.positions[3*e],a=this.positions[3*e+1],s=this.positions[3*e+2];r.push({index:o,start:a,end:s}),e++}return r},Gr.serialize=function(t,e){var n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return function t(e,n,i,r){if(!(i>=r)){for(var o=e[i+r>>1],a=i-1,s=r+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;Wr(e,a,s),Wr(n,3*a,3*s),Wr(n,3*a+1,3*s+1),Wr(n,3*a+2,3*s+2)}t(e,n,i,s),t(e,n,s+1,r)}}(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}},Gr.deserialize=function(t){var e=new Gr;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},di("FeaturePositionMap",Gr);var Hr=function(t,e){this.gl=t.gl,this.location=e},qr=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(Hr),Xr=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(Hr),Zr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(Hr),Qr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(Hr),Yr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(Hr),Kr=function(t){function e(e,n){t.call(this,e,n),this.current=Yt.transparent}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(Hr),Jr=new Float32Array(16),$r=function(t){function e(e,n){t.call(this,e,n),this.current=Jr}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Hr);function to(t){return[Vr(255*t.r,255*t.g),Vr(255*t.b,255*t.a)]}var eo=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map((function(t){return"u_"+t})),this.type=n,this.maxValue=-1/0};eo.prototype.defines=function(){return this.names.map((function(t){return"#define HAS_UNIFORM_u_"+t}))},eo.prototype.setConstantPatternPositions=function(){},eo.prototype.populatePaintArray=function(){},eo.prototype.updatePaintArray=function(){},eo.prototype.upload=function(){},eo.prototype.destroy=function(){},eo.prototype.setUniforms=function(t,e,n,i){e.set(i.constantOr(this.value))},eo.prototype.getBinding=function(t,e){return"color"===this.type?new Kr(t,e):new Xr(t,e)},eo.serialize=function(t){var e=t.value,n=t.names,i=t.type;return{value:mi(e),names:n,type:i}},eo.deserialize=function(t){var e=t.value,n=t.names,i=t.type;return new eo(yi(e),n,i)};var no=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map((function(t){return"u_"+t})),this.type=n,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};no.prototype.defines=function(){return this.names.map((function(t){return"#define HAS_UNIFORM_u_"+t}))},no.prototype.populatePaintArray=function(){},no.prototype.updatePaintArray=function(){},no.prototype.upload=function(){},no.prototype.destroy=function(){},no.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},no.prototype.setUniforms=function(t,e,n,i,r){var o=this.patternPositions;"u_pattern_to"===r&&o.patternTo&&e.set(o.patternTo),"u_pattern_from"===r&&o.patternFrom&&e.set(o.patternFrom)},no.prototype.getBinding=function(t,e){return new Yr(t,e)};var io=function(t,e,n,i){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map((function(t){return"a_"+t})),this.maxValue=-1/0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new i};io.prototype.defines=function(){return[]},io.prototype.setConstantPatternPositions=function(){},io.prototype.populatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,o=r.length;r.reserve(t);var a=this.expression.evaluate(new ji(0),e,{},[],i);if("color"===this.type)for(var s=to(a),u=o;u<t;u++)r.emplaceBack(s[0],s[1]);else{for(var c=o;c<t;c++)r.emplaceBack(a);this.maxValue=Math.max(this.maxValue,a)}},io.prototype.updatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,o=this.expression.evaluate({zoom:0},n,i);if("color"===this.type)for(var a=to(o),s=t;s<e;s++)r.emplace(s,a[0],a[1]);else{for(var u=t;u<e;u++)r.emplace(u,o);this.maxValue=Math.max(this.maxValue,o)}},io.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},io.prototype.setUniforms=function(t,e){e.set(0)},io.prototype.getBinding=function(t,e){return new Xr(t,e)};var ro=function(t,e,n,i,r,o){this.expression=t,this.names=e,this.uniformNames=this.names.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=-1/0;var a=o;this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new a};ro.prototype.defines=function(){return[]},ro.prototype.setConstantPatternPositions=function(){},ro.prototype.populatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,o=r.length;r.reserve(t);var a=this.expression.evaluate(new ji(this.zoom),e,{},[],i),s=this.expression.evaluate(new ji(this.zoom+1),e,{},[],i);if("color"===this.type)for(var u=to(a),c=to(s),l=o;l<t;l++)r.emplaceBack(u[0],u[1],c[0],c[1]);else{for(var h=o;h<t;h++)r.emplaceBack(a,s);this.maxValue=Math.max(this.maxValue,a,s)}},ro.prototype.updatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,o=this.expression.evaluate({zoom:this.zoom},n,i),a=this.expression.evaluate({zoom:this.zoom+1},n,i);if("color"===this.type)for(var s=to(o),u=to(a),c=t;c<e;c++)r.emplace(c,s[0],s[1],u[0],u[1]);else{for(var l=t;l<e;l++)r.emplace(l,o,a);this.maxValue=Math.max(this.maxValue,o,a)}},ro.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ro.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ro.prototype.interpolationFactor=function(t){return this.useIntegerZoom&&(t=Math.floor(t)),c(this.expression.interpolationFactor(t,this.zoom,this.zoom+1),0,1)},ro.prototype.setUniforms=function(t,e,n){e.set(this.interpolationFactor(n.zoom))},ro.prototype.getBinding=function(t,e){return new Xr(t,e)};var oo=function(t,e,n,i,r,o,a){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map((function(t){return"u_"+t+"_t"})),this.useIntegerZoom=i,this.zoom=r,this.maxValue=-1/0,this.layerId=a,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}})),this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o};oo.prototype.defines=function(){return[]},oo.prototype.setConstantPatternPositions=function(){},oo.prototype.populatePaintArray=function(t,e,n){var i=this.zoomInPaintVertexArray,r=this.zoomOutPaintVertexArray,o=this.layerId,a=i.length;if(i.reserve(t),r.reserve(t),n&&e.patterns&&e.patterns[o]){var s=e.patterns[o],u=s.min,c=s.mid,l=s.max,h=n[u],p=n[c],f=n[l];if(!h||!p||!f)return;for(var d=a;d<t;d++)i.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1]),r.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1])}},oo.prototype.updatePaintArray=function(t,e,n,i,r){var o=this.zoomInPaintVertexArray,a=this.zoomOutPaintVertexArray,s=this.layerId;if(r&&n.patterns&&n.patterns[s]){var u=n.patterns[s],c=u.min,l=u.mid,h=u.max,p=r[c],f=r[l],d=r[h];if(!p||!f||!d)return;for(var A=t;A<e;A++)o.emplace(A,f.tl[0],f.tl[1],f.br[0],f.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1]),a.emplace(A,f.tl[0],f.tl[1],f.br[0],f.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1])}},oo.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},oo.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},oo.prototype.setUniforms=function(t,e){e.set(0)},oo.prototype.getBinding=function(t,e){return new Xr(t,e)};var ao=function(){this.binders={},this.cacheKey="",this._buffers=[]};ao.createDynamic=function(t,e,n){var i=new ao,r=[];for(var o in t.paint._values)if(n(o)){var a=t.paint.get(o);if(a instanceof Xi&&pn(a.property.specification)){var s=uo(o,t.type),u=a.property.specification.type,c=a.property.useIntegerZoom;if("cross-faded"===a.property.specification["property-type"]||"cross-faded-data-driven"===a.property.specification["property-type"])if("constant"===a.value.kind)i.binders[o]=new no(a.value.value,s,u),r.push("/u_"+o);else{var l=co(o,u,"source");i.binders[o]=new oo(a.value,s,u,c,e,l,t.id),r.push("/a_"+o)}else if("constant"===a.value.kind)i.binders[o]=new eo(a.value.value,s,u),r.push("/u_"+o);else if("source"===a.value.kind){var h=co(o,u,"source");i.binders[o]=new io(a.value,s,u,h),r.push("/a_"+o)}else{var p=co(o,u,"composite");i.binders[o]=new ro(a.value,s,u,c,e,p),r.push("/z_"+o)}}}return i.cacheKey=r.sort().join(""),i},ao.prototype.populatePaintArrays=function(t,e,n,i,r){for(var o in this.binders)this.binders[o].populatePaintArray(t,e,i,r)},ao.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders)this.binders[n].setConstantPatternPositions(t,e)},ao.prototype.updatePaintArrays=function(t,e,n,i,r){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(+a);s<u.length;s+=1){var c=u[s],l=n.feature(c.index);for(var h in this.binders){var p=this.binders[h];if(!(p instanceof eo||p instanceof no)&&!0===p.expression.isStateDependent){var f=i.paint.get(h);p.expression=f.value,p.updatePaintArray(c.start,c.end,l,t[a],r),o=!0}}}return o},ao.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},ao.prototype.getPaintVertexBuffers=function(){return this._buffers},ao.prototype.getUniforms=function(t,e){var n=[];for(var i in this.binders)for(var r=this.binders[i],o=0,a=r.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=r.getBinding(t,e[s]);n.push({name:s,property:i,binding:u})}}return n},ao.prototype.setUniforms=function(t,e,n,i){for(var r=0,o=e;r<o.length;r+=1){var a=o[r],s=a.name,u=a.property,c=a.binding;this.binders[u].setUniforms(t,c,i,n.get(u),s)}},ao.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof oo){var r=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;r&&e.push(r)}else(i instanceof io||i instanceof ro)&&i.paintVertexBuffer&&e.push(i.paintVertexBuffer)}this._buffers=e},ao.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var n=[];for(var i in this.binders){var r=this.binders[i];(r instanceof io||r instanceof ro)&&r.paintVertexBuffer&&n.push(r.paintVertexBuffer)}this._buffers=n},ao.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var so=function(t,e,n,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var r=0,o=e;r<o.length;r+=1){var a=o[r];this.programConfigurations[a.id]=ao.createDynamic(a,n,i),this.programConfigurations[a.id].layoutAttributes=t}this.needsUpload=!1,this._featureMap=new Gr,this._bufferOffset=0};function uo(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function co(t,e,n){var i={color:{source:Sr,composite:Pr},number:{source:_r,composite:Sr}},r=function(t){return{"line-pattern":{source:hr,composite:hr},"fill-pattern":{source:hr,composite:hr},"fill-extrusion-pattern":{source:hr,composite:hr}}[t]}(t);return r&&r[n]||i[e][n]}so.prototype.populatePaintArrays=function(t,e,n,i,r){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,n,i,r);void 0!==e.id&&this._featureMap.add(+e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},so.prototype.updatePaintArrays=function(t,e,n,i){for(var r=0,o=n;r<o.length;r+=1){var a=o[r];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,i)||this.needsUpload}},so.prototype.get=function(t){return this.programConfigurations[t]},so.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},so.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},di("ConstantBinder",eo),di("CrossFadedConstantBinder",no),di("SourceExpressionBinder",io),di("CrossFadedCompositeBinder",oo),di("CompositeExpressionBinder",ro),di("ProgramConfiguration",ao,{omit:["_buffers"]}),di("ProgramConfigurationSet",so);var lo=8192,ho={min:-1*Math.pow(2,14),max:Math.pow(2,14)-1};function po(t){for(var e=lo/t.extent,n=t.loadGeometry(),i=0;i<n.length;i++)for(var r=n[i],o=0;o<r.length;o++){var a=r[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<ho.min||a.x>ho.max||a.y<ho.min||a.y>ho.max)&&(x("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a.x=c(a.x,ho.min,ho.max),a.y=c(a.y,ho.min,ho.max))}return n}function fo(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}var Ao=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new sr,this.indexArray=new wr,this.segments=new Ur,this.programConfigurations=new so(jr,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function go(t,e){for(var n=0;n<t.length;n++)if(To(e,t[n]))return!0;for(var i=0;i<e.length;i++)if(To(t,e[i]))return!0;return!!_o(t,e)}function mo(t,e,n){return!!To(t,e)||!!xo(e,t,n)}function yo(t,e){if(1===t.length)return Eo(e,t[0]);for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)if(To(t,i[r]))return!0;for(var o=0;o<t.length;o++)if(Eo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(_o(t,e[a]))return!0;return!1}function vo(t,e,n){if(t.length>1){if(_o(t,e))return!0;for(var i=0;i<e.length;i++)if(xo(e[i],t,n))return!0}for(var r=0;r<t.length;r++)if(xo(t[r],e,n))return!0;return!1}function _o(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var i=t[n],r=t[n+1],o=0;o<e.length-1;o++)if(bo(i,r,e[o],e[o+1]))return!0;return!1}function bo(t,e,n,i){return w(t,n,i)!==w(e,n,i)&&w(t,e,n)!==w(t,e,i)}function xo(t,e,n){var i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(var r=1;r<e.length;r++)if(wo(t,e[r-1],e[r])<i)return!0;return!1}function wo(t,e,n){var i=e.distSqr(n);if(0===i)return t.distSqr(e);var r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return r<0?t.distSqr(e):r>1?t.distSqr(n):t.distSqr(n.sub(e)._mult(r)._add(e))}function Eo(t,e){for(var n,i,r,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)i=n[s],r=n[u],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(o=!o);return o}function To(t,e){for(var n=!1,i=0,r=t.length-1;i<t.length;r=i++){var o=t[i],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function So(t,e,n){var i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;var o=w(t,e,n[0]);return o!==w(t,e,n[1])||o!==w(t,e,n[2])||o!==w(t,e,n[3])}function Po(t,e,n){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).binders[t].maxValue}function Mo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Co(t,e,n,i,o){if(!e[0]&&!e[1])return t;var a=r.convert(e)._mult(o);"viewport"===n&&a._rotate(-i);for(var s=[],u=0;u<t.length;u++){var c=t[u];s.push(c.sub(a))}return s}Ao.prototype.populate=function(t,e){var n=this.layers[0],i=[],r=null;"circle"===n.type&&(r=n.layout.get("circle-sort-key"));for(var o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,c=s.index,l=s.sourceLayerIndex;if(this.layers[0]._featureFilter(new ji(this.zoom),u)){var h=po(u),p=r?r.evaluate(u,{}):void 0,f={id:u.id,properties:u.properties,type:u.type,sourceLayerIndex:l,index:c,geometry:h,patterns:{},sortKey:p};i.push(f)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var d=0,A=i;d<A.length;d+=1){var g=A[d],m=g,y=m.geometry,v=m.index,_=m.sourceLayerIndex,b=t[v].feature;this.addFeature(g,y,v),e.featureIndex.insert(b,y,v,_,this.index)}},Ao.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ao.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ao.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ao.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ao.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ao.prototype.addFeature=function(t,e,n){for(var i=0,r=e;i<r.length;i+=1)for(var o=0,a=r[i];o<a.length;o+=1){var s=a[o],u=s.x,c=s.y;if(!(u<0||u>=lo||c<0||c>=lo)){var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),h=l.vertexLength;fo(this.layoutVertexArray,u,c,-1,-1),fo(this.layoutVertexArray,u,c,1,-1),fo(this.layoutVertexArray,u,c,1,1),fo(this.layoutVertexArray,u,c,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),l.vertexLength+=4,l.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{})},di("CircleBucket",Ao,{omit:["layers"]});var Io,Oo=new tr({"circle-sort-key":new Yi(Pt.layout_circle["circle-sort-key"])}),Lo={paint:new tr({"circle-radius":new Yi(Pt.paint_circle["circle-radius"]),"circle-color":new Yi(Pt.paint_circle["circle-color"]),"circle-blur":new Yi(Pt.paint_circle["circle-blur"]),"circle-opacity":new Yi(Pt.paint_circle["circle-opacity"]),"circle-translate":new Qi(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new Qi(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qi(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qi(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yi(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yi(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yi(Pt.paint_circle["circle-stroke-opacity"])}),layout:Oo},Ro="undefined"!=typeof Float32Array?Float32Array:Array;function ko(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)}),Io=new Ro(3),Ro!=Float32Array&&(Io[0]=0,Io[1]=0,Io[2]=0),function(){var t=new Ro(4);Ro!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Do=function(t){function e(e){t.call(this,e,Lo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ao(t)},e.prototype.queryRadius=function(t){var e=t;return Po("circle-radius",this,e)+Po("circle-stroke-width",this,e)+Mo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,o,a,s){for(var u=Co(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),c=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),l="map"===this.paint.get("circle-pitch-alignment"),h=l?u:function(t,e){return t.map((function(t){return Bo(t,e)}))}(u,s),p=l?c*a:c,f=0,d=i;f<d.length;f+=1)for(var A=0,g=d[f];A<g.length;A+=1){var m=g[A],y=l?m:Bo(m,s),v=p,_=ko([],[m.x,m.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=_[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=o.cameraToCenterDistance/_[3]),mo(h,y,v))return!0}return!1},e}(er);function Bo(t,e){var n=ko([],[t.x,t.y,0,1],e);return new r(n[0]/n[3],n[1]/n[3])}var Fo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ao);function zo(t,e,n,i){var r=e.width,o=e.height;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return t.width=r,t.height=o,t.data=i,t}function No(t,e,n){var i=e.width,r=e.height;if(i!==t.width||r!==t.height){var o=zo({},{width:i,height:r},n);jo(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=o.data}}function jo(t,e,n,i,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<r.height;u++)for(var c=((n.y+u)*t.width+n.x)*o,l=((i.y+u)*e.width+i.x)*o,h=0;h<r.width*o;h++)s[l+h]=a[c+h];return e}di("HeatmapBucket",Fo,{omit:["layers"]});var Uo=function(t,e){zo(this,t,1,e)};Uo.prototype.resize=function(t){No(this,t,1)},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(t,e,n,i,r){jo(t,e,n,i,r,1)};var Vo=function(t,e){zo(this,t,4,e)};Vo.prototype.resize=function(t){No(this,t,4)},Vo.prototype.replace=function(t,e){e?this.data.set(t):t instanceof Uint8ClampedArray?this.data=new Uint8Array(t.buffer):this.data=t},Vo.prototype.clone=function(){return new Vo({width:this.width,height:this.height},new Uint8Array(this.data))},Vo.copy=function(t,e,n,i,r){jo(t,e,n,i,r,4)},di("AlphaImage",Uo),di("RGBAImage",Vo);var Go={paint:new tr({"heatmap-radius":new Yi(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yi(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qi(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $i(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qi(Pt.paint_heatmap["heatmap-opacity"])})};function Wo(t,e){for(var n=new Uint8Array(1024),i={},r=0,o=0;r<256;r++,o+=4){i[e]=r/255;var a=t.evaluate(i);n[o+0]=Math.floor(255*a.r/a.a),n[o+1]=Math.floor(255*a.g/a.a),n[o+2]=Math.floor(255*a.b/a.a),n[o+3]=Math.floor(255*a.a)}return new Vo({width:256,height:1},n)}var Ho=function(t){function e(e){t.call(this,e,Go),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Fo(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Wo(t,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(er),qo={paint:new tr({"hillshade-illumination-direction":new Qi(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qi(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qi(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qi(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qi(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qi(Pt.paint_hillshade["hillshade-accent-color"])})},Xo=function(t){function e(e){t.call(this,e,qo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(er),Zo=or([{name:"a_pos",components:2,type:"Int16"}],4).members,Qo=Ko,Yo=Ko;function Ko(t,e,n){n=n||2;var i,r,o,a,s,u,c,l=e&&e.length,h=l?e[0]*n:t.length,p=Jo(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(l&&(p=function(t,e,n,i){var r,o,a,s=[];for(r=0,o=e.length;r<o;r++)(a=Jo(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),s.push(ca(a));for(s.sort(oa),r=0;r<s.length;r++)aa(s[r],n),n=$o(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=o=t[0],r=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(u=t[d+1])<r&&(r=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-i,a-r))?1/c:0}return ta(p,f,n,i,r,c),f}function Jo(t,e,n,i,r){var o,a;if(r===xa(t,e,n,i)>0)for(o=e;o<n;o+=i)a=va(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=va(o,t[o],t[o+1],a);return a&&fa(a,a.next)&&(_a(a),a=a.next),a}function $o(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!fa(i,i.next)&&0!==pa(i.prev,i,i.next))i=i.next;else{if(_a(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function ta(t,e,n,i,r,o,a){if(t){!a&&o&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=ua(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<c&&(s++,i=i.nextZ);e++);for(u=c;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?na(t,i,r,o):ea(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),_a(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?ta(t=ia($o(t),e,n),e,n,i,r,o,2):2===a&&ra(t,e,n,i,r,o):ta($o(t),e,n,i,r,o,1);break}}}function ea(t){var e=t.prev,n=t,i=t.next;if(pa(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(la(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&pa(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function na(t,e,n,i){var r=t.prev,o=t,a=t.next;if(pa(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,u=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,l=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=ua(s,u,e,n,i),p=ua(c,l,e,n,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&la(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&pa(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&la(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&pa(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&la(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&pa(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&la(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&pa(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ia(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!fa(r,o)&&da(r,i,i.next,o)&&ma(r,o)&&ma(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),_a(i),_a(i.next),i=t=o),i=i.next}while(i!==t);return $o(i)}function ra(t,e,n,i,r,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ha(a,s)){var u=ya(a,s);return a=$o(a,a.next),u=$o(u,u.next),ta(a,e,n,i,r,o),void ta(u,e,n,i,r,o)}s=s.next}a=a.next}while(a!==t)}function oa(t,e){return t.x-e.x}function aa(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n;var u,c=n,l=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&la(o<h?r:a,o,l,h,o<h?a:r,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(r-i.x),ma(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&sa(n,i)))&&(n=i,p=u)),i=i.next}while(i!==c);return n}(t,e)){var n=ya(e,t);$o(n,n.next)}}function sa(t,e){return pa(t.prev,t,e.prev)<0&&pa(e.next,t,t.next)<0}function ua(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ca(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function la(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function ha(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&da(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ma(t,e)&&ma(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(pa(t.prev,t,e.prev)||pa(t,e.prev,e))||fa(t,e)&&pa(t.prev,t,t.next)>0&&pa(e.prev,e,e.next)>0)}function pa(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function fa(t,e){return t.x===e.x&&t.y===e.y}function da(t,e,n,i){var r=ga(pa(t,e,n)),o=ga(pa(t,e,i)),a=ga(pa(n,i,t)),s=ga(pa(n,i,e));return r!==o&&a!==s||!(0!==r||!Aa(t,n,e))||!(0!==o||!Aa(t,i,e))||!(0!==a||!Aa(n,t,i))||!(0!==s||!Aa(n,e,i))}function Aa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ga(t){return t>0?1:t<0?-1:0}function ma(t,e){return pa(t.prev,t,t.next)<0?pa(t,e,t.next)>=0&&pa(t,t.prev,e)>=0:pa(t,e,t.prev)<0||pa(t,t.next,e)<0}function ya(t,e){var n=new ba(t.i,t.x,t.y),i=new ba(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function va(t,e,n,i){var r=new ba(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _a(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ba(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xa(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}function wa(t,e,n,i,r){!function t(e,n,i,r,o){for(;r>i;){if(r-i>600){var a=r-i+1,s=n-i+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(i,Math.floor(n-s*c/a+l)),Math.min(r,Math.floor(n+(a-s)*c/a+l)),o)}var h=e[n],p=i,f=r;for(Ea(e,i,n),o(e[r],h)>0&&Ea(e,i,r);p<f;){for(Ea(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[i],h)?Ea(e,i,f):Ea(e,++f,r),f<=n&&(i=f+1),n<=f&&(r=f-1)}}(t,e,n||0,i||t.length-1,r||Ta)}function Ea(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function Ta(t,e){return t<e?-1:t>e?1:0}function Sa(t,e){var n=t.length;if(n<=1)return[t];for(var i,r,o=[],a=0;a<n;a++){var s=E(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(i&&o.push(i),i=[t[a]]):i.push(t[a]))}if(i&&o.push(i),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(wa(o[u],e,1,o[u].length-1,Pa),o[u]=o[u].slice(0,e));return o}function Pa(t,e){return e.area-t.area}function Ma(t,e,n){for(var i=n.patternDependencies,r=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(r=!0);var u=s.constantOr(null);u&&(r=!0,i[u.to]=!0,i[u.from]=!0)}return r}function Ca(t,e,n,i,r){for(var o=r.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.paint.get(t+"-pattern").value;if("constant"!==c.kind){var l=c.evaluate({zoom:i-1},n,{},r.availableImages),h=c.evaluate({zoom:i},n,{},r.availableImages),p=c.evaluate({zoom:i+1},n,{},r.availableImages);l=l&&l.name?l.name:l,h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[l]=!0,o[h]=!0,o[p]=!0,n.patterns[u.id]={min:l,mid:h,max:p}}}return n}Ko.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,a=Math.abs(xa(t,0,o,n));if(r)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(xa(t,c,l,n))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,f=i[s+1]*n,d=i[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},Ko.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[r][o][a]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n},Qo.default=Yo;var Ia=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sr,this.indexArray=new wr,this.indexArray2=new Er,this.programConfigurations=new so(Zo,t.layers,t.zoom),this.segments=new Ur,this.segments2=new Ur,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ia.prototype.populate=function(t,e){this.hasPattern=Ma("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),i=[],r=0,o=t;r<o.length;r+=1){var a=o[r],s=a.feature,u=a.index,c=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new ji(this.zoom),s)){var l=po(s),h=n?n.evaluate(s,{},e.availableImages):void 0,p={id:s.id,properties:s.properties,type:s.type,sourceLayerIndex:c,index:u,geometry:l,patterns:{},sortKey:h};i.push(p)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var f=0,d=i;f<d.length;f+=1){var A=d[f],g=A,m=g.geometry,y=g.index,v=g.sourceLayerIndex;if(this.hasPattern){var _=Ca("fill",this.layers,A,this.zoom,e);this.patternFeatures.push(_)}else this.addFeature(A,m,y,{});var b=t[y].feature;e.featureIndex.insert(b,m,y,v,this.index)}},Ia.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ia.prototype.addFeatures=function(t,e){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var r=i[n];this.addFeature(r,r.geometry,r.index,e)}},Ia.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ia.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ia.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zo),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ia.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ia.prototype.addFeature=function(t,e,n,i){for(var r=0,o=Sa(e,500);r<o.length;r+=1){for(var a=o[r],s=0,u=0,c=a;u<c.length;u+=1)s+=c[u].length;for(var l=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=l.vertexLength,p=[],f=[],d=0,A=a;d<A.length;d+=1){var g=A[d];if(0!==g.length){g!==a[0]&&f.push(p.length/2);var m=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),y=m.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(y+g.length-1,y),p.push(g[0].x),p.push(g[0].y);for(var v=1;v<g.length;v++)this.layoutVertexArray.emplaceBack(g[v].x,g[v].y),this.indexArray2.emplaceBack(y+v-1,y+v),p.push(g[v].x),p.push(g[v].y);m.vertexLength+=g.length,m.primitiveLength+=g.length}}for(var _=Qo(p,f),b=0;b<_.length;b+=3)this.indexArray.emplaceBack(h+_[b],h+_[b+1],h+_[b+2]);l.vertexLength+=s,l.primitiveLength+=_.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i)},di("FillBucket",Ia,{omit:["layers","patternFeatures"]});var Oa=new tr({"fill-sort-key":new Yi(Pt.layout_fill["fill-sort-key"])}),La={paint:new tr({"fill-antialias":new Qi(Pt.paint_fill["fill-antialias"]),"fill-opacity":new Yi(Pt.paint_fill["fill-opacity"]),"fill-color":new Yi(Pt.paint_fill["fill-color"]),"fill-outline-color":new Yi(Pt.paint_fill["fill-outline-color"]),"fill-translate":new Qi(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new Qi(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ki(Pt.paint_fill["fill-pattern"])}),layout:Oa},Ra=function(t){function e(e){t.call(this,e,La)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new Ia(t)},e.prototype.queryRadius=function(){return Mo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,o,a){return yo(Co(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),i)},e.prototype.isTileClipped=function(){return!0},e}(er),ka=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Da=Ba;function Ba(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(Fa,this,e)}function Fa(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function za(t){for(var e,n,i=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],i+=((n=t[a]).x-e.x)*(e.y+n.y);return i}Ba.types=["Unknown","Point","LineString","Polygon"],Ba.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},Ba.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;t.pos<e;){if(i<=0){var l=t.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<a&&(a=r),r>s&&(s=r),(o+=t.readSVarint())<u&&(u=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,c]},Ba.prototype.toGeoJSON=function(t,e,n){var i,r,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),c=Ba.types[this.type];function l(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+s)/o;t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<u.length;i++)h[i]=u[i][0];l(u=h);break;case 2:for(i=0;i<u.length;i++)l(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],o=0;o<e;o++){var a=za(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(n&&r.push(n),n=[t[o]]):n.push(t[o]))}return n&&r.push(n),r}(u),i=0;i<u.length;i++)for(r=0;r<u[i].length;r++)l(u[i][r])}1===u.length?u=u[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Na=ja;function ja(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ua,this,e),this.length=this._features.length}function Ua(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}function Va(t,e,n){if(3===t){var i=new Na(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}ja.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Da(this._pbf,e,this.extent,this._keys,this._values)};var Ga={VectorTile:function(t,e){this.layers=t.readFields(Va,{},e)},VectorTileFeature:Da,VectorTileLayer:Na},Wa=Ga.VectorTileFeature.types,Ha=Math.pow(2,13);function qa(t,e,n,i,r,o,a,s){t.emplaceBack(e,n,2*Math.floor(i*Ha)+a,r*Ha*2,o*Ha*2,Math.round(s))}var Xa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new cr,this.indexArray=new wr,this.programConfigurations=new so(ka,t.layers,t.zoom),this.segments=new Ur,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Za(t,e){return t.x===e.x&&(t.x<0||t.x>lo)||t.y===e.y&&(t.y<0||t.y>lo)}function Qa(t){return t.every((function(t){return t.x<0}))||t.every((function(t){return t.x>lo}))||t.every((function(t){return t.y<0}))||t.every((function(t){return t.y>lo}))}Xa.prototype.populate=function(t,e){this.features=[],this.hasPattern=Ma("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter(new ji(this.zoom),o)){var u=po(o),c={sourceLayerIndex:s,index:a,geometry:u,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(c.id=o.id),this.hasPattern?this.features.push(Ca("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,u,a,{}),e.featureIndex.insert(o,u,a,s,this.index,!0)}}},Xa.prototype.addFeatures=function(t,e){for(var n=0,i=this.features;n<i.length;n+=1){var r=i[n],o=r.geometry;this.addFeature(r,o,r.index,e)}},Xa.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Xa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Xa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ka),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Xa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xa.prototype.addFeature=function(t,e,n,i){for(var r=0,o=Sa(e,500);r<o.length;r+=1){for(var a=o[r],s=0,u=0,c=a;u<c.length;u+=1)s+=c[u].length;for(var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,p=a;h<p.length;h+=1){var f=p[h];if(0!==f.length&&!Qa(f))for(var d=0,A=0;A<f.length;A++){var g=f[A];if(A>=1){var m=f[A-1];if(!Za(g,m)){l.vertexLength+4>Ur.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=g.sub(m)._perp()._unit(),v=m.dist(g);d+v>32768&&(d=0),qa(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,0,d),qa(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,1,d),d+=v,qa(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,d),qa(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,d);var _=l.vertexLength;this.indexArray.emplaceBack(_,_+2,_+1),this.indexArray.emplaceBack(_+1,_+2,_+3),l.vertexLength+=4,l.primitiveLength+=2}}}}if(l.vertexLength+s>Ur.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===Wa[t.type]){for(var b=[],x=[],w=l.vertexLength,E=0,T=a;E<T.length;E+=1){var S=T[E];if(0!==S.length){S!==a[0]&&x.push(b.length/2);for(var P=0;P<S.length;P++){var M=S[P];qa(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),b.push(M.x),b.push(M.y)}}}for(var C=Qo(b,x),I=0;I<C.length;I+=3)this.indexArray.emplaceBack(w+C[I],w+C[I+2],w+C[I+1]);l.primitiveLength+=C.length/3,l.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i)},di("FillExtrusionBucket",Xa,{omit:["layers","features"]});var Ya={paint:new tr({"fill-extrusion-opacity":new Qi(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yi(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qi(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qi(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ki(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yi(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yi(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qi(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ka=function(t){function e(e){t.call(this,e,Ya)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Xa(t)},e.prototype.queryRadius=function(){return Mo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,i,o,a,s,u){var c=Co(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),l=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),p=function(t,e,n,i){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],c=[u.x,u.y,0,1];ko(c,c,e),o.push(new r(c[0]/c[3],c[1]/c[3]))}return o}(c,u),f=function(t,e,n,i){for(var o=[],a=[],s=i[8]*e,u=i[9]*e,c=i[10]*e,l=i[11]*e,h=i[8]*n,p=i[9]*n,f=i[10]*n,d=i[11]*n,A=0,g=t;A<g.length;A+=1){for(var m=[],y=[],v=0,_=g[A];v<_.length;v+=1){var b=_[v],x=b.x,w=b.y,E=i[0]*x+i[4]*w+i[12],T=i[1]*x+i[5]*w+i[13],S=i[2]*x+i[6]*w+i[14],P=i[3]*x+i[7]*w+i[15],M=S+c,C=P+l,I=E+h,O=T+p,L=S+f,R=P+d,k=new r((E+s)/C,(T+u)/C);k.z=M/C,m.push(k);var D=new r(I/R,O/R);D.z=L/R,y.push(D)}o.push(m),a.push(y)}return[o,a]}(i,h,l,u);return function(t,e,n){var i=1/0;yo(n,e)&&(i=$a(n,e[0]));for(var r=0;r<e.length;r++)for(var o=e[r],a=t[r],s=0;s<o.length-1;s++){var u=o[s],c=o[s+1],l=a[s],h=[u,c,a[s+1],l,u];go(n,h)&&(i=Math.min(i,$a(n,h)))}return i!==1/0&&i}(f[0],f[1],p)},e}(er);function Ja(t,e){return t.x*e.x+t.y*e.y}function $a(t,e){if(1===t.length){var n=e[0],i=e[1],r=e[3],o=t[0],a=i.sub(n),s=r.sub(n),u=o.sub(n),c=Ja(a,a),l=Ja(a,s),h=Ja(s,s),p=Ja(u,a),f=Ja(u,s),d=c*h-l*l,A=(h*p-l*f)/d,g=(c*f-l*p)/d,m=1-A-g;return n.z*m+i.z*A+r.z*g}for(var y=1/0,v=0,_=e;v<_.length;v+=1){var b=_[v];y=Math.min(y,b.z)}return y}var ts=or([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,es=Ga.VectorTileFeature.types,ns=Math.cos(Math.PI/180*37.5),is=Math.pow(2,14)/.5,rs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new lr,this.indexArray=new wr,this.programConfigurations=new so(ts,t.layers,t.zoom),this.segments=new Ur,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};rs.prototype.populate=function(t,e){this.hasPattern=Ma("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),i=[],r=0,o=t;r<o.length;r+=1){var a=o[r],s=a.feature,u=a.index,c=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new ji(this.zoom),s)){var l=po(s),h=n?n.evaluate(s,{}):void 0,p={id:s.id,properties:s.properties,type:s.type,sourceLayerIndex:c,index:u,geometry:l,patterns:{},sortKey:h};i.push(p)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var f=0,d=i;f<d.length;f+=1){var A=d[f],g=A,m=g.geometry,y=g.index,v=g.sourceLayerIndex;if(this.hasPattern){var _=Ca("line",this.layers,A,this.zoom,e);this.patternFeatures.push(_)}else this.addFeature(A,m,y,{});var b=t[y].feature;e.featureIndex.insert(b,m,y,v,this.index)}},rs.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},rs.prototype.addFeatures=function(t,e){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var r=i[n];this.addFeature(r,r.geometry,r.index,e)}},rs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},rs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ts),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},rs.prototype.addFeature=function(t,e,n,i){for(var r=this.layers[0].layout,o=r.get("line-join").evaluate(t,{}),a=r.get("line-cap"),s=r.get("line-miter-limit"),u=r.get("line-round-limit"),c=0,l=e;c<l.length;c+=1){var h=l[c];this.addLine(h,t,o,a,s,u,n,i)}},rs.prototype.addLine=function(t,e,n,i,r,o,a,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(var u=0;u<t.length-1;u++)this.totalDistance+=t[u].dist(t[u+1])}for(var c="Polygon"===es[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var h=0;h<l-1&&t[h].equals(t[h+1]);)h++;if(!(l<(c?3:2))){"bevel"===n&&(r=1.05);var p,f=this.overscaling<=16?15*lo/(512*this.overscaling):0,d=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),A=void 0,g=void 0,m=void 0,y=void 0;this.e1=this.e2=-1,c&&(p=t[l-2],y=t[h].sub(p)._unit()._perp());for(var v=h;v<l;v++)if(!(g=c&&v===l-1?t[h+1]:t[v+1])||!t[v].equals(g)){y&&(m=y),p&&(A=p),p=t[v],y=g?g.sub(p)._unit()._perp():m;var _=(m=m||y).add(y);0===_.x&&0===_.y||_._unit();var b=m.x*y.x+m.y*y.y,x=_.x*y.x+_.y*y.y,w=0!==x?1/x:1/0,E=2*Math.sqrt(2-2*x),T=x<ns&&A&&g,S=m.x*y.y-m.y*y.x>0;if(T&&v>h){var P=p.dist(A);if(P>2*f){var M=p.sub(p.sub(A)._mult(f/P)._round());this.updateDistance(A,M),this.addCurrentVertex(M,m,0,0,d),A=M}}var C=A&&g,I=C?n:c?"butt":i;if(C&&"round"===I&&(w<o?I="miter":w<=2&&(I="fakeround")),"miter"===I&&w>r&&(I="bevel"),"bevel"===I&&(w>2&&(I="flipbevel"),w<r&&(I="miter")),A&&this.updateDistance(A,p),"miter"===I)_._mult(w),this.addCurrentVertex(p,_,0,0,d);else if("flipbevel"===I){if(w>100)_=y.mult(-1);else{var O=w*m.add(y).mag()/m.sub(y).mag();_._perp()._mult(O*(S?-1:1))}this.addCurrentVertex(p,_,0,0,d),this.addCurrentVertex(p,_.mult(-1),0,0,d)}else if("bevel"===I||"fakeround"===I){var L=-Math.sqrt(w*w-1),R=S?L:0,k=S?0:L;if(A&&this.addCurrentVertex(p,m,R,k,d),"fakeround"===I)for(var D=Math.round(180*E/Math.PI/20),B=1;B<D;B++){var F=B/D;if(.5!==F){var z=F-.5;F+=F*z*(F-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*z*z+(.848013+b*(.215638*b-1.06021)))}var N=y.sub(m)._mult(F)._add(m)._unit()._mult(S?-1:1);this.addHalfVertex(p,N.x,N.y,!1,S,0,d)}g&&this.addCurrentVertex(p,y,-R,-k,d)}else if("butt"===I)this.addCurrentVertex(p,_,0,0,d);else if("square"===I){var j=A?1:-1;this.addCurrentVertex(p,_,j,j,d)}else"round"===I&&(A&&(this.addCurrentVertex(p,m,0,0,d),this.addCurrentVertex(p,m,1,1,d,!0)),g&&(this.addCurrentVertex(p,y,-1,-1,d,!0),this.addCurrentVertex(p,y,0,0,d)));if(T&&v<l-1){var U=p.dist(g);if(U>2*f){var V=p.add(g.sub(p)._mult(f/U)._round());this.updateDistance(p,V),this.addCurrentVertex(V,y,0,0,d),p=V}}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,s)}},rs.prototype.addCurrentVertex=function(t,e,n,i,r,o){void 0===o&&(o=!1);var a=e.x+e.y*n,s=e.y-e.x*n,u=-e.x+e.y*i,c=-e.y-e.x*i;this.addHalfVertex(t,a,s,o,!1,n,r),this.addHalfVertex(t,u,c,o,!0,-i,r),this.distance>is/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,i,r,o))},rs.prototype.addHalfVertex=function(t,e,n,i,r,o,a){var s=t.x,u=t.y,c=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((s<<1)+(i?1:0),(u<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&c)<<2,c>>6);var l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),r?this.e2=l:this.e1=l},rs.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(is-1):this.distance},di("LineBucket",rs,{omit:["layers","patternFeatures"]});var os=new tr({"line-cap":new Qi(Pt.layout_line["line-cap"]),"line-join":new Yi(Pt.layout_line["line-join"]),"line-miter-limit":new Qi(Pt.layout_line["line-miter-limit"]),"line-round-limit":new Qi(Pt.layout_line["line-round-limit"]),"line-sort-key":new Yi(Pt.layout_line["line-sort-key"])}),as={paint:new tr({"line-opacity":new Yi(Pt.paint_line["line-opacity"]),"line-color":new Yi(Pt.paint_line["line-color"]),"line-translate":new Qi(Pt.paint_line["line-translate"]),"line-translate-anchor":new Qi(Pt.paint_line["line-translate-anchor"]),"line-width":new Yi(Pt.paint_line["line-width"]),"line-gap-width":new Yi(Pt.paint_line["line-gap-width"]),"line-offset":new Yi(Pt.paint_line["line-offset"]),"line-blur":new Yi(Pt.paint_line["line-blur"]),"line-dasharray":new Ji(Pt.paint_line["line-dasharray"]),"line-pattern":new Ki(Pt.paint_line["line-pattern"]),"line-gradient":new $i(Pt.paint_line["line-gradient"])}),layout:os},ss=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new ji(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,i,r){return n=h({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,i,r)},e}(Yi))(as.paint.properties["line-width"].specification);ss.useIntegerZoom=!0;var us=function(t){function e(e){t.call(this,e,as)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Wo(t,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=ss.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new rs(t)},e.prototype.queryRadius=function(t){var e=t,n=cs(Po("line-width",this,e),Po("line-gap-width",this,e)),i=Po("line-offset",this,e);return n/2+Math.abs(i)+Mo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,o,a,s){var u=Co(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),c=s/2*cs(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),l=this.paint.get("line-offset").evaluate(e,n);return l&&(i=function(t,e){for(var n=[],i=new r(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var c=a[u-1],l=a[u],h=a[u+1],p=0===u?i:l.sub(c)._unit()._perp(),f=u===a.length-1?i:h.sub(l)._unit()._perp(),d=p._add(f)._unit(),A=d.x*f.x+d.y*f.y;d._mult(1/A),s.push(d._mult(e)._add(l))}n.push(s)}return n}(i,l*s)),function(t,e,n){for(var i=0;i<e.length;i++){var r=e[i];if(t.length>=3)for(var o=0;o<r.length;o++)if(To(t,r[o]))return!0;if(vo(t,r,n))return!0}return!1}(u,i,c)},e.prototype.isTileClipped=function(){return!0},e}(er);function cs(t,e){return e>0?e+2*t:t}var ls=or([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hs=or([{name:"a_projected_pos",components:3,type:"Float32"}],4),ps=(or([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),or([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),fs=(or([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),or([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),ds=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function As(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Ni.applyArabicShaping&&(t=Ni.applyArabicShaping(t)),t}(t.text,e,n)})),t}or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"}]),or([{type:"Float32",name:"offsetX"}]),or([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var gs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},ms=function(t,e,n,i,r){var o,a,s=8*r-i-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+t[e+h],h+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=i;l>0;a=256*a+t[e+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=c}return(f?-1:1)*a*Math.pow(2,o-i)},ys=function(t,e,n,i,r,o){var a,s,u,c=8*o-r-1,l=(1<<c)-1,h=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*u-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;t[n+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;t[n+f]=255&a,f+=d,a/=256,c-=8);t[n+f-d]|=128*A},vs=_s;function _s(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_s.Varint=0,_s.Fixed64=1,_s.Bytes=2,_s.Fixed32=5;var bs="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function xs(t){return t.type===_s.Bytes?t.readVarint()+t.pos:t.pos+1}function ws(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Es(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function Ts(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Ss(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Ps(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Ms(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Cs(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Is(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Os(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Ls(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Rs(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function ks(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ds(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Bs(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Fs(t,e,n){1===t&&n.readMessage(zs,e)}function zs(t,e,n){if(3===t){var i=n.readMessage(Ns,{}),r=i.id,o=i.bitmap,a=i.width,s=i.height,u=i.left,c=i.top,l=i.advance;e.push({id:r,bitmap:new Uo({width:a+6,height:s+6},o),metrics:{width:a,height:s,left:u,top:c,advance:l}})}}function Ns(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function js(t){for(var e=0,n=0,i=0,r=t;i<r.length;i+=1){var o=r[i];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,c=0,l=t;c<l.length;c+=1)for(var h=l[c],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}_s.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ks(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Bs(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ks(this.buf,this.pos)+4294967296*ks(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=ks(this.buf,this.pos)+4294967296*Bs(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ms(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ms(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return ws(t,i,e);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return ws(t,i,e);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return ws(t,i,e);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return ws(t,i,e);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return ws(t,i,e);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return ws(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&bs?function(t,e,n){return bs.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var i="",r=e;r<n;){var o,a,s,u=t[r],c=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l>n)break;1===l?u<128&&(c=u):2===l?128==(192&(o=t[r+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=t[r+1],a=t[r+2],s=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=l}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_s.Bytes)return t.push(this.readVarint(e));var n=xs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_s.Bytes)return t.push(this.readSVarint());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_s.Bytes)return t.push(this.readBoolean());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_s.Bytes)return t.push(this.readFloat());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_s.Bytes)return t.push(this.readDouble());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_s.Bytes)return t.push(this.readFixed32());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_s.Bytes)return t.push(this.readSFixed32());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_s.Bytes)return t.push(this.readFixed64());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_s.Bytes)return t.push(this.readSFixed64());var e=xs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===_s.Varint)for(;this.buf[this.pos++]>127;);else if(e===_s.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_s.Fixed32)this.pos+=4;else{if(e!==_s.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ds(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ds(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ds(this.buf,-1&t,this.pos),Ds(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ds(this.buf,-1&t,this.pos),Ds(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Es(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&Es(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,_s.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ts,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Ss,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Cs,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Ps,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ms,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Is,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Os,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ls,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Rs,e)},writeBytesField:function(t,e){this.writeTag(t,_s.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_s.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_s.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_s.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_s.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_s.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_s.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_s.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_s.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_s.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Us=function(t,e){var n=e.pixelRatio,i=e.version,r=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=r,this.stretchY=o,this.content=a,this.version=i},Vs={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Vs.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Vs.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Vs.tlbr.get=function(){return this.tl.concat(this.br)},Vs.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Us.prototype,Vs);var Gs=function(t,e){var n={},i={};this.haveRenderCallbacks=[];var r=[];this.addImages(t,n,r),this.addImages(e,i,r);var o=js(r),a=o.w,s=o.h,u=new Vo({width:a||1,height:s||1});for(var c in t){var l=t[c],h=n[c].paddedRect;Vo.copy(l.data,u,{x:0,y:0},{x:h.x+1,y:h.y+1},l.data)}for(var p in e){var f=e[p],d=i[p].paddedRect,A=d.x+1,g=d.y+1,m=f.data.width,y=f.data.height;Vo.copy(f.data,u,{x:0,y:0},{x:A,y:g},f.data),Vo.copy(f.data,u,{x:0,y:y-1},{x:A,y:g-1},{width:m,height:1}),Vo.copy(f.data,u,{x:0,y:0},{x:A,y:g+y},{width:m,height:1}),Vo.copy(f.data,u,{x:m-1,y:0},{x:A-1,y:g},{width:1,height:y}),Vo.copy(f.data,u,{x:0,y:0},{x:A+m,y:g},{width:1,height:y})}this.image=u,this.iconPositions=n,this.patternPositions=i};Gs.prototype.addImages=function(t,e,n){for(var i in t){var r=t[i],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),e[i]=new Us(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}},Gs.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},Gs.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var i=t.tl,r=i[0],o=i[1];n.update(e.data,void 0,{x:r,y:o})}},di("ImagePosition",Us),di("ImageAtlas",Gs);var Ws={horizontal:1,vertical:2,horizontalOnly:3},Hs=function(){this.scale=1,this.fontStack="",this.imageName=null};Hs.forText=function(t,e){var n=new Hs;return n.scale=t||1,n.fontStack=e,n},Hs.forImage=function(t){var e=new Hs;return e.imageName=t,e};var qs=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Xs(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A){var g,m=qs.fromFeature(t,r);h===Ws.vertical&&m.verticalizePunctuation();var y=Ni.processBidirectionalText,v=Ni.processStyledBidirectionalText;if(y&&1===m.sections.length){g=[];for(var _=0,b=y(m.toString(),tu(m,c,o,e,i,f,d));_<b.length;_+=1){var x=b[_],w=new qs;w.text=x,w.sections=m.sections;for(var E=0;E<x.length;E++)w.sectionIndex.push(0);g.push(w)}}else if(v){g=[];for(var T=0,S=v(m.text,m.sectionIndex,tu(m,c,o,e,i,f,d));T<S.length;T+=1){var P=S[T],M=new qs;M.text=P[0],M.sectionIndex=P[1],M.sections=m.sections,g.push(M)}}else g=function(t,e){for(var n=[],i=t.text,r=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(r,s)),r=s}return r<i.length&&n.push(t.substring(r,i.length)),n}(m,tu(m,c,o,e,i,f,d));var C=[],I={positionedLines:C,text:m.toString(),top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,i,r,o,a,s,u,c,l,h){for(var p=0,f=-17,d=0,A=0,g="right"===s?1:"left"===s?0:.5,m=0,y=0,v=r;y<v.length;y+=1){var _=v[y];_.trim();var b=_.getMaxScale(),x=24*(b-1),w={positionedGlyphs:[],lineOffset:0};t.positionedLines[m]=w;var E=w.positionedGlyphs,T=0;if(_.length()){for(var S=0;S<_.length();S++){var P=_.getSection(S),M=_.getSectionIndex(S),C=_.getCharCode(S),I=0,O=null,L=null,R=null,k=24,D=!(u===Ws.horizontal||!l&&!wi(C)||l&&(Zs[C]||(H=C,_i.Arabic(H)||_i["Arabic Supplement"](H)||_i["Arabic Extended-A"](H)||_i["Arabic Presentation Forms-A"](H)||_i["Arabic Presentation Forms-B"](H))));if(P.imageName){var B=i[P.imageName];if(!B)continue;R=P.imageName,t.iconsInText=t.iconsInText||!0,L=B.paddedRect;var F=B.displaySize;P.scale=24*P.scale/h,O={width:F[0],height:F[1],left:1,top:-3,advance:D?F[1]:F[0]},I=x+(24-F[1]*P.scale),k=O.advance;var z=D?F[0]*P.scale-24*b:F[1]*P.scale-24*b;z>0&&z>T&&(T=z)}else{var N=n[P.fontStack],j=N&&N[C];if(j&&j.rect)L=j.rect,O=j.metrics;else{var U=e[P.fontStack],V=U&&U[C];if(!V)continue;O=V.metrics}I=24*(b-P.scale)}D?(t.verticalizable=!0,E.push({glyph:C,imageName:R,x:p,y:f+I,vertical:D,scale:P.scale,fontStack:P.fontStack,sectionIndex:M,metrics:O,rect:L}),p+=k*P.scale+c):(E.push({glyph:C,imageName:R,x:p,y:f+I,vertical:D,scale:P.scale,fontStack:P.fontStack,sectionIndex:M,metrics:O,rect:L}),p+=O.advance*P.scale+c)}if(0!==E.length){var G=p-c;d=Math.max(G,d),nu(E,0,E.length-1,g,T)}p=0;var W=o*b+T;w.lineOffset=Math.max(T,x),f+=W,A=Math.max(W,A),++m}else f+=o,++m}var H,q=f- -17,X=eu(a),Z=X.horizontalAlign,Q=X.verticalAlign;(function(t,e,n,i,r,o,a,s,u){var c,l=(e-n)*r;c=o!==a?-s*i- -17:(-i*u+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var A=d[f];A.x+=l,A.y+=c}})(t.positionedLines,g,Z,Q,d,A,o,q,r.length),t.top+=-Q*q,t.bottom=t.top+q,t.left+=-Z*d,t.right=t.left+d}(I,e,n,i,g,a,s,u,h,c,p,A),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(C)&&I}qs.fromFeature=function(t,e){for(var n=new qs,i=0;i<t.sections.length;i++){var r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n},qs.prototype.length=function(){return this.text.length},qs.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},qs.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},qs.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},qs.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;i&&Ei(i)&&!gs[t[n+1]]||r&&Ei(r)&&!gs[t[n-1]]||!gs[t[n]]?e+=t[n]:e+=gs[t[n]]}return e}(this.text)},qs.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Zs[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,i=this.text.length-1;i>=0&&i>=t&&Zs[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},qs.prototype.substring=function(t,e){var n=new qs;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},qs.prototype.toString=function(){return this.text},qs.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},qs.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Hs.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,i=0;i<t.text.length;++i)this.sectionIndex.push(n)},qs.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Hs.forImage(e)),this.sectionIndex.push(this.sections.length-1)):x("Reached maximum number of images 6401")}else x("Can't add FormattedSection with an empty image.")},qs.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Zs={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qs={};function Ys(t,e,n,i,r,o){if(e.imageName){var a=i[e.imageName];return a?a.displaySize[0]*e.scale*24/o+r:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+r:0}function Ks(t,e,n,i){var r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Js(t,e,n){var i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function $s(t,e,n,i,r,o){for(var a=null,s=Ks(e,n,r,o),u=0,c=i;u<c.length;u+=1){var l=c[u],h=Ks(e-l.x,n,r,o)+l.badness;h<=s&&(a=l,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function tu(t,e,n,i,r,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],c=function(t,e,n,i,r,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=Ys(t.getCharCode(s),u,i,r,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,i,r,a),l=t.text.indexOf("​")>=0,h=0,p=0;p<t.length();p++){var f=t.getSection(p),d=t.getCharCode(p);if(Zs[d]||(h+=Ys(d,f,i,r,e,a)),p<t.length()-1){var A=!((s=d)<11904||!(_i["Bopomofo Extended"](s)||_i.Bopomofo(s)||_i["CJK Compatibility Forms"](s)||_i["CJK Compatibility Ideographs"](s)||_i["CJK Compatibility"](s)||_i["CJK Radicals Supplement"](s)||_i["CJK Strokes"](s)||_i["CJK Symbols and Punctuation"](s)||_i["CJK Unified Ideographs Extension A"](s)||_i["CJK Unified Ideographs"](s)||_i["Enclosed CJK Letters and Months"](s)||_i["Halfwidth and Fullwidth Forms"](s)||_i.Hiragana(s)||_i["Ideographic Description Characters"](s)||_i["Kangxi Radicals"](s)||_i["Katakana Phonetic Extensions"](s)||_i.Katakana(s)||_i["Vertical Forms"](s)||_i["Yi Radicals"](s)||_i["Yi Syllables"](s)));(Qs[d]||A||f.imageName)&&u.push($s(p+1,h,c,u,Js(d,t.getCharCode(p+1),A&&l),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}($s(t.length(),h,c,u,0,!0))}function eu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function nu(t,e,n,i,r){if(i||r)for(var o=t[n],a=o.metrics.advance*o.scale,s=(t[n].x+a)*i,u=e;u<=n;u++)t[u].x-=s,t[u].y+=r}function iu(t,e,n,i,r,o){var a,s=t.image;if(s.content){var u=s.content,c=s.pixelRatio||1;a=[u[0]/c,u[1]/c,s.displaySize[0]-u[2]/c,s.displaySize[1]-u[3]/c]}var l,h,p,f,d=e.left*o,A=e.right*o;"width"===n||"both"===n?(f=r[0]+d-i[3],h=r[0]+A+i[1]):h=(f=r[0]+(d+A-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*o,m=e.bottom*o;return"height"===n||"both"===n?(l=r[1]+g-i[0],p=r[1]+m+i[2]):p=(l=r[1]+(g+m-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:l,right:h,bottom:p,left:f,collisionPadding:a}}Qs[10]=!0,Qs[32]=!0,Qs[38]=!0,Qs[40]=!0,Qs[41]=!0,Qs[43]=!0,Qs[45]=!0,Qs[47]=!0,Qs[173]=!0,Qs[183]=!0,Qs[8203]=!0,Qs[8208]=!0,Qs[8211]=!0,Qs[8231]=!0;var ru=function(t){function e(e,n,i,r){t.call(this,e,n),this.angle=i,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(r);di("Anchor",ru);var ou=128;function au(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ji(t+1))};if("source"===n.kind)return{kind:"source"};for(var i=n.zoomStops,r=n.interpolationType,o=0;o<i.length&&i[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<i.length&&i[a]<t+1;)a++;a=Math.min(i.length-1,a);var s=i[o],u=i[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new ji(s)),maxSize:n.evaluate(new ji(u)),interpolationType:r}}function su(t,e,n){var i=e.uSize,r=e.uSizeT,o=n.lowerSize,a=n.upperSize;return"source"===t.kind?o/ou:"composite"===t.kind?we(o/ou,a/ou,r):i}function uu(t,e){var n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){var r=t.interpolationType,o=t.minZoom,a=t.maxZoom,s=r?c(Ne.interpolationFactor(r,e,o,a),0,1):0;"camera"===t.kind?i=we(t.minSize,t.maxSize,s):n=s}return{uSizeT:n,uSize:i}}var cu=Object.freeze({__proto__:null,getSizeData:au,evaluateSizeForFeature:su,evaluateSizeForZoom:uu,SIZE_PACK_FACTOR:ou});function lu(t,e,n,i,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],c=0;s<n/2;){var l=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=l.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),c+=f;s-u[0].distance>i;)c-=u.shift().angleDelta;if(c>r)return!1;a++,s+=h.dist(p)}return!0}function hu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function pu(t,e,n){return t?.6*e*n:0}function fu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function du(t,e,n,i,r,o){for(var a=pu(n,r,o),s=fu(n,i)*o,u=0,c=hu(t)/2,l=0;l<t.length-1;l++){var h=t[l],p=t[l+1],f=h.dist(p);if(u+f>c){var d=(c-u)/f,A=we(h.x,p.x,d),g=we(h.y,p.y,d),m=new ru(A,g,p.angleTo(h),l);return m._round(),!a||lu(t,m,s,a,e)?m:void 0}u+=f}}function Au(t,e,n,i,r,o,a,s,u){var c=pu(i,o,a),l=fu(i,r),h=l*a,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,i,r,o,a,s,u,c){for(var l=a/2,h=hu(e),p=0,f=n-i,d=[],A=0;A<e.length-1;A++){for(var g=e[A],m=e[A+1],y=g.dist(m),v=m.angleTo(g);f+i<p+y;){var _=((f+=i)-p)/y,b=we(g.x,m.x,_),x=we(g.y,m.y,_);if(b>=0&&b<c&&x>=0&&x<c&&f-l>=0&&f+l<=h){var w=new ru(b,x,v,A);w._round(),r&&!lu(e,w,a,r,o)||d.push(w)}}p+=y}return u||d.length||s||(d=t(e,p/2,i,r,o,a,s,!0,c)),d}(t,p?e/2*s%e:(l/2+2*o)*a*s%e,e,c,n,h,p,!1,u)}function gu(t,e,n,i){var o=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,c=a.paddedRect.h-2,l=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,u]],f=a.stretchY||[[0,c]],d=function(t,e){return t+e[1]-e[0]},A=p.reduce(d,0),g=f.reduce(d,0),m=u-A,y=c-g,v=0,_=A,b=0,x=g,w=0,E=m,T=0,S=y;if(a.content&&i){var P=a.content;v=mu(p,0,P[0]),b=mu(f,0,P[1]),_=mu(p,P[0],P[2]),x=mu(f,P[1],P[3]),w=P[0]-v,T=P[1]-b,E=P[2]-P[0]-_,S=P[3]-P[1]-x}var M=function(i,o,u,c){var p=vu(i.stretch-v,_,l,t.left),f=_u(i.fixed-w,E,i.stretch,A),d=vu(o.stretch-b,x,h,t.top),m=_u(o.fixed-T,S,o.stretch,g),y=vu(u.stretch-v,_,l,t.left),P=_u(u.fixed-w,E,u.stretch,A),M=vu(c.stretch-b,x,h,t.top),C=_u(c.fixed-T,S,c.stretch,g),I=new r(p,d),O=new r(y,d),L=new r(y,M),R=new r(p,M),k=new r(f/s,m/s),D=new r(P/s,C/s),B=e*Math.PI/180;if(B){var F=Math.sin(B),z=Math.cos(B),N=[z,-F,F,z];I._matMult(N),O._matMult(N),R._matMult(N),L._matMult(N)}var j=i.stretch+i.fixed,U=u.stretch+u.fixed,V=o.stretch+o.fixed,G=c.stretch+c.fixed;return{tl:I,tr:O,bl:R,br:L,tex:{x:a.paddedRect.x+1+j,y:a.paddedRect.y+1+V,w:U-j,h:G-V},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:k,pixelOffsetBR:D,minFontScaleX:E/s/l,minFontScaleY:S/s/h,isSDF:n}};if(i&&(a.stretchX||a.stretchY))for(var C=yu(p,m,A),I=yu(f,y,g),O=0;O<C.length-1;O++)for(var L=C[O],R=C[O+1],k=0;k<I.length-1;k++){var D=I[k],B=I[k+1];o.push(M(L,D,R,B))}else o.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:c+1}));return o}function mu(t,e,n){for(var i=0,r=0,o=t;r<o.length;r+=1){var a=o[r];i+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return i}function yu(t,e,n){for(var i=[{fixed:-1,stretch:0}],r=0,o=t;r<o.length;r+=1){var a=o[r],s=a[0],u=a[1],c=i[i.length-1];i.push({fixed:s-c.stretch,stretch:c.stretch}),i.push({fixed:s-c.stretch,stretch:c.stretch+(u-s)})}return i.push({fixed:e+1,stretch:n}),i}function vu(t,e,n,i){return t/e*n+i}function _u(t,e,n,i){return t-e*n/i}var bu=function(t,e,n,i,o,a,s,u,c,l,h,p){var f=s.top*u-c,d=s.bottom*u+c,A=s.left*u-c,g=s.right*u+c,m=s.collisionPadding;if(m&&(A-=m[0]*u,f-=m[1]*u,g+=m[2]*u,d+=m[3]*u),this.boxStartIndex=t.length,l){var y=d-f,v=g-A;y>0&&(y=Math.max(10*u,y),this._addLineCollisionCircles(t,e,n,n.segment,v,y,i,o,a,h))}else{if(p){var _=new r(A,f),b=new r(g,f),x=new r(A,d),w=new r(g,d),E=p*Math.PI/180;_._rotate(E),b._rotate(E),x._rotate(E),w._rotate(E),A=Math.min(_.x,b.x,x.x,w.x),g=Math.max(_.x,b.x,x.x,w.x),f=Math.min(_.y,b.y,x.y,w.y),d=Math.max(_.y,b.y,x.y,w.y)}t.emplaceBack(n.x,n.y,A,f,g,d,i,o,a,0,0)}this.boxEndIndex=t.length};bu.prototype._addLineCollisionCircles=function(t,e,n,i,r,o,a,s,u,c){var l=o/2,h=Math.floor(r/l)||1,p=1+.4*Math.log(c)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,A=n,g=i+1,m=d,y=-r/2,v=y-r/4;do{if(--g<0){if(m>y)return;g=0;break}m-=e[g].dist(A),A=e[g]}while(m>v);for(var _=e[g].dist(e[g+1]),b=-f;b<h+f;b++){var x=b*l,w=y+x;if(x<0&&(w+=x),x>r&&(w+=x-r),!(w<m)){for(;m+_<w;){if(m+=_,++g+1>=e.length)return;_=e[g].dist(e[g+1])}var E=w-m,T=e[g],S=e[g+1].sub(T)._unit()._mult(E)._add(T)._round(),P=Math.abs(w-d)<l?0:.8*(w-d);t.emplaceBack(S.x,S.y,-o/2,-o/2,o/2,o/2,a,s,u,o/2,P)}}};var xu=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=wu),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function wu(t,e){return t<e?-1:t>e?1:0}function Eu(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],c=0;c<u.length;c++){var l=u[c];(!c||l.x<i)&&(i=l.x),(!c||l.y<o)&&(o=l.y),(!c||l.x>a)&&(a=l.x),(!c||l.y>s)&&(s=l.y)}var h=a-i,p=s-o,f=Math.min(h,p),d=f/2,A=new xu([],Tu);if(0===f)return new r(i,o);for(var g=i;g<a;g+=f)for(var m=o;m<s;m+=f)A.push(new Su(g+d,m+d,d,t));for(var y=function(t){for(var e=0,n=0,i=0,r=t[0],o=0,a=r.length,s=a-1;o<a;s=o++){var u=r[o],c=r[s],l=u.x*c.y-c.x*u.y;n+=(u.x+c.x)*l,i+=(u.y+c.y)*l,e+=3*l}return new Su(n/e,i/e,0,t)}(t),v=A.length;A.length;){var _=A.pop();(_.d>y.d||!y.d)&&(y=_,n&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,v)),_.max-y.d<=e||(d=_.h/2,A.push(new Su(_.p.x-d,_.p.y-d,d,t)),A.push(new Su(_.p.x+d,_.p.y-d,d,t)),A.push(new Su(_.p.x-d,_.p.y+d,d,t)),A.push(new Su(_.p.x+d,_.p.y+d,d,t)),v+=4)}return n&&(console.log("num probes: "+v),console.log("best distance: "+y.d)),y.p}function Tu(t,e){return e.max-t.max}function Su(t,e,n,i){this.p=new r(t,e),this.h=n,this.d=function(t,e){for(var n=!1,i=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,s=o.length,u=s-1;a<s;u=a++){var c=o[a],l=o[u];c.y>t.y!=l.y>t.y&&t.x<(l.x-c.x)*(t.y-c.y)/(l.y-c.y)+c.x&&(n=!n),i=Math.min(i,wo(t,c,l))}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}xu.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},xu.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},xu.prototype.peek=function(){return this.data[0]},xu.prototype._up=function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,o=e[r];if(n(i,o)>=0)break;e[t]=o,t=r}e[t]=i},xu.prototype._down=function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,r)>=0)break;e[t]=a,t=o}e[t]=r};var Pu=e((function(t){t.exports=function(t,e){var n,i,r,o,a,s,u,c;for(n=3&t.length,i=t.length-n,r=e,a=3432918353,s=461845907,c=0;c<i;)u=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:r^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(c)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),Mu=e((function(t){t.exports=function(t,e){for(var n,i=t.length,r=e^i,o=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),Cu=Pu,Iu=Pu,Ou=Mu;Cu.murmur3=Iu,Cu.murmur2=Ou;var Lu=Number.POSITIVE_INFINITY;function Ru(t,e){return e[1]!==Lu?function(t,e,n){var i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){var n=0,i=0;e<0&&(e=0);var r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function ku(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}var Du=32640;function Bu(t,e,n,i,o,a,s,u,c,l,h,p,f,d){var A=function(t,e,n,i,o,a,s,u){for(var c=i.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,l=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var f=p[h],d=0,A=f.positionedGlyphs;d<A.length;d+=1){var g=A[d];if(g.rect){var m=g.rect||{},y=4,v=!0,_=1,b=0,x=(o||u)&&g.vertical,w=g.metrics.advance*g.scale/2;if(u&&e.verticalizable){var E=24*(g.scale-1),T=(24-g.metrics.width*g.scale)/2;b=f.lineOffset/2-(g.imageName?-T:E)}if(g.imageName){var S=s[g.imageName];v=S.sdf,y=1/(_=S.pixelRatio)}var P=o?[g.x+w,g.y]:[0,0],M=o?[0,0]:[g.x+w+n[0],g.y+n[1]-b],C=[0,0];x&&(C=M,M=[0,0]);var I=(g.metrics.left-y)*g.scale-w+M[0],O=(-g.metrics.top-y)*g.scale+M[1],L=I+m.w*g.scale/_,R=O+m.h*g.scale/_,k=new r(I,O),D=new r(L,O),B=new r(I,R),F=new r(L,R);if(x){var z=new r(-w,w- -17),N=-Math.PI/2,j=12-w,U=g.imageName?j:0,V=new r(22-j,-U),G=new(Function.prototype.bind.apply(r,[null].concat(C)));k._rotateAround(N,z)._add(V)._add(G),D._rotateAround(N,z)._add(V)._add(G),B._rotateAround(N,z)._add(V)._add(G),F._rotateAround(N,z)._add(V)._add(G)}if(c){var W=Math.sin(c),H=Math.cos(c),q=[H,-W,W,H];k._matMult(q),D._matMult(q),B._matMult(q),F._matMult(q)}var X=new r(0,0),Z=new r(0,0);l.push({tl:k,tr:D,bl:B,br:F,tex:m,writingMode:e.writingMode,glyphOffset:P,sectionIndex:g.sectionIndex,isSDF:v,pixelOffsetTL:X,pixelOffsetBR:Z,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,u,o,a,s,i,t.allowVerticalPlacement),g=t.textSizeData,m=null;"source"===g.kind?(m=[ou*o.layout.get("text-size").evaluate(s,{})])[0]>Du&&x(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((m=[ou*d.compositeTextSizes[0].evaluate(s,{}),ou*d.compositeTextSizes[1].evaluate(s,{})])[0]>Du||m[1]>Du)&&x(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,A,m,u,a,s,l,e,c.lineStartIndex,c.lineLength,f);for(var y=0,v=h;y<v.length;y+=1)p[v[y]]=t.text.placedSymbolArray.length-1;return 4*A.length}function Fu(t){for(var e in t)return t[e];return null}function zu(t,e,n,i){var r=t.compareText;if(e in r){for(var o=r[e],a=o.length-1;a>=0;a--)if(i.dist(o[a])<n)return!0}else r[e]=[];return r[e].push(i),!1}var Nu=Ga.VectorTileFeature.types,ju=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uu(t,e,n,i,r,o,a,s,u,c,l,h,p){var f=s?Math.min(Du,Math.round(s[0])):0,d=s?Math.min(Du,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),o,a,(f<<1)+(u?1:0),d,16*c,16*l,256*h,256*p)}function Vu(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function Gu(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Pi(n[e].text))return!0;return!1}var Wu=function(t){this.layoutVertexArray=new pr,this.indexArray=new wr,this.programConfigurations=t,this.segments=new Ur,this.dynamicLayoutVertexArray=new fr,this.opacityVertexArray=new dr,this.placedSymbolArray=new Or};Wu.prototype.upload=function(t,e,n,i){n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ls.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,hs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ju,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t)},Wu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},di("SymbolBuffers",Wu);var Hu=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Ur,this.collisionVertexArray=new mr};Hu.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ps.members,!0)},Hu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},di("CollisionBuffers",Hu);var qu=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasPaintOverrides=!1,this.hasRTLText=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=au(this.zoom,e["text-size"]),this.iconSizeData=au(this.zoom,e["icon-size"]);var n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1);var o="viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey;this.sortFeaturesByY=o&&(n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement")),"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return Ws[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};qu.prototype.createArrays=function(){var t=this.layers[0].layout;this.hasPaintOverrides=Yu.hasPaintOverrides(t),this.text=new Wu(new so(ls.members,this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new Wu(new so(ls.members,this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.textCollisionBox=new Hu(gr,fs.members,Er),this.iconCollisionBox=new Hu(gr,fs.members,Er),this.textCollisionCircle=new Hu(gr,ds.members,wr),this.iconCollisionCircle=new Hu(gr,ds.members,wr),this.glyphOffsetArray=new Dr,this.lineVertexArray=new Fr,this.symbolInstances=new Rr},qu.prototype.calculateGlyphDependencies=function(t,e,n,i,r){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||i)&&r){var a=gs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},qu.prototype.populate=function(t,e){var n=this.layers[0],i=n.layout,r=i.get("text-font"),o=i.get("text-field"),a=i.get("icon-image"),s=("constant"!==o.value.kind||o.value.value instanceof $t&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==r.value.kind||r.value.value.length>0),u=("constant"!==a.value.kind||!!a.value.value)&&Object.keys(a.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],s||u){for(var l=e.iconDependencies,h=e.glyphDependencies,p=e.availableImages,f=new ji(this.zoom),d=0,A=t;d<A.length;d+=1){var g=A[d],m=g.feature,y=g.index,v=g.sourceLayerIndex;if(n._featureFilter(f,m)){var _=void 0;if(s){var b=n.getValueAndResolveTokens("text-field",m,p),x=$t.factory(b);Gu(x)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Fi()||this.hasRTLText&&Ni.isParsed())&&(_=As(x,n,m))}var w=void 0;if(u){var E=n.getValueAndResolveTokens("icon-image",m,p);w=E instanceof te?E:te.fromString(E)}if(_||w){var T=this.sortFeaturesByKey?c.evaluate(m,{}):void 0,S={text:_,icon:w,index:y,sourceLayerIndex:v,geometry:po(m),properties:m.properties,type:Nu[m.type],sortKey:T};if(void 0!==m.id&&(S.id=m.id),this.features.push(S),w&&(l[w.name]=!0),_){var P=r.evaluate(m,{}).join(","),M="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ws.vertical)>=0;for(var C=0,I=_.sections;C<I.length;C+=1){var O=I[C];if(O.image)l[O.image.name]=!0;else{var L=bi(_.toString()),R=O.fontStack||P,k=h[R]=h[R]||{};this.calculateGlyphDependencies(O.text,k,M,this.allowVerticalPlacement,L)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},i=[],r=0;function o(e){i.push(t[e]),r++}function a(t,e,r){var o=n[t];return delete n[t],n[e]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function s(t,n,r){var o=e[n];return delete e[n],e[t]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function u(t,e,n){var i=n?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var c=0;c<t.length;c++){var l=t[c],h=l.geometry,p=l.text?l.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in e&&n[f]!==e[d]){var A=s(f,d,h),g=a(f,d,i[A].geometry);delete e[f],delete n[d],n[u(p,i[g].geometry,!0)]=g,i[A].geometry=null}else f in n?a(f,d,h):d in e?s(f,d,h):(o(c),e[f]=r-1,n[d]=r-1)}else o(c)}return i.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},qu.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},qu.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},qu.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},qu.prototype.upload=function(t){this.uploaded||(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t),this.textCollisionCircle.upload(t),this.iconCollisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},qu.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.textCollisionBox.destroy(),this.iconCollisionBox.destroy(),this.textCollisionCircle.destroy(),this.iconCollisionCircle.destroy()},qu.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:i},a<e.length-1&&(i+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},s>0&&(r+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var c=o[u];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},qu.prototype.addSymbols=function(t,e,n,i,r,o,a,s,u,c,l){var h=this,p=t.indexArray,f=t.layoutVertexArray,d=t.dynamicLayoutVertexArray,A=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,o.sortKey),g=this.glyphOffsetArray.length,m=A.vertexLength,y=this.allowVerticalPlacement&&a===Ws.vertical?Math.PI/2:0,v=function(t){var e=t.tl,i=t.tr,r=t.bl,o=t.br,a=t.tex,u=t.pixelOffsetTL,c=t.pixelOffsetBR,l=t.minFontScaleX,g=t.minFontScaleY,m=A.vertexLength,v=t.glyphOffset[1];Uu(f,s.x,s.y,e.x,v+e.y,a.x,a.y,n,t.isSDF,u.x,u.y,l,g),Uu(f,s.x,s.y,i.x,v+i.y,a.x+a.w,a.y,n,t.isSDF,c.x,u.y,l,g),Uu(f,s.x,s.y,r.x,v+r.y,a.x,a.y+a.h,n,t.isSDF,u.x,c.y,l,g),Uu(f,s.x,s.y,o.x,v+o.y,a.x+a.w,a.y+a.h,n,t.isSDF,c.x,c.y,l,g),Vu(d,s,y),p.emplaceBack(m,m+1,m+2),p.emplaceBack(m+1,m+2,m+3),A.vertexLength+=4,A.primitiveLength+=2,h.glyphOffsetArray.emplaceBack(t.glyphOffset[0])};if(o.text&&o.text.sections){var _=o.text.sections;if(this.hasPaintOverrides){for(var b,x=function(e,n){void 0===b||b===e&&!n||t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{},_[b]),b=e},w=0,E=e;w<E.length;w+=1){var T=E[w];x(T.sectionIndex,!1),v(T)}x(b,!0)}else{for(var S=0,P=e;S<P.length;S+=1)v(P[S]);t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{},_[0])}}else{for(var M=0,C=e;M<C.length;M+=1)v(C[M]);t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{})}t.placedSymbolArray.emplaceBack(s.x,s.y,g,this.glyphOffsetArray.length-g,m,u,c,s.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],a,0,!1,0,l)},qu.prototype._addCollisionDebugVertex=function(t,e,n,i,r,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(o.x),Math.round(o.y))},qu.prototype.addCollisionDebugVertices=function(t,e,n,i,o,a,s,u){var c=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=c.vertexLength,h=o.layoutVertexArray,p=o.collisionVertexArray,f=s.anchorX,d=s.anchorY;if(this._addCollisionDebugVertex(h,p,a,f,d,new r(t,e)),this._addCollisionDebugVertex(h,p,a,f,d,new r(n,e)),this._addCollisionDebugVertex(h,p,a,f,d,new r(n,i)),this._addCollisionDebugVertex(h,p,a,f,d,new r(t,i)),c.vertexLength+=4,u){var A=o.indexArray;A.emplaceBack(l,l+1,l+2),A.emplaceBack(l,l+2,l+3),c.primitiveLength+=2}else{var g=o.indexArray;g.emplaceBack(l,l+1),g.emplaceBack(l+1,l+2),g.emplaceBack(l+2,l+3),g.emplaceBack(l+3,l),c.primitiveLength+=4}},qu.prototype.addDebugCollisionBoxes=function(t,e,n,i){for(var r=t;r<e;r++){var o=this.collisionBoxArray.get(r),a=o.x1,s=o.y1,u=o.x2,c=o.y2,l=o.radius>0;this.addCollisionDebugVertices(a,s,u,c,l?i?this.textCollisionCircle:this.iconCollisionCircle:i?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n,l)}},qu.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},qu.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,i,r,o,a,s,u){for(var c={},l=e;l<n;l++){var h=t.get(l);if(0===h.radius){c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}c.textCircles||(c.textCircles=[],c.textFeatureIndex=h.featureIndex),c.textCircles.push(h.anchorPointX,h.anchorPointY,h.radius,h.signedDistanceFromAnchor,1)}for(var p=i;p<r;p++){var f=t.get(p);if(0===f.radius){c.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},c.verticalTextFeatureIndex=f.featureIndex;break}}for(var d=o;d<a;d++){var A=t.get(d);if(0===A.radius){c.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},c.iconFeatureIndex=A.featureIndex;break}}for(var g=s;g<u;g++){var m=t.get(g);if(0===m.radius){c.verticalIconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},c.verticalIconFeatureIndex=m.featureIndex;break}}return c},qu.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},qu.prototype.hasTextData=function(){return this.text.segments.get().length>0},qu.prototype.hasIconData=function(){return this.icon.segments.get().length>0},qu.prototype.hasTextCollisionBoxData=function(){return this.textCollisionBox.segments.get().length>0},qu.prototype.hasIconCollisionBoxData=function(){return this.iconCollisionBox.segments.get().length>0},qu.prototype.hasTextCollisionCircleData=function(){return this.textCollisionCircle.segments.get().length>0},qu.prototype.hasIconCollisionCircleData=function(){return this.iconCollisionCircle.segments.get().length>0},qu.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs,r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)},qu.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),i=[],r=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);i.push(0|Math.round(e*s.anchorX+n*s.anchorY)),r.push(s.featureIndex)}return o.sort((function(t,e){return i[t]-i[e]||r[e]-r[t]})),o},qu.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,i=this.symbolInstanceIndexes;n<i.length;n+=1){var r=i[n],o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t,n,i){t>=0&&i.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},di("SymbolBucket",qu,{omit:["layers","collisionBoxArray","features","compareText"]}),qu.MAX_GLYPHS=65535,qu.addDynamicAttributes=Vu;var Xu=new tr({"symbol-placement":new Qi(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new Qi(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qi(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yi(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qi(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qi(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qi(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qi(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qi(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yi(Pt.layout_symbol["icon-size"]),"icon-text-fit":new Qi(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qi(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yi(Pt.layout_symbol["icon-image"]),"icon-rotate":new Yi(Pt.layout_symbol["icon-rotate"]),"icon-padding":new Qi(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new Qi(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new Yi(Pt.layout_symbol["icon-offset"]),"icon-anchor":new Yi(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qi(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qi(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qi(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new Yi(Pt.layout_symbol["text-field"]),"text-font":new Yi(Pt.layout_symbol["text-font"]),"text-size":new Yi(Pt.layout_symbol["text-size"]),"text-max-width":new Yi(Pt.layout_symbol["text-max-width"]),"text-line-height":new Qi(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new Yi(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new Yi(Pt.layout_symbol["text-justify"]),"text-radial-offset":new Yi(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qi(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new Yi(Pt.layout_symbol["text-anchor"]),"text-max-angle":new Qi(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new Qi(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new Yi(Pt.layout_symbol["text-rotate"]),"text-padding":new Qi(Pt.layout_symbol["text-padding"]),"text-keep-upright":new Qi(Pt.layout_symbol["text-keep-upright"]),"text-transform":new Yi(Pt.layout_symbol["text-transform"]),"text-offset":new Yi(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new Qi(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qi(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new Qi(Pt.layout_symbol["text-optional"])}),Zu={paint:new tr({"icon-opacity":new Yi(Pt.paint_symbol["icon-opacity"]),"icon-color":new Yi(Pt.paint_symbol["icon-color"]),"icon-halo-color":new Yi(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yi(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yi(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new Qi(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qi(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yi(Pt.paint_symbol["text-opacity"]),"text-color":new Yi(Pt.paint_symbol["text-color"],{runtimeType:Nt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Yi(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new Yi(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new Yi(Pt.paint_symbol["text-halo-blur"]),"text-translate":new Qi(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new Qi(Pt.paint_symbol["text-translate-anchor"])}),layout:Xu},Qu=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Dt,this.defaultValue=t};Qu.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Qu.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Qu.prototype.possibleOutputs=function(){return[void 0]},Qu.prototype.serialize=function(){return null},di("FormatSectionOverride",Qu,{omit:["defaultValue"]});var Yu=function(t){function e(e){t.call(this,e,Zu)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var i=this.layout.get("text-writing-mode");if(i){for(var r=[],o=0,a=i;o<a.length;o+=1){var s=a[o];r.indexOf(s)<0&&r.push(s)}this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n){var i=this.layout.get(t).evaluate(e,{},n),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||En(r.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new qu(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=Zu.paint.overridableProperties;t<n.length;t+=1){var i=n[t];if(e.hasPaintOverride(this.layout,i)){var r,o=this.paint.get(i),a=new Qu(o),s=new wn(a,o.property.specification);r="constant"===o.value.kind||"source"===o.value.kind?new Sn("source",s):new Pn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[i]=new Xi(o.property,r,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),i=Zu.paint.properties[e],r=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1){var o=n[e];if(i.overrides&&i.overrides.hasOverride(o))return void(r=!0)}};if("constant"===n.value.kind&&n.value.value instanceof $t)o(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){if(!r)if(t instanceof re&&ne(t.value)===Gt){var e=t.value;o(e.sections)}else t instanceof ue?o(t.sections):t.eachChild(a)},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return r},e.hasPaintOverrides=function(t){for(var n=0,i=Zu.paint.overridableProperties;n<i.length;n+=1){var r=i[n];if(e.hasPaintOverride(t,r))return!0}return!1},e}(er),Ku={paint:new tr({"background-color":new Qi(Pt.paint_background["background-color"]),"background-pattern":new Ji(Pt.paint_background["background-pattern"]),"background-opacity":new Qi(Pt.paint_background["background-opacity"])})},Ju=function(t){function e(e){t.call(this,e,Ku)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(er),$u={paint:new tr({"raster-opacity":new Qi(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qi(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qi(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qi(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new Qi(Pt.paint_raster["raster-saturation"]),"raster-contrast":new Qi(Pt.paint_raster["raster-contrast"]),"raster-resampling":new Qi(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new Qi(Pt.paint_raster["raster-fade-duration"])})},tc=function(t){function e(e){t.call(this,e,$u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(er),ec=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(er),nc={circle:Do,heatmap:Ho,hillshade:Xo,fill:Ra,"fill-extrusion":Ka,line:us,symbol:Yu,background:Ju,raster:tc},ic=self.HTMLImageElement,rc=self.HTMLCanvasElement,oc=self.HTMLVideoElement,ac=self.ImageData,sc=function(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)};sc.prototype.update=function(t,e,n){var i=t.width,r=t.height,o=!(this.size&&this.size[0]===i&&this.size[1]===r||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[i,r],t instanceof ic||t instanceof rc||t instanceof oc||t instanceof ac?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},c=u.x,l=u.y;t instanceof ic||t instanceof rc||t instanceof oc||t instanceof ac?s.texSubImage2D(s.TEXTURE_2D,0,c,l,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,c,l,i,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},sc.prototype.bind=function(t,e,n){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},sc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},sc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var uc=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};uc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},uc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var cc=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},g(["receive","process"],this),this.invoker=new uc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=T()?t:self};function lc(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}cc.prototype.send=function(t,e,n,i,r){var o=this;void 0===r&&(r=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=M(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:mi(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:o.mapId})}}},cc.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i()}else T()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},cc.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},cc.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(yi(e.error)):i(null,yi(e.data)))}else{var r=!1,o=M(this.globalScope)?void 0:[],a=e.hasCallback?function(e,i){r=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?mi(e):null,data:mi(i,o)},o)}:function(t){r=!0},s=null,u=yi(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var c=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,c[0],u.source)[c[1]](u,a)}else a(new Error("Could not find function "+e.type));!r&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},cc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var hc=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};hc.prototype.setNorthEast=function(t){return this._ne=t instanceof pc?new pc(t.lng,t.lat):pc.convert(t),this},hc.prototype.setSouthWest=function(t){return this._sw=t instanceof pc?new pc(t.lng,t.lat):pc.convert(t),this},hc.prototype.extend=function(t){var e,n,i=this._sw,r=this._ne;if(t instanceof pc)e=t,n=t;else{if(!(t instanceof hc))return Array.isArray(t)?t.every(Array.isArray)?this.extend(hc.convert(t)):this.extend(pc.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return i||r?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new pc(e.lng,e.lat),this._ne=new pc(n.lng,n.lat)),this},hc.prototype.getCenter=function(){return new pc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},hc.prototype.getSouthWest=function(){return this._sw},hc.prototype.getNorthEast=function(){return this._ne},hc.prototype.getNorthWest=function(){return new pc(this.getWest(),this.getNorth())},hc.prototype.getSouthEast=function(){return new pc(this.getEast(),this.getSouth())},hc.prototype.getWest=function(){return this._sw.lng},hc.prototype.getSouth=function(){return this._sw.lat},hc.prototype.getEast=function(){return this._ne.lng},hc.prototype.getNorth=function(){return this._ne.lat},hc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},hc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},hc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},hc.prototype.contains=function(t){var e=pc.convert(t),n=e.lng,i=e.lat,r=this._sw.lat<=i&&i<=this._ne.lat,o=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=n&&n>=this._ne.lng),r&&o},hc.convert=function(t){return!t||t instanceof hc?t:new hc(t)};var pc=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};pc.prototype.wrap=function(){return new pc(l(this.lng,-180,180),this.lat)},pc.prototype.toArray=function(){return[this.lng,this.lat]},pc.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},pc.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new hc(new pc(this.lng-n,this.lat-e),new pc(this.lng+n,this.lat+e))},pc.convert=function(t){if(t instanceof pc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new pc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new pc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var fc=2*Math.PI*6378137;function dc(t){return fc*Math.cos(t*Math.PI/180)}function Ac(t){return(180+t)/360}function gc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function mc(t,e){return t/dc(e)}function yc(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var vc=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};vc.fromLngLat=function(t,e){void 0===e&&(e=0);var n=pc.convert(t);return new vc(Ac(n.lng),gc(n.lat),mc(e,n.lat))},vc.prototype.toLngLat=function(){return new pc(360*this.x-180,yc(this.y))},vc.prototype.toAltitude=function(){return this.z*dc(yc(this.y))},vc.prototype.meterInMercatorCoordinateUnits=function(){return 1/fc*(t=yc(this.y),1/Math.cos(t*Math.PI/180));var t};var _c=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=wc(0,t,e,n)};_c.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},_c.prototype.url=function(t,e){var n,i,r,o,a,s=(n=this.x,i=this.y,r=this.z,o=lc(256*n,256*(i=Math.pow(2,r)-i-1),r),a=lc(256*(n+1),256*(i+1),r),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var i,r="",o=t;o>0;o--)r+=(e&(i=1<<o-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},_c.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new r((t.x*e-this.x)*lo,(t.y*e-this.y)*lo)},_c.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var bc=function(t,e){this.wrap=t,this.canonical=e,this.key=wc(t,e.z,e.x,e.y)},xc=function(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new _c(n,+i,+r),this.key=wc(e,t,i,r)};function wc(t,e,n,i){(t*=2)<0&&(t=-1*t-1);var r=1<<e;return 32*(r*r*t+r*i+n)+e}xc.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},xc.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new xc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},xc.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},xc.prototype.children=function(t){if(this.overscaledZ>=t)return[new xc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new xc(e,this.wrap,e,n,i),new xc(e,this.wrap,e,n+1,i),new xc(e,this.wrap,e,n,i+1),new xc(e,this.wrap,e,n+1,i+1)]},xc.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},xc.prototype.wrapped=function(){return new xc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},xc.prototype.unwrapTo=function(t){return new xc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},xc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},xc.prototype.toUnwrapped=function(){return new bc(this.wrap,this.canonical)},xc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},xc.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new vc(t.x-this.wrap,t.y))},di("CanonicalTileID",_c),di("OverscaledTileID",xc,{omit:["posMatrix"]});var Ec=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return x('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var i=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var r=0;r<i;r++)this.data[this._idx(-1,r)]=this.data[this._idx(0,r)],this.data[this._idx(i,r)]=this.data[this._idx(i-1,r)],this.data[this._idx(r,-1)]=this.data[this._idx(r,0)],this.data[this._idx(r,i)]=this.data[this._idx(r,i-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(i,-1)]=this.data[this._idx(i-1,0)],this.data[this._idx(-1,i)]=this.data[this._idx(0,i-1)],this.data[this._idx(i,i)]=this.data[this._idx(i-1,i-1)]};Ec.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[i],n[i+1],n[i+2])},Ec.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ec.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Ec.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Ec.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Ec.prototype.getPixels=function(){return new Vo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ec.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var i=e*this.dim,r=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,c=o;c<a;c++)for(var l=i;l<r;l++)this.data[this._idx(l,c)]=t.data[this._idx(l+s,c+u)]},di("DEMData",Ec);var Tc=or([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Sc=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Sc.prototype.encode=function(t){return this._stringToNumber[t]},Sc.prototype.decode=function(t){return this._numberToString[t]};var Pc=function(t,e,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id)},Mc={geometry:{configurable:!0}};Mc.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Mc.geometry.set=function(t){this._geometry=t},Pc.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Pc.prototype,Mc);var Cc=function(){this.state={},this.stateChanges={},this.deletedStates={}};Cc.prototype.updateState=function(t,e,n){var i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},h(this.stateChanges[t][i],n),null===this.deletedStates[t])for(var r in this.deletedStates[t]={},this.state[t])r!==i&&(this.deletedStates[t][r]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][i])for(var o in this.deletedStates[t][i]={},this.state[t][i])n[o]||(this.deletedStates[t][i][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][a]&&delete this.deletedStates[t][i][a]},Cc.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e&&e>=0)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e&&e>=0)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}},Cc.prototype.getState=function(t,e){var n=String(e),i=this.state[t]||{},r=this.stateChanges[t]||{},o=h({},i[n],r[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var a=this.deletedStates[t][e];if(null===a)return{};for(var s in a)delete o[s]}return o},Cc.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Cc.prototype.coalesceChanges=function(t,e){var n={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var r={};for(var o in this.stateChanges[i])this.state[i][o]||(this.state[i][o]={}),h(this.state[i][o],this.stateChanges[i][o]),r[o]=this.state[i][o];n[i]=r}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else for(var l=0,p=Object.keys(this.deletedStates[a][c]);l<p.length;l+=1){var f=p[l];delete this.state[a][c][f]}s[c]=this.state[a][c]}n[a]=n[a]||{},h(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var d in t)t[d].setFeatureState(n,e)};var Ic=function(t,e,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new li(lo,16,0),this.grid3D=new li(lo,16,0),this.featureIndexArray=n||new Nr};function Oc(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y)}return{minX:e,minY:n,maxX:i,maxY:r}}function Lc(t,e){return e-t}Ic.prototype.insert=function(t,e,n,i,r,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var c=e[u],l=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var p=c[h];l[0]=Math.min(l[0],p.x),l[1]=Math.min(l[1],p.y),l[2]=Math.max(l[2],p.x),l[3]=Math.max(l[3],p.y)}l[0]<lo&&l[1]<lo&&l[2]>=0&&l[3]>=0&&s.insert(a,l[0],l[1],l[2],l[3])}},Ic.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ga.VectorTile(new vs(this.rawTileData)).layers,this.sourceLayerCoder=new Sc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ic.prototype.query=function(t,e,n){var i=this;this.loadVTLayers();for(var o=t.params||{},a=lo/t.tileSize/t.scale,s=zn(o.filter),u=t.queryGeometry,c=t.queryPadding*a,l=Oc(u),h=this.grid.query(l.minX-c,l.minY-c,l.maxX+c,l.maxY+c),p=Oc(t.cameraQueryGeometry),f=0,d=this.grid3D.query(p.minX-c,p.minY-c,p.maxX+c,p.maxY+c,(function(e,n,i,o){return function(t,e,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&i>=u.x&&o>=u.y)return!0}var c=[new r(e,n),new r(e,o),new r(i,o),new r(i,n)];if(t.length>2)for(var l=0,h=c;l<h.length;l+=1)if(To(t,h[l]))return!0;for(var p=0;p<t.length-1;p++)if(So(t[p],t[p+1],c))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,i+c,o+c)}));f<d.length;f+=1){var A=d[f];h.push(A)}h.sort(Lc);for(var g,m={},y=function(r){var c=h[r];if(c!==g){g=c;var l=i.featureIndexArray.get(c),p=null;i.loadMatchingFeature(m,l.bucketIndex,l.sourceLayerIndex,l.featureIndex,s,o.layers,e,(function(e,r){p||(p=po(e));var o={};return e.id&&(o=n.getState(r.sourceLayer||"_geojsonTileLayer",e.id)),r.queryIntersectsFeature(u,e,o,p,i.z,t.transform,a,t.pixelPosMatrix)}))}},v=0;v<h.length;v++)y(v);return m},Ic.prototype.loadMatchingFeature=function(t,e,n,i,r,o,a,s){var u=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,u)){var c=this.sourceLayerCoder.decode(n),l=this.vtLayers[c].feature(i);if(r(new ji(this.tileID.overscaledZ),l))for(var h=0;h<u.length;h++){var p=u[h];if(!(o&&o.indexOf(p)<0)){var f=a[p];if(f){var d=!s||s(l,f);if(d){var A=new Pc(l,this.z,this.x,this.y);A.layer=f.serialize();var g=t[p];void 0===g&&(g=t[p]=[]),g.push({featureIndex:i,feature:A,intersectionZ:d})}}}}}},Ic.prototype.lookupSymbolFeatures=function(t,e,n,i,r,o){var a={};this.loadVTLayers();for(var s=zn(i),u=0,c=t;u<c.length;u+=1){var l=c[u];this.loadMatchingFeature(a,e,n,l,s,r,o)}return a},Ic.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var i=0,r=n[e];i<r.length;i+=1)if(t===r[i])return!0;return!1},di("FeatureIndex",Ic,{omit:["rawTileData","sourceLayerCoder"]});var Rc=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Rc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<F.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Rc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Rc.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var i in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var i=function(){var t=o[r],i=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==i.length){t.layers=i,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return i.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=i;a<s.length;a+=1){var u=s[a];n[u.id]=t}}},r=0,o=t;r<o.length;r+=1)i();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var r=this.buckets[i];if(r instanceof qu){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof qu&&a.hasRTLText){this.hasRTLText=!0,Ni.isLoading()||Ni.isLoaded()||"deferred"!==Fi()||zi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Cr},Rc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Rc.prototype.getBucket=function(t){return this.buckets[t.id]},Rc.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sc(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sc(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},Rc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Rc.prototype.queryRenderedFeatures=function(t,e,n,i,r,o,a,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:r,tileSize:this.tileSize,pixelPosMatrix:u,transform:a,params:o,queryPadding:this.queryPadding*s},t,e):{}},Rc.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var n=this.latestFeatureIndex.loadVTLayers(),i=e?e.sourceLayer:"",r=n._geojsonTileLayer||n[i];if(r)for(var o=zn(e&&e.filter),a=this.tileID.canonical,s=a.z,u=a.x,c=a.y,l={z:s,x:u,y:c},h=0;h<r.length;h++){var p=r.feature(h);if(o(new ji(this.tileID.overscaledZ),p)){var f=new Pc(p,s,u,c);f.tile=l,t.push(f)}}}},Rc.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer),delete this.mask},Rc.prototype.setMask=function(t,e){if(!a(this.mask,t)&&(this.clearMask(),this.mask=t,!a(t,{0:!0}))){var n=new ur,i=new wr;this.segments=new Ur,this.segments.prepareSegment(0,n,i);for(var o=Object.keys(t),s=0;s<o.length;s++){var u=t[+o[s]],c=lo>>u.z,l=new r(u.x*c,u.y*c),h=new r(l.x+c,l.y+c),p=this.segments.prepareSegment(4,n,i);n.emplaceBack(l.x,l.y,l.x,l.y),n.emplaceBack(h.x,l.y,h.x,l.y),n.emplaceBack(l.x,h.y,l.x,h.y),n.emplaceBack(h.x,h.y,h.x,h.y);var f=p.vertexLength;i.emplaceBack(f,f+1,f+2),i.emplaceBack(f+1,f+2,f+3),p.vertexLength+=4,p.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(n,Tc.members),this.maskedIndexBuffer=e.createIndexBuffer(i)}},Rc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Rc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Rc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=S(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var o=this.expirationTime-e;o?this.expirationTime=i+Math.max(o,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Rc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Rc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets){var r=this.buckets[i],o=r.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];a&&s&&0!==Object.keys(s).length&&(r.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(i).queryRadius(r))))}}},Rc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Rc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()},Rc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Rc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=F.now()+t},Rc.prototype.setDependencies=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1)n[r[i]]=!0;this.dependencies[t]=n},Rc.prototype.hasDependency=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],o=this.dependencies[r];if(o)for(var a=0,s=e;a<s.length;a+=1)if(o[s[a]])return!0}return!1},t.Actor=cc,t.AlphaImage=Uo,t.CanonicalTileID=_c,t.CollisionBoxArray=Cr,t.Color=Yt,t.DEMData=Ec,t.DataConstantProperty=Qi,t.DictionaryCoder=Sc,t.EXTENT=lo,t.ErrorEvent=Tt,t.EvaluationParameters=ji,t.Event=Et,t.Evented=St,t.FeatureIndex=Ic,t.FillBucket=Ia,t.FillExtrusionBucket=Xa,t.ImageAtlas=Gs,t.ImagePosition=Us,t.LineBucket=rs,t.LngLat=pc,t.LngLatBounds=hc,t.MercatorCoordinate=vc,t.ONE_EM=24,t.OverscaledTileID=xc,t.Point=r,t.Point$1=r,t.ProgramConfiguration=ao,t.Properties=tr,t.Protobuf=vs,t.RGBAImage=Vo,t.RequestManager=W,t.ResourceType=pt,t.SegmentVector=Ur,t.SourceFeatureState=Cc,t.StructArrayLayout1ui2=Tr,t.StructArrayLayout2i4=sr,t.StructArrayLayout2ui4=Er,t.StructArrayLayout3ui6=wr,t.StructArrayLayout4i8=ur,t.SymbolBucket=qu,t.Texture=sc,t.Tile=Rc,t.Transitionable=Gi,t.Uniform1f=Xr,t.Uniform1i=qr,t.Uniform2f=Zr,t.Uniform3f=Qr,t.Uniform4f=Yr,t.UniformColor=Kr,t.UniformMatrix4f=$r,t.UnwrappedTileID=bc,t.ValidationError=Mt,t.WritingMode=Ws,t.ZoomHistory=vi,t.addDynamicAttributes=Vu,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var i=t.length,r=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),r[a]=e,0==--i&&n(o,r)}))}))},t.bezier=s,t.bindAll=g,t.browser=F,t.cacheEntryPossiblyAdded=function(t){++ht>ut&&(t.getActor().send("enforceCacheSizeLimit",st),ht=0)},t.clamp=c,t.clearTileCache=function(t){var e=self.caches.delete(at);t&&e.catch(t).then((function(){return t()}))},t.clone=function(t){var e=new Ro(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=_,t.config=z,t.create=function(){var t=new Ro(16);return Ro!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new Ro(9);return Ro!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new Ro(4);return Ro!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Tn,t.createLayout=or,t.createStyleLayer=function(t){return"custom"===t.type?new ec(t):new nc[t.type](t)},t.deepEqual=a,t.ease=u,t.emitValidationErrors=ci,t.endsWith=m,t.enforceCacheSizeLimit=function(t){ct(),$&&$.then((function(e){e.keys().then((function(n){for(var i=0;i<n.length-t;i++)e.delete(n[i])}))}))},t.evaluateSizeForFeature=su,t.evaluateSizeForZoom=uu,t.evaluateVariableOffset=Ru,t.evented=Bi,t.extend=h,t.featureFilter=zn,t.filterObject=v,t.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=eu,t.getAnchorJustification=ku,t.getArrayBuffer=vt,t.getImage=bt,t.getJSON=function(t,e){return yt(h(t,{type:"json"}),e)},t.getRTLTextPluginStatus=Fi,t.getReferrer=dt,t.getVideo=function(t,e){var n,i,r=self.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");n=t[o],i=void 0,(i=self.document.createElement("a")).href=n,(i.protocol!==self.document.location.protocol||i.host!==self.document.location.host)&&(r.crossOrigin="Anonymous"),a.src=t[o],r.appendChild(a)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],f=e[11],d=e[12],A=e[13],g=e[14],m=e[15],y=n*s-i*a,v=n*u-r*a,_=n*c-o*a,b=i*u-r*s,x=i*c-o*s,w=r*c-o*u,E=l*A-h*d,T=l*g-p*d,S=l*m-f*d,P=h*g-p*A,M=h*m-f*A,C=p*m-f*g,I=y*C-v*M+_*P+b*S-x*T+w*E;return I?(I=1/I,t[0]=(s*C-u*M+c*P)*I,t[1]=(r*M-i*C-o*P)*I,t[2]=(A*w-g*x+m*b)*I,t[3]=(p*x-h*w-f*b)*I,t[4]=(u*S-a*C-c*T)*I,t[5]=(n*C-r*S+o*T)*I,t[6]=(g*_-d*w-m*v)*I,t[7]=(l*w-p*_+f*v)*I,t[8]=(a*M-s*S+c*E)*I,t[9]=(i*S-n*M-o*E)*I,t[10]=(d*x-A*_+m*y)*I,t[11]=(h*_-l*x-f*y)*I,t[12]=(s*T-a*P-u*E)*I,t[13]=(n*P-i*T+r*E)*I,t[14]=(A*v-d*b-g*y)*I,t[15]=(l*b-h*v+p*y)*I,t):null},t.isChar=_i,t.isMapboxURL=H,t.keysDifference=function(t,e){var n=[];for(var i in t)i in e||n.push(i);return n},t.makeRequest=yt,t.mapObject=y,t.mercatorXfromLng=Ac,t.mercatorYfromLat=gc,t.mercatorZfromAltitude=mc,t.multiply=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],A=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],b=n[2],x=n[3];return t[0]=v*i+_*s+b*h+x*A,t[1]=v*r+_*u+b*p+x*g,t[2]=v*o+_*c+b*f+x*m,t[3]=v*a+_*l+b*d+x*y,v=n[4],_=n[5],b=n[6],x=n[7],t[4]=v*i+_*s+b*h+x*A,t[5]=v*r+_*u+b*p+x*g,t[6]=v*o+_*c+b*f+x*m,t[7]=v*a+_*l+b*d+x*y,v=n[8],_=n[9],b=n[10],x=n[11],t[8]=v*i+_*s+b*h+x*A,t[9]=v*r+_*u+b*p+x*g,t[10]=v*o+_*c+b*f+x*m,t[11]=v*a+_*l+b*d+x*y,v=n[12],_=n[13],b=n[14],x=n[15],t[12]=v*i+_*s+b*h+x*A,t[13]=v*r+_*u+b*p+x*g,t[14]=v*o+_*c+b*f+x*m,t[15]=v*a+_*l+b*d+x*y,t},t.mvt=Ga,t.number=we,t.ortho=function(t,e,n,i,r,o,a){var s=1/(e-n),u=1/(i-r),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(a+o)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new vs(t).readFields(Fs,[])},t.pbf=vs,t.performSymbolLayout=function(t,e,n,i,o,a){t.createArrays();var s=512*t.overscaling;t.tilePixelRatio=lo/s,t.compareText={},t.iconsNeedLinear=!1;var u=t.layers[0].layout,c=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var h=t.textSizeData,p=h.minZoom,f=h.maxZoom;l.compositeTextSizes=[c["text-size"].possiblyEvaluate(new ji(p)),c["text-size"].possiblyEvaluate(new ji(f))]}if("composite"===t.iconSizeData.kind){var d=t.iconSizeData,A=d.minZoom,g=d.maxZoom;l.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new ji(A)),c["icon-size"].possiblyEvaluate(new ji(g))]}l.layoutTextSize=c["text-size"].possiblyEvaluate(new ji(t.zoom+1)),l.layoutIconSize=c["icon-size"].possiblyEvaluate(new ji(t.zoom+1)),l.textMaxSize=c["text-size"].possiblyEvaluate(new ji(18));for(var m=24*u.get("text-line-height"),y="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),v=u.get("text-keep-upright"),_=u.get("text-size"),b=function(){var a=E[w],s=u.get("text-font").evaluate(a,{}).join(","),c=_.evaluate(a,{}),h=l.layoutTextSize.evaluate(a,{}),p=l.layoutIconSize.evaluate(a,{}),f={horizontal:{},vertical:void 0},d=a.text,A=[0,0];if(d){var g=d.toString(),b=24*u.get("text-letter-spacing").evaluate(a,{}),T=function(t){for(var e=0,n=t;e<n.length;e+=1)if(!xi(n[e].charCodeAt(0)))return!1;return!0}(g)?b:0,S=u.get("text-anchor").evaluate(a,{}),P=u.get("text-variable-anchor");if(!P){var M=u.get("text-radial-offset").evaluate(a,{});A=M?Ru(S,[24*M,Lu]):u.get("text-offset").evaluate(a,{}).map((function(t){return 24*t}))}var C=y?"center":u.get("text-justify").evaluate(a,{}),I=u.get("symbol-placement"),O="point"===I?24*u.get("text-max-width").evaluate(a,{}):0,L=function(){t.allowVerticalPlacement&&bi(g)&&(f.vertical=Xs(d,e,n,o,s,O,m,S,"left",T,A,Ws.vertical,!0,I,h,c))};if(!y&&P){for(var R="auto"===C?P.map((function(t){return ku(t)})):[C],k=!1,D=0;D<R.length;D++){var B=R[D];if(!f.horizontal[B])if(k)f.horizontal[B]=f.horizontal[0];else{var F=Xs(d,e,n,o,s,O,m,"center",B,T,A,Ws.horizontal,!1,I,h,c);F&&(f.horizontal[B]=F,k=1===F.positionedLines.length)}}L()}else{"auto"===C&&(C=ku(S));var z=Xs(d,e,n,o,s,O,m,S,C,T,A,Ws.horizontal,!1,I,h,c);z&&(f.horizontal[C]=z),L(),bi(g)&&y&&v&&(f.vertical=Xs(d,e,n,o,s,O,m,S,C,T,A,Ws.vertical,!1,I,h,c))}}var N=void 0,j=!1;if(a.icon&&a.icon.name){var U=i[a.icon.name];U&&(N=function(t,e,n){var i=eu(n),r=i.horizontalAlign,o=i.verticalAlign,a=e[0],s=e[1],u=a-t.displaySize[0]*r,c=u+t.displaySize[0],l=s-t.displaySize[1]*o;return{image:t,top:l,bottom:l+t.displaySize[1],left:u,right:c}}(o[a.icon.name],u.get("icon-offset").evaluate(a,{}),u.get("icon-anchor").evaluate(a,{})),j=U.sdf,void 0===t.sdfIcons?t.sdfIcons=U.sdf:t.sdfIcons!==U.sdf&&x("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),U.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==u.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}var V=Fu(f.horizontal)||f.vertical;t.iconsInText=!!V&&V.iconsInText,(V||N)&&function(t,e,n,i,o,a,s,u,c,l){var h=a.textMaxSize.evaluate(e,{});void 0===h&&(h=s);var p,f=t.layers[0].layout,d=f.get("icon-offset").evaluate(e,{}),A=Fu(n.horizontal),g=s/24,m=t.tilePixelRatio*g,y=t.tilePixelRatio*h/24,v=t.tilePixelRatio*u,_=t.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*t.tilePixelRatio,w=f.get("icon-padding")*t.tilePixelRatio,E=f.get("text-max-angle")/180*Math.PI,T="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),S="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),P=f.get("symbol-placement"),M=_/2,C=f.get("icon-text-fit");i&&"none"!==C&&(t.allowVerticalPlacement&&n.vertical&&(p=iu(i,n.vertical,C,f.get("icon-text-fit-padding"),d,g)),A&&(i=iu(i,A,C,f.get("icon-text-fit-padding"),d,g)));var I=function(r,s){s.x<0||s.x>=lo||s.y<0||s.y>=lo||function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,w){var E,T,S,P,M,C=t.addToLineVertexArray(e,n),I=0,O=0,L=0,R=0,k=-1,D=-1,B={},F=Cu(""),z=0,N=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(z=(E=s.layout.get("text-offset").evaluate(_,{}).map((function(t){return 24*t})))[0],N=E[1]):(z=24*s.layout.get("text-radial-offset").evaluate(_,{}),N=Lu),t.allowVerticalPlacement&&i.vertical){var j=s.layout.get("text-rotate").evaluate(_,{})+90,U=i.vertical;P=new bu(u,n,e,c,l,h,U,p,f,d,t.overscaling,j),a&&(M=new bu(u,n,e,c,l,h,a,g,m,d,t.overscaling,j))}if(r){var V=s.layout.get("icon-rotate").evaluate(_,{}),G="none"!==s.layout.get("icon-text-fit"),W=gu(r,V,w,G),H=a?gu(a,V,w,G):void 0;S=new bu(u,n,e,c,l,h,r,g,m,!1,t.overscaling,V),I=4*W.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[ou*s.layout.get("icon-size").evaluate(_,{})])[0]>Du&&x(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[ou*b.compositeIconSizes[0].evaluate(_,{}),ou*b.compositeIconSizes[1].evaluate(_,{})])[0]>Du||X[1]>Du)&&x(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,X,v,y,_,!1,e,C.lineStartIndex,C.lineLength,-1),k=t.icon.placedSymbolArray.length-1,H&&(O=4*H.length,t.addSymbols(t.icon,H,X,v,y,_,Ws.vertical,e,C.lineStartIndex,C.lineLength,-1),D=t.icon.placedSymbolArray.length-1)}for(var Z in i.horizontal){var Q=i.horizontal[Z];if(!T){F=Cu(Q.text);var Y=s.layout.get("text-rotate").evaluate(_,{});T=new bu(u,n,e,c,l,h,Q,p,f,d,t.overscaling,Y)}var K=1===Q.positionedLines.length;if(L+=Bu(t,e,Q,o,s,d,_,A,C,i.vertical?Ws.horizontal:Ws.horizontalOnly,K?Object.keys(i.horizontal):[Z],B,k,b),K)break}i.vertical&&(R+=Bu(t,e,i.vertical,o,s,d,_,A,C,Ws.vertical,["vertical"],B,D,b));var J=T?T.boxStartIndex:t.collisionBoxArray.length,$=T?T.boxEndIndex:t.collisionBoxArray.length,tt=P?P.boxStartIndex:t.collisionBoxArray.length,et=P?P.boxEndIndex:t.collisionBoxArray.length,nt=S?S.boxStartIndex:t.collisionBoxArray.length,it=S?S.boxEndIndex:t.collisionBoxArray.length,rt=M?M.boxStartIndex:t.collisionBoxArray.length,ot=M?M.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=qu.MAX_GLYPHS&&x("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical||-1,k,D,F,J,$,tt,et,nt,it,rt,ot,c,L,R,I,O,0,p,z,N)}(t,s,r,n,i,o,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,m,b,T,c,v,w,S,d,e,a,l)};if("line"===P)for(var O=0,L=function(t,e,n,i,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],c=void 0,l=0;l<u.length-1;l++){var h=u[l],p=u[l+1];h.x<0&&p.x<0||(h.x<0?h=new r(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round():p.x<0&&(p=new r(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round()),h.y<0&&p.y<0||(h.y<0?h=new r(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round():p.y<0&&(p=new r(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round()),h.x>=i&&p.x>=i||(h.x>=i?h=new r(i,h.y+(p.y-h.y)*((i-h.x)/(p.x-h.x)))._round():p.x>=i&&(p=new r(i,h.y+(p.y-h.y)*((i-h.x)/(p.x-h.x)))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new r(h.x+(p.x-h.x)*((o-h.y)/(p.y-h.y)),o)._round():p.y>=o&&(p=new r(h.x+(p.x-h.x)*((o-h.y)/(p.y-h.y)),o)._round()),c&&h.equals(c[c.length-1])||(c=[h],a.push(c)),c.push(p)))))}return a}(e.geometry,0,0,lo,lo);O<L.length;O+=1)for(var R=L[O],k=0,D=Au(R,_,E,n.vertical||A,i,24,y,t.overscaling,lo);k<D.length;k+=1){var B=D[k];A&&zu(t,A.text,M,B)||I(R,B)}else if("line-center"===P)for(var F=0,z=e.geometry;F<z.length;F+=1){var N=z[F];if(N.length>1){var j=du(N,E,n.vertical||A,i,24,y);j&&I(N,j)}}else if("Polygon"===e.type)for(var U=0,V=Sa(e.geometry,0);U<V.length;U+=1){var G=V[U],W=Eu(G,16);I(G[0],new ru(W.x,W.y,0))}else if("LineString"===e.type)for(var H=0,q=e.geometry;H<q.length;H+=1){var X=q[H];I(X,new ru(X[0].x,X[0].y,0))}else if("Point"===e.type)for(var Z=0,Q=e.geometry;Z<Q.length;Z+=1)for(var Y=0,K=Q[Z];Y<K.length;Y+=1){var J=K[Y];I([J],new ru(J.x,J.y,0))}}(t,a,f,N,i,l,h,p,A,j)},w=0,E=t.features;w<E.length;w+=1)b();a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,i,r){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){for(var n={},i=0;i<e.length;i++){var r=e[i];r in t&&(n[r]=t[r])}return n},t.plugin=Ni,t.polygonIntersectsPolygon=go,t.postMapLoadEvent=ot,t.postTurnstileEvent=it,t.potpack=js,t.rasterBoundsAttributes=Tc,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=di,t.registerForPluginStateChange=function(t){return t({pluginStatus:Li,pluginURL:Ri}),Bi.on("pluginStateChange",t),t},t.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=i*u+o*s,t[1]=r*u+a*s,t[2]=i*-s+o*u,t[3]=r*-s+a*u,t},t.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*i,t[5]=a*r+l*i,t[6]=s*r+h*i,t[7]=u*r+p*i,t[8]=c*r-o*i,t[9]=l*r-a*i,t[10]=h*r-s*i,t[11]=p*r-u*i,t},t.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*i,t[1]=a*r+l*i,t[2]=s*r+h*i,t[3]=u*r+p*i,t[4]=c*r-o*i,t[5]=l*r-a*i,t[6]=h*r-s*i,t[7]=p*r-u*i,t},t.scale=function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setCacheLimits=function(t,e){st=t,ut=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),Li===Mi||Li===Ci||Li===Ii)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ri=F.resolveURL(t),Li=Mi,Oi=e,Di(),n||zi()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],i=t[2];return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.styleSpec=Pt,t.symbolSize=cu,t.transformMat3=function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t},t.transformMat4=ko,t.translate=function(t,e,n){var i,r,o,a,s,u,c,l,h,p,f,d,A=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*A+e[4]*g+e[8]*m+e[12],t[13]=e[1]*A+e[5]*g+e[9]*m+e[13],t[14]=e[2]*A+e[6]*g+e[10]*m+e[14],t[15]=e[3]*A+e[7]*g+e[11]*m+e[15]):(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*A+s*g+h*m+e[12],t[13]=r*A+u*g+p*m+e[13],t[14]=o*A+c*g+f*m+e[14],t[15]=a*A+l*g+d*m+e[15]),t},t.triggerPluginCompletionEvent=ki,t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=ai,t.validateStyle=oi,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=Ga,t.version="1.6.1",t.warnOnce=x,t.webpSupported=N,t.window=self,t.wrap=l})),i(0,(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",r=0,o=t;r<o.length;r+=1)i+=e(o[r])+",";return i+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var i="",r=0,o=t.refProperties;r<o.length;r+=1)i+="/"+e(n[o[r]]);return i}var i=function(t){this.keyCache={},t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,i){for(var r=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var c=0,l=i;c<l.length;c+=1){var h=l[c];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t,e){for(var i={},r=0;r<t.length;r++){var o=e&&e[t[r].id]||n(t[r]);e&&(e[t[r].id]=o);var a=i[o];a||(a=i[o]=[]),a.push(t[r])}var s=[];for(var u in i)s.push(i[u]);return s}(t.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(t){return r._layers[t.id]})),A=d[0];if("none"!==A.visibility){var g=A.source||"",m=this.familiesBySource[g];m||(m=this.familiesBySource[g]={});var y=A.sourceLayer||"_geojsonTileLayer",v=m[y];v||(v=m[y]=[]),v.push(d)}}};var r=function(e){var n={},i=[];for(var r in e){var o=e[r],a=n[r]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};i.push(c),a[s]={rect:c,metrics:u.metrics}}}}var l=t.potpack(i),h=l.w,p=l.h,f=new t.AlphaImage({width:h||1,height:p||1});for(var d in e){var A=e[d];for(var g in A){var m=A[+g];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var y=n[d][g].rect;t.AlphaImage.copy(m.bitmap,f,{x:0,y:0},{x:y.x+1,y:y.y+1},m.bitmap)}}}this.image=f,this.positions=n};t.register("GlyphAtlas",r);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function a(e,n,i){for(var r=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(r,i)}o.prototype.parse=function(e,n,i,o,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var c=new t.DictionaryCoder(Object.keys(e.layers).sort()),l=new t.FeatureIndex(this.tileID);l.bucketLayerIDs=[];var h,p,f,d,A={},g={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},m=n.familiesBySource[this.source];for(var y in m){var v=e.layers[y];if(v){1===v.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var _=c.encode(y),b=[],x=0;x<v.length;x++){var w=v.feature(x);b.push({feature:w,index:x,sourceLayerIndex:_})}for(var E=0,T=m[y];E<T.length;E+=1){var S=T[E],P=S[0];P.minzoom&&this.zoom<Math.floor(P.minzoom)||P.maxzoom&&this.zoom>=P.maxzoom||"none"!==P.visibility&&(a(S,this.zoom,i),(A[P.id]=P.createBucket({index:l.bucketLayerIDs.length,layers:S,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_,sourceID:this.source})).populate(b,g),l.bucketLayerIDs.push(S.map((function(t){return t.id}))))}}}var M=t.mapObject(g.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(M).length?o.send("getGlyphs",{uid:this.uid,stacks:M},(function(t,e){h||(h=t,p=e,O.call(u))})):p={};var C=Object.keys(g.iconDependencies);C.length?o.send("getImages",{icons:C,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,f=e,O.call(u))})):f={};var I=Object.keys(g.patternDependencies);function O(){if(h)return s(h);if(p&&f&&d){var e=new r(p),n=new t.ImageAtlas(f,d);for(var o in A){var u=A[o];u instanceof t.SymbolBucket?(a(u.layers,this.zoom,i),t.performSymbolLayout(u,p,e.positions,f,n.iconPositions,this.showCollisionBoxes)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(a(u.layers,this.zoom,i),u.addFeatures(g,n.patternPositions))}this.status="done",s(null,{buckets:t.values(A).filter((function(t){return!t.isEmpty()})),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,O.call(u))})):d={},O.call(this)};var s="undefined"!=typeof performance,u={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,n){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,n)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},c=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},u.mark(this._marks.start)};function l(e,n){var i=t.getArrayBuffer(e.request,(function(e,i,r,o){e?n(e):i&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:r,expires:o})}));return function(){i.cancel(),n()}}c.prototype.finish=function(){u.mark(this._marks.end);var t=u.getEntriesByName(this._marks.measure);return 0===t.length&&(u.measure(this._marks.measure,this._marks.start,this._marks.end),t=u.getEntriesByName(this._marks.measure),u.clearMarks(this._marks.start),u.clearMarks(this._marks.end),u.clearMeasures(this._marks.measure)),t},u.Performance=c;var h=function(t,e,n,i){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=i||l,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,n){var i=this,r=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new u.Performance(e.request),s=this.loading[r]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete i.loading[r],e||!o)return s.status="done",i.loaded[r]=s,n(e);var u=o.rawData,c={};o.expires&&(c.expires=o.expires),o.cacheControl&&(c.cacheControl=o.cacheControl);var l={};if(a){var h=a.finish();h&&(l.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,i.layerIndex,i.availableImages,i.actor,(function(e,i){if(e||!i)return n(e);n(null,t.extend({rawTileData:u.slice(0)},i,c,l))})),i.loaded=i.loaded||{},i.loaded[r]=s}))},h.prototype.reloadTile=function(t,e){var n=this,i=this.loaded,r=t.uid,o=this;if(i&&i[r]){var a=i[r];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,i){var r=a.reloadCallback;r&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,r)),e(t,i)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},h.prototype.abortTile=function(t,e){var n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()},h.prototype.removeTile=function(t,e){var n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()};var p=function(){this.loaded={}};p.prototype.loadTile=function(e,n){var i=e.uid,r=e.encoding,o=e.rawImageData,a=new t.DEMData(i,o,r);this.loaded=this.loaded||{},this.loaded[i]=a,n(null,a)},p.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var f=6378137;function d(t){var e=0;if(t&&t.length>0){e+=Math.abs(A(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(A(t[n]))}return e}function A(t){var e,n,i,r,o,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(i=u-2,r=u-1,o=0):a===u-1?(i=u-1,r=0,o=1):(i=a,r=a+1,o=a+2),e=t[i],n=t[r],s+=(g(t[o][0])-g(e[0]))*Math.sin(g(n[1]));s=s*f*f/2}return s}function g(t){return t*Math.PI/180}var m={geometry:function t(e){var n,i=0;switch(e.type){case"Polygon":return d(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)i+=d(e.coordinates[n]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)i+=t(e.geometries[n]);return i}},ring:A};function y(t,e){return function(n){return t(n,e)}}function v(t,e){e=!!e,t[0]=_(t[0],e);for(var n=1;n<t.length;n++)t[n]=_(t[n],!e);return t}function _(t,e){return function(t){return m.ring(t)>=0}(t)===e?t:t.reverse()}var b=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,x=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};x.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,i=this._feature.geometry;n<i.length;n+=1){var r=i[n];e.push([new t.Point$1(r[0],r[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],c=0,l=s[a];c<l.length;c+=1){var h=l[c];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},x.prototype.toGeoJSON=function(t,e,n){return b.call(this,t,e,n)};var w=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};w.prototype.feature=function(t){return new x(this._features[t])};var E=t.vectorTile.VectorTileFeature,T=S;function S(t,e){this.options=e||{},this.features=t,this.length=t.length}function P(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}S.prototype.feature=function(t){return new P(this.features[t],this.options.extent)},P.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var i=e[n],r=[],o=0;o<i.length;o++)r.push(new t.Point$1(i[o][0],i[o][1]));this.geometry.push(r)}return this.geometry},P.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.y)}return[e,i,n,r]},P.prototype.toGeoJSON=E.prototype.toGeoJSON;var M=O,C=O,I=T;function O(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,L,t.layers[n])}(e,n),n.finish()}function L(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,R,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)e.writeMessage(4,z,o[n])}function R(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,k,t),e.writeVarintField(3,n.type),e.writeMessage(4,F,n)}function k(t,e){var n=t.feature,i=t.keys,r=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(i.push(s),u=i.length-1,o[s]=u),e.writeVarint(u);var c=n.properties[s],l=typeof c;"string"!==l&&"boolean"!==l&&"number"!==l&&(c=JSON.stringify(c));var h=l+":"+c,p=a[h];void 0===p&&(r.push(c),p=r.length-1,a[h]=p),e.writeVarint(p)}}function D(t,e){return(e<<3)+(7&t)}function B(t){return t<<1^t>>31}function F(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],c=1;1===i&&(c=u.length),e.writeVarint(D(1,c));for(var l=3===i?u.length-1:u.length,h=0;h<l;h++){1===h&&1!==i&&e.writeVarint(D(2,l-1));var p=u[h].x-r,f=u[h].y-o;e.writeVarint(B(p)),e.writeVarint(B(f)),r+=p,o+=f}3===i&&e.writeVarint(D(7,1))}}function z(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function N(t,e,n,i){j(t,n,i),j(e,2*n,2*i),j(e,2*n+1,2*i+1)}function j(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function U(t,e,n,i){var r=t-n,o=e-i;return r*r+o*o}M.fromVectorTileJs=C,M.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new T(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return O({layers:n})},M.GeoJSONWrapper=I;var V=function(t){return t[0]},G=function(t){return t[1]},W=function(t,e,n,i,r){void 0===e&&(e=V),void 0===n&&(n=G),void 0===i&&(i=64),void 0===r&&(r=Float64Array),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new r(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,i,r,o,a){if(!(o-r<=i)){var s=r+o>>1;!function t(e,n,i,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,u=i-r+1,c=Math.log(s),l=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);t(e,n,i,Math.max(r,Math.floor(i-u*l/s+h)),Math.min(o,Math.floor(i+(s-u)*l/s+h)),a)}var p=n[2*i+a],f=r,d=o;for(N(e,n,r,i),n[2*o+a]>p&&N(e,n,r,o);f<d;){for(N(e,n,f,d),f++,d--;n[2*f+a]<p;)f++;for(;n[2*d+a]>p;)d--}n[2*r+a]===p?N(e,n,r,d):N(e,n,++d,o),d<=i&&(r=d+1),i<=d&&(o=d-1)}}(e,n,s,r,o,a%2),t(e,n,i,r,s-1,a+1),t(e,n,i,s+1,o,a+1)}}(a,s,i,0,a.length-1,0)};W.prototype.range=function(t,e,n,i){return function(t,e,n,i,r,o,a){for(var s,u,c=[0,t.length-1,0],l=[];c.length;){var h=c.pop(),p=c.pop(),f=c.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=r&&u>=i&&u<=o&&l.push(t[d]);else{var A=Math.floor((f+p)/2);s=e[2*A],u=e[2*A+1],s>=n&&s<=r&&u>=i&&u<=o&&l.push(t[A]);var g=(h+1)%2;(0===h?n<=s:i<=u)&&(c.push(f),c.push(A-1),c.push(g)),(0===h?r>=s:o>=u)&&(c.push(A+1),c.push(p),c.push(g))}}return l}(this.ids,this.coords,t,e,n,i,this.nodeSize)},W.prototype.within=function(t,e,n){return function(t,e,n,i,r,o){for(var a=[0,t.length-1,0],s=[],u=r*r;a.length;){var c=a.pop(),l=a.pop(),h=a.pop();if(l-h<=o)for(var p=h;p<=l;p++)U(e[2*p],e[2*p+1],n,i)<=u&&s.push(t[p]);else{var f=Math.floor((h+l)/2),d=e[2*f],A=e[2*f+1];U(d,A,n,i)<=u&&s.push(t[f]);var g=(c+1)%2;(0===c?n-r<=d:i-r<=A)&&(a.push(h),a.push(f-1),a.push(g)),(0===c?n+r>=d:i+r>=A)&&(a.push(f+1),a.push(l),a.push(g))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var H={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},q=function(t){this.options=$(Object.create(H),t),this.trees=new Array(this.options.maxZoom+1)};function X(t,e,n,i,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function Z(t,e){var n=t.geometry.coordinates,i=n[0],r=n[1];return{x:K(i),y:J(r),zoom:1/0,index:e,parentId:-1}}function Q(t){return{type:"Feature",id:t.id,properties:Y(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,i}function Y(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return $($({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function K(t){return t/360+.5}function J(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function $(t,e){for(var n in e)t[n]=e[n];return t}function tt(t){return t.x}function et(t){return t.y}function nt(t,e,n,i,r,o){var a=r-n,s=o-i;if(0!==a||0!==s){var u=((t-n)*a+(e-i)*s)/(a*a+s*s);u>1?(n=r,i=o):u>0&&(n+=a*u,i+=s*u)}return(a=t-n)*a+(s=e-i)*s}function it(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)rt(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)rt(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)rt(t,e[i][r])}(r),r}function rt(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function ot(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=i||0),"Point"===o)at(r,s);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)at(r[c],s);else if("LineString"===o)st(r,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<r.length;c++)s=[],st(r[c],s,a,!1),t.push(it(u,"LineString",s,e.properties));return}ut(r,s,a,!1)}else if("Polygon"===o)ut(r,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)ot(t,{id:u,geometry:e.geometry.geometries[c],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var l=[];ut(r[c],l,a,!0),s.push(l)}}t.push(it(u,o,s,e.properties))}}function at(t,e){e.push(ct(t[0])),e.push(lt(t[1])),e.push(0)}function st(t,e,n,i){for(var r,o,a=0,s=0;s<t.length;s++){var u=ct(t[s][0]),c=lt(t[s][1]);e.push(u),e.push(c),e.push(0),s>0&&(a+=i?(r*c-u*o)/2:Math.sqrt(Math.pow(u-r,2)+Math.pow(c-o,2))),r=u,o=c}var l=e.length-3;e[2]=1,function t(e,n,i,r){for(var o,a=r,s=i-n>>1,u=i-n,c=e[n],l=e[n+1],h=e[i],p=e[i+1],f=n+3;f<i;f+=3){var d=nt(e[f],e[f+1],c,l,h,p);if(d>a)o=f,a=d;else if(d===a){var A=Math.abs(f-s);A<u&&(o=f,u=A)}}a>r&&(o-n>3&&t(e,n,o,r),e[o+2]=a,i-o>3&&t(e,o,i,r))}(e,0,l,n),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function ut(t,e,n,i){for(var r=0;r<t.length;r++){var o=[];st(t[r],o,n,i),e.push(o)}}function ct(t){return t/360+.5}function lt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ht(t,e,n,i,r,o,a,s){if(i/=e,o>=(n/=e)&&a<i)return t;if(a<n||o>=i)return null;for(var u=[],c=0;c<t.length;c++){var l=t[c],h=l.geometry,p=l.type,f=0===r?l.minX:l.minY,d=0===r?l.maxX:l.maxY;if(f>=n&&d<i)u.push(l);else if(!(d<n||f>=i)){var A=[];if("Point"===p||"MultiPoint"===p)pt(h,A,n,i,r);else if("LineString"===p)ft(h,A,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===p)At(h,A,n,i,r,!1);else if("Polygon"===p)At(h,A,n,i,r,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var m=[];At(h[g],m,n,i,r,!0),m.length&&A.push(m)}if(A.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<A.length;g++)u.push(it(l.id,p,A[g],l.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===A.length?(p="LineString",A=A[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===A.length?"Point":"MultiPoint"),u.push(it(l.id,p,A,l.tags))}}}return u.length?u:null}function pt(t,e,n,i,r){for(var o=0;o<t.length;o+=3){var a=t[o+r];a>=n&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ft(t,e,n,i,r,o,a){for(var s,u,c=dt(t),l=0===r?mt:yt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],A=t[p+2],g=t[p+3],m=t[p+4],y=0===r?f:d,v=0===r?g:m,_=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-m,2))),y<n?v>n&&(u=l(c,f,d,g,m,n),a&&(c.start=h+s*u)):y>i?v<i&&(u=l(c,f,d,g,m,i),a&&(c.start=h+s*u)):gt(c,f,d,A),v<n&&y>=n&&(u=l(c,f,d,g,m,n),_=!0),v>i&&y<=i&&(u=l(c,f,d,g,m,i),_=!0),!o&&_&&(a&&(c.end=h+s*u),e.push(c),c=dt(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],A=t[b+2],(y=0===r?f:d)>=n&&y<=i&&gt(c,f,d,A),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&gt(c,c[0],c[1],c[2]),c.length&&e.push(c)}function dt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function At(t,e,n,i,r,o){for(var a=0;a<t.length;a++)ft(t[a],e,n,i,r,o,!1)}function gt(t,e,n,i){t.push(e),t.push(n),t.push(i)}function mt(t,e,n,i,r,o){var a=(o-e)/(i-e);return t.push(o),t.push(n+(r-n)*a),t.push(1),a}function yt(t,e,n,i,r,o){var a=(o-n)/(r-n);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function vt(t,e){for(var n=[],i=0;i<t.length;i++){var r,o=t[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=_t(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var s=0;s<o.geometry.length;s++)r.push(_t(o.geometry[s],e))}else if("MultiPolygon"===a)for(r=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(_t(o.geometry[s][c],e));r.push(u)}n.push(it(o.id,a,r,o.tags))}return n}function _t(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function bt(t,e){if(t.transformed)return t;var n,i,r,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(i=0;i<c.length;i+=2)u.geometry.push(xt(c[i],c[i+1],e,o,a,s));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(xt(c[i][r],c[i][r+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function xt(t,e,n,i,r,o){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-o))]}function wt(t,e,n,i,r){for(var o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Et(a,t[s],o,r);var u=t[s].minX,c=t[s].minY,l=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function Et(t,e,n,i){var r=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Tt(a,r,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)Tt(a,r[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<r.length;u++){var c=r[u];for(s=0;s<c.length;s++)Tt(a,c[s],t,n,!0,0===s)}if(a.length){var l=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in l={},e.tags)l[h]=e.tags[h];l.mapbox_clip_start=r.start/r.size,l.mapbox_clip_end=r.end/r.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==e.id&&(p.id=e.id),t.features.push(p)}}function Tt(t,e,n,i,r,o){var a=i*i;if(i>0&&e.size<(r?a:i))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,o=r-2;i<r;o=i,i+=2)n+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=a,t[r-1-i]=s}}(s,o),t.push(s)}}function St(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)ot(n,t.features[i],e,i);else"Feature"===t.type?ot(n,t,e):ot(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,i=t,r=ht(t,1,-1-n,n,0,-1,2,e),o=ht(t,1,1-n,2+n,0,-1,2,e);return(r||o)&&(i=ht(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=vt(r,1).concat(i)),o&&(i=i.concat(vt(o,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pt(t,e,n){return 32*((1<<t)*n+e)+t}function Mt(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);var r=new w(i.features),o=M(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}q.prototype.load=function(t){var e=this.options,n=e.log,i=e.minZoom,r=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(Z(t[u],u));this.trees[r+1]=new W(s,tt,et,o,Float32Array),n&&console.timeEnd(a);for(var c=r;c>=i;c--){var l=+Date.now();s=this._cluster(s,c),this.trees[c]=new W(s,tt,et,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-l)}return n&&console.timeEnd("total time"),this},q.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){var a=this.getClusters([n,i,180,o],e),s=this.getClusters([-180,i,r,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],c=[],l=0,h=u.range(K(n),J(o),K(r),J(i));l<h.length;l+=1){var p=h[l],f=u.points[p];c.push(f.numPoints?Q(f):this.points[f.index])}return c},q.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);var o=r.points[e];if(!o)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,c=r.within(o.x,o.y,a);u<c.length;u+=1){var l=c[u],h=r.points[l];h.parentId===t&&s.push(h.numPoints?Q(h):this.points[h.index])}if(0===s.length)throw new Error(i);return s},q.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var i=[];return this._appendLeaves(i,t,e,n,0),i},q.prototype.getTile=function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/r,c=(n+1+s)/r,l={features:[]};return this._addTileFeatures(i.range((e-s)/r,u,(e+1+s)/r,c),i.points,e,n,r,l),0===e&&this._addTileFeatures(i.range(1-s/r,u,1,c),i.points,r,n,r,l),e===r-1&&this._addTileFeatures(i.range(0,u,s/r,c),i.points,-1,n,r,l),l.features.length?l:null},q.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},q.prototype._appendLeaves=function(t,e,n,i,r){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?r+u.point_count<=i?r+=u.point_count:r=this._appendLeaves(t,u.cluster_id,n,i,r):r<i?r++:t.push(s),t.length===n)break}return r},q.prototype._addTileFeatures=function(t,e,n,i,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],c=u.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(u.x*r-n)),Math.round(this.options.extent*(u.y*r-i))]],tags:c?Y(u):this.points[u.index].properties},h=void 0;c?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(l.id=h),o.features.push(l)}},q.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},q.prototype._cluster=function(t,e){for(var n=[],i=this.options,r=i.radius,o=i.extent,a=i.reduce,s=r/(o*Math.pow(2,e)),u=0;u<t.length;u++){var c=t[u];if(!(c.zoom<=e)){c.zoom=e;for(var l=this.trees[e+1],h=l.within(c.x,c.y,s),p=c.numPoints||1,f=c.x*p,d=c.y*p,A=a&&p>1?this._map(c,!0):null,g=(u<<5)+(e+1)+this.points.length,m=0,y=h;m<y.length;m+=1){var v=y[m],_=l.points[v];if(!(_.zoom<=e)){_.zoom=e;var b=_.numPoints||1;f+=_.x*b,d+=_.y*b,p+=b,_.parentId=g,a&&(A||(A=this._map(c,!0)),a(A,this._map(_)))}}1===p?n.push(c):(c.parentId=g,n.push(X(f/p,d/p,g,p,A)))}}return n},q.prototype._getOriginId=function(t){return t-this.points.length>>5},q.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},q.prototype._map=function(t,e){if(t.numPoints)return e?$({},t.properties):t.properties;var n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?$({},i):i},St.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},St.prototype.splitTile=function(t,e,n,i,r,o,a){for(var s=[t,e,n,i],u=this.options,c=u.debug;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var l=1<<e,h=Pt(e,n,i),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=wt(t,e,n,i,u),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,r){if(e===u.maxZoom||e===r)continue;var d=1<<r-e;if(n!==Math.floor(o/d)||i!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var A,g,m,y,v,_,b=.5*u.buffer/u.extent,x=.5-b,w=.5+b,E=1+b;A=g=m=y=null,v=ht(t,l,n-b,n+w,0,p.minX,p.maxX,u),_=ht(t,l,n+x,n+E,0,p.minX,p.maxX,u),t=null,v&&(A=ht(v,l,i-b,i+w,1,p.minY,p.maxY,u),g=ht(v,l,i+x,i+E,1,p.minY,p.maxY,u),v=null),_&&(m=ht(_,l,i-b,i+w,1,p.minY,p.maxY,u),y=ht(_,l,i+x,i+E,1,p.minY,p.maxY,u),_=null),c>1&&console.timeEnd("clipping"),s.push(A||[],e+1,2*n,2*i),s.push(g||[],e+1,2*n,2*i+1),s.push(m||[],e+1,2*n+1,2*i),s.push(y||[],e+1,2*n+1,2*i+1)}}},St.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,o=i.debug;if(t<0||t>24)return null;var a=1<<t,s=Pt(t,e=(e%a+a)%a,n);if(this.tiles[s])return bt(this.tiles[s],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,c=t,l=e,h=n;!u&&c>0;)c--,l=Math.floor(l/2),h=Math.floor(h/2),u=this.tiles[Pt(c,l,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,l,h),o>1&&console.time("drilling down"),this.splitTile(u.source,c,l,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?bt(this.tiles[s],r):null):null};var Ct=function(e){function n(t,n,i,r){e.call(this,t,n,i,Mt),r&&(this.loadGeoJSON=r)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var r=!!(i&&i.request&&i.request.collectResourceTiming)&&new u.Performance(i.request);this.loadGeoJSON(i,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+i.source+"' is not a valid GeoJSON object."));!function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(y(t,n)),e;case"GeometryCollection":return e.geometries=e.geometries.map(y(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=v(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(y(v,e))),t}(e,n);default:return e}}(a,!0);try{e._geoJSONIndex=i.cluster?new q(function(e){var n=e.superclusterOptions,i=e.clusterProperties;if(!i||!n)return n;for(var r={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(i),c=0,l=u;c<l.length;c+=1){var h=l[c],p=i[h],f=p[0],d=p[1],A=t.createExpression(d),g=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);r[h]=A.value,o[h]=g.value}return n.map=function(t){s.properties=t;for(var e={},n=0,i=u;n<i.length;n+=1){var o=i[n];e[o]=r[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,i=u;n<i.length;n+=1){var r=i[n];a.accumulated=t[r],t[r]=o[r].evaluate(a,s)}},n}(i)).load(a.features):function(t,e){return new St(t,e)}(a,i.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var s={};if(r){var u=r.finish();u&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(u)))}n(null,s)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var i=this.loaded,r=t.uid;return i&&i[r]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},n.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},n.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},n}(h),It=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:h,geojson:Ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return It.prototype.setReferrer=function(t,e){this.referrer=e},It.prototype.setImages=function(t,e,n){this.availableImages[t]=e,n()},It.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},It.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},It.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},It.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},It.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},It.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},It.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},It.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},It.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}},It.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},It.prototype.syncRTLPluginState=function(e,n,i){try{t.plugin.setState(n);var r=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=r){this.self.importScripts(r);var o=t.plugin.isParsed();i(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+r),o)}}catch(t){i(t.toString())}},It.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},It.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},It.prototype.getWorkerSource=function(t,e,n){var i=this;if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){var r={send:function(e,n,r){i.actor.send(e,n,r,t)}};this.workerSources[t][e][n]=new this.workerSourceTypes[e](r,this.getLayerIndex(t),this.getAvailableImages(t))}return this.workerSources[t][e][n]},It.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},It.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new It(t.window)),It})),i(0,(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===n[t]&&(n[t]=function(t){var n=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",i)||n.probablySupportsContext("experimental-webgl",i):n.supportsContext?n.supportsContext("webgl",i)||n.supportsContext("experimental-webgl",i):n.getContext("webgl",i)||n.getContext("experimental-webgl",i)}(t)),n[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,i){var r=t.window.document.createElement(e);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},i=t.window.document.documentElement.style;function r(t){if(!i)return t[0];for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var o,a=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){i&&a&&(o=i[a],i[a]="none")},n.enableDrag=function(){i&&a&&(i[a]=o)};var s=r(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var c=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",c,c),t.window.removeEventListener("test",c,c)}catch(t){u=!1}n.addEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&u?t.addEventListener(e,n,i):t.addEventListener(e,n,i.capture)},n.removeEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&u?t.removeEventListener(e,n,i):t.removeEventListener(e,n,i.capture)};var l=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",l,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",l,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",l,!0)}),0)},n.mousePos=function(e,n){var i=e.getBoundingClientRect(),r=t.window.TouchEvent&&n instanceof t.window.TouchEvent?n.touches[0]:n;return new t.Point(r.clientX-i.left-e.clientLeft,r.clientY-i.top-e.clientTop)},n.touchPos=function(e,n){for(var i=e.getBoundingClientRect(),r=[],o="touchend"===n.type?n.changedTouches:n.touches,a=0;a<o.length;a++)r.push(new t.Point(o[a].clientX-i.left-e.clientLeft,o[a].clientY-i.top-e.clientTop));return r},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var i=n[e],r=i.ids,o=i.callback;this._notify(r,o)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),i=!1),i},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,i=0,r=t;i<r.length;i+=1){var o=r[i];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){var n=this.images[t];e.version=n.version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var i=0,r=t;i<r.length;i+=1){var o=r[i];this.images[o]||(n=!1)}this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var i={},r=0,o=e;r<o.length;r+=1){var a=o[r];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?i[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,i)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{var r={w:i.data.width+2,h:i.data.height+2,x:0,y:0},o=new t.ImagePosition(r,i);this.patterns[e]={bin:r,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var i=t.potpack(e),r=i.w,o=i.h,a=this.atlasImage;for(var s in a.resize({width:r||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,c=u.x+1,l=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:l},{width:p,height:f}),t.RGBAImage.copy(h,a,{x:0,y:f-1},{x:c,y:l-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:l+f},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:c-1,y:l},{width:1,height:f}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c+p,y:l},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var r=this.images[i];h(r)&&this.updateImage(i,r)}}},n}(t.Evented),f=g,d=g,A=1e20;function g(t,e,n,i,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function m(t,e,n,i,r,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)i[u]=t[u*e+s];for(y(i,r,o,a,n),u=0;u<n;u++)t[u*e+s]=r[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)i[s]=t[u*e+s];for(y(i,r,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(r[s])}}function y(t,e,n,i,r){n[0]=0,i[0]=-A,i[1]=+A;for(var o=1,a=0;o<r;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=i[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,i[a]=s,i[a+1]=+A}for(o=0,a=0;o<r;o++){for(;i[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var r=e.data[4*i+3]/255;this.gridOuter[i]=1===r?0:0===r?A:Math.pow(Math.max(0,.5-r),2),this.gridInner[i]=1===r?A:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(m(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),m(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++){var o=this.gridOuter[i]-this.gridInner[i];n[i]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return n},f.default=d;var v=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};v.prototype.setURL=function(t){this.url=t},v.prototype.getGlyphs=function(e,n){var i=this,r=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1){var u=s[a];r.push({stack:o,id:u})}t.asyncAll(r,(function(t,e){var n=t.stack,r=t.id,o=i.entries[n];o||(o=i.entries[n]={glyphs:{},requests:{}});var a=o.glyphs[r];if(void 0===a){if(a=i._tinySDF(o,n,r))return o.glyphs[r]=a,void e(null,{stack:n,id:r,glyph:a});var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var u=o.requests[s];u||(u=o.requests[s]=[],v.loadGlyphRange(n,s,i.url,i.requestManager,(function(t,e){if(e)for(var n in e)i._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);for(var r=0,a=u;r<a.length;r+=1)(0,a[r])(t,e);delete o.requests[s]}))),u.push((function(t,i){t?e(t):i&&e(null,{stack:n,id:r,glyph:i[r]||null})}))}}else e(null,{stack:n,id:r,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var i={},r=0,o=e;r<o.length;r+=1){var a=o[r],s=a.stack,u=a.id,c=a.glyph;(i[s]||(i[s]={}))[u]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}n(null,i)}}))},v.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},v.prototype._tinySDF=function(e,n,i){var r=this.localIdeographFontFamily;if(r&&this._doesCharSupportLocalGlyph(i)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new v.TinySDF(24,3,8,.25,r,a)}return{id:i,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},v.loadGlyphRange=function(e,n,i,r,o){var a=256*n,s=a+255,u=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var i={},r=0,a=t.parseGlyphPBF(n);r<a.length;r+=1){var s=a[r];i[s.id]=s}o(null,i)}}))},v.TinySDF=f;var _=function(){this.specification=t.styleSpec.light.position};_.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},_.prototype.interpolate=function(e,n,i){return{x:t.number(e.x,n.x,i),y:t.number(e.y,n.y,i),z:t.number(e.z,n.z,i)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new _,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),x=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var i in e){var r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),r):this._transitionable.setValue(i,r)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),w=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};w.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},w.prototype.addDash=function(e,n){var i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];for(var s=this.width/o,u=s/2,c=e.length%2==1,l=-i;l<=i;l++)for(var h=this.nextRow+i+l,p=this.width*h,f=c?-e[e.length-1]:0,d=e[0],A=1,g=0;g<this.width;g++){for(;d<g/s;)f=d,d+=e[A],c&&A===e.length-1&&(d+=e[0]),A++;var m=Math.abs(g-f*s),y=Math.abs(g-d*s),v=Math.min(m,y),_=A%2==1,b=void 0;if(n){var x=i?l/i*(u+1):0;if(_){var w=u-Math.abs(x);b=Math.sqrt(v*v+w*w)}else b=u-Math.sqrt(v*v+x*x)}else b=(_?1:-1)*v;this.data[3+4*(p+g)]=Math.max(0,Math.min(255,b+128))}var E={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:o};return this.nextRow+=r,this.dirty=!0,E},w.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var E=function e(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var r=this.workerPool.acquire(this.id),o=0;o<r.length;o++){var a=r[o],s=new e.Actor(a,i,this.id);s.name="Worker "+o,this.actors.push(s)}};function T(e,n,i){var r=function(r,o){if(r)return i(r);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),e.url&&(a.tiles=n.canonicalizeTileset(a,e.url)),i(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.browser.frame((function(){return r(null,e)}))}E.prototype.broadcast=function(e,n,i){i=i||function(){},t.asyncAll(this.actors,(function(t,i){t.send(e,n,i)}),i)},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var S=function(e,n,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24};S.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},S.prototype.contains=function(e){var n=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=i&&e.x<o&&e.y>=r&&e.y<a};var P=function(e){function n(n,i,r,o){if(e.call(this),this.id=n,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,i){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new S(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,null),r={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function o(i,r){return delete e.request,e.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",r,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.clearMask(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),M=function(e){function n(n,i,r,o){e.call(this),this.id=n,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,i){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new S(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var i=this,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){i.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=i.map.painter.context,s=a.gl;e.texture=i.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(i.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),t.clearMask(),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),C=function(e){function n(n,i,r,o){e.call(this,n,i,r,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);function r(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,r.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+i)%i,s=n.x+1===i?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<i&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.clearMask(),t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(M),I=function(e){function n(n,i,r,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(o),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution);var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*a,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(i.clusterRadius||50)*a,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties},i.workerOptions)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",i))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var i={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(i.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",i))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},i),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var i=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.actor.send(this.type+".loadData",i,(function(t,r){n._removed||r&&r.abandoned||(n._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[n.id]&&(n._resourceTiming=r.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:i.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var i=this,r=e.actor?"reloadTile":"loadTile";e.actor=this.actor;var o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};e.request=this.actor.send(r,o,(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,i.map.painter,"reloadTile"===r),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.clearMask(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),O=function(e){function n(t,n,i,r){e.call(this),this.id=t,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(e,n){var i=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(r,o){i._loaded=!0,r?i.fire(new t.ErrorEvent(r)):o&&(i.image=o,e&&(i.coordinates=e),n&&n(),i._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,i=1/0,r=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),o=Math.max(o,u.y)}var c=r-n,l=o-i,h=Math.max(c,l),p=Math.max(0,Math.floor(-Math.log(h)/Math.LN2)),f=Math.pow(2,p);return new t.CanonicalTileID(p,Math.floor((n+r)/2*f),Math.floor((i+o)/2*f))}(i),this.minzoom=this.maxzoom=this.tileID.z;var r=i.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),L=function(e){function n(t,n,i,r){e.call(this,t,n,i,r),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var i=0,r=n.urls;i<r.length;i+=1){var o=r[i];this.urls.push(this.map._requestManager.transformRequest(o,t.ResourceType.Source).url)}t.getVideo(this.urls,(function(n,i){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(e.video=i,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(O),R=function(e){function n(n,i,r,o){e.call(this,n,i,r,o),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,i=n.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,i.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[r];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(O),k={vector:P,raster:M,"raster-dem":C,geojson:I,video:L,image:O,canvas:R};function D(e,n){var i=t.identity([]);return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(n.toUnwrapped()))}function B(t,e,n,i,r){var o=function(t,e,n){if(t)for(var i=0,r=t;i<r.length;i+=1){var o=e[r[i]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),a=r.maxPitchScaleFactor(),s=t.tilesIn(n,a,o);s.sort(F);for(var u=[],c=0,l=s;c<l.length;c+=1){var h=l[c];u.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,i,r,a,D(t.transform,h.tileID))})}var p=function(t){for(var e={},n={},i=0,r=t;i<r.length;i+=1){var o=r[i],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var c in a)for(var l=a[c],h=u[c]=u[c]||{},p=e[c]=e[c]||[],f=0,d=l;f<d.length;f+=1){var A=d[f];h[A.featureIndex]||(h[A.featureIndex]=!0,p.push(A))}}return e}(u);for(var f in p)p[f].forEach((function(e){var n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return p}function F(t,e){var n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}var z=function(t,e){this.max=t,this.onRemove=e,this.reset()};z.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var i=n[e];i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}return this.data={},this.order=[],this},z.prototype.add=function(t,e,n){var i=this,r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){i.remove(t,o)}),n)),this.data[r].push(o),this.order.push(r),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},z.prototype.has=function(t){return t.wrapped().key in this.data},z.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},z.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},z.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},z.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this},z.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},z.prototype.filter=function(t){var e=[];for(var n in this.data)for(var i=0,r=this.data[n];i<r.length;i+=1){var o=r[i];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var N=function(t,e,n){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};N.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},N.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},N.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var j={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],r=e.attributes[i.name];void 0!==r&&t.enableVertexAttribArray(r)}},U.prototype.setVertexAttribPointers=function(t,e,n){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[j[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}},U.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var G=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),it=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),At=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),gt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),_t=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e}(V),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(_t),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(_t),wt=function(t,e,n){this.context=t,this.width=e,this.height=n;var i=t.gl,r=this.framebuffer=i.createFramebuffer();this.colorAttachment=new bt(t,r),this.depthAttachment=new xt(t,r)};wt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n),t.deleteFramebuffer(this.framebuffer)};var Et=function(t,e,n){this.func=t,this.mask=e,this.range=n};Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);var Tt=function(t,e,n,i,r,o){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o};Tt.disabled=new Tt({func:519,mask:0},0,0,7680,7680,7680);var St=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};St.disabled=new St(St.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),St.unblended=new St(St.Replace,t.Color.transparent,[!0,!0,!0,!0]),St.alphaBlended=new St([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Pt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};Pt.disabled=new Pt(!1,1029,2305),Pt.backCCW=new Pt(!0,1029,2305);var Mt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new W(this),this.clearStencil=new H(this),this.colorMask=new q(this),this.depthMask=new X(this),this.stencilMask=new Z(this),this.stencilFunc=new Q(this),this.stencilOp=new Y(this),this.stencilTest=new K(this),this.depthRange=new J(this),this.depthTest=new $(this),this.depthFunc=new tt(this),this.blend=new et(this),this.blendFunc=new nt(this),this.blendColor=new it(this),this.blendEquation=new rt(this),this.cullFace=new ot(this),this.cullFaceSide=new at(this),this.frontFace=new st(this),this.program=new ut(this),this.activeTexture=new ct(this),this.viewport=new lt(this),this.bindFramebuffer=new ht(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new dt(this),this.bindElementBuffer=new At(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gt(this),this.pixelStoreUnpack=new mt(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new vt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query")};Mt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Mt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Mt.prototype.createIndexBuffer=function(t,e){return new N(this,t,e)},Mt.prototype.createVertexBuffer=function(t,e,n){return new U(this,t,e,n)},Mt.prototype.createRenderbuffer=function(t,e,n){var i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r},Mt.prototype.createFramebuffer=function(t,e){return new wt(this,t,e)},Mt.prototype.clear=function(t){var e=t.color,n=t.depth,i=this.gl,r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),i.clear(r)},Mt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Mt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Mt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Mt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,St.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Mt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ct=function(e){function n(n,i,r){var o=this;e.call(this),this.id=n,this.dispatcher=r,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,i,r){var o=new k[n.type](e,n,i,r);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,i,r,this),this._tiles={},this._cache=new z(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(It)},n.prototype.getRenderableIds=function(e){var n=this,i=[];for(var r in this._tiles)this._isIdRenderable(+r,e)&&i.push(+r);return e?i.sort((function(e,i){var r=n._tiles[e].tileID,o=n._tiles[i].tileID,a=new t.Point(r.canonical.x,r.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return r.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})):i.sort(It)},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var i=e[n];if(t.neighboringTiles&&t.neighboringTiles[i]){var r=this.getTileByID(i);o(t,r),o(r,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,i){for(var r in this._tiles){var o=this._tiles[r];if(!(i[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){i[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){for(var n=t.overscaledZ-1;n>=e;n--){var i=t.scaledTo(n);if(!i)return;var r=String(i.key),o=this._tiles[r];if(o&&o.hasData())return o;if(this._cache.has(i))return this._cache.get(i)}},n.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),n=Math.floor(5*e),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,n=Math.round(e);if(this._prevLng=t,n){var i={};for(var r in this._tiles){var o=this._tiles[r];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+n),i[o.tileID.key]=o}for(var a in this._tiles=i,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var s in this._tiles){var u=this._tiles[s];this._setTileReloadTimer(s,u)}}},n.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter((function(t){return i._source.hasTile(t)})))):r=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(r,o);if(Ot(this._source.type)){for(var c={},l={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],A=this._tiles[f];if(A&&!(A.fadeEndTime&&A.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(d,a);g&&(this._addTile(g.tileID),c[g.tileID.key]=g.tileID),l[f]=d}}for(var m in this._retainLoadedChildren(l,o,s,u),c)u[m]||(this._coveredTiles[m]=!0,u[m]=c[m])}for(var y in u)this._tiles[y].clearFadeHold();for(var v=0,_=t.keysDifference(this._tiles,u);v<_.length;v+=1){var b=_[v],x=this._tiles[b];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(b)}}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var i={},r={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,c=t;u<c.length;u+=1){var l=c[u],h=this._addTile(l);i[l.key]=l,h.hasData()||e<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,e,a,i);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],A=this._tiles[d.key];if(!A.hasData()){if(e+1>this._source.maxzoom){var g=d.children(this._source.maxzoom)[0],m=this.getTile(g);if(m&&m.hasData()){i[g.key]=g;continue}}else{var y=d.children(this._source.maxzoom);if(i[y[0].key]&&i[y[1].key]&&i[y[2].key]&&i[y[3].key])continue}for(var v=A.wasRequested(),_=d.overscaledZ-1;_>=o;--_){var b=d.scaledTo(_);if(r[b.key])break;if(r[b.key]=!0,!(A=this.getTile(b))&&v&&(A=this._addTile(b)),A&&(i[b.key]=b,v=A.wasRequested(),A.hasData()))break}}}return i},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var i=Boolean(n);return i||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),i))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,i){var r=this,o=[],a=this.transform;if(!a)return o;for(var s=i?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),c=s.map((function(t){return a.pointCoordinate(t)})),l=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,A=0,g=c;A<g.length;A+=1){var m=g[A];h=Math.min(h,m.x),p=Math.min(p,m.y),f=Math.max(f,m.x),d=Math.max(d,m.y)}for(var y=function(e){var i=r._tiles[l[e]];if(!i.holdingForFade()){var s=i.tileID,A=Math.pow(2,a.zoom-i.tileID.overscaledZ),g=n*i.queryPadding*t.EXTENT/i.tileSize/A,m=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(m[0].x-g<t.EXTENT&&m[0].y-g<t.EXTENT&&m[1].x+g>=0&&m[1].y+g>=0){var y=u.map((function(t){return s.getTilePoint(t)})),v=c.map((function(t){return s.getTilePoint(t)}));o.push({tile:i,tileID:s,queryGeometry:y,cameraQueryGeometry:v,scale:A})}}},v=0;v<l.length;v++)y(v);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),i=0,r=n;i<r.length;i+=1){var o=r[i];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ot(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.updateState(t,e,n)},n.prototype.removeFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.removeFeatureState(t,e,n)},n.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},n.prototype.setDependencies=function(t,e,n){var i=this._tiles[t];i&&i.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function It(t,e){return t%32-e%32||e-t}function Ot(t){return"raster"===t||"image"===t||"video"===t}function Lt(){return new t.window.Worker(nr.workerUrl)}Ct.maxOverzooming=10,Ct.maxUnderzooming=3;var Rt=function(){this.active={}};Rt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new Lt);return this.active[t]=!0,this.workers.slice()},Rt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)};var kt,Dt=Math.floor(t.browser.hardwareConcurrency/2);function Bt(e,n){var i={};for(var r in e)"ref"!==r&&(i[r]=e[r]);return t.refProperties.forEach((function(t){t in n&&(i[t]=n[t])})),i}function Ft(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Bt(t[i],e[t[i].ref]));return t}Rt.workerCount=Math.max(Math.min(Dt,6),1);var zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Nt(t,e,n){n.push({command:zt.addSource,args:[t,e[t]]})}function jt(t,e,n){e.push({command:zt.removeSource,args:[t]}),n[t]=!0}function Ut(t,e,n,i){jt(t,n,i),Nt(t,e,n)}function Vt(e,n,i){var r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;return!0}function Gt(e,n,i,r,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:a,args:[r,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:a,args:[r,s,n[s],o]}))}function Wt(t){return t.id}function Ht(t,e){return t[e.id]=e,t}var qt=function(t,e,n){var i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Xt(e,n,i,r,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),i||t.rotateZ(a,a,r.angle)):t.multiply(a,r.labelPlaneMatrix,e),a}function Zt(e,n,i,r,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),i||t.rotateZ(a,a,-r.angle),a}return r.glCoordMatrix}function Qt(e,n){var i=[e.x,e.y,0,1];oe(i,i,n);var r=i[3];return{point:new t.Point(i[0]/r,i[1]/r),signedDistanceFromCamera:r}}function Yt(t,e){var n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function Kt(e,n,i,r,o,a,s,u){var c=r?e.textSizeData:e.iconSizeData,l=t.evaluateSizeForZoom(c,i.transform.zoom),h=[256/i.width*2+1,256/i.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,A=i.transform.width/i.transform.height,g=!1,m=0;m<d.length;m++){var y=d.get(m);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!g)re(y.numGlyphs,p);else{g=!1;var v=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(v,v,n),Yt(v,h)){var _=.5+v[3]/i.transform.cameraToCenterDistance*.5,b=t.evaluateSizeForFeature(c,l,y),x=s?b*_:b/_,w=new t.Point(y.anchorX,y.anchorY),E=Qt(w,o).point,T={},S=te(y,x,!1,u,n,o,a,e.glyphOffsetArray,f,p,E,w,T,A);g=S.useVertical,(S.notEnoughRoom||g||S.needsFlipping&&te(y,x,!0,u,n,o,a,e.glyphOffsetArray,f,p,E,w,T,A).notEnoughRoom)&&re(y.numGlyphs,p)}else re(y.numGlyphs,p)}}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function Jt(t,e,n,i,r,o,a,s,u,c,l,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,A=e.getoffsetX(s.glyphStartIndex),g=e.getoffsetX(p-1),m=ne(t*A,n,i,r,o,a,s.segment,f,d,u,c,l,h);if(!m)return null;var y=ne(t*g,n,i,r,o,a,s.segment,f,d,u,c,l,h);return y?{first:m,last:y}:null}function $t(e,n,i,r){return e===t.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function te(e,n,i,r,o,a,s,u,c,l,h,p,f,d){var A,g=n/24,m=e.lineOffsetX*g,y=e.lineOffsetY*g;if(e.numGlyphs>1){var v=e.glyphStartIndex+e.numGlyphs,_=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,x=Jt(g,u,m,y,i,h,p,e,c,a,f,!1);if(!x)return{notEnoughRoom:!0};var w=Qt(x.first.point,s).point,E=Qt(x.last.point,s).point;if(r&&!i){var T=$t(e.writingMode,w,E,d);if(T)return T}A=[x.first];for(var S=e.glyphStartIndex+1;S<v-1;S++)A.push(ne(g*u.getoffsetX(S),m,y,i,h,p,e.segment,_,b,c,a,f,!1));A.push(x.last)}else{if(r&&!i){var P=Qt(p,o).point,M=e.lineStartIndex+e.segment+1,C=new t.Point(c.getx(M),c.gety(M)),I=Qt(C,o),O=I.signedDistanceFromCamera>0?I.point:ee(p,C,P,1,o),L=$t(e.writingMode,P,O,d);if(L)return L}var R=ne(g*u.getoffsetX(e.glyphStartIndex),m,y,i,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,a,f,!1);if(!R)return{notEnoughRoom:!0};A=[R]}for(var k=0,D=A;k<D.length;k+=1){var B=D[k];t.addDynamicAttributes(l,B.point,B.angle)}return{}}function ee(t,e,n,i,r){var o=Qt(t.add(t.sub(e)._unit()),r).point,a=n.sub(o);return n.add(a._mult(i/a.mag()))}function ne(e,n,i,r,o,a,s,u,c,l,h,p,f){var d=r?e-n:e+n,A=d>0?1:-1,g=0;r&&(A*=-1,g=Math.PI),A<0&&(g+=Math.PI);for(var m=A>0?u+s:u+s+1,y=m,v=o,_=o,b=0,x=0,w=Math.abs(d);b+x<=w;){if((m+=A)<u||m>=c)return null;if(_=v,void 0===(v=p[m])){var E=new t.Point(l.getx(m),l.gety(m)),T=Qt(E,h);if(T.signedDistanceFromCamera>0)v=p[m]=T.point;else{var S=m-A;v=ee(0===b?a:new t.Point(l.getx(S),l.gety(S)),E,_,w-b+1,h)}}b+=x,x=_.dist(v)}var P=(w-b)/x,M=v.sub(_),C=M.mult(P)._add(_);return C._add(M._unit()._perp()._mult(i*A)),{point:C,angle:g+Math.atan2(v.y-_.y,v.x-_.x),tileDistance:f?{prevTileDistance:m-A===y?0:l.gettileUnitDistanceFromAnchor(m-A),lastSegmentViewportDistance:w-b}:null}}qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},qt.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},qt.prototype.insertCircle=function(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)},qt.prototype._insertBoxCell=function(t,e,n,i,r,o){this.boxCells[r].push(o)},qt.prototype._insertCircleCell=function(t,e,n,i,r,o){this.circleCells[r].push(o)},qt.prototype._query=function(t,e,n,i,r,o){if(n<0||t>this.width||i<0||e>this.height)return!r&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var c=this.circles[3*u],l=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:c-h,y1:l-h,x2:c+h,y2:l+h})}return o?a.filter(o):a}var p={hitTest:r,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,n,i,this._queryCell,a,p,o),r?a.length>0:a},qt.prototype._queryCircle=function(t,e,n,i,r){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!i&&[];var c=[],l={hitTest:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}};return this._forEachCell(o,s,a,u,this._queryCellCircle,c,l,r),i?c.length>0:c},qt.prototype.query=function(t,e,n,i,r){return this._query(t,e,n,i,!1,r)},qt.prototype.hitTest=function(t,e,n,i,r){return this._query(t,e,n,i,!0,r)},qt.prototype.hitTestCircle=function(t,e,n,i){return this._queryCircle(t,e,n,!0,i)},qt.prototype._queryCell=function(t,e,n,i,r,o,a,s){var u=a.seenUids,c=this.boxCells[r];if(null!==c)for(var l=this.bboxes,h=0,p=c;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=l[d+2]&&e<=l[d+3]&&n>=l[d+0]&&i>=l[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:l[d],y1:l[d+1],x2:l[d+2],y2:l[d+3]})}}}var A=this.circleCells[r];if(null!==A)for(var g=this.circles,m=0,y=A;m<y.length;m+=1){var v=y[m];if(!u.circle[v]){u.circle[v]=!0;var _=3*v;if(this._circleAndRectCollide(g[_],g[_+1],g[_+2],t,e,n,i)&&(!s||s(this.circleKeys[v]))){if(a.hitTest)return o.push(!0),!0;var b=g[_],x=g[_+1],w=g[_+2];o.push({key:this.circleKeys[v],x1:b-w,y1:x-w,x2:b+w,y2:x+w})}}}},qt.prototype._queryCellCircle=function(t,e,n,i,r,o,a,s){var u=a.circle,c=a.seenUids,l=this.boxCells[r];if(null!==l)for(var h=this.bboxes,p=0,f=l;p<f.length;p+=1){var d=f[p];if(!c.box[d]){c.box[d]=!0;var A=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[A+0],h[A+1],h[A+2],h[A+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var g=this.circleCells[r];if(null!==g)for(var m=this.circles,y=0,v=g;y<v.length;y+=1){var _=v[y];if(!c.circle[_]){c.circle[_]=!0;var b=3*_;if(this._circlesCollide(m[b],m[b+1],m[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[_])))return o.push(!0),!0}}},qt.prototype._forEachCell=function(t,e,n,i,r,o,a,s){for(var u=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),l=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i),p=u;p<=l;p++)for(var f=c;f<=h;f++){var d=this.xCellCount*f+p;if(r.call(this,t,e,n,i,d,o,a,s))return}},qt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},qt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},qt.prototype._circlesCollide=function(t,e,n,i,r,o){var a=i-t,s=r-e,u=n+o;return u*u>a*a+s*s},qt.prototype._circleAndRectCollide=function(t,e,n,i,r,o,a){var s=(o-i)/2,u=Math.abs(t-(i+s));if(u>s+n)return!1;var c=(a-r)/2,l=Math.abs(e-(r+c));if(l>c+n)return!1;if(u<=s||l<=c)return!0;var h=u-s,p=l-c;return h*h+p*p<=n*n};var ie=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function re(t,e){for(var n=0;n<t;n++){var i=e.length;e.resize(i+4),e.float32.set(ie,3*i)}}function oe(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}var ae=function(t,e,n){void 0===e&&(e=new qt(t.width+200,t.height+200,25)),void 0===n&&(n=new qt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function se(t,e,n){t[e+4]=n?1:0}function ue(e,n,i){return n*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}ae.prototype.placeCollisionBox=function(t,e,n,i,r){var o=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,c=t.x2*a+o.point.x,l=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,c,l)||!e&&this.grid.hitTest(s,u,c,l,r)?{box:[],offscreen:!1}:{box:[s,u,c,l],offscreen:this.isOffscreen(s,u,c,l)}},ae.prototype.approximateTileDistance=function(t,e,n,i,r){var o=r?1:i/this.pitchfactor,a=t.lastSegmentViewportDistance*n;return t.prevTileDistance+a+(o-1)*a*Math.abs(Math.sin(e))},ae.prototype.placeCollisionCircles=function(e,n,i,r,o,a,s,u,c,l,h,p,f){var d=[],A=this.projectAnchor(c,o.anchorX,o.anchorY),g=u/24,m=o.lineOffsetX*u,y=o.lineOffsetY*u,v=new t.Point(o.anchorX,o.anchorY),_=Jt(g,s,m,y,!1,Qt(v,l).point,v,o,a,l,{},!0),b=!1,x=!1,w=!0,E=A.perspectiveRatio*r,T=1/(r*i),S=0,P=0;_&&(S=this.approximateTileDistance(_.first.tileDistance,_.first.angle,T,A.cameraDistance,p),P=this.approximateTileDistance(_.last.tileDistance,_.last.angle,T,A.cameraDistance,p));for(var M=0;M<e.length;M+=5){var C=e[M],I=e[M+1],O=e[M+2],L=e[M+3];if(!_||L<-S||L>P)se(e,M,!1);else{var R=this.projectPoint(c,C,I),k=O*E;if(d.length>0){var D=R.x-d[d.length-4],B=R.y-d[d.length-3];if(k*k*2>D*D+B*B&&M+8<e.length){var F=e[M+8];if(F>-S&&F<P){se(e,M,!1);continue}}}var z=M/5;d.push(R.x,R.y,k,z),se(e,M,!0);var N=R.x-k,j=R.y-k,U=R.x+k,V=R.y+k;if(w=w&&this.isOffscreen(N,j,U,V),x=x||this.isInsideGrid(N,j,U,V),!n&&this.grid.hitTestCircle(R.x,R.y,k,f)){if(!h)return{circles:[],offscreen:!1};b=!0}}}return{circles:b||!x?[]:d,offscreen:w}},ae.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],i=1/0,r=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var c=u[s],l=new t.Point(c.x+100,c.y+100);i=Math.min(i,l.x),r=Math.min(r,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y),n.push(l)}for(var h={},p={},f=0,d=this.grid.query(i,r,o,a).concat(this.ignoredGrid.query(i,r,o,a));f<d.length;f+=1){var A=d[f],g=A.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var m=[new t.Point(A.x1,A.y1),new t.Point(A.x2,A.y1),new t.Point(A.x2,A.y2),new t.Point(A.x1,A.y2)];t.polygonIntersectsPolygon(n,m)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},ae.prototype.insertCollisionBox=function(t,e,n,i,r){var o={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};(e?this.ignoredGrid:this.grid).insert(o,t[0],t[1],t[2],t[3])},ae.prototype.insertCollisionCircles=function(t,e,n,i,r){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:i,collisionGroupID:r},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},ae.prototype.projectAnchor=function(t,e,n){var i=[e,n,0,1];return oe(i,i,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5,cameraDistance:i[3]}},ae.prototype.projectPoint=function(e,n,i){var r=[n,i,0,1];return oe(r,r,e),new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100)},ae.prototype.projectAndGetPerspectiveRatio=function(e,n,i){var r=[n,i,0,1];return oe(r,r,e),{point:new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},ae.prototype.isOffscreen=function(t,e,n,i){return n<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary},ae.prototype.isInsideGrid=function(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary};var ce=function(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var le=function(t,e,n,i,r){this.text=new ce(t?t.text:null,e,n,r),this.icon=new ce(t?t.icon:null,e,i,r)};le.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var he=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},pe=function(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r},fe=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function de(e,n,i,r,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*i,c=t.evaluateVariableOffset(e,r);return new t.Point(s+c[0]*o,u+c[1]*o)}function Ae(e,n,i,r,o,a){var s=e.x1,u=e.x2,c=e.y1,l=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(n,i);return r&&f._rotate(o?a:-a),{x1:s+f.x,y1:c+f.y,x2:u+f.x,y2:l+f.y,anchorPointX:h,anchorPointY:p}}fe.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var ge=function(t,e,n,i){this.transform=t.clone(),this.collisionIndex=new ae(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new fe(n),this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}};function me(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}ge.prototype.placeLayerTile=function(e,n,i,r){var o=n.getBucket(e),a=n.latestFeatureIndex;if(o&&a&&e.id===o.layerIds[0]){var s=n.collisionBoxArray,u=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),l=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),p=Xt(h,"map"===u.get("text-pitch-alignment"),"map"===u.get("text-rotation-alignment"),this.transform,ue(n,1,this.transform.zoom)),f=Xt(h,"map"===u.get("icon-pitch-alignment"),"map"===u.get("icon-rotation-alignment"),this.transform,ue(n,1,this.transform.zoom));this.retainedQueryData[o.bucketInstanceId]=new pe(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,n.tileID),this.placeLayerBucket(o,h,p,f,c,l,i,n.holdingForFade(),r,s)}},ge.prototype.attemptAnchorPlacement=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d){var A,g=[h.textOffset0,h.textOffset1],m=de(t,n,i,g,r),y=this.collisionIndex.placeCollisionBox(Ae(e,m.x,m.y,o,a,this.transform.angle),l,s,u,c.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(Ae(d,m.x,m.y,o,a,this.transform.angle),l,s,u,c.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(A=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:n,height:i,anchor:t,textBoxScale:r,prevAnchor:A},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:m,placedGlyphBoxes:y}):void 0},ge.prototype.placeLayerBucket=function(e,n,i,r,o,a,s,u,c,l){var h=this,p=e.layers[0].layout,f=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom),d=p.get("text-optional"),A=p.get("icon-optional"),g=p.get("text-allow-overlap"),m=p.get("icon-allow-overlap"),y=g&&(m||!e.hasIconData()||A),v=m&&(g||!e.hasTextData()||d),_=this.collisionGroups.get(e.sourceID),b="map"===p.get("text-rotation-alignment"),x="map"===p.get("text-pitch-alignment"),w="none"!==p.get("icon-text-fit"),E="viewport-y"===p.get("symbol-z-order");!e.collisionArrays&&l&&e.deserializeCollisionBoxes(l);var T=function(r,l){if(!c[r.crossTileID])if(u)h.placements[r.crossTileID]=new he(!1,!1,!1);else{var E,T=!1,S=!1,P=!0,M=null,C={box:null,offscreen:null},I={box:null,offscreen:null},O=null,L=null,R=0,k=0,D=0;l.textFeatureIndex&&(R=l.textFeatureIndex),l.verticalTextFeatureIndex&&(k=l.verticalTextFeatureIndex);var B=l.textBox;if(B){var F=function(n){var i=t.WritingMode.horizontal;if(e.allowVerticalPlacement&&!n&&h.prevPlacement){var o=h.prevPlacement.placedOrientations[r.crossTileID];o&&(h.placedOrientations[r.crossTileID]=o,i=o,h.markUsedOrientation(e,i,r))}return i},z=function(n,i){if(e.allowVerticalPlacement&&r.numVerticalGlyphVertices>0&&l.verticalTextBox)for(var o=0,a=e.writingModes;o<a.length&&(a[o]===t.WritingMode.vertical?(C=i(),I=C):C=n(),!(C&&C.box&&C.box.length));o+=1);else C=n()};if(p.get("text-variable-anchor")){var N=p.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[r.crossTileID]){var j=h.prevPlacement.variableOffsets[r.crossTileID];N.indexOf(j.anchor)>0&&(N=N.filter((function(t){return t!==j.anchor}))).unshift(j.anchor)}var U=function(t,i,o){for(var s=t.x2-t.x1,u=t.y2-t.y1,c=r.textBoxScale,l=w&&!m?i:null,p={box:[],offscreen:!1},f=g?2*N.length:N.length,d=0;d<f;++d){var A=N[d%N.length],y=d>=N.length,v=h.attemptAnchorPlacement(A,t,s,u,c,b,x,a,n,_,y,r,e,o,l);if(v&&(p=v.placedGlyphBoxes)&&p.box&&p.box.length){T=!0,M=v.shift;break}}return p};z((function(){return U(B,l.iconBox,t.WritingMode.horizontal)}),(function(){var n=l.verticalTextBox,i=C&&C.box&&C.box.length;return e.allowVerticalPlacement&&!i&&r.numVerticalGlyphVertices>0&&n?U(n,l.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),C&&(T=C.box,P=C.offscreen);var V=F(C&&C.box);if(!T&&h.prevPlacement){var G=h.prevPlacement.variableOffsets[r.crossTileID];G&&(h.variableOffsets[r.crossTileID]=G,h.markUsedJustification(e,G.anchor,r,V))}}else{var W=function(t,i){var o=h.collisionIndex.placeCollisionBox(t,p.get("text-allow-overlap"),a,n,_.predicate);return o&&o.box&&o.box.length&&(h.markUsedOrientation(e,i,r),h.placedOrientations[r.crossTileID]=i),o};z((function(){return W(B,t.WritingMode.horizontal)}),(function(){var n=l.verticalTextBox;return e.allowVerticalPlacement&&r.numVerticalGlyphVertices>0&&n?W(n,t.WritingMode.vertical):{box:null,offscreen:null}})),F(C&&C.box&&C.box.length)}}T=(E=C)&&E.box&&E.box.length>0,P=E&&E.offscreen;var H=l.textCircles;if(H){var q=e.text.placedSymbolArray.get(r.centerJustifiedTextSymbolIndex),X=t.evaluateSizeForFeature(e.textSizeData,f,q);O=h.collisionIndex.placeCollisionCircles(H,p.get("text-allow-overlap"),o,a,q,e.lineVertexArray,e.glyphOffsetArray,X,n,i,s,x,_.predicate),T=p.get("text-allow-overlap")||O.circles.length>0,P=P&&O.offscreen}if(l.iconFeatureIndex&&(D=l.iconFeatureIndex),l.iconBox){var Z=function(t){var e=w&&M?Ae(t,M.x,M.y,b,x,h.transform.angle):t;return h.collisionIndex.placeCollisionBox(e,p.get("icon-allow-overlap"),a,n,_.predicate)};S=I&&I.box&&I.box.length&&l.verticalIconBox?(L=Z(l.verticalIconBox)).box.length>0:(L=Z(l.iconBox)).box.length>0,P=P&&L.offscreen}var Q=d||0===r.numHorizontalGlyphVertices&&0===r.numVerticalGlyphVertices,Y=A||0===r.numIconVertices;Q||Y?Y?Q||(S=S&&T):T=S&&T:S=T=S&&T,T&&E&&E.box&&(I&&I.box&&k?h.collisionIndex.insertCollisionBox(E.box,p.get("text-ignore-placement"),e.bucketInstanceId,k,_.ID):h.collisionIndex.insertCollisionBox(E.box,p.get("text-ignore-placement"),e.bucketInstanceId,R,_.ID)),S&&L&&h.collisionIndex.insertCollisionBox(L.box,p.get("icon-ignore-placement"),e.bucketInstanceId,D,_.ID),T&&O&&h.collisionIndex.insertCollisionCircles(O.circles,p.get("text-ignore-placement"),e.bucketInstanceId,R,_.ID),h.placements[r.crossTileID]=new he(T||y,S||v,P||e.justReloaded),c[r.crossTileID]=!0}};if(E)for(var S=e.getSortedSymbolIndexes(this.transform.angle),P=S.length-1;P>=0;--P){var M=S[P];T(e.symbolInstances.get(M),e.collisionArrays[M])}else for(var C=0;C<e.symbolInstances.length;++C)T(e.symbolInstances.get(C),e.collisionArrays[C]);e.justReloaded=!1},ge.prototype.markUsedJustification=function(e,n,i,r){var o,a={left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex};o=r===t.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:a[t.getAnchorJustification(n)];for(var s=0,u=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];s<u.length;s+=1){var c=u[s];c>=0&&(e.text.placedSymbolArray.get(c).crossTileID=o>=0&&c!==o?0:i.crossTileID)}},ge.prototype.markUsedOrientation=function(e,n,i){for(var r=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];a<s.length;a+=1){var u=s[a];e.text.placedSymbolArray.get(u).placedOrientation=r}i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)},ge.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],c=r[s];c?(this.opacities[s]=new le(c,i,u.text,u.icon),n=n||u.text!==c.text.placed||u.icon!==c.icon.placed):(this.opacities[s]=new le(null,i,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var l in r){var h=r[l];if(!this.opacities[l]){var p=new le(h,i,!1,!1);p.isHidden()||(this.opacities[l]=p,n=n||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},ge.prototype.updateLayerOpacities=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1){var o=r[i],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},ge.prototype.updateBucketOpacities=function(e,n,i){var r=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear(),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexArray.clear(),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexArray.clear();var o=e.layers[0].layout,a=new le(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),c=o.get("text-variable-anchor"),l="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new le(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData())&&e.deserializeCollisionBoxes(i);for(var d=function(t,e,n){for(var i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n)},A=function(i){var o=e.symbolInstances.get(i),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,A=o.crossTileID,g=n[A],m=r.opacities[A];g?m=a:m||(m=f,r.opacities[A]=m),n[A]=!0;var y=s>0||u>0,v=o.numIconVertices>0,_=r.placedOrientations[o.crossTileID],b=_===t.WritingMode.vertical,x=_===t.WritingMode.horizontal||_===t.WritingMode.horizontalOnly;if(y){var w=Te(m.text),E=b?Se:w;d(e.text,s,E);var T=x?Se:w;d(e.text,u,T);var S=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=S||b?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=S||x?1:0);var P=r.variableOffsets[o.crossTileID];P&&r.markUsedJustification(e,P.anchor,o,_);var M=r.placedOrientations[o.crossTileID];M&&(r.markUsedJustification(e,"left",o,M),r.markUsedOrientation(e,M,o))}if(v){var C=Te(m.icon),I=!(p&&o.verticalPlacedIconSymbolIndex&&b);if(o.placedIconSymbolIndex>=0){var O=I?C:Se;d(e.icon,o.numIconVertices,O),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()}if(o.verticalPlacedIconSymbolIndex>=0){var L=I?Se:C;d(e.icon,o.numVerticalIconVertices,L),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden()}}if(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData()){var R=e.collisionArrays[i];if(R){var k=new t.Point(0,0);if(R.textBox||R.verticalTextBox){var D=!0;if(c){var B=r.variableOffsets[A];B?(k=de(B.anchor,B.width,B.height,B.textOffset,B.textBoxScale),l&&k._rotate(h?r.transform.angle:-r.transform.angle)):D=!1}R.textBox&&me(e.textCollisionBox.collisionVertexArray,m.text.placed,!D||b,k.x,k.y),R.verticalTextBox&&me(e.textCollisionBox.collisionVertexArray,m.text.placed,!D||x,k.x,k.y)}var F=Boolean(!x&&R.verticalIconBox);R.iconBox&&me(e.iconCollisionBox.collisionVertexArray,m.icon.placed,F,p?k.x:0,p?k.y:0),R.verticalIconBox&&me(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!F,p?k.x:0,p?k.y:0);var z=R.textCircles;if(z&&e.hasTextCollisionCircleData())for(var N=0;N<z.length;N+=5){var j=g||0===z[N+4];me(e.textCollisionCircle.collisionVertexArray,m.text.placed,j)}}}},g=0;g<e.symbolInstances.length;g++)A(g);e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexBuffer&&e.iconCollisionCircle.collisionVertexBuffer.updateData(e.iconCollisionCircle.collisionVertexArray),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexBuffer&&e.textCollisionCircle.collisionVertexBuffer.updateData(e.textCollisionCircle.collisionVertexArray)},ge.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ge.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},ge.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},ge.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},ge.prototype.setStale=function(){this.stale=!0};var ye=Math.pow(2,25),ve=Math.pow(2,24),_e=Math.pow(2,17),be=Math.pow(2,16),xe=Math.pow(2,9),we=Math.pow(2,8),Ee=Math.pow(2,1);function Te(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*ye+e*ve+n*_e+e*be+n*xe+e*we+n*Ee+e}var Se=0,Pe=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Pe.prototype.continuePlacement=function(t,e,n,i,r){for(;this._currentTileIndex<t.length;){var o=t[this._currentTileIndex];if(e.placeLayerTile(i,o,n,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};var Me=function(t,e,n,i,r,o,a){this.placement=new ge(t,r,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1};Me.prototype.isDone=function(){return this._done},Me.prototype.continuePlacement=function(e,n,i){for(var r=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Pe),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Me.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Ce=512/t.EXTENT/2,Ie=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var i=0;i<e.length;i++){var r=e.get(i),o=r.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}};Ie.prototype.getScaledCoordinates=function(e,n){var i=n.canonical.z-this.tileID.canonical.z,r=Ce/Math.pow(2,i);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},Ie.prototype.findMatches=function(t,e,n){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0;r<t.length;r++){var o=t.get(r);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,c=a;u<c.length;u+=1){var l=c[u];if(Math.abs(l.coord.x-s.x)<=i&&Math.abs(l.coord.y-s.y)<=i&&!n[l.crossTileID]){n[l.crossTileID]=!0,o.crossTileID=l.crossTileID;break}}}}};var Oe=function(){this.maxCrossTileID=0};Oe.prototype.generate=function(){return++this.maxCrossTileID};var Le=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Le.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var i=this.indexes[n],r={};for(var o in i){var a=i[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),r[a.tileID.key]=a}this.indexes[n]=r}this.lng=t},Le.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,r)}else{var c=a[t.scaledTo(Number(o)).key];c&&c.findMatches(e.symbolInstances,t,r)}}for(var l=0;l<e.symbolInstances.length;l++){var h=e.symbolInstances.get(l);h.crossTileID||(h.crossTileID=n.generate(),r[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ie(t,e.symbolInstances,e.bucketInstanceId),!0},Le.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var i=0,r=e.indexedSymbolInstances[n];i<r.length;i+=1){var o=r[i];delete this.usedCrossTileIDs[t][o.crossTileID]}},Le.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var i=this.indexes[n];for(var r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e};var Re=function(){this.layerIndexes={},this.crossTileIDs=new Oe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Re.prototype.addLayer=function(t,e,n){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Le);var r=!1,o={};i.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(u.tileID,c,this.crossTileIDs)&&(r=!0),o[c.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(r=!0),r},Re.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var ke=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},De=t.pick(zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Be=t.pick(zt,["setCenter","setZoom","setBearing","setPitch"]),Fe=function(e){function n(i,r){var o=this;void 0===r&&(r={}),e.call(this),this.map=i,this.dispatcher=new E((kt||(kt=new Rt),kt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new v(i._requestManager,r.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Re,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){var n={pluginStatus:e.pluginStatus,pluginURL:e.pluginURL};a.dispatcher.broadcast("syncRTLPluginState",n,(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var i in a.sourceCaches)a.sourceCaches[i].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var i in o._layers){var r=o._layers[i];r.source===n.id&&o._validateLayer(r)}}}}))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadURL=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){i._request=null,e?i.fire(new t.ErrorEvent(e)):n&&i._load(n,r)}))},n.prototype.loadJSON=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){i._request=null,i._load(e,!1!==n.validate)}))},n.prototype._load=function(e,n){var i=this;if(!n||!ke(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._spriteRequest=function(e,n,i){var r,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,r=e,l())})),c=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){c=null,a||(a=t,o=e,l())}));function l(){if(a)i(a);else if(r&&o){var e=t.browser.getImageData(o),n={};for(var s in r){var u=r[s],c=u.width,l=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,A=u.stretchX,g=u.stretchY,m=u.content,y=new t.RGBAImage({width:c,height:l});t.RGBAImage.copy(e,y,{x:h,y:p},{x:0,y:0},{width:c,height:l}),n[s]={data:y,pixelRatio:d,sdf:f,stretchX:A,stretchY:g,content:m}}i(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),c&&(c.cancel(),c=null)}}}(e.sprite,this.map._requestManager,(function(e,n){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(n)for(var r in n)i.imageManager.addImage(r,n[r]);i.imageManager.setLoaded(!0),i.dispatcher.broadcast("setImages",i.imageManager.listImages()),i.fire(new t.Event("data",{dataType:"style"}))})):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var o=Ft(this.stylesheet.layers);this._order=o.map((function(t){return t.id})),this._layers={};for(var a=0,s=o;a<s.length;a+=1){var u=s[a];(u=t.createStyleLayer(u)).setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var i=e.sourceLayer;if(i){var r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+i+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,i=t;n<i.length;n+=1){var r=i[n],o=this._layers[r];"custom"!==o.type&&e.push(o.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var o in(i.length||r.length)&&this._updateWorkerLayers(i,r),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var u in this.sourceCaches)this.sourceCaches[u].used=!1;for(var c=0,l=this._order;c<l.length;c+=1){var h=l[c],p=this._layers[h];p.recalculate(e,this.imageManager.listImages()),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),ke(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ft(e.layers);var i=function(e,n){if(!e)return[{command:zt.setStyle,args:[n]}];var i=[];try{if(!t.deepEqual(e.version,n.version))return[{command:zt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||i.push({command:zt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||i.push({command:zt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||i.push({command:zt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||i.push({command:zt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||i.push({command:zt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||i.push({command:zt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||i.push({command:zt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||i.push({command:zt.setLight,args:[n.light]});var r={},o=[];!function(e,n,i,r){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||jt(o,i,r));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Vt(e,n,o)?i.push({command:zt.setGeoJSONSourceData,args:[o,n[o].data]}):Ut(o,n,i,r)):Nt(o,n,i))}(e.sources,n.sources,o,r);var a=[];e.layers&&e.layers.forEach((function(t){r[t.source]?i.push({command:zt.removeLayer,args:[t.id]}):a.push(t)})),i=i.concat(o),function(e,n,i){n=n||[];var r,o,a,s,u,c,l,h=(e=e||[]).map(Wt),p=n.map(Wt),f=e.reduce(Ht,{}),d=n.reduce(Ht,{}),A=h.slice(),g=Object.create(null);for(r=0,o=0;r<h.length;r++)a=h[r],d.hasOwnProperty(a)?o++:(i.push({command:zt.removeLayer,args:[a]}),A.splice(A.indexOf(a,o),1));for(r=0,o=0;r<p.length;r++)a=p[p.length-1-r],A[A.length-1-r]!==a&&(f.hasOwnProperty(a)?(i.push({command:zt.removeLayer,args:[a]}),A.splice(A.lastIndexOf(a,A.length-o),1)):o++,c=A[A.length-r],i.push({command:zt.addLayer,args:[d[a],c]}),A.splice(A.length-r,0,a),g[a]=!0);for(r=0;r<p.length;r++)if(s=f[a=p[r]],u=d[a],!g[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(l in Gt(s.layout,u.layout,i,a,null,zt.setLayoutProperty),Gt(s.paint,u.paint,i,a,null,zt.setPaintProperty),t.deepEqual(s.filter,u.filter)||i.push({command:zt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||i.push({command:zt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(l)&&"layout"!==l&&"paint"!==l&&"filter"!==l&&"metadata"!==l&&"minzoom"!==l&&"maxzoom"!==l&&(0===l.indexOf("paint.")?Gt(s[l],u[l],i,a,l.slice(6),zt.setPaintProperty):t.deepEqual(s[l],u[l])||i.push({command:zt.setLayerProperty,args:[a,l,u[l]]}));for(l in u)u.hasOwnProperty(l)&&!s.hasOwnProperty(l)&&"layout"!==l&&"paint"!==l&&"filter"!==l&&"metadata"!==l&&"minzoom"!==l&&"maxzoom"!==l&&(0===l.indexOf("paint.")?Gt(s[l],u[l],i,a,l.slice(6),zt.setPaintProperty):t.deepEqual(s[l],u[l])||i.push({command:zt.setLayerProperty,args:[a,l,u[l]]}))}else i.push({command:zt.removeLayer,args:[a]}),c=A[A.lastIndexOf(a)+1],i.push({command:zt.addLayer,args:[u,c]})}(a,n.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:zt.setStyle,args:[n]}]}return i}(this.serialize(),e).filter((function(t){return!(t.command in Be)}));if(0===i.length)return!1;var r=i.filter((function(t){return!(t.command in De)}));if(r.length>0)throw new Error("Unimplemented: "+r.map((function(t){return t.command})).join(", ")+".");return i.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._changedImages[e]=!0,this._changed=!0,this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._changedImages[e]=!0,this._changed=!0,this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,i){var r=this;if(void 0===i&&(i={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,i))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Ct(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:r.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var o;if("custom"===e.type){if(ke(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},i))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,r),this._layerOrderChanged=!0,this._layers[r]=o,this._removedLayers[r]&&o.source&&"custom"!==o.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var i=this._order.indexOf(e);this._order.splice(i,1);var r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.setLayerZoomRange=function(e,n,i){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=this.getLayer(e);if(r){if(!t.deepEqual(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.validateStyle.filter,"layers."+r.id+".filter",n,null,i)||(r.filter=t.clone$1(n),this._updateLayer(r)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,r),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),i)||(o.setPaintProperty(n,i,r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=e.sourceLayer,o=this.sourceCaches[i],a=parseInt(e.id,10);if(void 0!==o){var s=o.getSource().type;"geojson"===s&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?isNaN(a)||a<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):o.setFeatureState(r,a,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=this.sourceCaches[i];if(void 0!==r){var o=r.getSource().type,a="vector"===o?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==o||a?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):r.removeFeatureState(a,s,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,i=e.sourceLayer,r=this.sourceCaches[n],o=parseInt(e.id,10);if(void 0!==r)if("vector"!==r.getSource().type||i){if(!(isNaN(o)||o<0))return r.getFeatureState(i,o);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},i={},r=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){i[a]=o;for(var s=0,u=t;s<u.length;s+=1){var c=u[s][a];if(c)for(var l=0,h=c;l<h.length;l+=1){var p=h[l];r.push(p)}}}}r.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var f=[],d=this._order.length-1;d>=0;d--){var A=this._order[d];if(n(A))for(var g=r.length-1;g>=0;g--){var m=r[g].feature;if(i[m.layer.id]<d)break;f.push(m),r.pop()}else for(var y=0,v=t;y<v.length;y+=1){var _=v[y][A];if(_)for(var b=0,x=_;b<x.length;b+=1){var w=x[b];f.push(w.feature)}}}return f},n.prototype.queryRenderedFeatures=function(e,n,i){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[u.source]=!0}}var c=[];for(var l in this.sourceCaches)n.layers&&!r[l]||c.push(B(this.sourceCaches[l],this._layers,e,n,i));return this.placement&&c.push(function(t,e,n,i,r,o){for(var a={},s=r.queryRenderedSymbols(n),u=[],c=0,l=Object.keys(s).map(Number);c<l.length;c+=1){var h=l[c];u.push(o[h])}u.sort(F);for(var p=function(){var e=d[f],n=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,i.filter,i.layers,t);for(var r in n){var o=a[r]=a[r]||[],u=n[r];u.sort((function(t,n){var i=e.featureSortOrder;if(i){var r=i.indexOf(t.featureIndex);return i.indexOf(n.featureIndex)-r}return n.featureIndex-t.featureIndex}));for(var c=0,l=u;c<l.length;c+=1){var h=l[c];o.push(h)}}},f=0,d=u;f<d.length;f+=1)p();var A=function(n){a[n].forEach((function(i){var r=i.feature,o=t[n],a=e[o.source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a}))};for(var g in a)A(g);return a}(this._layers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var i=this.sourceCaches[e];return i?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),i=[],r={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;r[s]||(r[s]=!0,a.querySourceFeatures(i,e))}return i}(i,n):[]},n.prototype.addSourceType=function(t,e,i){return n.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var i=this.light.getLight(),r=!1;for(var o in e)if(!t.deepEqual(e[o],i[o])){r=!0;break}if(r){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,i,r,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&ke(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:i,styleSpec:t.styleSpec},r)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,i,r){for(var o=!1,a=!1,s={},u=0,c=this._order;u<c.length;u+=1){var l=c[u],h=this._layers[l];if("symbol"===h.type){if(!s[h.source]){var p=this.sourceCaches[h.source];s[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,s[h.source],e.center.lng);o=o||f}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var d=this._layerOrderChanged||0===i;if((d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Me(e,this._order,d,n,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(var A=0,g=this._order;A<g.length;A+=1){var m=g[A],y=this._layers[m];"symbol"===y.type&&this.placement.updateLayerOpacities(y,s[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var i=this.sourceCaches[e.source];i&&i.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,i){return t.makeRequest(n,i)},n}(t.Evented);Fe.getSourceType=function(t){return k[t]},Fe.setSourceType=function(t,e){k[t]=e},Fe.registerForPluginStateChange=t.registerForPluginStateChange;var ze=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ne=pn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),je=pn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ue=pn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ve=pn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ge=pn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),We=pn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),He=pn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),qe=pn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Xe=pn("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Ze=pn("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Qe=pn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Ye=pn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ke=pn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Je=pn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),$e=pn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),tn=pn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),en=pn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),nn=pn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),rn=pn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),on=pn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),an=pn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),sn=pn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),un=pn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),cn=pn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),ln=pn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),hn=pn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function pn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,o){return i[o]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+n+" "+r+" "+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,o){var a="float"===r?"vec2":"vec4",s=o.match(/color/)?"color":a;return i[o]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float u_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\nvarying "+n+" "+r+" "+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = a_"+o+";\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+s+"(a_"+o+", u_"+o+"_t);\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float u_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+n+" "+r+" "+o+" = a_"+o+";\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+n+" "+r+" "+o+" = unpack_mix_"+s+"(a_"+o+", u_"+o+"_t);\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n"}))}}var fn=Object.freeze({__proto__:null,prelude:Ne,background:je,backgroundPattern:Ue,circle:Ve,clippingMask:Ge,heatmap:We,heatmapTexture:He,collisionBox:qe,collisionCircle:Xe,debug:Ze,fill:Qe,fillOutline:Ye,fillOutlinePattern:Ke,fillPattern:Je,fillExtrusion:$e,fillExtrusionPattern:tn,hillshadePrepare:en,hillshade:nn,line:rn,lineGradient:on,linePattern:an,lineSDF:sn,raster:un,symbolIcon:cn,symbolSDF:ln,symbolTextAndIcon:hn}),dn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};dn.prototype.bind=function(t,e,n,i,r,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==i.length,c=0;!u&&c<i.length;c++)this.boundPaintVertexBuffers[c]!==i[c]&&(u=!0);var l=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||u||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||l?this.freshBind(e,n,i,r,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind())},dn.prototype.freshBind=function(t,e,n,i,r,o,a){var s,u=t.numAttributes,c=this.context,l=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(var h=u;h<s;h++)l.disableVertexAttribArray(h)}e.enableAttributes(l,t);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(l,t);o&&o.enableAttributes(l,t),a&&a.enableAttributes(l,t),e.bind(),e.setVertexAttribPointers(l,t,r);for(var d=0,A=n;d<A.length;d+=1){var g=A[d];g.bind(),g.setVertexAttribPointers(l,t,r)}o&&(o.bind(),o.setVertexAttribPointers(l,t,r)),i&&i.bind(),a&&(a.bind(),a.setVertexAttribPointers(l,t,r)),c.currentNumAttributes=u},dn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var An=function(t,e,n,i,r){var o=t.gl;this.program=o.createProgram();var a=n.defines();r&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(Ne.fragmentSource,e.fragmentSource).join("\n"),u=a.concat(Ne.vertexSource,e.vertexSource).join("\n"),c=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(c,s),o.compileShader(c),o.attachShader(this.program,c);var l=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(l,u),o.compileShader(l),o.attachShader(this.program,l);for(var h=n.layoutAttributes||[],p=0;p<h.length;p++)o.bindAttribLocation(this.program,p,h[p].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={};for(var f={},d=0;d<this.numAttributes;d++){var A=o.getActiveAttrib(this.program,d);A&&(this.attributes[A.name]=o.getAttribLocation(this.program,A.name))}for(var g=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),m=0;m<g;m++){var y=o.getActiveUniform(this.program,m);y&&(f[y.name]=o.getUniformLocation(this.program,y.name))}this.fixedUniforms=i(t,f),this.binderUniforms=n.getUniforms(t,f)}}};function gn(e,n,i){var r=1/ue(i,1,n.transform.tileZoom),o=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,n.transform.tileZoom)/o,s=a*(i.tileID.canonical.x+i.tileID.wrap*o),u=a*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,u>>16],u_pixel_coord_lower:[65535&s,65535&u]}}An.prototype.draw=function(t,e,n,i,r,o,a,s,u,c,l,h,p,f,d,A){var g,m=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[y].set(a[y]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var v=(g={},g[m.LINES]=2,g[m.TRIANGLES]=3,g[m.LINE_STRIP]=1,g)[e],_=0,b=l.get();_<b.length;_+=1){var x=b[_],w=x.vaos||(x.vaos={});(w[s]||(w[s]=new dn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],c,x.vertexOffset,d,A),m.drawElements(e,x.primitiveLength*v,m.UNSIGNED_SHORT,x.primitiveOffset*v*2)}}};var mn=function(e,n,i,r){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var c=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},yn=function(e,n,i,r,o,a,s){return t.extend(mn(e,n,i,r),gn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},vn=function(t){return{u_matrix:t}},_n=function(e,n,i,r){return t.extend(vn(e),gn(i,n,r))},bn=function(t,e){return{u_matrix:t,u_world:e}},xn=function(e,n,i,r,o){return t.extend(_n(e,n,i,r),{u_world:o})},wn=function(e,n,i,r){var o,a,s=e.transform;if("map"===r.paint.get("circle-pitch-alignment")){var u=ue(i,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},En=function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},Tn=function(t,e,n){var i=ue(n,1,e.zoom),r=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*r),e.pixelsToGLUnits[1]/(i*r)],u_overscale_factor:o}},Sn=function(t,e){return{u_matrix:t,u_color:e}},Pn=function(t){return{u_matrix:t}},Mn=function(t,e,n,i){return{u_matrix:t,u_extrude_scale:ue(e,1,n),u_intensity:i}};function Cn(e,n){var i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.MercatorCoordinate(0,r/i).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}var In=function(e,n,i){var r=e.transform;return{u_matrix:Dn(e,n,i),u_ratio:1/ue(n,1,r.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},On=function(e,n,i){return t.extend(In(e,n,i),{u_image:0})},Ln=function(e,n,i,r){var o=e.transform,a=kn(n,o);return{u_matrix:Dn(e,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:1/ue(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[t.browser.devicePixelRatio,a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Rn=function(e,n,i,r,o){var a=e.transform,s=e.lineAtlas,u=kn(n,a),c="round"===i.layout.get("line-cap"),l=s.getDash(r.from,c),h=s.getDash(r.to,c),p=l.width*o.fromScale,f=h.width*o.toScale;return t.extend(In(e,n,i),{u_patternscale_a:[u/p,-l.height/2],u_patternscale_b:[u/f,-h.height/2],u_sdfgamma:s.width/(256*Math.min(p,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:h.y,u_mix:o.t})};function kn(t,e){return 1/ue(t,1,e.tileZoom)}function Dn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Bn=function(t,e,n,i,r){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(a=r.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Fn(r.paint.get("raster-hue-rotate"))};var o,a};function Fn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var zn=function(t,e,n,i,r,o,a,s,u,c){var l=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:l.cameraToCenterDistance,u_pitch:l.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:l.width/l.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},Nn=function(e,n,i,r,o,a,s,u,c,l,h){var p=o.transform;return t.extend(zn(e,n,i,r,o,a,s,u,c,l),{u_gamma_scale:r?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},jn=function(e,n,i,r,o,a,s,u,c,l){return t.extend(Nn(e,n,i,r,o,a,s,u,!0,c,!0),{u_texsize_icon:l,u_texture_icon:1})},Un=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Vn=function(e,n,i,r,o,a){return t.extend(function(t,e,n,i){var r=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,c=Math.pow(2,i.tileID.overscaledZ),l=i.tileSize*Math.pow(2,n.transform.tileZoom)/c,h=l*(i.tileID.canonical.x+i.tileID.wrap*c),p=l*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/ue(i,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(r,a,i,o),{u_matrix:e,u_opacity:n})},Gn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:En,collisionCircle:En,debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_maxzoom:new t.Uniform1f(e,n.u_maxzoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1f(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1f(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Wn(e,n){for(var i=e.sort((function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0})),r=0;r<i.length;r++){var o={},a=i[r],s=i.slice(r+1);Hn(a.tileID.wrapped(),a.tileID,s,new t.OverscaledTileID(0,a.tileID.wrap+1,0,0,0),o),a.setMask(o,n)}}function Hn(e,n,i,r,o){for(var a=0;a<i.length;a++){var s=i[a];if(r.isLessThan(s.tileID))break;if(n.key===s.tileID.key)return;if(s.tileID.isChildOf(n)){for(var u=n.children(1/0),c=0;c<u.length;c++)Hn(e,u[c],i.slice(a),r,o);return}}var l=n.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(l,n.canonical.x-(e.canonical.x<<l),n.canonical.y-(e.canonical.y<<l));o[h.key]=o[h.key]||h}function qn(t,e,n,i,r,o,a,s){for(var u=t.context,c=u.gl,l=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox"),h=0;h<i.length;h++){var p=i[h],f=e.getTile(p),d=f.getBucket(n);if(d){var A=r?s?d.textCollisionCircle:d.iconCollisionCircle:s?d.textCollisionBox:d.iconCollisionBox;if(A){var g=p.posMatrix;0===o[0]&&0===o[1]||(g=t.translatePosMatrix(p.posMatrix,f,o,a)),l.draw(u,r?c.TRIANGLES:c.LINES,Et.disabled,Tt.disabled,t.colorModeForRenderPass(),Pt.disabled,Tn(g,t.transform,f),n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,null,t.transform.zoom,null,null,A.collisionVertexBuffer)}}}}function Xn(t,e,n,i,r,o,a){qn(t,e,n,i,!1,r,o,a),qn(t,e,n,i,!0,r,o,a)}var Zn=t.identity(new Float32Array(16));function Qn(e,n,i,r,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,c=-(s.verticalAlign-.5)*i,l=t.evaluateVariableOffset(e,r);return new t.Point((u/o+l[0])*a,(c/o+l[1])*a)}function Yn(e,n,i,r,o,a,s,u,c,l,h){var p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,A={};f.clear();for(var g=0;g<p.length;g++){var m=p.get(g),y=e.allowVerticalPlacement&&!m.placedOrientation,v=m.hidden||!m.crossTileID||y?null:r[m.crossTileID];if(v){var _=new t.Point(m.anchorX,m.anchorY),b=Qt(_,i?u:s),x=.5+a.cameraToCenterDistance/b.signedDistanceFromCamera*.5,w=o.evaluateSizeForFeature(e.textSizeData,l,m)*x/t.ONE_EM;i&&(w*=e.tilePixelRatio/c);for(var E=v.width,T=v.height,S=Qn(v.anchor,E,T,v.textOffset,v.textBoxScale,w),P=i?Qt(_.add(S),s).point:b.point.add(n?S.rotate(-a.angle):S),M=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,C=0;C<m.numGlyphs;C++)t.addDynamicAttributes(f,P,M);h&&m.associatedIconIndex>=0&&(A[m.associatedIconIndex]={shiftedAnchor:P,angle:M})}else re(m.numGlyphs,f)}if(h){d.clear();for(var I=e.icon.placedSymbolArray,O=0;O<I.length;O++){var L=I.get(O);if(L.hidden)re(L.numGlyphs,d);else{var R=A[O];if(R)for(var k=0;k<L.numGlyphs;k++)t.addDynamicAttributes(d,R.shiftedAnchor,R.angle);else re(L.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Kn(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Jn(e,n,i,r,o,a,s,u,c,l,h,p){for(var f,d,A=e.context,g=A.gl,m=e.transform,y="map"===u,v="map"===c,_=y&&"point"!==i.layout.get("symbol-placement"),b=y&&!v&&!_,x=void 0!==i.layout.get("symbol-sort-key").constantOr(1),w=e.depthModeForSublayer(0,Et.ReadOnly),E=i.layout.get("text-variable-anchor"),T=[],S=0,P=r;S<P.length;S+=1){var M=P[S],C=n.getTile(M),I=C.getBucket(i);if(I){var O=o?I.text:I.icon;if(O&&O.segments.get().length){var L=O.programConfigurations.get(i.id),R=o||I.sdfIcons,k=o?I.textSizeData:I.iconSizeData,D=v||0!==m.pitch;f||(f=e.useProgram(Kn(R,o,I),L),d=t.evaluateSizeForZoom(k,m.zoom));var B=void 0,F=[0,0],z=void 0,N=void 0,j=null,U=void 0;if(o){if(z=C.glyphAtlasTexture,N=g.LINEAR,B=C.glyphAtlasTexture.size,I.iconsInText){F=C.imageAtlasTexture.size,j=C.imageAtlasTexture;var V="composite"===k.kind||"camera"===k.kind;U=D||e.options.rotating||e.options.zooming||V?g.LINEAR:g.NEAREST}}else{var G=1!==i.layout.get("icon-size").constantOr(0)||I.iconsNeedLinear;z=C.imageAtlasTexture,N=R||e.options.rotating||e.options.zooming||G||D?g.LINEAR:g.NEAREST,B=C.imageAtlasTexture.size}var W=ue(C,1,e.transform.zoom),H=Xt(M.posMatrix,v,y,e.transform,W),q=Zt(M.posMatrix,v,y,e.transform,W),X=E&&I.hasTextData(),Z="none"!==i.layout.get("icon-text-fit")&&X&&I.hasIconData();_&&Kt(I,M.posMatrix,e,o,H,q,v,l);var Q=e.translatePosMatrix(M.posMatrix,C,a,s),Y=_||o&&E||Z?Zn:H,K=e.translatePosMatrix(q,C,a,s,!0),J=R&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:f,buffers:O,uniformValues:R?I.iconsInText?jn(k.kind,d,b,v,e,Q,Y,K,B,F):Nn(k.kind,d,b,v,e,Q,Y,K,o,B,!0):zn(k.kind,d,b,v,e,Q,Y,K,o,B),atlasTexture:z,atlasTextureIcon:j,atlasInterpolation:N,atlasInterpolationIcon:U,isSDF:R,hasHalo:J};if(x)for(var tt=0,et=O.segments.get();tt<et.length;tt+=1){var nt=et[tt];T.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}else T.push({segments:O.segments,sortKey:0,state:$})}}}x&&T.sort((function(t,e){return t.sortKey-e.sortKey}));for(var it=0,rt=T;it<rt.length;it+=1){var ot=rt[it],at=ot.state;if(A.activeTexture.set(g.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,g.CLAMP_TO_EDGE),at.atlasTextureIcon&&(A.activeTexture.set(g.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,g.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,$n(at.buffers,ot.segments,i,e,at.program,w,h,p,st)),st.u_is_halo=0}$n(at.buffers,ot.segments,i,e,at.program,w,h,p,at.uniformValues)}}function $n(t,e,n,i,r,o,a,s,u){var c=i.context,l=c.gl;r.draw(c,l.TRIANGLES,o,a,s,Pt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ti(t,e,n,i,r,o,a){var s,u,c,l,h,p=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),A=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,m=i;g<m.length;g+=1){var y=m[g],v=e.getTile(y);if(!d||v.patternsLoaded()){var _=v.getBucket(n);if(_){var b=_.programConfigurations.get(n.id),x=t.useProgram(u,b);d&&(t.context.activeTexture.set(p.TEXTURE0),v.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePatternPaintBuffers(A));var w=f.constantOr(null);if(w&&v.imageAtlas){var E=v.imageAtlas,T=E.patternPositions[w.to.toString()],S=E.patternPositions[w.from.toString()];T&&S&&b.setConstantPatternPositions(T,S)}var P=t.translatePosMatrix(y.posMatrix,v,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){l=_.indexBuffer2,h=_.segments2;var M=[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===u&&d?xn(P,t,A,v,M):bn(P,M)}else l=_.indexBuffer,h=_.segments,c=d?_n(P,t,A,v):vn(P);x.draw(t.context,s,r,t.stencilModeForClipping(y),o,Pt.disabled,c,n.id,_.layoutVertexBuffer,l,h,n.paint,t.transform.zoom,b)}}}}function ei(t,e,n,i,r,o,a){for(var s=t.context,u=s.gl,c=n.paint.get("fill-extrusion-pattern"),l=c.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=i;f<d.length;f+=1){var A=d[f],g=e.getTile(A),m=g.getBucket(n);if(m){var y=m.programConfigurations.get(n.id),v=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",y);l&&(t.context.activeTexture.set(u.TEXTURE0),g.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePatternPaintBuffers(h));var _=c.constantOr(null);if(_&&g.imageAtlas){var b=g.imageAtlas,x=b.patternPositions[_.to.toString()],w=b.patternPositions[_.from.toString()];x&&w&&y.setConstantPatternPositions(x,w)}var E=t.translatePosMatrix(A.posMatrix,g,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),T=n.paint.get("fill-extrusion-vertical-gradient"),S=l?yn(E,t,T,p,A,h,g):mn(E,t,T,p);v.draw(s,s.gl.TRIANGLES,r,o,a,Pt.backCCW,S,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,t.transform.zoom,y)}}}function ni(t,e,n,i,r,o){var a=t.context,s=a.gl,u=e.fbo;if(u){var c=t.useProgram("hillshade");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var l=function(t,e,n){var i=n.paint.get("hillshade-shadow-color"),r=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Cn(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:i,u_highlight:r,u_accent:o}}(t,e,n);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?c.draw(a,s.TRIANGLES,i,r,o,Pt.disabled,l,n.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):c.draw(a,s.TRIANGLES,i,r,o,Pt.disabled,l,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function ii(e,n,i,r,o,a,s){var u=e.context,c=u.gl,l=n.dem;if(l&&l.data){var h=l.dim,p=l.stride,f=l.getPixels();if(u.activeTexture.set(c.TEXTURE1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(p),n.demTexture){var d=n.demTexture;d.update(f,{premultiply:!1}),d.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(u,f,c.RGBA,{premultiply:!1}),n.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);u.activeTexture.set(c.TEXTURE0);var A=n.fbo;if(!A){var g=new t.Texture(u,{width:h,height:h,data:null},c.RGBA);g.bind(c.LINEAR,c.CLAMP_TO_EDGE),(A=n.fbo=u.createFramebuffer(h,h)).colorAttachment.set(g.texture)}u.bindFramebuffer.set(A.framebuffer),u.viewport.set([0,0,h,h]),e.useProgram("hillshadePrepare").draw(u,c.TRIANGLES,o,a,s,Pt.disabled,function(e,n,i){var r=n.stride,o=t.create();return t.ortho(o,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(o,o,[0,-t.EXTENT,0]),{u_matrix:o,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_maxzoom:i,u_unpack:n.getUnpackVector()}}(n.tileID,l,r),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ri(e,n,i,r,o){var a=r.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,c=n?(s-n.timeAdded)/a:-1,l=i.getSource(),h=o.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-c,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function oi(e,n,i){var r=e.context,o=r.gl,a=i.posMatrix,s=e.useProgram("debug"),u=Et.disabled,c=Tt.disabled,l=e.colorModeForRenderPass(),h="$debug";s.draw(r,o.LINE_STRIP,u,c,l,Pt.disabled,Sn(a,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var p=n.getTileByID(i.key).latestRawTileData,f=p&&p.byteLength||0,d=Math.floor(f/1024),A=n.getTile(i).tileSize,g=512/Math.min(A,512),m=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(m+=" => "+i.overscaledZ);for(var y=function(t,e,n,i){i=i||1;var r,o,a,s,u,c,l,h,p=[];for(r=0,o=t.length;r<o;r++)if(u=ai[t[r]]){for(h=null,a=0,s=u[1].length;a<s;a+=2)-1===u[1][a]&&-1===u[1][a+1]?h=null:(c=e+u[1][a]*i,l=n-u[1][a+1]*i,h&&p.push(h.x,h.y,c,l),h={x:c,y:l});e+=u[0]*i}return p}(m+" "+d+"kb",50,200*g,5*g),v=new t.StructArrayLayout2i4,_=new t.StructArrayLayout2ui4,b=0;b<y.length;b+=2)v.emplaceBack(y[b],y[b+1]),_.emplaceBack(b,b+1);for(var x=r.createVertexBuffer(v,ze.members),w=r.createIndexBuffer(_),E=t.SegmentVector.simpleSegment(0,0,v.length/2,v.length/2),T=t.EXTENT/(Math.pow(2,e.transform.zoom-i.overscaledZ)*A*g),S=[],P=-1;P<=1;P++)for(var M=-1;M<=1&&(0!==P||0!==M);M++)S.push([P,M]);for(var C=0;C<S.length;C++){var I=S[C];s.draw(r,o.LINES,u,c,l,Pt.disabled,Sn(t.translate([],a,[T*I[0],T*I[1],0]),t.Color.white),h,x,w,E)}s.draw(r,o.LINES,u,c,l,Pt.disabled,Sn(a,t.Color.black),h,x,w,E),x.destroy(),w.destroy(),E.destroy()}var ai={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},si={symbol:function(e,n,i,r,o){if("translucent"===e.renderPass){var a=Tt.disabled,s=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,n,i,r,o,a,s){for(var u=n.transform,c="map"===o,l="map"===a,h=0,p=e;h<p.length;h+=1){var f=p[h],d=r.getTile(f),A=d.getBucket(i);if(A&&A.text&&A.text.segments.get().length){var g=A.textSizeData,m=t.evaluateSizeForZoom(g,u.zoom),y=ue(d,1,n.transform.zoom),v=Xt(f.posMatrix,l,c,n.transform,y),_="none"!==i.layout.get("icon-text-fit")&&A.hasIconData();if(m){var b=Math.pow(2,u.zoom-d.tileID.overscaledZ);Yn(A,c,l,s,t.symbolSize,u,v,f.posMatrix,b,m,_)}}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&Jn(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),a,s),0!==i.paint.get("text-opacity").constantOr(1)&&Jn(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Xn(e,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Xn(e,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,i,r){if("translucent"===e.renderPass){var o=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),u=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var c=e.context,l=c.gl,h=e.depthModeForSublayer(0,Et.ReadOnly),p=Tt.disabled,f=e.colorModeForRenderPass(),d=[],A=0;A<r.length;A++){var g=r[A],m=n.getTile(g),y=m.getBucket(i);if(y){var v=y.programConfigurations.get(i.id),_={programConfiguration:v,program:e.useProgram("circle",v),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:wn(e,g,m,i)};if(u)for(var b=0,x=y.segments.get();b<x.length;b+=1){var w=x[b];d.push({segments:new t.SegmentVector([w]),sortKey:w.sortKey,state:_})}else d.push({segments:y.segments,sortKey:0,state:_})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,T=d;E<T.length;E+=1){var S=T[E],P=S.state,M=P.programConfiguration,C=P.program,I=P.layoutVertexBuffer,O=P.indexBuffer,L=P.uniformValues,R=S.segments;C.draw(c,l.TRIANGLES,h,p,f,Pt.disabled,L,i.id,I,O,R,i.paint,e.transform.zoom,M)}}}},heatmap:function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=e.depthModeForSublayer(0,Et.ReadOnly),u=Tt.disabled,c=new St([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,n,i,r){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.width/4,n.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),r.colorAttachment.set(i),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,n,i,r))}(t,e,o,r)}}(o,e,i),o.clear({color:t.Color.transparent});for(var l=0;l<r.length;l++){var h=r[l];if(!n.hasRenderableParent(h)){var p=n.getTile(h),f=p.getBucket(i);if(f){var d=f.programConfigurations.get(i.id),A=e.useProgram("heatmap",d),g=e.transform.zoom;A.draw(o,a.TRIANGLES,s,u,c,Pt.disabled,Mn(h.posMatrix,p,g,i.paint.get("heatmap-intensity")),i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,i.paint,e.transform.zoom,d)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var i=e.context,r=i.gl,o=n.heatmapFbo;if(o){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(i,n.colorRamp,r.RGBA)),a.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Et.disabled,Tt.disabled,e.colorModeForRenderPass(),Pt.disabled,function(e,n,i,r){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:i,u_color_ramp:r,u_opacity:n.paint.get("heatmap-opacity")}}(e,n,0,1),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,i))},line:function(e,n,i,r){if("translucent"===e.renderPass){var o=i.paint.get("line-opacity"),a=i.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=e.depthModeForSublayer(0,Et.ReadOnly),u=e.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),l=i.paint.get("line-pattern"),h=l.constantOr(1),p=i.paint.get("line-gradient"),f=i.getCrossfadeParameters(),d=c?"lineSDF":h?"linePattern":p?"lineGradient":"line",A=e.context,g=A.gl,m=!0;if(p){A.activeTexture.set(g.TEXTURE0);var y=i.gradientTexture;if(!i.gradient)return;y||(y=i.gradientTexture=new t.Texture(A,i.gradient,g.RGBA)),y.bind(g.LINEAR,g.CLAMP_TO_EDGE)}for(var v=0,_=r;v<_.length;v+=1){var b=_[v],x=n.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(i);if(w){var E=w.programConfigurations.get(i.id),T=e.context.program.get(),S=e.useProgram(d,E),P=m||S.program!==T,M=l.constantOr(null);if(M&&x.imageAtlas){var C=x.imageAtlas,I=C.patternPositions[M.to.toString()],O=C.patternPositions[M.from.toString()];I&&O&&E.setConstantPatternPositions(I,O)}var L=c?Rn(e,x,i,c,f):h?Ln(e,x,i,f):p?On(e,x,i):In(e,x,i);c&&(P||e.lineAtlas.dirty)?(A.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(A)):h&&(A.activeTexture.set(g.TEXTURE0),x.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),E.updatePatternPaintBuffers(f)),S.draw(A,g.TRIANGLES,s,e.stencilModeForClipping(b),u,Pt.disabled,L,i.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,i.paint,e.transform.zoom,E),m=!1}}}}}},fill:function(e,n,i,r){var o=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){var l=e.depthModeForSublayer(1,"opaque"===e.renderPass?Et.ReadWrite:Et.ReadOnly);ti(e,n,i,r,l,s,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){var h=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);ti(e,n,i,r,h,s,!0)}}},"fill-extrusion":function(t,e,n,i){var r=n.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var o=new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);if(1!==r||n.paint.get("fill-extrusion-pattern").constantOr(1))ei(t,e,n,i,o,Tt.disabled,St.disabled),ei(t,e,n,i,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();ei(t,e,n,i,o,Tt.disabled,a)}}},hillshade:function(t,e,n,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var r=t.context,o=e.getSource().maxzoom,a=t.depthModeForSublayer(0,Et.ReadOnly),s=Tt.disabled,u=t.colorModeForRenderPass(),c=0,l=i;c<l.length;c+=1){var h=l[c],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?ii(t,p,n,o,a,s,u):"translucent"===t.renderPass&&ni(t,p,n,a,s,u)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,i){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity"))for(var r=t.context,o=r.gl,a=e.getSource(),s=t.useProgram("raster"),u=Tt.disabled,c=t.colorModeForRenderPass(),l=i.length&&i[0].overscaledZ,h=!t.options.moving,p=0,f=i;p<f.length;p+=1){var d=f[p],A=t.depthModeForSublayer(d.overscaledZ-l,1===n.paint.get("raster-opacity")?Et.ReadWrite:Et.ReadOnly,o.LESS),g=e.getTile(d),m=t.transform.calculatePosMatrix(d.toUnwrapped(),h);g.registerFadeDuration(n.paint.get("raster-fade-duration"));var y=e.findLoadedParent(d,0),v=ri(g,y,e,n,t.transform),_=void 0,b=void 0,x="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;r.activeTexture.set(o.TEXTURE0),g.texture.bind(x,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(o.TEXTURE1),y?(y.texture.bind(x,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),_=Math.pow(2,y.tileID.overscaledZ-g.tileID.overscaledZ),b=[g.tileID.canonical.x*_%1,g.tileID.canonical.y*_%1]):g.texture.bind(x,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var w=Bn(m,b||[0,0],_||1,v,n);a instanceof O?s.draw(r,o.TRIANGLES,A,u,c,Pt.disabled,w,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):g.maskedBoundsBuffer&&g.maskedIndexBuffer&&g.segments?s.draw(r,o.TRIANGLES,A,u,c,Pt.disabled,w,n.id,g.maskedBoundsBuffer,g.maskedIndexBuffer,g.segments,n.paint,t.transform.zoom):s.draw(r,o.TRIANGLES,A,u,c,Pt.disabled,w,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var i=n.paint.get("background-color"),r=n.paint.get("background-opacity");if(0!==r){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,c=n.paint.get("background-pattern");if(!t.isPatternMissing(c)){var l=!c&&1===i.a&&1===r&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===l){var h=Tt.disabled,p=t.depthModeForSublayer(0,"opaque"===l?Et.ReadWrite:Et.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(c?"backgroundPattern":"background"),A=s.coveringTiles({tileSize:u});c&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var g=n.getCrossfadeParameters(),m=0,y=A;m<y.length;m+=1){var v=y[m],_=t.transform.calculatePosMatrix(v.toUnwrapped()),b=c?Vn(_,r,t,c,{tileID:v,tileSize:u},g):Un(_,r,i);d.draw(o,a.TRIANGLES,p,h,f,Pt.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var i=0;i<n.length;i++)oi(t,e,n[i])},custom:function(t,e,n){var i=t.context,r=n.implementation;if("offscreen"===t.renderPass){var o=r.prerender;o&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),o.call(r,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(Tt.disabled);var a="3d"===r.renderingMode?new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Et.ReadOnly);i.setDepthMode(a),r.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},ui=function(e,n){this.context=new Mt(e),this.transform=n,this._tileTextures={},this.setup(),this.numSublayers=Ct.maxUnderzooming+Ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new Re,this.gpuTimers={}};function ci(t,e){if(t.y>e.y){var n=t;t=e,e=n}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function li(t,e,n,i,r){var o=Math.max(n,Math.floor(e.y0)),a=Math.min(i,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,c=e.dx/e.dy,l=t.dx>0,h=e.dx<0,p=o;p<a;p++){var f=u*Math.max(0,Math.min(t.dy,p+l-t.y0))+t.x0,d=c*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;r(Math.floor(d),Math.ceil(f),p)}}function hi(t,e,n,i,r,o){var a,s=ci(t,e),u=ci(e,n),c=ci(n,t);s.dy>u.dy&&(a=s,s=u,u=a),s.dy>c.dy&&(a=s,s=c,c=a),u.dy>c.dy&&(a=u,u=c,c=a),s.dy&&li(c,s,i,r,o),u.dy&&li(c,u,i,r,o)}ui.prototype.resize=function(e,n){var i=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,o=this.style._order;r<o.length;r+=1){var a=o[r];this.style._layers[a].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},ui.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,ze.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,ze.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,ze.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var u=this.context.gl;this.stencilClearMode=new Tt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},ui.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Et.disabled,this.stencilClearMode,St.disabled,Pt.disabled,Pn(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ui.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,i=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(St.disabled),n.setDepthMode(Et.disabled);var r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(n,i.TRIANGLES,Et.disabled,new Tt({func:i.ALWAYS,mask:0},u,255,i.KEEP,i.KEEP,i.REPLACE),St.disabled,Pt.disabled,Pn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ui.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Tt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},ui.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Tt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},ui.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new St([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?St.unblended:St.alphaBlended},ui.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Et.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(n||this.context.gl.LEQUAL,e,[i,i])},ui.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ui.prototype.render=function(e,n){var i=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var r=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,c,l={},h={},p={};for(var f in o){var d=o[f];l[f]=d.getVisibleCoordinates(),h[f]=l[f].slice().reverse(),p[f]=d.getVisibleCoordinates(!0).reverse()}for(var A in o){var g=o[A],m=g.getSource();if("raster"===m.type||"raster-dem"===m.type){for(var y=[],v=0,_=l[A];v<_.length;v+=1){var b=_[v];y.push(g.getTile(b))}Wn(y,this.context)}}this.opaquePassCutoff=1/0;for(var x=0;x<r.length;x++){var w=r[x];if(this.style._layers[w].is3D()){this.opaquePassCutoff=x;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var E=0,T=r;E<T.length;E+=1){var S=T[E],P=this.style._layers[S];if(P.hasOffscreenPass()&&!P.isHidden(this.transform.zoom)){var M=h[P.source];("custom"===P.type||M.length)&&this.renderLayer(this,o[P.source],P,M)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var C=this.style._layers[r[this.currentLayer]],I=o[C.source],O=l[C.source];this._renderTileClippingMasks(C,O),this.renderLayer(this,I,C,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var L=this.style._layers[r[this.currentLayer]],R=o[L.source],k=("symbol"===L.type?p:h)[L.source];this._renderTileClippingMasks(L,l[L.source]),this.renderLayer(this,R,L,k)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(i.transform.zoom)&&(t.source!==(c&&c.id)&&(c=i.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<c.getSource().maxzoom)&&(u=c))})),u&&si.debug(this,u,u.getVisibleCoordinates())),this.context.setDefault()},ui.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},ui.prototype.renderLayer=function(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||i.length)&&(this.id=n.id,this.gpuTimingStart(n),si[n.type](t,e,n,i,this.style.placement.variableOffsets),this.gpuTimingEnd())},ui.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},ui.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},ui.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},ui.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var i=t[n],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),e[n]=o}return e},ui.prototype.translatePosMatrix=function(e,n,i,r,o){if(!i[0]&&!i[1])return e;var a=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);i=[i[0]*u-i[1]*s,i[0]*s+i[1]*u]}var c=[o?i[0]:ue(n,i[0],this.transform.zoom),o?i[1]:ue(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,c),l},ui.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},ui.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},ui.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},ui.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new An(this.context,fn[t],e,Gn[t],this._showOverdrawInspector)),this.cache[n]},ui.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ui.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var pi=function(e,n,i,r,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},fi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};pi.prototype.clone=function(){var t=new pi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},fi.minZoom.get=function(){return this._minZoom},fi.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},fi.maxZoom.get=function(){return this._maxZoom},fi.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},fi.minPitch.get=function(){return this._minPitch},fi.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},fi.maxPitch.get=function(){return this._maxPitch},fi.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},fi.renderWorldCopies.get=function(){return this._renderWorldCopies},fi.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},fi.worldSize.get=function(){return this.tileSize*this.scale},fi.centerPoint.get=function(){return this.size._div(2)},fi.size.get=function(){return new t.Point(this.width,this.height)},fi.bearing.get=function(){return-this.angle/Math.PI*180},fi.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},fi.pitch.get=function(){return this._pitch/Math.PI*180},fi.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},fi.fov.get=function(){return this._fov/Math.PI*180},fi.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},fi.zoom.get=function(){return this._zoom},fi.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},fi.center.get=function(){return this._center},fi.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},pi.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},pi.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new t.Point(0,0)),r=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(i.x,r.x,o.x,a.x)),u=Math.floor(Math.max(i.x,r.x,o.x,a.x)),c=s-1;c<=u+1;c++)0!==c&&n.push(new t.UnwrappedTileID(c,e));return n},pi.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),i=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var r=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=new t.Point(o*r.x-.5,o*r.y-.5);return function(e,n,i,r){void 0===r&&(r=!0);var o=1<<e,a={};function s(n,s,u){var c,l,h,p;if(u>=0&&u<=o)for(c=n;c<s;c++)l=Math.floor(c/o),h=(c%o+o)%o,0!==l&&!0!==r||(p=new t.OverscaledTileID(i,l,e,h,u),a[p.key]=p)}var u=n.map((function(e){return new t.Point(e.x,e.y)._mult(o)}));return hi(u[0],u[1],u[2],0,o,s),hi(u[2],u[3],u[0],0,o,s),Object.keys(a).map((function(t){return a[t]}))}(n,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?i:n,this._renderWorldCopies).sort((function(t,e){return a.dist(t.canonical)-a.dist(e.canonical)}))},pi.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},fi.unmodified.get=function(){return this._unmodified},pi.prototype.zoomScale=function(t){return Math.pow(2,t)},pi.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},pi.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},pi.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},fi.point.get=function(){return this.project(this.center)},pi.prototype.setLocationAtPoint=function(e,n){var i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(i.x-r.x),o.y-(i.y-r.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},pi.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},pi.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},pi.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},pi.prototype.coordinateLocation=function(t){return t.toLngLat()},pi.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);var r=n[3],o=i[3],a=n[0]/r,s=i[0]/o,u=n[1]/r,c=i[1]/o,l=n[2]/r,h=i[2]/o,p=l===h?0:(0-l)/(h-l);return new t.MercatorCoordinate(t.number(a,s,p)/this.worldSize,t.number(u,c,p)/this.worldSize)},pi.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},pi.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},pi.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},pi.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},pi.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var i=e.key,r=n?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),r[i]=new Float32Array(u),r[i]},pi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},pi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,i,r,o=-90,a=90,s=-180,u=180,c=this.size,l=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<c.y?c.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,n=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<c.x?c.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=l,void(this._constraining=!1);if(this.latRange){var A=f.y,g=c.y/2;A-g<o&&(r=o+g),A+g>a&&(r=a-g)}if(this.lngRange){var m=f.x,y=c.x/2;m-y<s&&(i=s+y),m+y>u&&(i=u-y)}void 0===i&&void 0===r||(this.center=this.unproject(new t.Point(void 0!==i?i:f.x,void 0!==r?r:f.y))),this._unmodified=l,this._constraining=!1}},pi.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,n=Math.PI/2+this._pitch,i=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-n-e),r=this.point,o=r.x,a=r.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),u=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,u,s),t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-o,-a,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c;var l=this.width%2/2,h=this.height%2/2,p=Math.cos(this.angle),f=Math.sin(this.angle),d=o-Math.round(o)+p*l+f*h,A=a-Math.round(a)+p*h+f*l,g=new Float64Array(c);if(t.translate(g,g,[d>.5?d-1:d,A>.5?A-1:A,0]),this.alignedProjMatrix=g,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},pi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},pi.prototype.getCameraPoint=function(){var e=this._pitch,n=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,n))},pi.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var i=n.x,r=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var c=u[s];i=Math.min(i,c.x),r=Math.min(r,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y)}return[new t.Point(i,r),new t.Point(o,r),new t.Point(o,a),new t.Point(i,a),new t.Point(i,r)]},Object.defineProperties(pi.prototype,fi);var di=function(e){var n,i,r,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),i=!1,r=null,o=function(){r=null,i&&(n(),r=setTimeout(o,300),i=!1)},function(){return i=!0,r||o(),r})};di.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},di.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},di.prototype.getHashString=function(e){var n=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),c=this._map.getPitch(),l="";if(l+=e?"/"+a+"/"+s+"/"+i:i+"/"+s+"/"+a,(u||c)&&(l+="/"+Math.round(10*u)/10),c&&(l+="/"+Math.round(c)),this._hashName){var h=this._hashName,p=!1,f=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+l):t})).filter((function(t){return t}));return p||f.push(h+"="+l),"#"+f.join("&")}return"#"+l},di.prototype._getCurrentHash=function(){var e,n=this,i=t.window.location.hash.replace("#","");return this._hashName?(i.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):i.split("/")},di.prototype._onHashChange=function(){var t=this._getCurrentHash();return t.length>=3&&!t.some((function(t){return isNaN(t)}))&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},di.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var Ai=function(e){function i(i,r,o,a){void 0===a&&(a={});var s=n.mousePos(r.getCanvasContainer(),o),u=r.unproject(s);e.call(this,i,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=r}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),gi=function(e){function i(i,r,o){var a=n.touchPos(r.getCanvasContainer(),o),s=a.map((function(t){return r.unproject(t)})),u=a.reduce((function(t,e,n,i){return t.add(e.div(i.length))}),new t.Point(0,0)),c=r.unproject(u);e.call(this,i,{points:a,point:u,lngLats:s,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),mi=function(t){function e(e,n,i){t.call(this,e,{originalEvent:i}),this._defaultPrevented=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),yi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};yi.prototype.setZoomRate=function(t){this._defaultZoomRate=t},yi.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},yi.prototype.isEnabled=function(){return!!this._enabled},yi.prototype.isActive=function(){return!!this._active},yi.prototype.isZooming=function(){return!!this._zooming},yi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},yi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},yi.prototype.onWheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=t.browser.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this.isActive()||this._start(e)),e.preventDefault()}},yi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},yi.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e}))),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},yi.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var n=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*r))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a="number"==typeof this._targetZoom?this._targetZoom:n.zoom,s=this._startZoom,u=this._easing,c=!1;if("wheel"===this._type&&s&&u){var l=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=u(l);n.zoom=t.number(s,a,h),l<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):c=!0}else n.zoom=a,c=!0;n.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom}),200))}},yi.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var i=this._prevEase,r=(t.browser.now()-i.start)/i.duration,o=i.easing(r+.01)-i.easing(r),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n};var vi=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};vi.prototype.isEnabled=function(){return!!this._enabled},vi.prototype.isActive=function(){return!!this._active},vi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},vi.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),n.disableDrag(),this._startPos=this._lastPos=n.mousePos(this._el,e),this._active=!0)},vi.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=e,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(i.x,e.x),o=Math.max(i.x,e.x),a=Math.min(i.y,e.y),s=Math.max(i.y,e.y);n.setTransform(this._box,"translate("+r+"px,"+a+"px)"),this._box.style.width=o-r+"px",this._box.style.height=s-a+"px"}},vi.prototype._onMouseUp=function(e){if(0===e.button){var i=this._startPos,r=n.mousePos(this._el,e);this._finish(),n.suppressClick(),i.x===r.x&&i.y===r.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},vi.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},vi.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},vi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var _i=t.bezier(0,0,.25,1),bi=function(e,n){this._map=e,this._el=n.element||e.getCanvasContainer(),this._state="disabled",this._button=n.button||"right",this._bearingSnap=n.bearingSnap||0,this._pitchWithRotate=!1!==n.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};bi.prototype.isEnabled=function(){return"disabled"!==this._state},bi.prototype.isActive=function(){return"active"===this._state},bi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},bi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},bi.prototype.onMouseDown=function(e){if("enabled"===this._state){var i="touchstart"===e.type;if(i)this._startTime=Date.now();else if("right"===this._button){if(this._eventButton=n.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==n.mouseButton(e))return;this._eventButton=0}n.disableDrag(),i?(t.window.document.addEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("touchend",this._onMouseUp)):(t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp)),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._prevPos=this._lastPos=n.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},bi.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},bi.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var n=this._map.transform,i=this._prevPos,r=this._lastPos,o=.8*(i.x-r.x),a=-.5*(i.y-r.y),s=n.bearing-o,u=n.pitch-a,c=this._inertia,l=c[c.length-1];this._drainInertiaBuffer(),c.push([t.browser.now(),this._map._normalizeBearing(s,l[1])]);var h=n.bearing;if(n.bearing=s,this._pitchWithRotate){var p=n.pitch;n.pitch=u,n.pitch!==p&&this._fireEvent("pitch",e)}n.bearing!==h&&this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._prevPos=this._lastPos}},bi.prototype._onMouseUp=function(t){if("touchend"===t.type&&this._startPos===this._lastPos&&Date.now()-this._startTime<300&&this._el.click(),n.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.document.removeEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("touchend",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),n.enableDrag()},bi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._lastPos},bi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var n=this._map,i=n.getBearing(),r=this._inertia,o=function(){Math.abs(i)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(r.length<2)o();else{var a=r[0],s=r[r.length-1],u=r[r.length-2],c=n._normalizeBearing(i,u[1]),l=s[1]-a[1],h=l<0?-1:1,p=(s[0]-a[0])/1e3;if(0!==l&&0!==p){var f=Math.abs(l*(.25/p));f>180&&(f=180);var d=f/180;c+=h*f*(d/2),Math.abs(n._normalizeBearing(c,0))<this._bearingSnap&&(c=n._normalizeBearing(0,c)),n.rotateTo(c,{duration:1e3*d,easing:_i,noMoveStart:!0},{originalEvent:t})}else o()}},bi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},bi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var xi={linearity:.3,easing:t.bezier(0,0,.3,1),maxSpeed:1400,deceleration:2500},wi=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=n.clickTolerance||1,this._inertiaOptions=xi,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};wi.prototype.isEnabled=function(){return"disabled"!==this._state},wi.prototype.isActive=function(){return"active"===this._state},wi.prototype.enable=function(e){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled",this._inertiaOptions=t.extend(xi,e))},wi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},wi.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==n.mouseButton(e)||(n.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},wi.prototype.onTouchStart=function(e){this.isEnabled()&&(e.touches&&e.touches.length>1&&("pending"===this._state||"active"===this._state)||(n.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},wi.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._prevPos=this._lastPos=n.mousePos(this._el,e),this._startTouch=this._lastTouch=t.window.TouchEvent&&e instanceof t.window.TouchEvent?n.touchPos(this._el,e):null,this._inertia=[[t.browser.now(),this._startPos]]},wi.prototype._touchesMatch=function(t,e){return!(!t||!e||t.length!==e.length)&&t.every((function(t,n){return e[n]===t}))},wi.prototype._onMove=function(e){e.preventDefault();var i=t.window.TouchEvent&&e instanceof t.window.TouchEvent?n.touchPos(this._el,e):null,r=n.mousePos(this._el,e);(i?this._touchesMatch(this._lastTouch,i):this._lastPos.equals(r))||"pending"===this._state&&r.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=r,this._lastTouch=i,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._shouldStart=!0),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},wi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t)if(this._map.touchZoomRotate.isActive())this._abort(t);else if(this._shouldStart&&(this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._shouldStart=!1),this.isActive()){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._prevPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._prevPos=this._lastPos,delete this._lastMoveEvent}},wi.prototype._onMouseUp=function(t){if(0===n.mouseButton(t))switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},wi.prototype._onTouchEnd=function(t){if(t.touches&&0!==t.touches.length)switch(this._state){case"pending":case"active":break;case"enabled":this.onTouchStart(t)}else switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},wi.prototype._abort=function(e){switch(this._state){case"active":this._state="enabled",this._shouldStart||(this._fireEvent("dragend",e),this._fireEvent("moveend",e)),this._unbind(),this._deactivate(),t.window.TouchEvent&&e instanceof t.window.TouchEvent&&e.touches.length>1&&n.addEventListener(t.window.document,"touchend",this._onTouchEnd);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},wi.prototype._onBlur=function(t){this._abort(t)},wi.prototype._unbind=function(){n.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onTouchEnd),n.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.removeEventListener(t.window.document,"mouseup",this._onMouseUp),n.removeEventListener(t.window,"blur",this._onBlur)},wi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._mouseDownPos,delete this._lastPos,delete this._startTouch,delete this._lastTouch,delete this._shouldStart},wi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var n=e[e.length-1],i=e[0],r=n[1].sub(i[1]),o=(n[0]-i[0])/1e3;if(0===o||n[1].equals(i[1]))this._fireEvent("moveend",t);else{var a=this._inertiaOptions,s=a.linearity,u=a.easing,c=a.maxSpeed,l=a.deceleration,h=r.mult(s/o),p=h.mag();p>c&&(p=c,h._unit()._mult(p));var f=p/(l*s),d=h.mult(-f/2);this._map.panBy(d,{duration:1e3*f,easing:u,noMoveStart:!0},{originalEvent:t})}}},wi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},wi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var Ei=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function Ti(t){return t*(2-t)}Ei.prototype.isEnabled=function(){return!!this._enabled},Ei.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},Ei.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},Ei.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,i=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),u={duration:300,delayEndEvents:500,easing:Ti,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*n,pitch:a.getPitch()+10*i,offset:[100*-r,100*-o],center:a.getCenter()};a.easeTo(u,{originalEvent:t})}};var Si=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};Si.prototype.isEnabled=function(){return!!this._enabled},Si.prototype.isActive=function(){return!!this._active},Si.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Si.prototype.onTouchStart=function(t){var e=this;if(this.isEnabled()&&!(t.points.length>1))if(this._tapped){var n=t.points[0],i=this._tappedPoint;if(i&&i.dist(n)<=30){t.originalEvent.preventDefault();var r=function(){e._tapped&&e._zoom(t),e._map.off("touchcancel",o),e._resetTapped()},o=function(){e._map.off("touchend",r),e._resetTapped()};this._map.once("touchend",r),this._map.once("touchcancel",o)}else this._resetTapped()}else this._tappedPoint=t.points[0],this._tapped=setTimeout((function(){e._tapped=null,e._tappedPoint=null}),300)},Si.prototype._resetTapped=function(){clearTimeout(this._tapped),this._tapped=null,this._tappedPoint=null},Si.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Si.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Si.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Pi=t.bezier(0,0,.15,1),Mi=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Mi.prototype.isEnabled=function(){return!!this._enabled},Mi.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Mi.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Mi.prototype.disableRotation=function(){this._rotationDisabled=!0},Mi.prototype.enableRotation=function(){this._rotationDisabled=!1},Mi.prototype.isActive=function(){return this.isEnabled()&&!!this._gestureIntent},Mi.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var i=n.mousePos(this._el,e.touches[0]),r=n.mousePos(this._el,e.touches[1]),o=i.add(r).div(2);this._startVec=i.sub(r),this._startAround=this._map.transform.pointLocation(o),this._gestureIntent=void 0,this._inertia=[],n.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.addEventListener(t.window.document,"touchend",this._onEnd)}},Mi.prototype._getTouchEventData=function(t){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]),r=e.sub(i);return{vec:r,center:e.add(i).div(2),scale:r.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI}},Mi.prototype._onMove=function(e){if(2===e.touches.length){var n=this._getTouchEventData(e),i=n.vec,r=n.scale,o=n.bearing;if(!this._gestureIntent){var a=this._rotationDisabled&&1!==r||Math.abs(1-r)>.15;Math.abs(o)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=i)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Mi.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var n=this._map.transform;this._startScale||(this._startScale=n.scale,this._startBearing=n.bearing);var i=this._getTouchEventData(this._lastTouchEvent),r=i.center,o=i.bearing,a=i.scale,s=n.pointLocation(r),u=n.locationPoint(s);"rotate"===e&&(n.bearing=this._startBearing+o),n.zoom=n.scaleZoom(this._startScale*a),n.setLocationAtPoint(this._startAround,u),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),a,r])}},Mi.prototype._onEnd=function(e){n.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onEnd);var i=this._gestureIntent,r=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new t.Event(i+"end",{originalEvent:e})),this._drainInertiaBuffer();var o=this._inertia,a=this._map;if(o.length<2)a.snapToNorth({},{originalEvent:e});else{var s=o[o.length-1],u=o[0],c=a.transform.scaleZoom(r*s[1]),l=a.transform.scaleZoom(r*u[1]),h=c-l,p=(s[0]-u[0])/1e3,f=s[2];if(0!==p&&c!==l){var d=.15*h/p;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var A=1e3*Math.abs(d/(12*.15)),g=c+d*A/2e3;a.easeTo({zoom:g,duration:A,easing:Pi,around:this._aroundCenter?a.getCenter():a.unproject(f),noMoveStart:!0},{originalEvent:e})}else a.snapToNorth({},{originalEvent:e})}}},Mi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>2&&n-e[0][0]>160;)e.shift()};var Ci={scrollZoom:yi,boxZoom:vi,dragRotate:bi,dragPan:wi,keyboard:Ei,doubleClickZoom:Si,touchZoomRotate:Mi},Ii=function(e){function n(n,i){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,i){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),i)},n.prototype.panTo=function(e,n,i){return this.easeTo(t.extend({center:e},n),i)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,i){return this.easeTo(t.extend({zoom:e},n),i)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.rotateTo=function(e,n,i){return this.easeTo(t.extend({bearing:e},n),i)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,n)},n.prototype._cameraForBoxAndBearing=function(e,n,i,r){if("number"==typeof(r=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}if(t.deepEqual(Object.keys(r.padding).sort((function(t,e){return t<e?-1:t>e?1:0})),["bottom","left","right","top"])){var a=this.transform,s=a.project(t.LngLat.convert(e)),u=a.project(t.LngLat.convert(n)),c=s.rotate(-i*Math.PI/180),l=u.rotate(-i*Math.PI/180),h=new t.Point(Math.max(c.x,l.x),Math.max(c.y,l.y)),p=new t.Point(Math.min(c.x,l.x),Math.min(c.y,l.y)),f=h.sub(p),d=(a.width-r.padding.left-r.padding.right)/f.x,A=(a.height-r.padding.top-r.padding.bottom)/f.y;if(!(A<0||d<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(d,A)),r.maxZoom),m=t.Point.convert(r.offset),y=(r.padding.left-r.padding.right)/2,v=(r.padding.top-r.padding.bottom)/2,_=new t.Point(m.x+y,m.y+v).mult(a.scale/a.zoomScale(g));return{center:a.unproject(s.add(u).div(2).sub(_)),zoom:g,bearing:i}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,i,r,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),i,r),r,o)},n.prototype._fitInternal=function(e,n,i){return e?(n=t.extend(e,n)).linear?this.easeTo(n,i):this.flyTo(n,i):this},n.prototype.jumpTo=function(e,n){this.stop();var i=this.transform,r=!1,o=!1,a=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(a=!0,i.pitch=+e.pitch),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),r&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var i=this;this.stop(),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var r=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,l="pitch"in e?+e.pitch:s,h=r.centerPoint.add(t.Point.convert(e.offset)),p=r.pointLocation(h),f=t.LngLat.convert(e.center||p);this._normalizeCenter(f);var d,A,g=r.project(p),m=r.project(f).sub(g),y=r.zoomScale(u-o);return e.around&&(d=t.LngLat.convert(e.around),A=r.locationPoint(d)),this._zooming=u!==o,this._rotating=a!==c,this._pitching=l!==s,this._prepareEase(n,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease((function(e){if(i._zooming&&(r.zoom=t.number(o,u,e)),i._rotating&&(r.bearing=t.number(a,c,e)),i._pitching&&(r.pitch=t.number(s,l,e)),d)r.setLocationAtPoint(d,A);else{var p=r.zoomScale(r.zoom-o),f=u>o?Math.min(2,y):Math.max(.5,y),v=Math.pow(f,1-e),_=r.unproject(g.add(m.mult(e*v)).mult(p));r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,h)}i._fireMoveEvents(n)}),(function(){e.delayEndEvents?i._easeEndTimeoutID=setTimeout((function(){return i._afterEase(n)}),e.delayEndEvents):i._afterEase(n)}),e),this},n.prototype._prepareEase=function(e,n){this._moving=!0,n||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e){var n=this._zooming,i=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,n&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),r&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},n.prototype.flyTo=function(e,n){var i=this;if(!e.essential&&t.browser.prefersReducedMotion){var r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,l="bearing"in e?this._normalizeBearing(e.bearing,s):s,h="pitch"in e?+e.pitch:u,p=o.zoomScale(c-a),f=o.centerPoint.add(t.Point.convert(e.offset)),d=o.pointLocation(f),A=t.LngLat.convert(e.center||d);this._normalizeCenter(A);var g=o.project(d),m=o.project(A).sub(g),y=e.curve,v=Math.max(o.width,o.height),_=v/p,b=m.mag();if("minZoom"in e){var x=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),w=v/o.zoomScale(x-a);y=Math.sqrt(w/b*2)}var E=y*y;function T(t){var e=(_*_-v*v+(t?-1:1)*E*E*b*b)/(2*(t?_:v)*E*b);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var M=T(0),C=function(t){return P(M)/P(M+y*t)},I=function(t){return v*((P(M)*(S(e=M+y*t)/P(e))-S(M))/E)/b;var e},O=(T(1)-M)/y;if(Math.abs(b)<1e-6||!isFinite(O)){if(Math.abs(v-_)<1e-6)return this.easeTo(e,n);var L=_<v?-1:1;O=Math.abs(Math.log(_/v))/y,I=function(){return 0},C=function(t){return Math.exp(L*y*t)}}if("duration"in e)e.duration=+e.duration;else{var R="screenSpeed"in e?+e.screenSpeed/y:+e.speed;e.duration=1e3*O/R}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==l,this._pitching=h!==u,this._prepareEase(n,!1),this._ease((function(e){var r=e*O,p=1/C(r);o.zoom=1===e?c:a+o.scaleZoom(p),i._rotating&&(o.bearing=t.number(s,l,e)),i._pitching&&(o.pitch=t.number(u,h,e));var d=1===e?A:o.unproject(g.add(m.mult(I(r))).mult(p));o.setLocationAtPoint(o.renderWorldCopies?d.wrap():d,f),i._fireMoveEvents(n)}),(function(){return i._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},n.prototype._ease=function(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),Oi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};Oi.prototype.getDefaultPosition=function(){return"bottom-right"},Oi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Oi.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Oi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var i=n.reduce((function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow"}},Oi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Oi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var i in n){var r=n[i];if(r.used){var o=r.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Oi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Li=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Li.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Li.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Li.prototype.getDefaultPosition=function(){return"bottom-left"},Li.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Li.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Li.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var Ri=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ri.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Ri.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,i=e?this._queue.concat(e):this._queue;n<i.length;n+=1){var r=i[n];if(r.id===t)return void(r.cancelled=!0)}},Ri.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!i.cancelled&&(i.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ri.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ki={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Di=t.window.HTMLImageElement,Bi=t.window.HTMLElement,Fi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},zi=function(i){function r(e){var r=this;if(null!=(e=t.extend({},Fi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var o=new pi(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(i.call(this,o,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new Ri,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},ki,e.locale),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Bi))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return r._update(!1)})),this.on("moveend",(function(){return r._update(!1)})),this.on("zoom",(function(){return r._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var i=t.getCanvasContainer(),r=null,o=!1,a=null;for(var s in Ci)t[s]=new Ci[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);n.addEventListener(i,"mouseout",(function(e){t.fire(new Ai("mouseout",t,e))})),n.addEventListener(i,"mousedown",(function(r){o=!0,a=n.mousePos(i,r);var s=new Ai("mousedown",t,r);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(r),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(r),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(r))})),n.addEventListener(i,"mouseup",(function(e){var n=t.dragRotate.isActive();r&&!n&&t.fire(new Ai("contextmenu",t,r)),r=null,o=!1,t.fire(new Ai("mouseup",t,e))})),n.addEventListener(i,"mousemove",(function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var n=e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new Ai("mousemove",t,e))}})),n.addEventListener(i,"mouseover",(function(e){for(var n=e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new Ai("mouseover",t,e))})),n.addEventListener(i,"touchstart",(function(n){var i=new gi("touchstart",t,n);t.fire(i),i.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(n),t.touchZoomRotate.onStart(n),t.doubleClickZoom.onTouchStart(i))}),{passive:!1}),n.addEventListener(i,"touchmove",(function(e){t.fire(new gi("touchmove",t,e))}),{passive:!1}),n.addEventListener(i,"touchend",(function(e){t.fire(new gi("touchend",t,e))})),n.addEventListener(i,"touchcancel",(function(e){t.fire(new gi("touchcancel",t,e))})),n.addEventListener(i,"click",(function(r){var o=n.mousePos(i,r);(!a||o.equals(a)||o.dist(a)<e.clickTolerance)&&t.fire(new Ai("click",t,r))})),n.addEventListener(i,"dblclick",(function(e){var n=new Ai("dblclick",t,e);t.fire(n),n.defaultPrevented||t.doubleClickZoom.onDblClick(n)})),n.addEventListener(i,"contextmenu",(function(e){var n=t.dragRotate.isActive();o||n?o&&(r=e):t.fire(new Ai("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()})),n.addEventListener(i,"wheel",(function(n){e.interactive&&t.stop();var i=new mi("wheel",t,n);t.fire(i),i.defaultPrevented||t.scrollZoom.onWheel(n)}),{passive:!1})}(this,e);var a="string"==typeof e.hash&&e.hash||void 0;this._hash=e.hash&&new di(a).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Oi({customAttribution:e.customAttribution})),this.addControl(new Li,e.logoPosition),this.on("style.load",(function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet)})),this.on("data",(function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){r.fire(new t.Event(e.dataType+"dataloading",e))}))}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(e,n){if(void 0===n&&e.getDefaultPosition&&(n=e.getDefaultPosition()),void 0===n&&(n="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=e.onAdd(this);this._controls.push(e);var r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this},r.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},r.prototype.resize=function(e){var n=this._containerDimensions(),i=n[0],r=n[1];return this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(i,r),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},r.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},r.prototype.getMinPitch=function(){return this.transform.minPitch},r.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},r.prototype.getMaxPitch=function(){return this.transform.maxPitch},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},r.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},r.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},r.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},r.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},r.prototype.on=function(t,e,n){var r=this;if(void 0===n)return i.prototype.on.call(this,t,e);var o=function(){var i;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){var a=r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(r,new Ai(t,r,i.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){(r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(r,new Ai(t,r,i.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(r,new Ai(t,r,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(i={},i[t]=function(t){var i=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(r,t),delete t.features)},i)}}();for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o),o.delegates)this.on(a,o.delegates[a]);return this},r.prototype.off=function(t,e,n){if(void 0===n)return i.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var r=this._delegatedListeners[t],o=0;o<r.length;o++){var a=r[o];if(a.layer===e&&a.listener===n){for(var s in a.delegates)this.off(s,a.delegates[s]);return r.splice(o,1),this}}return this},r.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var i;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])i=[t.Point.convert(e)];else{var r=t.Point.convert(e[0]),o=t.Point.convert(e[1]);i=[r,new t.Point(o.x,r.y),o,new t.Point(r.x,o.y),r]}return this.style.queryRenderedFeatures(i,n,this.transform)},r.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},r.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},r.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},r.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Fe(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},r.prototype._diffStyle=function(e,n){var i=this;if("string"==typeof e){var r=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(o,(function(e,r){e?i.fire(new t.ErrorEvent(e)):r&&i._updateDiff(r,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},r.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce("Unable to perform style diff: "+(i.message||i.error||i)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},r.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},r.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var i in n){var r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},r.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},r.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},r.prototype.getSource=function(t){return this.style.getSource(t)},r.prototype.addImage=function(e,n,i){void 0===i&&(i={});var r=i.pixelRatio;void 0===r&&(r=1);var o=i.sdf;void 0===o&&(o=!1);var a=i.stretchX,s=i.stretchY,u=i.content;if(n instanceof Di){var c=t.browser.getImageData(n),l=c.width,h=c.height,p=c.data;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:h},p),pixelRatio:r,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var f=n.width,d=n.height,A=n.data,g=n;this.style.addImage(e,{data:new t.RGBAImage({width:f,height:d},new Uint8Array(A)),pixelRatio:r,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:g}),g.onAdd&&g.onAdd(this,e)}},r.prototype.updateImage=function(e,n){var i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var r=n instanceof Di?t.browser.getImageData(n):n,o=r.width,a=r.height,s=r.data;if(void 0===o||void 0===a)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||a!==i.data.height)return this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var u=!(n instanceof Di);i.data.replace(s,u),this.style.updateImage(e,i)},r.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},r.prototype.removeImage=function(t){this.style.removeImage(t)},r.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},r.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},r.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},r.prototype.getLayer=function(t){return this.style.getLayer(t)},r.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},r.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},r.prototype.getFilter=function(t){return this.style.getFilter(t)},r.prototype.setPaintProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setPaintProperty(t,e,n,i),this._update(!0)},r.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},r.prototype.setLayoutProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setLayoutProperty(t,e,n,i),this._update(!0)},r.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},r.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},r.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},r.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},r.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},r.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var r=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,r)}))},r.prototype._resizeCanvas=function(e,n){var i=t.window.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},r.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(this.painter=new ui(i,this.transform),t.webpSupported.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},r.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},r.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},r.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},r.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},r.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},r.prototype._render=function(){var e,n=this,i=0,r=this.painter.context.extTimerQuery;this.listens("gpu-timing-frame")&&(e=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,e),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var a=this.transform.zoom,s=t.browser.now();this.style.zoomHistory.update(a,s);var u=new t.EvaluationParameters(a,{now:s,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=u.crossFadingFactor();1===c&&c===this._crossFadingFactor||(o=!0,this._crossFadingFactor=c),this.style.update(u)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),gpuTiming:!!this.listens("gpu-timing-layer"),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var l=t.browser.now()-i;r.endQueryEXT(r.TIME_ELAPSED_EXT,e),setTimeout((function(){var i=r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(e),n.fire(new t.Event("gpu-timing-frame",{cpuTime:l,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){var h=this.painter.collectGpuTimers();setTimeout((function(){var e=n.painter.queryGpuTimers(h);n.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}return this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),Ni(this._canvasContainer),Ni(this._controlContainer),Ni(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},r.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(){e._frame=null,e._render()})))},r.prototype._onWindowOnline=function(){this._update()},r.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},r.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},o.version.get=function(){return t.version},Object.defineProperties(r.prototype,o),r}(Ii);function Ni(t){t.parentNode&&t.parentNode.removeChild(t)}var ji={showCompass:!0,showZoom:!0,visualizePitch:!1},Ui=function(e){var i=this;this.options=t.extend({},ji,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return i._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return i._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){i.options.visualizePitch?i._map.resetNorthPitch({},{originalEvent:t}):i._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};function Vi(e,n,i){if(e=new t.LngLat(e.lng,e.lat),n){var r=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=i.locationPoint(e).distSqr(n);i.locationPoint(r).distSqr(n)<a?e=r:i.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){var s=i.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}Ui.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.disabled=t===this._map.getMaxZoom(),this._zoomOutButton.disabled=t===this._map.getMinZoom()},Ui.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Ui.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bi(t,{button:"left",element:this._compass}),n.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),n.addEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.enable()),this._container},Ui.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),n.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),n.removeEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.disable(),delete this._handler),delete this._map},Ui.prototype._createButton=function(t,e){var i=n.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i},Ui.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Gi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wi(t,e,n){var i=t.classList;for(var r in Gi)i.remove("mapboxgl-"+n+"-anchor-"+r);i.add("mapboxgl-"+n+"-anchor-"+e)}var Hi,qi=function(e){function i(i,r){var o=this;if(e.call(this),(i instanceof t.window.HTMLElement||r)&&(i=t.extend({element:i},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._draggable=i&&i.draggable||!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=t.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var a=n.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill-rule","nonzero");var c=n.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"transform","translate(3.0, 29.0)"),c.setAttributeNS(null,"fill","#000000");for(var l=0,h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<h.length;l+=1){var p=h[l],f=n.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",p.rx),f.setAttributeNS(null,"ry",p.ry),c.appendChild(f)}var d=n.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var A=n.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(A);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),g.appendChild(m);var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=n.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),v.appendChild(_),v.appendChild(b),u.appendChild(c),u.appendChild(d),u.appendChild(g),u.appendChild(y),u.appendChild(v),a.appendChild(u),this._element.appendChild(a),this._offset=t.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),this._element.addEventListener("focus",(function(){var t=o._map.getContainer();t.scrollTop=0,t.scrollLeft=0})),Wi(this._element,this._anchor,"marker"),this._popup=null}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},i.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Vi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Gi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+i+" "+e)}},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},i.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},i.prototype.getRotation=function(){return this._rotation},i.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},i.prototype.getRotationAlignment=function(){return this._rotationAlignment},i.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},i.prototype.getPitchAlignment=function(){return this._pitchAlignment},i}(t.Evented),Xi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},Zi=function(e){function i(n){e.call(this),this.options=t.extend({},Xi,n),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Hi?i(Hi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){Hi="denied"!==t.state,i(Hi)})):(Hi=!!t.window.navigator.geolocation,i(Hi)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),n.remove(this._container),this._map=void 0},i.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},i.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},i.prototype._onSuccess=function(e){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},i.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),o=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),o,{geolocateSource:!0})},i.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},i.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else this._setErrorState();"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new qi(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){var n=e.originalEvent&&"resize"===e.originalEvent.type;e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||n||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))}))},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),Qi={maxWidth:100,unit:"metric"},Yi=function(e){this.options=t.extend({},Qi,e),t.bindAll(["_onMove","setUnit"],this)};function Ki(t,e,n){var i,r,o,a,s,u,c=n&&n.maxWidth||100,l=t._container.clientHeight/2,h=(i=t.unproject([0,l]),r=t.unproject([c,l]),o=Math.PI/180,a=i.lat*o,s=r.lat*o,u=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((r.lng-i.lng)*o),6371e3*Math.acos(Math.min(u,1)));if(n&&"imperial"===n.unit){var p=3.2808*h;p>5280?Ji(e,c,p/5280,t._getUIString("ScaleControl.Miles")):Ji(e,c,p,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Ji(e,c,h/1852,t._getUIString("ScaleControl.NauticalMiles")):h>=1e3?Ji(e,c,h/1e3,t._getUIString("ScaleControl.Kilometers")):Ji(e,c,h,t._getUIString("ScaleControl.Meters"))}function Ji(t,e,n,i){var r,o,a,s=(r=n,(o=Math.pow(10,(""+Math.floor(r)).length-1))*(a=(a=r/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a))),u=s/n;t.style.width=e*u+"px",t.innerHTML=s+i}Yi.prototype.getDefaultPosition=function(){return"bottom-left"},Yi.prototype._onMove=function(){Ki(this._map,this._container,this.options)},Yi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Yi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Yi.prototype.setUnit=function(t){this.options.unit=t,Ki(this._map,this._container,this.options)};var $i=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};$i.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},$i.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},$i.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},$i.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},$i.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},$i.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},$i.prototype._isFullscreen=function(){return this._fullscreen},$i.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},$i.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var tr={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},er=function(e){function i(n){e.call(this),this.options=t.extend(Object.create(tr),n),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){var n=this;return this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",(function(t){n._update(t.point)})),this._map.on("mouseup",(function(t){n._update(t.point)})),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),this._map.off("mousemove"),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove"),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},i.prototype.trackPointer=function(){var t=this;return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",(function(e){t._update(e.point)})),this._map.on("drag",(function(e){t._update(e.point)})),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},i.prototype.getElement=function(){return this._container},i.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},i.prototype.setHTML=function(e){var n,i=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");for(r.innerHTML=e;n=r.firstChild;)i.appendChild(n);return this.setDOMContent(i)},i.prototype.getMaxWidth=function(){return this._container.style.maxWidth},i.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},i.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},i.prototype.addClassName=function(t){this._container.classList.add(t)},i.prototype.removeClassName=function(t){this._container.classList.remove(t)},i.prototype.toggleClassName=function(t){return this._container.classList.toggle(t)},i.prototype._createContent=function(){this._content&&n.remove(this._content),this._content=n.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},i.prototype._update=function(e){var i=this,r=this._lngLat||this._trackPointer;if(this._map&&r&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return i._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vi(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var o=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),a=this.options.anchor,s=function e(n){if(n){if("number"==typeof n){var i=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(i,i),"top-right":new t.Point(-i,i),bottom:new t.Point(0,-n),"bottom-left":new t.Point(i,-i),"bottom-right":new t.Point(-i,-i),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var r=t.Point.convert(n);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!a){var u,c=this._container.offsetWidth,l=this._container.offsetHeight;u=o.y+s.bottom.y<l?["top"]:o.y>this._map.transform.height-l?["bottom"]:[],o.x<c/2?u.push("left"):o.x>this._map.transform.width-c/2&&u.push("right"),a=0===u.length?"bottom":u.join("-")}var h=o.add(s[a]).round();n.setTransform(this._container,Gi[a]+" translate("+h.x+"px,"+h.y+"px)"),Wi(this._container,a,"popup")}},i.prototype._onClickClose=function(){this.remove()},i}(t.Evented),nr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:zi,NavigationControl:Ui,GeolocateControl:Zi,AttributionControl:Oi,ScaleControl:Yi,FullscreenControl:$i,Popup:er,Marker:qi,Style:Fe,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Rt.workerCount},set workerCount(t){Rt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return nr})),n}()},function(t,e,n){"use strict";n.r(e);var i=n(219);class r extends i.a{}r.layerName="GreatCircleLayer",r.defaultProps={getHeight:{type:"accessor",value:0},greatCircle:!0};var o=n(188),a=n(214),s=n(118),u=n.n(s);const c=180/Math.PI;function l(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function h(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function p(t){return[h(t[0]),h(t[1])]}function f(t,[e,n]){switch(t){case 0:return[1,e,n];case 1:return[-e,1,n];case 2:return[-e,-n,1];case 3:return[-1,-n,-e];case 4:return[n,-1,-e];case 5:return[n,e,-1];default:throw new Error("Invalid face")}}function d([t,e,n]){const i=Math.atan2(n,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*c,i*c]}function A(t,e,n,i){if(0===i){1===n&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function g(t){if("string"==typeof t){if(t.indexOf("/")>0)return t;t=function(t){const e=t.padEnd(16,"0");return u.a.fromString(e,16)}(t)}return function(t){let e=u.a.fromString(t,!0,10).toString(2);for(;e.length<64;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),o=r.length/2,a=u.a.fromString(i,!0,2).toString(10);let s=u.a.fromString(r,!0,2).toString(4);for(;s.length<o;)s="0"+s;return"".concat(a,"/").concat(s)}(t.toString())}function m(t){return function({face:t,ij:e,level:n}){const i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(100*Math.pow(2,-n))),o=new Float64Array(4*r*2+2);let a=0,s=0;for(let u=0;u<4;u++){const c=i[u].slice(0),h=i[u+1],A=(h[0]-c[0])/r,g=(h[1]-c[1])/r;for(let i=0;i<r;i++){c[0]+=A,c[1]+=g;const i=d(f(t,p(l(e,n,c))));Math.abs(i[1])>89.999&&(i[0]=s);const r=i[0]-s;i[0]+=r>180?-360:r<-180?360:0,o[a++]=i[0],o[a++]=i[1],s=i[0]}}return o[a++]=o[0],o[a++]=o[1],o}(function(t){const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length,o=[0,0];let a;for(let t=r-1;t>=0;t--){a=r-t;const e=i[t];let n=0,s=0;"1"===e?s=1:"2"===e?(n=1,s=1):"3"===e&&(n=1);const u=Math.pow(2,a-1);A(u,o,n,s),o[0]+=u*n,o[1]+=u*s}if(n%2==1){const t=o[0];o[0]=o[1],o[1]=t}return{face:n,ij:o,level:a}}(g(t)))}const y={...a.a.defaultProps,getS2Token:{type:"accessor",value:t=>t.token}};class v extends o.a{renderLayers(){const{data:t,getS2Token:e}=this.props,{elevationScale:n,extruded:i,wireframe:r,filled:o,stroked:s,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:l,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:f,lineDashJustified:d,getElevation:A,getFillColor:g,getLineColor:y,getLineWidth:v,getLineDashArray:_}=this.props,{updateTriggers:b,material:x}=this.props;return new(this.getSubLayerClass("cell",a.a))({filled:o,wireframe:r,extruded:i,elevationScale:n,stroked:s,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:l,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:f,lineDashJustified:d,material:x,getElevation:A,getFillColor:g,getLineColor:y,getLineWidth:v,getLineDashArray:_},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:b.getElevation,getFillColor:b.getFillColor,getLineColor:b.getLineColor,getLineWidth:b.getLineWidth,getLineDashArray:b.getLineDashArray}}),{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(t,n)=>m(e(t,n))})}}v.layerName="S2Layer",v.defaultProps=y;var _=n(63),b=n(222),x=n(206),w=n(6);class E{constructor({x:t,y:e,z:n,onTileLoad:i,onTileError:r}){this.x=t,this.y=e,this.z=n,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this._isCancelled=!1,this.onTileLoad=i,this.onTileError=r}get data(){return this._isLoaded?this.content:this._loader}get isLoaded(){return this._isLoaded}get isLoading(){return Boolean(this._loader)}get isCancelled(){return this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||w.a.error("byteLength not defined in tile data")(),t}async _loadData(t,e){const{x:n,y:i,z:r,bbox:o}=this;this._abortController=new AbortController;const{signal:a}=this._abortController,s=await e.scheduleRequest(this,t=>t.isSelected?1:-1);if(!s)return void(this._isCancelled=!0);if(this._isCancelled)return void s.done();let u,c;try{u=await t({x:n,y:i,z:r,bbox:o,signal:a})}catch(t){c=t||!0}finally{s.done(),this._isCancelled&&!u?this._isLoaded=!1:(this._isLoaded=!0,this._isCancelled=!1)}this._isLoaded&&(c?this.onTileError(c,this):(this.content=u,this.onTileLoad(this)))}loadData(t,e){t&&(this._isCancelled=!1,this._loader=this._loadData(t,e),this._loader.finally(()=>{this._loader=void 0}))}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}}var T=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function M(t,e,n){return e&&P(t.prototype,e),n&&P(t,n),t}var C=n(147),I=new C.a,O=new C.a,L=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S(this,t),i=i||I.copy(e).add(n).scale(.5),this.center=new C.a(i),this.halfDiagonal=new C.a(n).subtract(this.center),this.minimum=new C.a(e),this.maximum=new C.a(n)}return M(t,[{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=this.halfDiagonal,n=O.from(t.normal),i=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),r=this.center.dot(n)+t.distance;return r-i>0?T.INSIDE:r+i<0?T.OUTSIDE:T.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e,n=I.from(t).subtract(this.center),i=this.halfDiagonal,r=0;return(e=Math.abs(n.x)-i.x)>0&&(r+=e*e),(e=Math.abs(n.y)-i.y)>0&&(r+=e*e),(e=Math.abs(n.z)-i.z)>0&&(r+=e*e),r}}]),t}(),R=n(8),k=new C.a,D=new C.a,B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;S(this,t),this.radius=-0,this.center=new C.a,this.fromCenterRadius(e,n)}return M(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=k.from(e),this.center=(new C.a).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,n=this.radius,i=t.center,r=t.radius,o=k.copy(i).subtract(e),a=o.magnitude();if(n>=a+r)return this.clone();if(r>=a+n)return t.clone();var s=.5*(n+a+r);return D.copy(o).scale((-n+s)/a).add(e),this.center.copy(D),this.radius=s,this}},{key:"expand",value:function(t){var e=(t=k.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,n=this.radius,i=t.normal.dot(e)+t.distance;return i<-n?T.OUTSIDE:i<n?T.INTERSECTING:T.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=R.e(k,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=k.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}();function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function z(t){return function(t){if(Array.isArray(t))return F(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return F(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var N=n(215),j=n(225),U=new C.a,V=new C.a,G=new C.a,W=new C.a,H=new C.a,q=new C.a,X=new C.a,Z=new C.a,Q=new C.a,Y=new C.a,K=0,J=1,$=2,tt=3,et=4,nt=5,it=6,rt=7,ot=8,at=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];S(this,t),this.center=(new C.a).from(e),this.halfAxes=new N.a(n)}return M(t,[{key:"fromCenterHalfSizeQuaternion",value:function(t,e,n){var i=new j.a(n),r=(new N.a).fromQuaternion(i);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=(new C.a).from(t),this.halfAxes=r,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new B,e=this.halfAxes,n=e.getColumn(0,Z),i=e.getColumn(1,Q),r=e.getColumn(2,Y),o=U.copy(n).add(i).add(r);return t.center.copy(this.center),t.radius=o.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,n=t.normal,i=this.halfAxes,r=n.x,o=n.y,a=n.z,s=Math.abs(r*i[K]+o*i[J]+a*i[$])+Math.abs(r*i[tt]+o*i[et]+a*i[nt])+Math.abs(r*i[it]+o*i[rt]+a*i[ot]),u=n.dot(e)+t.distance;return u<=-s?T.OUTSIDE:u>=s?T.INSIDE:T.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=V.from(t).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,G),r=n.getColumn(1,W),o=n.getColumn(2,H),a=i.magnitude(),s=r.magnitude(),u=o.magnitude();i.normalize(),r.normalize(),o.normalize();var c,l=0;return(c=Math.abs(e.dot(i))-a)>0&&(l+=c*c),(c=Math.abs(e.dot(r))-s)>0&&(l+=c*c),(c=Math.abs(e.dot(o))-u)>0&&(l+=c*c),l}},{key:"computePlaneDistances",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=this.center,a=this.halfAxes,s=a.getColumn(0,G),u=a.getColumn(1,W),c=a.getColumn(2,H),l=q.copy(s).add(u).add(c).add(o),h=X.copy(l).subtract(t),p=e.dot(h);return i=Math.min(p,i),r=Math.max(p,r),l.copy(o).add(s).add(u).subtract(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),l.copy(o).add(s).subtract(u).add(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),l.copy(o).add(s).subtract(u).subtract(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),o.copy(l).subtract(s).add(u).add(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),o.copy(l).subtract(s).add(u).subtract(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),o.copy(l).subtract(s).subtract(u).add(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),o.copy(l).subtract(s).subtract(u).subtract(c),h.copy(l).subtract(t),p=e.dot(h),i=Math.min(p,i),r=Math.max(p,r),n[0]=i,n[1]=r,n}},{key:"getTransform",value:function(){}},{key:"halfSize",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new C.a(t).len(),new C.a(e).len(),new C.a(n).len()]}},{key:"quaternion",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new C.a(t).normalize(),r=new C.a(e).normalize(),o=new C.a(n).normalize();return(new j.a).fromMatrix3(new N.a([].concat(z(i),z(r),z(o))))}}]),t}(),st=n(44),ut=n(3),ct=new C.a,lt=new C.a,ht=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;S(this,t),this.normal=new C.a,this.distance=-0,this.fromNormalDistance(e,n)}return M(t,[{key:"fromNormalDistance",value:function(t,e){return Object(st.a)(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=ct.from(t),this.normal.from(e).normalize();var n=-this.normal.dot(t);return this.distance=n,this}},{key:"fromCoefficients",value:function(t,e,n,i){return this.normal.set(t,e,n),Object(st.a)(Object(ut.d)(this.normal.len(),1)),this.distance=i,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return Object(ut.d)(this.distance,t.distance)&&Object(ut.d)(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=lt.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=ct.from(t);var n=this.getPointDistance(t),i=lt.copy(this.normal).scale(n);return t.subtract(i).to(e)}}]),t}();function pt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ft(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var dt=[new C.a([1,0,0]),new C.a([0,1,0]),new C.a([0,0,1])],At=new C.a,gt=new C.a,mt=(new ht(new C.a(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];S(this,t),this.planes=e,Object(st.a)(this.planes.every((function(t){return t instanceof ht})))}return M(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),M(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*dt.length;var e,n=t.center,i=t.radius,r=0,o=pt(dt);try{for(o.s();!(e=o.n()).done;){var a=e.value,s=this.planes[r],u=this.planes[r+1];s||(s=this.planes[r]=new ht),u||(u=this.planes[r+1]=new ht);var c=At.copy(a).scale(-i).add(n);a.dot(c);s.fromPointNormal(c,a);var l=At.copy(a).scale(i).add(n),h=gt.copy(a).negate();h.dot(l);u.fromPointNormal(l,h),r+=2}}catch(t){o.e(t)}finally{o.f()}return this}},{key:"computeVisibility",value:function(t){Object(st.a)(t);var e,n=T.INSIDE,i=pt(this.planes);try{for(i.s();!(e=i.n()).done;){var r=e.value;switch(t.intersectPlane(r)){case T.OUTSIDE:return T.OUTSIDE;case T.INTERSECTING:n=T.INTERSECTING}}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"computeVisibilityWithPlaneMask",value:function(e,n){if(Object(st.a)(e,"boundingVolume is required."),Object(st.a)(Number.isFinite(n),"parentPlaneMask is required."),n===t.MASK_OUTSIDE||n===t.MASK_INSIDE)return n;for(var i=t.MASK_INSIDE,r=this.planes,o=0;o<this.planes.length;++o){var a=o<31?1<<o:0;if(!(o<31&&0==(n&a))){var s=r[o],u=e.intersectPlane(s);if(u===T.OUTSIDE)return t.MASK_OUTSIDE;u===T.INTERSECTING&&(i|=a)}}return i}}]),t}());function yt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt=n(205);function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach((function(e){yt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xt=new C.a,wt=new C.a,Et=new C.a,Tt=new C.a,St=new C.a,Pt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,t),e=bt({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new mt([new ht,new ht,new ht,new ht,new ht,new ht]),this._perspectiveMatrix=new vt.a,this._infinitePerspective=new vt.a}return M(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,n){Object(st.a)(t,"position is required."),Object(st.a)(e,"direction is required."),Object(st.a)(n,"up is required.");var i=this._cullingVolume.planes;n=xt.copy(n).normalize();var r=wt.copy(e).cross(n).normalize(),o=Et.copy(e).multiplyByScalar(this.near).add(t),a=Tt.copy(e).multiplyByScalar(this.far).add(t),s=St;return s.copy(r).multiplyByScalar(this.left).add(o).subtract(t).cross(n),i[0].fromPointNormal(t,s),s.copy(r).multiplyByScalar(this.right).add(o).subtract(t).cross(n).negate(),i[1].fromPointNormal(t,s),s.copy(n).multiplyByScalar(this.bottom).add(o).subtract(t).cross(r).negate(),i[2].fromPointNormal(t,s),s.copy(n).multiplyByScalar(this.top).add(o).subtract(t).cross(r),i[3].fromPointNormal(t,s),s=(new C.a).copy(e),i[4].fromPointNormal(o,s),s.negate(),i[5].fromPointNormal(a,s),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,n,i){Mt(this),Object(st.a)(Number.isFinite(t)&&Number.isFinite(e)),Object(st.a)(t>0),Object(st.a)(e>0),Object(st.a)(n>0),Object(st.a)(i);var r=1/this.near,o=this.top*r,a=2*n*o/e,s=2*n*(o=this.right*r)/t;return i.x=s,i.y=a,i}},{key:"projectionMatrix",get:function(){return Mt(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Mt(this),this._infinitePerspective}}]),t}();function Mt(t){Object(st.a)(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,n=t.bottom,i=t.right,r=t.left,o=t.near,a=t.far;e===t._top&&n===t._bottom&&r===t._left&&i===t._right&&o===t._near&&a===t._far||(Object(st.a)(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=r,t._right=i,t._top=e,t._bottom=n,t._near=o,t._far=a,t._perspectiveMatrix=(new vt.a).frustum({left:r,right:i,bottom:n,top:e,near:o,far:a}),t._infinitePerspective=(new vt.a).frustum({left:r,right:i,bottom:n,top:e,near:o,far:1/0}))}function Ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function It(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(n),!0).forEach((function(e){yt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,t),e=It({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new Pt,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}M(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(Ot(this),Ot(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,n){return Ot(this),this._offCenterFrustum.computeCullingVolume(t,e,n)}},{key:"getPixelDimensions",value:function(t,e,n,i){return Ot(this),this._offCenterFrustum.getPixelDimensions(t,e,n,i)}},{key:"projectionMatrix",get:function(){return Ot(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Ot(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return Ot(this),this._fovy}},{key:"sseDenominator",get:function(){return Ot(this),this._sseDenominator}}])}();function Ot(t){Object(st.a)(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(Object(st.a)(t.fov>=0&&t.fov<Math.PI),Object(st.a)(t.aspectRatio>0),Object(st.a)(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,new C.a,Math.PI;var Lt=n(216);new N.a,new N.a,new N.a,new N.a,new N.a;new C.a,new C.a,new C.a,new C.a,new C.a,new N.a,new N.a,new N.a;var Rt=n(2);class kt{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get children(){if(!this._children){const t=2*this.x,e=2*this.y,n=this.z+1;this._children=[new kt(t,e,n),new kt(t,e+1,n),new kt(t+1,e,n),new kt(t+1,e+1,n)]}return this._children}update(t){const{viewport:e,cullingVolume:n,elevationBounds:i,minZ:r,maxZ:o,offset:a,project:s}=t,u=this.getBoundingVolume(i,a,s);if(n.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:t}=this;if(t<o&&t>=r){const n=u.distanceTo(e.cameraPosition)*e.scale/e.height;t+=Math.floor(Math.log2(n))}if(t>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const e of this.children)e.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}getBoundingVolume(t,e,n){if(n){const e=jt(this.x,this.y,this.z),i=jt(this.x+1,this.y+1,this.z),r=jt(this.x+.5,this.y+.5,this.z);e.z=t[1],i.z=t[1],r.z=t[0];const o=n(e),a=n(i),s=new Rt.c(n(r)),u=Math.max(s.distance(o),s.distance(a));return new B(s,u)}const i=512/Math.pow(2,this.z),r=this.x*i+512*e,o=512-(this.y+1)*i;return new L([r,o,t[0]],[r+i,o+i,t[1]])}}const Dt=[-1/0,-1/0,1/0,1/0],Bt={type:"url",value:"",validate:t=>"string"==typeof t||Array.isArray(t)&&t.every(t=>"string"==typeof t),equals:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function Ft(t,e){const n=[e.transformPoint([t[0],t[1]]),e.transformPoint([t[2],t[1]]),e.transformPoint([t[0],t[3]]),e.transformPoint([t[2],t[3]])];return[Math.min(...n.map(t=>t[0])),Math.min(...n.map(t=>t[1])),Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))]}function zt(t,e){if(!t||!t.length)return null;if(Array.isArray(t)){t=t[Math.abs(e.x+e.y)%t.length]}const{x:n,y:i,z:r}=e;return t.replace("{x}",n).replace("{y}",i).replace("{z}",r).replace("{-y}",Math.pow(2,r)-i-1)}function Nt(t){return Math.pow(2,t)}function jt(t,e,n){const i=Nt(n),r=t/i*360-180,o=Math.PI-2*Math.PI*e/i;return[r,180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))]}function Ut(t,e,n){const i=Nt(n);return[t/i*512,e/i*512]}function Vt(t,e,n,i){if(t.isGeospatial){const[t,r]=jt(e,n,i),[o,a]=jt(e+1,n+1,i);return{west:t,north:r,east:o,south:a}}const[r,o]=Ut(e,n,i),[a,s]=Ut(e+1,n+1,i);return{left:r,top:o,right:a,bottom:s}}function Gt(t,e,n,i){const r=function(t,e,n){let i;if(e&&2===e.length){const[n,r]=e,o=t.getBounds({z:n}),a=t.getBounds({z:r});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}(t,null,n),o=Nt(e),[a,s,u,c]=function(t,e,n){if(n){return Ft(t,n).map(t=>t*e/512)}return t.map(t=>t*e/512)}(r,o,i),l=[];for(let t=Math.floor(a);t<u;t++)for(let n=Math.floor(s);n<c;n++)l.push({x:t,y:n,z:e});return l}function Wt({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:o=512,modelMatrix:a,modelMatrixInverse:s}){let u=Math.round(t.zoom+Math.log2(512/o));if(Number.isFinite(n)&&u<n){if(!r)return[];u=n}Number.isFinite(e)&&u>e&&(u=e);let c=r;return a&&s&&r&&!t.isGeospatial&&(c=Ft(r,a)),t.isGeospatial?function(t,e,n){const i=t.resolution?t.projectPosition:null,r=Object.values(t.getFrustumPlanes()).map(({normal:t,distance:e})=>new ht(t.clone().negate(),e)),o=new mt(r),a=t.distanceScales.unitsPerMeter[2],s=n&&n[0]*a||0,u=n&&n[1]*a||0,c=t.pitch<=60?e:0,l=new kt(0,0,0),h={viewport:t,project:i,cullingVolume:o,elevationBounds:[s,u],minZ:c,maxZ:e,offset:0};if(l.update(h),t.subViewports&&t.subViewports.length>1){for(h.offset=-1;l.update(h)&&!(--h.offset<-3););for(h.offset=1;l.update(h)&&!(++h.offset>3););}return l.getSelected()}(t,u,i):Gt(t,u,c||Dt,s)}var Ht=n(212);class qt{constructor(t){this.opts=t,this._getTileData=t.getTileData,this.onTileError=t.onTileError,this.onTileLoad=e=>{t.onTileLoad(e),this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this.onTileUnload=t.onTileUnload,this._requestScheduler=new Ht.a({maxRequests:t.maxRequests,throttleRequests:t.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(t)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles.every(t=>t.isLoaded)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort()}update(t,{zRange:e,modelMatrix:n}={}){const i=new Rt.a(n),r=!i.equals(this._modelMatrix);if(!t.equals(this._viewport)||r){r&&(this._modelMatrixInverse=n&&i.clone().invert(),this._modelMatrix=n&&i),this._viewport=t;const o=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=o.map(t=>this._getTile(t,!0)),this._dirty&&this._rebuildTree()}const o=this.updateTileStates();return this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}getTileIndices({viewport:t,maxZoom:e,minZoom:n,zRange:i,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:a,extent:s}=this.opts;return Wt({viewport:t,maxZoom:e,minZoom:n,zRange:i,tileSize:a,extent:s,modelMatrix:r,modelMatrixInverse:o})}getTileMetadata({x:t,y:e,z:n}){return{bbox:Vt(this._viewport,t,e,n)}}getParentIndex(t){return t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),t.z-=1,t}updateTileStates(){this._updateTileStates(this.selectedTiles);const{maxRequests:t}=this.opts,e=[];let n=0,i=!1;for(const t of this._cache.values()){const r=Boolean(1&t.state);t.isVisible!==r&&(i=!0,t.isVisible=r),t.isSelected=5===t.state,t.isLoading&&(n++,t.isSelected||e.push(t))}if(t>0)for(;n>t&&e.length>0;){e.shift().abort(),n--}return i}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children.length=0;for(const e of t.values()){const t=this._getNearestAncestor(e.x,e.y,e.z);e.parent=t,t&&t.children.push(e)}}_updateTileStates(t){const{_cache:e}=this,n=this.opts.refinementStrategy||"best-available";for(const t of e.values())t.state=0;for(const e of t)e.state=5;if("never"!==n){for(const e of t)Zt(e,n);for(const e of t)Xt(e)&&Qt(e)}}_resizeCache(){const{_cache:t,opts:e}=this,n=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=e.maxCacheByteSize||1/0;if(t.size>n||this._cacheByteSize>i){for(const[r,o]of t)if(o.isVisible||(this._cacheByteSize-=e.maxCacheByteSize?o.byteLength:0,t.delete(r),this.onTileUnload(o)),t.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((t,e)=>t.z-e.z),this._dirty=!1)}_getTile({x:t,y:e,z:n},i){const r="".concat(t,",").concat(e,",").concat(n);let o=this._cache.get(r);return!o&&i?(o=new E({x:t,y:e,z:n,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData,this._requestScheduler),this._cache.set(r,o),this._dirty=!0):o&&o.isCancelled&&!o.isLoading&&o.loadData(this._getTileData,this._requestScheduler),o}_getNearestAncestor(t,e,n){const{_minZoom:i=0}=this;let r={x:t,y:e,z:n};for(;r.z>i;){r=this.getParentIndex(r);const t=this._getTile(r);if(t)return t}return null}}function Xt(t){let e=t;for(;e;){if(!1&e.state)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function Zt(t,e){let n,i=3;for(;n=t.parent;){if(t.isLoaded&&(i=4,"best-available"===e))return;n.state=Math.max(n.state,i),t=n}}function Qt(t){for(const e of t.children)e.state=Math.max(e.state,3),e.isLoaded||Qt(e)}const Yt={data:[],dataComparator:Bt.equals,renderSubLayers:{type:"function",value:t=>new b.a(t),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:t=>console.error(t),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,fetch:{type:"function",value:(t,{layer:e,signal:n})=>{const i={...e.getLoadOptions()};return i.fetch={...i.fetch,signal:n},Object(x.a)(t,i)},compare:!1},maxRequests:6};class Kt extends o.a{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t;null===(t=this.state.tileset)||void 0===t||t.finalize()}get isLoaded(){const{tileset:t}=this.state;return t.selectedTiles.every(t=>t.layers&&t.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:e,context:n,changeFlags:i}){let{tileset:r}=this.state;if(!r||i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getTileData)){r&&r.finalize();const e=Number.isFinite(this.state.maxZoom)?this.state.maxZoom:t.maxZoom,n=Number.isFinite(this.state.minZoom)?this.state.minZoom:t.minZoom,{tileSize:i,maxCacheSize:o,maxCacheByteSize:a,refinementStrategy:s,extent:u,maxRequests:c}=t;r=new qt({getTileData:this.getTileData.bind(this),maxCacheSize:o,maxCacheByteSize:a,maxZoom:e,minZoom:n,tileSize:i,refinementStrategy:s,extent:u,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this),maxRequests:c}),this.setState({tileset:r})}else(i.propsChanged||i.updateTriggersChanged)&&(r.setOptions(t),this.state.tileset.tiles.forEach(t=>{t.layers=null}));this._updateTileset()}_updateTileset(){const{tileset:t}=this.state,{zRange:e,modelMatrix:n}=this.props,i=t.update(this.context.viewport,{zRange:e,modelMatrix:n}),{isLoaded:r}=t,o=this.state.isLoaded!==r,a=this.state.frameNumber!==i;r&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.getCurrentLayer().props.onTileLoad(t),t.isVisible&&this.setNeedsUpdate()}_onTileError(t,e){const n=this.getCurrentLayer();n.props.onTileError(t),n._updateTileset(),e.isVisible&&this.setNeedsUpdate()}_onTileUnload(t){this.getCurrentLayer().props.onTileUnload(t)}getTileData(t){const{data:e}=this.props,{getTileData:n,fetch:i}=this.getCurrentLayer().props,{signal:r}=t;return t.url=zt(e,t),n?n(t):t.url?i(t.url,{layer:this,signal:r}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getHighlightedObjectIndex(){return-1}getPickingInfo({info:t,sourceLayer:e}){return t.tile=e.props.tile,t}_updateAutoHighlight(t){t.sourceLayer&&t.sourceLayer.updateAutoHighlight(t)}renderLayers(){const{visible:t}=this.props;return this.state.tileset.tiles.map(e=>{const n=t&&e.isVisible,i=this.getHighlightedObjectIndex(e);if(e.isLoaded)if(e.layers)!e.layers[0]||e.layers[0].props.visible===n&&e.layers[0].props.highlightedObjectIndex===i||(e.layers=e.layers.map(t=>t.clone({visible:n,highlightedObjectIndex:i})));else{const t=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.data,visible:n,_offset:0,tile:e,highlightedObjectIndex:i});e.layers=Object(_.b)(t,Boolean)}else;return e.layers})}}Kt.layerName="TileLayer",Kt.defaultProps=Yt;var Jt=n(92);class $t extends Jt.a{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":"uniform float trailLength;\nattribute float instanceTimestamps;\nattribute float instanceNextTimestamps;\nvarying float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"color.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}initializeState(t){super.initializeState(t),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{trailLength:e,currentTime:n}=this.props;t.uniforms={...t.uniforms,trailLength:e,currentTime:n},super.draw(t)}}$t.layerName="TripsLayer",$t.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}};var te=function(t){var e,n=void 0!==(t=t||{})?t:{},i={};for(e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);var r,o=[],a="";document.currentScript&&(a=document.currentScript.src),a=0!==a.indexOf("blob:")?a.substr(0,a.lastIndexOf("/")+1):"",r=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||0==i.status&&i.response)e(i.response);else{var r=Q(t);r?e(r.buffer):n()}},i.onerror=n,i.send(null)};var s=n.print||console.log.bind(console),u=n.printErr||console.warn.bind(console);for(e in i)i.hasOwnProperty(e)&&(n[e]=i[e]);i=null,n.arguments&&(o=n.arguments);var c=0,l=function(){return c};var h=!1;function p(t){var e,i=n["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",i||ut("Assertion failed: "+e),i}function f(t,e,n,i,r){var o={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);(function(t,e,n){(function(t,e,n,i){if(!(i>0))return 0;for(var r=n,o=n+i-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343){var u=t.charCodeAt(++a);s=65536+((1023&s)<<10)|1023&u}if(s<=127){if(n>=o)break;e[n++]=s}else if(s<=2047){if(n+1>=o)break;e[n++]=192|s>>6,e[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;e[n++]=224|s>>12,e[n++]=128|s>>6&63,e[n++]=128|63&s}else{if(n+3>=o)break;e[n++]=240|s>>18,e[n++]=128|s>>12&63,e[n++]=128|s>>6&63,e[n++]=128|63&s}}e[n]=0})(t,y,e,n)})(t,e=tt(n),n)}return e},array:function(t){var e=tt(t.length);return function(t,e){m.set(t,e)}(t,e),e}};var a=p(t),s=[],u=0;if(i)for(var c=0;c<i.length;c++){var l=o[n[c]];l?(0===u&&(u=nt()),s[c]=l(i[c])):s[c]=i[c]}var h=a.apply(null,s);return h=function(t){return"string"===e?A(t):"boolean"===e?Boolean(t):t}(h),0!==u&&et(u),h}var d="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(t,e){return t?function(t,e,n){for(var i=e+n,r=e;t[r]&&!(r>=i);)++r;if(r-e>16&&t.subarray&&d)return d.decode(t.subarray(e,r));for(var o="";e<r;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var u=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&t[e++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}(y,t,e):""}var g,m,y,v,_,b,x;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function w(t,e){return t%e>0&&(t+=e-t%e),t}function E(t){g=t,n.HEAP8=m=new Int8Array(t),n.HEAP16=v=new Int16Array(t),n.HEAP32=_=new Int32Array(t),n.HEAPU8=y=new Uint8Array(t),n.HEAPU16=new Uint16Array(t),n.HEAPU32=new Uint32Array(t),n.HEAPF32=b=new Float32Array(t),n.HEAPF64=x=new Float64Array(t)}var T=n.TOTAL_MEMORY||33554432;function S(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var i=e.func;"number"==typeof i?void 0===e.arg?n.dynCall_v(i):n.dynCall_vi(i,e.arg):i(void 0===e.arg?null:e.arg)}else e()}}T=(g=n.buffer?n.buffer:new ArrayBuffer(T)).byteLength,E(g),_[5916]=5266576;var P=[],M=[],C=[],I=[];var O=Math.abs,L=Math.ceil,R=Math.floor,k=Math.min,D=0,B=null,F=null;n.preloadedImages={},n.preloadedAudios={};var z,N,j=null,U="data:application/octet-stream;base64,";function V(t){return String.prototype.startsWith?t.startsWith(U):0===t.indexOf(U)}j="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAABhbGdvcy5jAHBvbHlmaWxsAGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvR2VvQm91bmRhcnkAYWRqYWNlbnRGYWNlRGlyW2NlbnRlcklKSy5mYWNlXVtmYWNlMl0gPT0gS0kAX2ZhY2VJamtUb0dlb0JvdW5kYXJ5AHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAaDNUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBwZW50YWdvblJvdGF0aW9ucyA+PSAwAGRpcmVjdGlvblJvdGF0aW9ucyA+PSAwAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9IMwAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMAB3aXRoaW5QZW50YWdvblJvdGF0aW9ucyA+PSAwAGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";function G(t){return t}function W(t){return t.replace(/\b__Z[\w\d_]+/g,(function(t){return t===t?t:t+" ["+t+"]"}))}function H(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}function q(){return m.length}function X(t){try{var e=new ArrayBuffer(t);if(e.byteLength!=t)return;return new Int8Array(e).set(m),$(e),E(e),1}catch(t){}}var Z="function"==typeof atob?atob:function(t){var e,n,i,r,o,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{e=s.indexOf(t.charAt(c++))<<2|(r=s.indexOf(t.charAt(c++)))>>4,n=(15&r)<<4|(o=s.indexOf(t.charAt(c++)))>>2,i=(3&o)<<6|(a=s.indexOf(t.charAt(c++))),u+=String.fromCharCode(e),64!==o&&(u+=String.fromCharCode(n)),64!==a&&(u+=String.fromCharCode(i))}while(c<t.length);return u};function Q(t){if(V(t))return function(t){try{for(var e=Z(t),n=new Uint8Array(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}catch(t){throw new Error("Converting base64 string to bytes failed.")}}(t.slice(U.length))}var Y,K,J=function(t,e,n){var i=new t.Int8Array(n),r=new t.Int32Array(n),o=(new t.Uint8Array(n),new t.Float32Array(n),new t.Float64Array(n)),a=0|e.p,s=t.Math.floor,u=t.Math.abs,c=t.Math.sqrt,l=t.Math.pow,h=t.Math.cos,p=t.Math.sin,f=t.Math.tan,d=t.Math.acos,A=t.Math.asin,g=t.Math.atan,m=t.Math.atan2,y=t.Math.ceil,v=t.Math.imul,_=t.Math.clz32,b=e.b,x=e.c,w=e.d,E=e.e,T=e.f,S=e.g,P=e.h,M=e.i,C=23696;function I(t,e,n,i){var r,o,a;0|O(t|=0,e|=0,n|=0,i|=0,a=0|he(o=(r=1+(0|v(3*n|0,n+1|0))|0)<<2))?(xe(0|i,0,r<<3|0),xe(0|a,0,0|o),L(t,e,n,i,a,r,0),pe(a)):pe(a)}function O(t,e,n,i,o){t|=0,e|=0,n|=0,o|=0;var a,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0;if(a=C,C=C+16|0,d=a,r[(s=i|=0)>>2]=t,r[s+4>>2]=e,(s=0!=(0|o))&&(r[o>>2]=0),0|Ot(t,e))return C=a,0|(d=1);r[d>>2]=0;t:do{if((0|n)>=1)if(s)for(h=0,p=1,f=1,u=0,s=t;;){if(!(u|h)){if(0==(0|(s=0|R(s,e,4,d)))&0==(0|(e=0|x()))){s=2;break t}if(0|Ot(s,e)){s=1;break t}}if(0==(0|(s=0|R(s,e,0|r[16+(h<<2)>>2],d)))&0==(0|(e=0|x()))){s=2;break t}if(r[(t=i+(f<<3)|0)>>2]=s,r[t+4>>2]=e,r[o+(f<<2)>>2]=p,t=(0|(u=u+1|0))==(0|p),l=6==(0|(c=h+1|0)),0|Ot(s,e)){s=1;break t}if((0|(p=p+(l&t&1)|0))>(0|n)){s=0;break}h=t?l?0:c:h,f=f+1|0,u=t?0:u}else for(h=0,p=1,f=1,u=0,s=t;;){if(!(u|h)){if(0==(0|(s=0|R(s,e,4,d)))&0==(0|(e=0|x()))){s=2;break t}if(0|Ot(s,e)){s=1;break t}}if(0==(0|(s=0|R(s,e,0|r[16+(h<<2)>>2],d)))&0==(0|(e=0|x()))){s=2;break t}if(r[(t=i+(f<<3)|0)>>2]=s,r[t+4>>2]=e,t=(0|(u=u+1|0))==(0|p),l=6==(0|(c=h+1|0)),0|Ot(s,e)){s=1;break t}if((0|(p=p+(l&t&1)|0))>(0|n)){s=0;break}h=t?l?0:c:h,f=f+1|0,u=t?0:u}else s=0}while(0);return C=a,0|(d=s)}function L(t,e,n,i,o,a,s){n|=0,i|=0,o|=0,a|=0,s|=0;var u,c,l=0,h=0,p=0,f=0,d=0;if(c=C,C=C+16|0,u=c,0==(0|(t|=0))&0==(0|(e|=0)))C=c;else{if(l=0|me(0|t,0|e,0|a,((0|a)<0)<<31>>31|0),x(),!(0==(0|(d=0|r[(f=h=i+(l<<3)|0)>>2]))&0==(0|(f=0|r[f+4>>2]))|(p=(0|d)==(0|t)&(0|f)==(0|e))))do{p=(0|(f=0|r[(d=h=i+((l=(l+1|0)%(0|a)|0)<<3)|0)>>2]))==(0|t)&(0|(d=0|r[d+4>>2]))==(0|e)}while(!(0==(0|f)&0==(0|d)|p));l=o+(l<<2)|0,p&&(0|r[l>>2])<=(0|s)?C=c:(r[(d=h)>>2]=t,r[d+4>>2]=e,r[l>>2]=s,(0|s)>=(0|n)?C=c:(d=s+1|0,r[u>>2]=0,L(f=0|R(t,e,2,u),0|x(),n,i,o,a,d),r[u>>2]=0,L(f=0|R(t,e,3,u),0|x(),n,i,o,a,d),r[u>>2]=0,L(f=0|R(t,e,1,u),0|x(),n,i,o,a,d),r[u>>2]=0,L(f=0|R(t,e,5,u),0|x(),n,i,o,a,d),r[u>>2]=0,L(f=0|R(t,e,4,u),0|x(),n,i,o,a,d),r[u>>2]=0,L(f=0|R(t,e,6,u),0|x(),n,i,o,a,d),C=c))}}function R(t,e,n,i){t|=0,e|=0,n|=0;var o,a,s=0,u=0,c=0,l=0,h=0,p=0,f=0;if((0|r[(i|=0)>>2])>0){s=0;do{n=0|ot(n),s=s+1|0}while((0|s)<(0|r[i>>2]))}o=0|ye(0|t,0|e,45),x(),a=127&o,u=0|Lt(t,e),s=0|ye(0|t,0|e,52),x(),s&=15;t:do{if(s)for(;;){if(p=0|ye(0|t,0|e,0|(h=3*(15-s|0)|0)),x(),p&=7,f=0==(0|Ft(s)),s=s+-1|0,l=0|ve(7,0,0|h),e&=~(0|x()),t=(h=0|ve(0|r[(f?464:48)+(28*p|0)+(n<<2)>>2],0,0|h))|t&~l,e|=0|x(),!(n=0|r[(f?672:256)+(28*p|0)+(n<<2)>>2])){n=0;break t}if(!s){c=6;break}}else c=6}while(0);6==(0|c)&&(t|=p=0|ve(0|(f=0|r[880+(28*a|0)+(n<<2)>>2]),0,45),e=0|x()|-1040385&e,n=0|r[4304+(28*a|0)+(n<<2)>>2],127==(127&f|0)&&(f=0|ve(0|r[880+(28*a|0)+20>>2],0,45),e=0|x()|-1040385&e,n=0|r[4304+(28*a|0)+20>>2],t=0|kt(f|t,e),e=0|x(),r[i>>2]=1+(0|r[i>>2]))),c=0|ye(0|t,0|e,45),x(),c&=127;t:do{if(0|k(c)){e:do{if(1==(0|Lt(t,e))){if((0|a)!=(0|c)){if(0|z(c,0|r[7728+(28*a|0)>>2])){t=0|Bt(t,e),u=1,e=0|x();break}t=0|kt(t,e),u=1,e=0|x();break}switch(0|u){case 5:t=0|Bt(t,e),e=0|x(),r[i>>2]=5+(0|r[i>>2]),u=0;break e;case 3:t=0|kt(t,e),e=0|x(),r[i>>2]=1+(0|r[i>>2]),u=0;break e;default:return f=0,b(0|(p=0)),0|f}}else u=0}while(0);if((0|n)>0){s=0;do{t=0|Rt(t,e),e=0|x(),s=s+1|0}while((0|s)!=(0|n))}if((0|a)!=(0|c)){if(!(0|D(c))){if(0!=(0|u)|5!=(0|Lt(t,e)))break;r[i>>2]=1+(0|r[i>>2]);break}switch(127&o){case 8:case 118:break t}3!=(0|Lt(t,e))&&(r[i>>2]=1+(0|r[i>>2]))}}else if((0|n)>0){s=0;do{t=0|kt(t,e),e=0|x(),s=s+1|0}while((0|s)!=(0|n))}}while(0);return r[i>>2]=((0|r[i>>2])+n|0)%6|0,f=t,b(0|(p=e)),0|f}function k(t){return 0|r[7728+(28*(t|=0)|0)+16>>2]}function D(t){return 4==(0|(t|=0))|117==(0|t)|0}function B(t){return 0|r[11152+(216*(0|r[(t|=0)>>2])|0)+(72*(0|r[t+4>>2])|0)+(24*(0|r[t+8>>2])|0)+(r[t+12>>2]<<3)>>2]}function F(t){return 0|r[11152+(216*(0|r[(t|=0)>>2])|0)+(72*(0|r[t+4>>2])|0)+(24*(0|r[t+8>>2])|0)+(r[t+12>>2]<<3)+4>>2]}function z(t,e){return e|=0,(0|r[7728+(28*(t|=0)|0)+20>>2])==(0|e)?0|(e=1):0|(e=(0|r[7728+(28*t|0)+24>>2])==(0|e))}function N(t,e){return 0|r[880+(28*(t|=0)|0)+((e|=0)<<2)>>2]}function j(t,e){return e|=0,(0|r[880+(28*(t|=0)|0)>>2])==(0|e)?0|(e=0):(0|r[880+(28*t|0)+4>>2])==(0|e)?0|(e=1):(0|r[880+(28*t|0)+8>>2])==(0|e)?0|(e=2):(0|r[880+(28*t|0)+12>>2])==(0|e)?0|(e=3):(0|r[880+(28*t|0)+16>>2])==(0|e)?0|(e=4):(0|r[880+(28*t|0)+20>>2])==(0|e)?0|(e=5):0|((0|r[880+(28*t|0)+24>>2])==(0|e)?6:7)}function U(t){return+o[(t|=0)+16>>3]<+o[t+24>>3]|0}function V(t,e){t|=0;var n,i,r=0;return(r=+o[(e|=0)>>3])>=+o[t+8>>3]&&r<=+o[t>>3]?(n=+o[t+16>>3],r=+o[t+24>>3],e=(i=+o[e+8>>3])>=r,t=i<=n&1,n<r?e&&(t=1):e||(t=0),0|(e=0!=(0|t))):0|(e=0)}function G(t,e){e|=0;var n,i,r,a,s,c,l,h,p=0,f=0;return n=C,C=C+224|0,r=n+200|0,i=n+32|0,s=n,h=(t|=0)+8|0,o[(a=n+16|0)>>3]=.5*(+o[t>>3]+ +o[h>>3]),p=+o[(c=t+16|0)>>3],p=+St(.5*((f=+o[t+24>>3])+(p<f?p+6.283185307179586:p))),o[a+8>>3]=p,p=+o[t>>3],f=+u(+p),l=+o[h>>3],t=f>+u(+l),o[s>>3]=t?l:p,o[s+8>>3]=+o[c>>3],p=+Pt(a,s),Ut(t=0|zt(a,e),e=0|x(),r),Vt(t,e,i),e=~~+y(+p/+Pt(r,i+8|0)),C=n,0|e}function W(t,e,n,i){e|=0,n|=0,i|=0,r[(t|=0)>>2]=e,r[t+4>>2]=n,r[t+8>>2]=i}function H(t,e){t|=0;var n,i,a,s,c=0,l=0,h=0,p=0,f=0,d=0,A=0;r[(s=(e|=0)+8|0)>>2]=0,i=+o[t>>3],p=+u(+i),a=+o[t+8>>3],p+=.5*(f=+u(+a)/.8660254037844386),p-=+(0|(c=~~p)),f-=+(0|(t=~~f));do{if(p<.5){if(p<.3333333333333333){if(r[e>>2]=c,f<.5*(p+1)){r[e+4>>2]=t;break}t=t+1|0,r[e+4>>2]=t;break}if(t=(1&!(f<(A=1-p)))+t|0,r[e+4>>2]=t,A<=f&f<2*p){c=c+1|0,r[e>>2]=c;break}r[e>>2]=c;break}if(!(p<.6666666666666666)){if(c=c+1|0,r[e>>2]=c,f<.5*p){r[e+4>>2]=t;break}t=t+1|0,r[e+4>>2]=t;break}if(f<1-p){if(r[e+4>>2]=t,2*p-1<f){r[e>>2]=c;break}}else t=t+1|0,r[e+4>>2]=t;c=c+1|0,r[e>>2]=c}while(0);do{if(i<0){if(1&t){c=~~(+(0|c)-(2*(+((d=0|de(0|c,((0|c)<0)<<31>>31|0,0|(d=(t+1|0)/2|0),((0|d)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))+1)),r[e>>2]=c;break}c=~~(+(0|c)-2*(+((d=0|de(0|c,((0|c)<0)<<31>>31|0,0|(d=(0|t)/2|0),((0|d)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))),r[e>>2]=c;break}}while(0);d=e+4|0,a<0&&(c=c-((1|t<<1)/2|0)|0,r[e>>2]=c,t=0-t|0,r[d>>2]=t),l=t-c|0,(0|c)<0?(h=0-c|0,r[d>>2]=l,r[s>>2]=h,r[e>>2]=0,t=l,c=0):h=0,(0|t)<0&&(c=c-t|0,r[e>>2]=c,h=h-t|0,r[s>>2]=h,r[d>>2]=0,t=0),n=c-h|0,l=t-h|0,(0|h)<0&&(r[e>>2]=n,r[d>>2]=l,r[s>>2]=0,t=l,c=n,h=0),(0|(l=(0|h)<(0|(l=(0|t)<(0|c)?t:c))?h:l))<=0||(r[e>>2]=c-l,r[d>>2]=t-l,r[s>>2]=h-l)}function q(t){var e,n=0,i=0,o=0,a=0,s=0;n=0|r[(t|=0)>>2],i=0|r[(e=t+4|0)>>2],(0|n)<0&&(i=i-n|0,r[e>>2]=i,r[(s=t+8|0)>>2]=(0|r[s>>2])-n,r[t>>2]=0,n=0),(0|i)<0?(n=n-i|0,r[t>>2]=n,a=(0|r[(s=t+8|0)>>2])-i|0,r[s>>2]=a,r[e>>2]=0,i=0):(s=a=t+8|0,a=0|r[a>>2]),(0|a)<0&&(n=n-a|0,r[t>>2]=n,i=i-a|0,r[e>>2]=i,r[s>>2]=0,a=0),(0|(o=(0|a)<(0|(o=(0|i)<(0|n)?i:n))?a:o))<=0||(r[t>>2]=n-o,r[e>>2]=i-o,r[s>>2]=a-o)}function X(t,e){e|=0;var n,i;i=0|r[(t|=0)+8>>2],n=+((0|r[t+4>>2])-i|0),o[e>>3]=+((0|r[t>>2])-i|0)-.5*n,o[e+8>>3]=.8660254037844386*n}function Z(t,e,n){t|=0,e|=0,r[(n|=0)>>2]=(0|r[e>>2])+(0|r[t>>2]),r[n+4>>2]=(0|r[e+4>>2])+(0|r[t+4>>2]),r[n+8>>2]=(0|r[e+8>>2])+(0|r[t+8>>2])}function Q(t,e,n){t|=0,e|=0,r[(n|=0)>>2]=(0|r[t>>2])-(0|r[e>>2]),r[n+4>>2]=(0|r[t+4>>2])-(0|r[e+4>>2]),r[n+8>>2]=(0|r[t+8>>2])-(0|r[e+8>>2])}function Y(t,e){e|=0;var n,i=0;i=0|v(0|r[(t|=0)>>2],e),r[t>>2]=i,n=0|v(0|r[(i=t+4|0)>>2],e),r[i>>2]=n,e=0|v(0|r[(t=t+8|0)>>2],e),r[t>>2]=e}function K(t){var e,n,i=0,o=0,a=0,s=0,u=0;u=(0|(n=0|r[(t|=0)>>2]))<0,t=(t=(o=(0|(s=((e=(0|(a=(0|r[t+4>>2])-(u?n:0)|0))<0)?0-a|0:0)+((0|r[t+8>>2])-(u?n:0))|0))<0)?0:s)-((a=(0|(o=(0|t)<(0|(o=(0|(i=(e?0:a)-(o?s:0)|0))<(0|(s=(u?0:n)-(e?a:0)-(o?s:0)|0))?i:s))?t:o))>0)?o:0)|0,i=i-(a?o:0)|0;t:do{switch(s-(a?o:0)|0){case 0:switch(0|i){case 0:return 0|(u=0==(0|t)?0:1==(0|t)?1:7);case 1:return 0|(u=0==(0|t)?2:1==(0|t)?3:7);default:break t}case 1:switch(0|i){case 0:return 0|(u=0==(0|t)?4:1==(0|t)?5:7);case 1:if(t)break t;return 0|(t=6);default:break t}}}while(0);return 0|(u=7)}function J(t){var e,n,i=0,o=0,a=0,s=0,u=0;o=0|r[(e=(t|=0)+8|0)>>2],a=0|le(+((3*(i=(0|r[t>>2])-o|0)|0)-(o=(0|r[(n=t+4|0)>>2])-o|0)|0)/7),r[t>>2]=a,i=0|le(+((o<<1)+i|0)/7),r[n>>2]=i,r[e>>2]=0,o=i-a|0,(0|a)<0?(u=0-a|0,r[n>>2]=o,r[e>>2]=u,r[t>>2]=0,i=o,a=0,o=u):o=0,(0|i)<0&&(a=a-i|0,r[t>>2]=a,o=o-i|0,r[e>>2]=o,r[n>>2]=0,i=0),u=a-o|0,s=i-o|0,(0|o)<0?(r[t>>2]=u,r[n>>2]=s,r[e>>2]=0,i=s,s=u,o=0):s=a,(0|(a=(0|o)<(0|(a=(0|i)<(0|s)?i:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=i-a,r[e>>2]=o-a)}function $(t){var e,n,i=0,o=0,a=0,s=0,u=0;o=0|r[(e=(t|=0)+8|0)>>2],a=0|le(+(((i=(0|r[t>>2])-o|0)<<1)+(o=(0|r[(n=t+4|0)>>2])-o|0)|0)/7),r[t>>2]=a,i=0|le(+((3*o|0)-i|0)/7),r[n>>2]=i,r[e>>2]=0,o=i-a|0,(0|a)<0?(u=0-a|0,r[n>>2]=o,r[e>>2]=u,r[t>>2]=0,i=o,a=0,o=u):o=0,(0|i)<0&&(a=a-i|0,r[t>>2]=a,o=o-i|0,r[e>>2]=o,r[n>>2]=0,i=0),u=a-o|0,s=i-o|0,(0|o)<0?(r[t>>2]=u,r[n>>2]=s,r[e>>2]=0,i=s,s=u,o=0):s=a,(0|(a=(0|o)<(0|(a=(0|i)<(0|s)?i:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=i-a,r[e>>2]=o-a)}function tt(t){var e,n,i,o=0,a=0,s=0,u=0;o=0|r[(t|=0)>>2],a=0|r[(n=t+4|0)>>2],s=0|r[(i=t+8|0)>>2],u=a+(3*o|0)|0,r[t>>2]=u,a=s+(3*a|0)|0,r[n>>2]=a,o=(3*s|0)+o|0,r[i>>2]=o,s=a-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=s,r[i>>2]=o,r[t>>2]=0,a=s,s=0):s=u,(0|a)<0&&(s=s-a|0,r[t>>2]=s,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=s-o|0,u=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,o=0):u=a,(0|(a=(0|o)<(0|(a=(0|u)<(0|s)?u:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=u-a,r[i>>2]=o-a)}function et(t){var e,n,i,o=0,a=0,s=0,u=0;u=0|r[(t|=0)>>2],s=(3*(o=0|r[(n=t+4|0)>>2])|0)+u|0,u=(a=0|r[(i=t+8|0)>>2])+(3*u|0)|0,r[t>>2]=u,r[n>>2]=s,o=(3*a|0)+o|0,r[i>>2]=o,a=s-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=a,r[i>>2]=o,r[t>>2]=0,u=0):a=s,(0|a)<0&&(u=u-a|0,r[t>>2]=u,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=u-o|0,s=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=s,r[i>>2]=0,u=e,o=0):s=a,(0|(a=(0|o)<(0|(a=(0|s)<(0|u)?s:u))?o:a))<=0||(r[t>>2]=u-a,r[n>>2]=s-a,r[i>>2]=o-a)}function nt(t,e){t|=0;var n,i,o,a=0,s=0,u=0;((e|=0)+-1|0)>>>0>=6||(u=(0|r[15472+(12*e|0)>>2])+(0|r[t>>2])|0,r[t>>2]=u,o=t+4|0,s=(0|r[15472+(12*e|0)+4>>2])+(0|r[o>>2])|0,r[o>>2]=s,i=t+8|0,e=(0|r[15472+(12*e|0)+8>>2])+(0|r[i>>2])|0,r[i>>2]=e,a=s-u|0,(0|u)<0?(e=e-u|0,r[o>>2]=a,r[i>>2]=e,r[t>>2]=0,s=0):(a=s,s=u),(0|a)<0&&(s=s-a|0,r[t>>2]=s,e=e-a|0,r[i>>2]=e,r[o>>2]=0,a=0),n=s-e|0,u=a-e|0,(0|e)<0?(r[t>>2]=n,r[o>>2]=u,r[i>>2]=0,s=n,e=0):u=a,(0|(a=(0|e)<(0|(a=(0|u)<(0|s)?u:s))?e:a))<=0||(r[t>>2]=s-a,r[o>>2]=u-a,r[i>>2]=e-a))}function it(t){var e,n,i,o=0,a=0,s=0,u=0;u=0|r[(t|=0)>>2],s=(o=0|r[(n=t+4|0)>>2])+u|0,u=(a=0|r[(i=t+8|0)>>2])+u|0,r[t>>2]=u,r[n>>2]=s,o=a+o|0,r[i>>2]=o,a=s-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=a,r[i>>2]=o,r[t>>2]=0,s=0):(a=s,s=u),(0|a)<0&&(s=s-a|0,r[t>>2]=s,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=s-o|0,u=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,o=0):u=a,(0|(a=(0|o)<(0|(a=(0|u)<(0|s)?u:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=u-a,r[i>>2]=o-a)}function rt(t){var e,n,i,o=0,a=0,s=0,u=0;o=0|r[(t|=0)>>2],s=0|r[(n=t+4|0)>>2],a=0|r[(i=t+8|0)>>2],u=s+o|0,r[t>>2]=u,s=a+s|0,r[n>>2]=s,o=a+o|0,r[i>>2]=o,a=s-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=a,r[i>>2]=o,r[t>>2]=0,s=0):(a=s,s=u),(0|a)<0&&(s=s-a|0,r[t>>2]=s,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=s-o|0,u=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,o=0):u=a,(0|(a=(0|o)<(0|(a=(0|u)<(0|s)?u:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=u-a,r[i>>2]=o-a)}function ot(t){switch(0|(t|=0)){case 1:t=5;break;case 5:t=4;break;case 4:t=6;break;case 6:t=2;break;case 2:t=3;break;case 3:t=1}return 0|t}function at(t){switch(0|(t|=0)){case 1:t=3;break;case 3:t=2;break;case 2:t=6;break;case 6:t=4;break;case 4:t=5;break;case 5:t=1}return 0|t}function st(t){var e,n,i,o=0,a=0,s=0,u=0;o=0|r[(t|=0)>>2],a=0|r[(n=t+4|0)>>2],s=0|r[(i=t+8|0)>>2],u=a+(o<<1)|0,r[t>>2]=u,a=s+(a<<1)|0,r[n>>2]=a,o=(s<<1)+o|0,r[i>>2]=o,s=a-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=s,r[i>>2]=o,r[t>>2]=0,a=s,s=0):s=u,(0|a)<0&&(s=s-a|0,r[t>>2]=s,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=s-o|0,u=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,o=0):u=a,(0|(a=(0|o)<(0|(a=(0|u)<(0|s)?u:s))?o:a))<=0||(r[t>>2]=s-a,r[n>>2]=u-a,r[i>>2]=o-a)}function ut(t){var e,n,i,o=0,a=0,s=0,u=0;u=0|r[(t|=0)>>2],s=((o=0|r[(n=t+4|0)>>2])<<1)+u|0,u=(a=0|r[(i=t+8|0)>>2])+(u<<1)|0,r[t>>2]=u,r[n>>2]=s,o=(a<<1)+o|0,r[i>>2]=o,a=s-u|0,(0|u)<0?(o=o-u|0,r[n>>2]=a,r[i>>2]=o,r[t>>2]=0,u=0):a=s,(0|a)<0&&(u=u-a|0,r[t>>2]=u,o=o-a|0,r[i>>2]=o,r[n>>2]=0,a=0),e=u-o|0,s=a-o|0,(0|o)<0?(r[t>>2]=e,r[n>>2]=s,r[i>>2]=0,u=e,o=0):s=a,(0|(a=(0|o)<(0|(a=(0|s)<(0|u)?s:u))?o:a))<=0||(r[t>>2]=u-a,r[n>>2]=s-a,r[i>>2]=o-a)}function ct(t,e){e|=0;var n,i,o,a=0,s=0,u=0;return o=(0|(i=(0|r[(t|=0)>>2])-(0|r[e>>2])|0))<0,n=(0|(s=(0|r[t+4>>2])-(0|r[e+4>>2])-(o?i:0)|0))<0,e=(e=(t=(0|(u=(o?0-i|0:0)+(0|r[t+8>>2])-(0|r[e+8>>2])+(n?0-s|0:0)|0))<0)?0:u)-((s=(0|(t=(0|e)<(0|(t=(0|(a=(n?0:s)-(t?u:0)|0))<(0|(u=(o?0:i)-(n?s:0)-(t?u:0)|0))?a:u))?e:t))>0)?t:0)|0,a=a-(s?t:0)|0,0|((0|(t=(0|(t=u-(s?t:0)|0))>-1?t:0-t|0))>(0|(e=(0|(a=(0|a)>-1?a:0-a|0))>(0|(e=(0|e)>-1?e:0-e|0))?a:e))?t:e)}function lt(t,e){e|=0;var n;n=0|r[(t|=0)+8>>2],r[e>>2]=(0|r[t>>2])-n,r[e+4>>2]=(0|r[t+4>>2])-n}function ht(t,e){e|=0;var n,i,o,a=0,s=0,u=0;s=0|r[(t|=0)>>2],r[e>>2]=s,t=0|r[t+4>>2],r[(i=e+4|0)>>2]=t,r[(o=e+8|0)>>2]=0,a=t-s|0,(0|s)<0?(t=0-s|0,r[i>>2]=a,r[o>>2]=t,r[e>>2]=0,s=0):(a=t,t=0),(0|a)<0&&(s=s-a|0,r[e>>2]=s,t=t-a|0,r[o>>2]=t,r[i>>2]=0,a=0),n=s-t|0,u=a-t|0,(0|t)<0?(r[e>>2]=n,r[i>>2]=u,r[o>>2]=0,a=u,u=n,t=0):u=s,(0|(s=(0|t)<(0|(s=(0|a)<(0|u)?a:u))?t:s))<=0||(r[e>>2]=u-s,r[i>>2]=a-s,r[o>>2]=t-s)}function pt(t){var e,n,i,o;n=(o=0|r[(e=(t|=0)+8|0)>>2])-(0|r[t>>2])|0,r[t>>2]=n,t=(0|r[(i=t+4|0)>>2])-o|0,r[i>>2]=t,r[e>>2]=0-(t+n)}function ft(t){var e,n,i=0,o=0,a=0,s=0,u=0;i=0-(o=0|r[(t|=0)>>2])|0,r[t>>2]=i,r[(e=t+8|0)>>2]=0,s=(a=0|r[(n=t+4|0)>>2])+o|0,(0|o)>0?(r[n>>2]=s,r[e>>2]=o,r[t>>2]=0,i=0,a=s):o=0,(0|a)<0?(u=i-a|0,r[t>>2]=u,o=o-a|0,r[e>>2]=o,r[n>>2]=0,s=u-o|0,i=0-o|0,(0|o)<0?(r[t>>2]=s,r[n>>2]=i,r[e>>2]=0,a=i,o=0):(a=0,s=u)):s=i,(0|(i=(0|o)<(0|(i=(0|a)<(0|s)?a:s))?o:i))<=0||(r[t>>2]=s-i,r[n>>2]=a-i,r[e>>2]=o-i)}function dt(t,e,n,i){e|=0,n|=0,i|=0;var a,s=0,u=0,c=0,l=0;if(a=C,C=C+32|0,function(t,e){e|=0;var n,i,r=0;r=+o[(t=t|0)>>3],n=+h(+r),r=+p(+r),o[e+16>>3]=r,r=+o[t+8>>3],i=n*+h(+r),o[e>>3]=i,r=n*+p(+r),o[e+8>>3]=r}(t|=0,u=a),r[n>>2]=0,s=+ne(15888,u),(c=+ne(15912,u))<s&&(r[n>>2]=1,s=c),(c=+ne(15936,u))<s&&(r[n>>2]=2,s=c),(c=+ne(15960,u))<s&&(r[n>>2]=3,s=c),(c=+ne(15984,u))<s&&(r[n>>2]=4,s=c),(c=+ne(16008,u))<s&&(r[n>>2]=5,s=c),(c=+ne(16032,u))<s&&(r[n>>2]=6,s=c),(c=+ne(16056,u))<s&&(r[n>>2]=7,s=c),(c=+ne(16080,u))<s&&(r[n>>2]=8,s=c),(c=+ne(16104,u))<s&&(r[n>>2]=9,s=c),(c=+ne(16128,u))<s&&(r[n>>2]=10,s=c),(c=+ne(16152,u))<s&&(r[n>>2]=11,s=c),(c=+ne(16176,u))<s&&(r[n>>2]=12,s=c),(c=+ne(16200,u))<s&&(r[n>>2]=13,s=c),(c=+ne(16224,u))<s&&(r[n>>2]=14,s=c),(c=+ne(16248,u))<s&&(r[n>>2]=15,s=c),(c=+ne(16272,u))<s&&(r[n>>2]=16,s=c),(c=+ne(16296,u))<s&&(r[n>>2]=17,s=c),(c=+ne(16320,u))<s&&(r[n>>2]=18,s=c),(c=+ne(16344,u))<s&&(r[n>>2]=19,s=c),(c=+d(+(1-.5*s)))<1e-16)return r[i>>2]=0,r[i+4>>2]=0,r[i+8>>2]=0,r[i+12>>2]=0,void(C=a);if(n=0|r[n>>2],s=+xt((s=+o[16368+(24*n|0)>>3])-+xt(+function(t,e){t|=0;var n,i,r,a,s;return a=+o[(e=e|0)>>3],i=+h(+a),r=+o[e+8>>3]-+o[t+8>>3],s=i*+p(+r),n=+o[t>>3],+ +m(+s,+(+p(+a)*+h(+n)-+h(+r)*(i*+p(+n))))}(15568+(n<<4)|0,t))),l=0|Ft(e)?+xt(s+-.3334731722518321):s,s=+f(+c)/.381966011250105,(0|e)>0){u=0;do{s*=2.6457513110645907,u=u+1|0}while((0|u)!=(0|e))}c=+h(+l)*s,o[i>>3]=c,l=+p(+l)*s,o[i+8>>3]=l,C=a}function At(t,e,n,i,a){e|=0,n|=0,i|=0,a|=0;var s=0,l=0;if((s=+function(t){var e,n;return n=+o[(t=t|0)>>3],e=+o[t+8>>3],+ +c(+(n*n+e*e))}(t|=0))<1e-16)return e=15568+(e<<4)|0,r[a>>2]=r[e>>2],r[a+4>>2]=r[e+4>>2],r[a+8>>2]=r[e+8>>2],void(r[a+12>>2]=r[e+12>>2]);if(l=+m(+ +o[t+8>>3],+ +o[t>>3]),(0|n)>0){t=0;do{s/=2.6457513110645907,t=t+1|0}while((0|t)!=(0|n))}i?(s/=3,n=0==(0|Ft(n)),s=+g(.381966011250105*(n?s:s/2.6457513110645907))):(s=+g(.381966011250105*s),0|Ft(n)&&(l=+xt(l+.3334731722518321))),function(t,e,n,i){t|=0,e=+e,i|=0;var a=0,s=0,c=0,l=0;if((n=+n)<1e-16)return r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],void(r[i+12>>2]=r[t+12>>2]);s=e<0?e+6.283185307179586:e,s=e>=6.283185307179586?s+-6.283185307179586:s;do{if(!(s<1e-16)){if(a=+u(+(s+-3.141592653589793))<1e-16,e=+o[t>>3],a){e-=n,o[i>>3]=e,a=i;break}if(c=+h(+n),n=+p(+n),e=c*+p(+e)+ +h(+s)*(n*+h(+e)),e=+A(+((e=e>1?1:e)<-1?-1:e)),o[i>>3]=e,+u(+(e+-1.5707963267948966))<1e-16)return o[i>>3]=1.5707963267948966,void(o[i+8>>3]=0);if(+u(+(e+1.5707963267948966))<1e-16)return o[i>>3]=-1.5707963267948966,void(o[i+8>>3]=0);if(l=+h(+e),s=n*+p(+s)/l,n=+o[t>>3],e=(c-+p(+e)*+p(+n))/+h(+n)/l,c=s>1?1:s,e=e>1?1:e,(e=+o[t+8>>3]+ +m(+(c<-1?-1:c),+(e<-1?-1:e)))>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);return void(o[i+8>>3]=e)}e=+o[t>>3]+n,o[i>>3]=e,a=i}while(0);if(+u(+(e+-1.5707963267948966))<1e-16)return o[a>>3]=1.5707963267948966,void(o[i+8>>3]=0);if(+u(+(e+1.5707963267948966))<1e-16)return o[a>>3]=-1.5707963267948966,void(o[i+8>>3]=0);if((e=+o[t+8>>3])>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);o[i+8>>3]=e}(15568+(e<<4)|0,+xt(+o[16368+(24*e|0)>>3]-l),s,a)}function gt(t,e,n){e|=0,n|=0;var i,o;i=C,C=C+16|0,X((t|=0)+4|0,o=i),At(o,0|r[t>>2],e,0,n),C=i}function mt(t,e,n){t|=0,e|=0,n|=0;var i,o=0,a=0,s=0,u=0,c=0;i=C,C=C+128|0,a=i,u=20208,c=(s=o=i+64|0)+60|0;do{r[s>>2]=r[u>>2],s=s+4|0,u=u+4|0}while((0|s)<(0|c));u=20272,c=(s=a)+60|0;do{r[s>>2]=r[u>>2],s=s+4|0,u=u+4|0}while((0|s)<(0|c));o=(c=0==(0|Ft(0|r[e>>2])))?o:a,st(a=t+4|0),ut(a),0|Ft(0|r[e>>2])&&(et(a),r[e>>2]=1+(0|r[e>>2])),r[n>>2]=r[t>>2],Z(a,o,e=n+4|0),q(e),r[n+16>>2]=r[t>>2],Z(a,o+12|0,e=n+20|0),q(e),r[n+32>>2]=r[t>>2],Z(a,o+24|0,e=n+36|0),q(e),r[n+48>>2]=r[t>>2],Z(a,o+36|0,e=n+52|0),q(e),r[n+64>>2]=r[t>>2],Z(a,o+48|0,n=n+68|0),q(n),C=i}function yt(t,e,n,i){n|=0,i|=0;var o,a,s,u,c,l,h=0,p=0,f=0,d=0,A=0;if(l=C,C=C+32|0,c=l+12|0,a=l,A=(t|=0)+4|0,d=0|r[16928+((e|=0)<<2)>>2],d=(u=0!=(0|i))?3*d|0:d,h=0|r[A>>2],o=0|r[(s=t+8|0)>>2],u){if((0|(h=o+h+(i=0|r[(p=t+12|0)>>2])|0))==(0|d))return C=l,0|(A=1);f=p}else h=o+h+(i=0|r[(f=t+12|0)>>2])|0;if((0|h)<=(0|d))return C=l,0|(A=0);do{if((0|i)>0){if(i=0|r[t>>2],(0|o)>0){p=18608+(80*i|0)+60|0,i=t;break}i=18608+(80*i|0)+40|0,n?(W(c,d,0,0),Q(A,c,a),rt(a),Z(a,c,A),p=i,i=t):(p=i,i=t)}else p=18608+(80*(0|r[t>>2])|0)+20|0,i=t}while(0);if(r[i>>2]=r[p>>2],(0|r[(h=p+16|0)>>2])>0){i=0;do{it(A),i=i+1|0}while((0|i)<(0|r[h>>2]))}return t=p+4|0,r[c>>2]=r[t>>2],r[c+4>>2]=r[t+4>>2],r[c+8>>2]=r[t+8>>2],e=0|r[16848+(e<<2)>>2],Y(c,u?3*e|0:e),Z(A,c,A),q(A),i=u&&((0|r[s>>2])+(0|r[A>>2])+(0|r[f>>2])|0)==(0|d)?1:2,C=l,0|(A=i)}function vt(t,e){t|=0,e|=0;var n=0;do{n=0|yt(t,e,0,1)}while(2==(0|n));return 0|n}function _t(t,e,n,i){t|=0,e|=0,i|=0;var a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x=0,E=0,T=0,S=0,P=0,M=0;if(b=C,C=C+240|0,x=b+224|0,g=b+208|0,m=b,y=b+192|0,v=b+176|0,_=b+160|0,p=b+144|0,f=b+128|0,d=b+112|0,A=b+96|0,0|(n|=0))return function(t,e,n){t|=0,e|=0,n|=0;var i,a,s,u,c,l,h,p,f,d,A,g,m,y,v,_,b,x,E,T=0,S=0,P=0,M=0,I=0,O=0,L=0,R=0;E=C,C=C+272|0,O=E+240|0,y=E,v=E+224|0,_=E+208|0,b=E+176|0,x=E+160|0,p=E+192|0,f=E+144|0,d=E+128|0,A=E+112|0,g=E+96|0,m=E+80|0,r[(I=E+256|0)>>2]=e,r[O>>2]=r[t>>2],r[O+4>>2]=r[t+4>>2],r[O+8>>2]=r[t+8>>2],r[O+12>>2]=r[t+12>>2],mt(O,I,y),r[n>>2]=0,O=v+4|0,i=b+4|0,a=16848+((I=0|r[I>>2])<<2)|0,s=16928+(I<<2)|0,u=d+8|0,c=A+8|0,l=g+8|0,h=_+4|0,M=0;t:for(;;){P=y+(((M>>>0)%5|0)<<4)|0,r[_>>2]=r[P>>2],r[_+4>>2]=r[P+4>>2],r[_+8>>2]=r[P+8>>2],r[_+12>>2]=r[P+12>>2];do{}while(2==(0|yt(_,I,0,1)));if(0!=(0|M)&0!=(0|Ft(e))){if(r[b>>2]=r[_>>2],r[b+4>>2]=r[_+4>>2],r[b+8>>2]=r[_+8>>2],r[b+12>>2]=r[_+12>>2],X(O,x),T=0|r[b>>2],S=0|r[17008+(80*T|0)+(r[v>>2]<<2)>>2],r[b>>2]=r[18608+(80*T|0)+(20*S|0)>>2],(0|(P=0|r[18608+(80*T|0)+(20*S|0)+16>>2]))>0){t=0;do{it(i),t=t+1|0}while((0|t)<(0|P))}switch(P=18608+(80*T|0)+(20*S|0)+4|0,r[p>>2]=r[P>>2],r[p+4>>2]=r[P+4>>2],r[p+8>>2]=r[P+8>>2],Y(p,3*(0|r[a>>2])|0),Z(i,p,i),q(i),X(i,f),L=+(0|r[s>>2]),o[d>>3]=3*L,o[u>>3]=0,R=-1.5*L,o[A>>3]=R,o[c>>3]=2.598076211353316*L,o[g>>3]=R,o[l>>3]=-2.598076211353316*L,0|r[17008+(80*(0|r[b>>2])|0)+(r[_>>2]<<2)>>2]){case 1:t=A,T=d;break;case 3:t=g,T=A;break;case 2:t=d,T=g;break;default:t=11;break t}te(x,f,T,t,m),At(m,0|r[b>>2],I,1,n+8+(r[n>>2]<<4)|0),r[n>>2]=1+(0|r[n>>2])}if(M>>>0<5&&(X(h,b),At(b,0|r[_>>2],I,1,n+8+(r[n>>2]<<4)|0),r[n>>2]=1+(0|r[n>>2])),r[v>>2]=r[_>>2],r[v+4>>2]=r[_+4>>2],r[v+8>>2]=r[_+8>>2],r[v+12>>2]=r[_+12>>2],(M=M+1|0)>>>0>=6){t=2;break}}2!=(0|t)?11==(0|t)&&w(22113,22160,571,22170):C=E}(t,e,i),void(C=b);r[x>>2]=e,r[g>>2]=r[t>>2],r[g+4>>2]=r[t+4>>2],r[g+8>>2]=r[t+8>>2],r[g+12>>2]=r[t+12>>2],bt(g,x,m),r[i>>2]=0,s=16928+((a=0|r[x>>2])<<2)|0,u=p+8|0,c=f+8|0,l=d+8|0,h=y+4|0,E=0,T=0,n=-1;t:for(;;){if(t=m+((x=(T>>>0)%6|0)<<4)|0,r[y>>2]=r[t>>2],r[y+4>>2]=r[t+4>>2],r[y+8>>2]=r[t+8>>2],r[y+12>>2]=r[t+12>>2],t=E,E=0|yt(y,a,0,1),0!=(0|T)&0!=(0|Ft(e))&&(1!=(0|t)&&(0|r[y>>2])!=(0|n))){switch(X(m+((((x+5|0)>>>0)%6|0)<<4)+4|0,v),X(m+(x<<4)+4|0,_),P=+(0|r[s>>2]),o[p>>3]=3*P,o[u>>3]=0,M=-1.5*P,o[f>>3]=M,o[c>>3]=2.598076211353316*P,o[d>>3]=M,o[l>>3]=-2.598076211353316*P,x=0|r[g>>2],0|r[17008+(80*x|0)+(((0|n)==(0|x)?0|r[y>>2]:n)<<2)>>2]){case 1:t=f,n=p;break;case 3:t=d,n=f;break;case 2:t=p,n=d;break;default:S=9;break t}te(v,_,n,t,A),0|ee(v,A)||0|ee(_,A)||(At(A,0|r[g>>2],a,1,i+8+(r[i>>2]<<4)|0),r[i>>2]=1+(0|r[i>>2]))}if(T>>>0<6&&(X(h,v),At(v,0|r[y>>2],a,1,i+8+(r[i>>2]<<4)|0),r[i>>2]=1+(0|r[i>>2])),(T=T+1|0)>>>0>=7)break;n=0|r[y>>2]}9==(0|S)&&w(22196,22160,735,22241),C=b}function bt(t,e,n){t|=0,e|=0,n|=0;var i,o=0,a=0,s=0,u=0,c=0;i=C,C=C+160|0,a=i,u=20336,c=(s=o=i+80|0)+72|0;do{r[s>>2]=r[u>>2],s=s+4|0,u=u+4|0}while((0|s)<(0|c));u=20416,c=(s=a)+72|0;do{r[s>>2]=r[u>>2],s=s+4|0,u=u+4|0}while((0|s)<(0|c));o=(c=0==(0|Ft(0|r[e>>2])))?o:a,st(a=t+4|0),ut(a),0|Ft(0|r[e>>2])&&(et(a),r[e>>2]=1+(0|r[e>>2])),r[n>>2]=r[t>>2],Z(a,o,e=n+4|0),q(e),r[n+16>>2]=r[t>>2],Z(a,o+12|0,e=n+20|0),q(e),r[n+32>>2]=r[t>>2],Z(a,o+24|0,e=n+36|0),q(e),r[n+48>>2]=r[t>>2],Z(a,o+36|0,e=n+52|0),q(e),r[n+64>>2]=r[t>>2],Z(a,o+48|0,e=n+68|0),q(e),r[n+80>>2]=r[t>>2],Z(a,o+60|0,n=n+84|0),q(n),C=i}function xt(t){var e;return e=(t=+t)<0?t+6.283185307179586:t,+(t>=6.283185307179586?e+-6.283185307179586:e)}function wt(t,e,n){return e|=0,n=+n,+u(+(+o[(t|=0)>>3]-+o[e>>3]))<n?0|(e=+u(+(+o[t+8>>3]-+o[e+8>>3]))<n):0|(e=0)}function Et(t,e){return e|=0,+u(+(+o[(t|=0)>>3]-+o[e>>3]))<17453292519943298e-27?0|(e=+u(+(+o[t+8>>3]-+o[e+8>>3]))<17453292519943298e-27):0|(e=0)}function Tt(t){if(!((t=+t)>1.5707963267948966))return+t;do{t+=-3.141592653589793}while(t>1.5707963267948966);return+t}function St(t){if((t=+t)>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(!(t<-3.141592653589793))return+t;do{t+=6.283185307179586}while(t<-3.141592653589793);return+t}function Pt(t,e){t|=0;var n=0,i=0,r=0;return i=+o[(e|=0)+8>>3],r=+o[t+8>>3],(n=+u(+(i-r)))>3.141592653589793&&(n=+u(+((i<0?i+6.283185307179586:i)-(r<0?r+6.283185307179586:r)))),i=1.5707963267948966-+o[t>>3],r=1.5707963267948966-+o[e>>3],r=+h(+i)*+h(+r)+ +h(+n)*(+p(+i)*+p(+r)),6371.007180918475*+d(+((r=r>1?1:r)<-1?-1:r))}function Mt(t,e){var n=0,i=0,r=0,o=0,a=0,s=0;if(!(!0&134217728==(2013265920&(e|=0)|0)))return 0|(e=0);if(a=0|ye(0|(t|=0),0|e,45),x(),(a&=127)>>>0>121)return 0|(e=0);n=0|ye(0|t,0|e,52),x(),n&=15;do{if(0|n){for(r=1,i=0;;){if(o=0|ye(0|t,0|e,3*(15-r|0)|0),x(),0!=(0|(o&=7))&(1^i)){if(1==(0|o)&0!=(0|k(a))){s=0,i=13;break}i=1}if(7==(0|o)){s=0,i=13;break}if(!(r>>>0<n>>>0)){i=9;break}r=r+1|0}if(9==(0|i)){if(15!=(0|n))break;return 0|(s=1)}if(13==(0|i))return 0|s}}while(0);for(;;){if(s=0|ye(0|t,0|e,3*(14-n|0)|0),x(),!(7==(7&s|0)&!0)){s=0,i=13;break}if(!(n>>>0<14)){s=1,i=13;break}n=n+1|0}return 13==(0|i)?0|s:0}function Ct(t,e,n){n|=0;var i=0,r=0;if(i=0|ye(0|(t|=0),0|(e|=0),52),x(),(0|(i&=15))>=(0|n)){if((0|i)!=(0|n))if(n>>>0<=15){if(t|=r=0|ve(0|n,0,52),e=0|x()|-15728641&e,(0|i)>(0|n))do{r=0|ve(7,0,3*(14-n|0)|0),n=n+1|0,t|=r,e=0|x()|e}while((0|n)<(0|i))}else e=0,t=0}else e=0,t=0;return b(0|e),0|t}function It(t,e,n,i){n|=0,i|=0;var o,a=0,s=0,u=0,c=0,l=0,h=0;if(u=0|ye(0|(t|=0),0|(e|=0),52),x(),(0|n)<16&(0|(u&=15))<=(0|n)){if((0|u)==(0|n))return r[(n=i)>>2]=t,void(r[n+4>>2]=e);if(o=(0|(l=0|Yt(7,n-u|0)))/7|0,c=0|ye(0|t,0|e,45),x(),0|k(127&c)){t:do{if(u)for(s=1;;){if(a=0|ye(0|t,0|e,3*(15-s|0)|0),x(),0|(a&=7))break t;if(!(s>>>0<u>>>0)){a=0;break}s=s+1|0}else a=0}while(0);s=0==(0|a)}else s=0;if(h=0|ve(u+1|0,0,52),a=0|x()|-15728641&e,It(e=(h|t)&~(e=0|ve(7,0,0|(c=3*(14-u|0)|0))),u=a&~(0|x()),n,i),a=i+(o<<3)|0,!s)return It((h=0|ve(1,0,0|c))|e,0|x()|u,n,a),h=a+(o<<3)|0,It((l=0|ve(2,0,0|c))|e,0|x()|u,n,h),h=h+(o<<3)|0,It((l=0|ve(3,0,0|c))|e,0|x()|u,n,h),h=h+(o<<3)|0,It((l=0|ve(4,0,0|c))|e,0|x()|u,n,h),h=h+(o<<3)|0,It((l=0|ve(5,0,0|c))|e,0|x()|u,n,h),void It((l=0|ve(6,0,0|c))|e,0|x()|u,n,h+(o<<3)|0);s=a+(o<<3)|0,(0|l)>6&&(xe(0|a,0,(h=(s>>>0>(l=a+8|0)>>>0?s:l)+-1+(0-a)|0)+8&-8|0),a=l+(h>>>3<<3)|0),It((h=0|ve(2,0,0|c))|e,0|x()|u,n,a),h=a+(o<<3)|0,It((l=0|ve(3,0,0|c))|e,0|x()|u,n,h),h=h+(o<<3)|0,It((l=0|ve(4,0,0|c))|e,0|x()|u,n,h),h=h+(o<<3)|0,It((l=0|ve(5,0,0|c))|e,0|x()|u,n,h),It((l=0|ve(6,0,0|c))|e,0|x()|u,n,h+(o<<3)|0)}}function Ot(t,e){var n=0,i=0,r=0;if(r=0|ye(0|(t|=0),0|(e|=0),45),x(),!(0|k(127&r)))return 0|(r=0);r=0|ye(0|t,0|e,52),x(),r&=15;t:do{if(r)for(i=1;;){if(n=0|ye(0|t,0|e,3*(15-i|0)|0),x(),0|(n&=7))break t;if(!(i>>>0<r>>>0)){n=0;break}i=i+1|0}else n=0}while(0);return 0|(r=0==(0|n)&1)}function Lt(t,e){var n=0,i=0,r=0;if(r=0|ye(0|(t|=0),0|(e|=0),52),x(),!(r&=15))return 0|(r=0);for(i=1;;){if(n=0|ye(0|t,0|e,3*(15-i|0)|0),x(),0|(n&=7)){i=5;break}if(!(i>>>0<r>>>0)){n=0,i=5;break}i=i+1|0}return 5==(0|i)?0|n:0}function Rt(t,e){var n=0,i=0,r=0,o=0,a=0,s=0,u=0;if(u=0|ye(0|(t|=0),0|(e|=0),52),x(),!(u&=15))return u=t,b(0|(s=e)),0|u;for(s=1,n=0;;){i=0|ve(7,0,0|(o=3*(15-s|0)|0)),r=0|x(),a=0|ye(0|t,0|e,0|o),x(),t=(o=0|ve(0|ot(7&a),0,0|o))|t&~i,e=(a=0|x())|e&~r;t:do{if(!n)if(0==(o&i|0)&0==(a&r|0))n=0;else if(i=0|ye(0|t,0|e,52),x(),i&=15){n=1;e:for(;;){switch(a=0|ye(0|t,0|e,3*(15-n|0)|0),x(),7&a){case 1:break e;case 0:break;default:n=1;break t}if(!(n>>>0<i>>>0)){n=1;break t}n=n+1|0}for(n=1;;){if(r=0|ye(0|t,0|e,0|(a=3*(15-n|0)|0)),x(),o=0|ve(7,0,0|a),e&=~(0|x()),t=t&~o|(a=0|ve(0|ot(7&r),0,0|a)),e=0|e|x(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<u>>>0))break;s=s+1|0}return b(0|e),0|t}function kt(t,e){var n=0,i=0,r=0,o=0,a=0;if(i=0|ye(0|(t|=0),0|(e|=0),52),x(),!(i&=15))return i=t,b(0|(n=e)),0|i;for(n=1;a=0|ye(0|t,0|e,0|(o=3*(15-n|0)|0)),x(),r=0|ve(7,0,0|o),e&=~(0|x()),t=(o=0|ve(0|ot(7&a),0,0|o))|t&~r,e=0|x()|e,n>>>0<i>>>0;)n=n+1|0;return b(0|e),0|t}function Dt(t,e){var n=0,i=0,r=0,o=0,a=0,s=0,u=0;if(u=0|ye(0|(t|=0),0|(e|=0),52),x(),!(u&=15))return u=t,b(0|(s=e)),0|u;for(s=1,n=0;;){i=0|ve(7,0,0|(o=3*(15-s|0)|0)),r=0|x(),a=0|ye(0|t,0|e,0|o),x(),t=(o=0|ve(0|at(7&a),0,0|o))|t&~i,e=(a=0|x())|e&~r;t:do{if(!n)if(0==(o&i|0)&0==(a&r|0))n=0;else if(i=0|ye(0|t,0|e,52),x(),i&=15){n=1;e:for(;;){switch(a=0|ye(0|t,0|e,3*(15-n|0)|0),x(),7&a){case 1:break e;case 0:break;default:n=1;break t}if(!(n>>>0<i>>>0)){n=1;break t}n=n+1|0}for(n=1;;){if(o=0|ve(7,0,0|(r=3*(15-n|0)|0)),a=e&~(0|x()),e=0|ye(0|t,0|e,0|r),x(),t=t&~o|(e=0|ve(0|at(7&e),0,0|r)),e=0|a|x(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<u>>>0))break;s=s+1|0}return b(0|e),0|t}function Bt(t,e){var n=0,i=0,r=0,o=0,a=0;if(i=0|ye(0|(t|=0),0|(e|=0),52),x(),!(i&=15))return i=t,b(0|(n=e)),0|i;for(n=1;o=0|ve(7,0,0|(a=3*(15-n|0)|0)),r=e&~(0|x()),e=0|ye(0|t,0|e,0|a),x(),t=(e=0|ve(0|at(7&e),0,0|a))|t&~o,e=0|x()|r,n>>>0<i>>>0;)n=n+1|0;return b(0|e),0|t}function Ft(t){return 0|(0|(t|=0))%2}function zt(t,e){t|=0;var n,i;return i=C,C=C+16|0,n=i,(e|=0)>>>0<=15&&2146435072!=(2146435072&r[t+4>>2]|0)&&2146435072!=(2146435072&r[t+8+4>>2]|0)?(!function(t,e,n){var i,r;i=C,C=C+16|0,dt(t|=0,e|=0,n|=0,r=i),H(r,n+4|0),C=i}(t,e,n),e=0|function(t,e){t|=0;var n,i=0,o=0,a=0,s=0,u=0,c=0,l=0,h=0;if(n=C,C=C+64|0,c=n+40|0,o=n+24|0,a=n+12|0,s=n,ve(0|(e|=0),0,52),i=134225919|x(),!e)return(0|r[t+4>>2])>2?(c=0,b(0|(u=0)),C=n,0|c):(0|r[t+8>>2])>2?(c=0,b(0|(u=0)),C=n,0|c):(0|r[t+12>>2])>2?(c=0,b(0|(u=0)),C=n,0|c):(ve(0|B(t),0,45),u=0|x()|i,c=-1,b(0|u),C=n,0|c);if(r[c>>2]=r[t>>2],r[c+4>>2]=r[t+4>>2],r[c+8>>2]=r[t+8>>2],r[c+12>>2]=r[t+12>>2],u=c+4|0,(0|e)>0)for(t=-1;r[o>>2]=r[u>>2],r[o+4>>2]=r[u+4>>2],r[o+8>>2]=r[u+8>>2],1&e?(J(u),r[a>>2]=r[u>>2],r[a+4>>2]=r[u+4>>2],r[a+8>>2]=r[u+8>>2],tt(a)):($(u),r[a>>2]=r[u>>2],r[a+4>>2]=r[u+4>>2],r[a+8>>2]=r[u+8>>2],et(a)),Q(o,a,s),q(s),l=0|ve(7,0,0|(h=3*(15-e|0)|0)),i&=~(0|x()),t=(h=0|ve(0|K(s),0,0|h))|t&~l,i=0|x()|i,(0|e)>1;)e=e+-1|0;else t=-1;t:do{if((0|r[u>>2])<=2&&(0|r[c+8>>2])<=2&&(0|r[c+12>>2])<=2){if(e=0|ve(0|(o=0|B(c)),0,45),e|=t,t=0|x()|-1040385&i,s=0|F(c),!(0|k(o))){if((0|s)<=0)break;for(a=0;;){if(o=0|ye(0|e,0|t,52),x(),o&=15)for(i=1;c=0|ye(0|e,0|t,0|(h=3*(15-i|0)|0)),x(),l=0|ve(7,0,0|h),t&=~(0|x()),e=e&~l|(h=0|ve(0|ot(7&c),0,0|h)),t=0|t|x(),i>>>0<o>>>0;)i=i+1|0;if((0|(a=a+1|0))==(0|s))break t}}a=0|ye(0|e,0|t,52),x(),a&=15;e:do{if(a){i=1;n:for(;;){switch(h=0|ye(0|e,0|t,3*(15-i|0)|0),x(),7&h){case 1:break n;case 0:break;default:break e}if(!(i>>>0<a>>>0))break e;i=i+1|0}if(0|z(o,0|r[c>>2]))for(i=1;l=0|ve(7,0,0|(c=3*(15-i|0)|0)),h=t&~(0|x()),t=0|ye(0|e,0|t,0|c),x(),e=e&~l|(t=0|ve(0|at(7&t),0,0|c)),t=0|h|x(),i>>>0<a>>>0;)i=i+1|0;else for(i=1;c=0|ye(0|e,0|t,0|(h=3*(15-i|0)|0)),x(),l=0|ve(7,0,0|h),t&=~(0|x()),e=e&~l|(h=0|ve(0|ot(7&c),0,0|h)),t=0|t|x(),i>>>0<a>>>0;)i=i+1|0}}while(0);if((0|s)>0){i=0;do{e=0|Rt(e,t),t=0|x(),i=i+1|0}while((0|i)!=(0|s))}}else e=0,t=0}while(0);return h=e,b(0|(l=t)),C=n,0|h}(n,e),t=0|x()):(t=0,e=0),b(0|t),C=i,0|e}function Nt(t,e,n){var i,o=0,a=0,s=0;if(i=(n|=0)+4|0,a=0|ye(0|(t|=0),0|(e|=0),52),x(),a&=15,s=0|ye(0|t,0|e,45),x(),o=0==(0|a),0|k(127&s)){if(o)return 0|(s=1);o=1}else{if(o)return 0|(s=0);o=0==(0|r[i>>2])&&0==(0|r[n+8>>2])?0!=(0|r[n+12>>2])&1:1}for(n=1;1&n?tt(i):et(i),s=0|ye(0|t,0|e,3*(15-n|0)|0),x(),nt(i,7&s),n>>>0<a>>>0;)n=n+1|0;return 0|o}function jt(t,e,n){n|=0;var i,o,a=0,s=0,u=0,c=0,l=0,h=0;o=C,C=C+16|0,i=o,h=0|ye(0|(t|=0),0|(e|=0),45),x(),h&=127;t:do{if(0!=(0|k(h))&&(u=0|ye(0|t,0|e,52),x(),0!=(0|(u&=15)))){a=1;e:for(;;){switch(l=0|ye(0|t,0|e,3*(15-a|0)|0),x(),7&l){case 5:break e;case 0:break;default:a=e;break t}if(!(a>>>0<u>>>0)){a=e;break t}a=a+1|0}for(s=1,a=e;c=0|ve(7,0,0|(e=3*(15-s|0)|0)),l=a&~(0|x()),a=0|ye(0|t,0|a,0|e),x(),t=t&~c|(a=0|ve(0|at(7&a),0,0|e)),a=0|l|x(),s>>>0<u>>>0;)s=s+1|0}else a=e}while(0);if(l=7728+(28*h|0)|0,r[n>>2]=r[l>>2],r[n+4>>2]=r[l+4>>2],r[n+8>>2]=r[l+8>>2],r[n+12>>2]=r[l+12>>2],0|Nt(t,a,n)){if(c=n+4|0,r[i>>2]=r[c>>2],r[i+4>>2]=r[c+4>>2],r[i+8>>2]=r[c+8>>2],u=0|ye(0|t,0|a,52),x(),l=15&u,1&u?(et(c),u=l+1|0):u=l,0|k(h)){t:do{if(l)for(e=1;;){if(s=0|ye(0|t,0|a,3*(15-e|0)|0),x(),0|(s&=7)){a=s;break t}if(!(e>>>0<l>>>0)){a=0;break}e=e+1|0}else a=0}while(0);a=4==(0|a)&1}else a=0;if(0|yt(n,u,a,0)){if(0|k(h))do{}while(0!=(0|yt(n,u,0,0)));(0|u)!=(0|l)&&$(c)}else(0|u)!=(0|l)&&(r[c>>2]=r[i>>2],r[c+4>>2]=r[i+4>>2],r[c+8>>2]=r[i+8>>2]);C=o}else C=o}function Ut(t,e,n){n|=0;var i,r;i=C,C=C+16|0,jt(t|=0,e|=0,r=i),e=0|ye(0|t,0|e,52),x(),gt(r,15&e,n),C=i}function Vt(t,e,n){n|=0;var i,r,o=0,a=0,s=0;if(r=C,C=C+16|0,jt(t|=0,e|=0,i=r),s=0|ye(0|t,0|e,52),x(),s&=15,a=0|ye(0|t,0|e,45),x(),!(0|k(127&a)))return _t(i,s,e=0,n),void(C=r);t:do{if(s)for(a=1;;){if(o=0|ye(0|t,0|e,3*(15-a|0)|0),x(),0|(o&=7))break t;if(!(a>>>0<s>>>0)){o=0;break}a=a+1|0}else o=0}while(0);_t(i,s,e=0==(0|o)&1,n),C=r}function Gt(t,e,n,i){var o,a=0,s=0,u=0,c=0,l=0;if(o=C,C=C+64|0,u=o,(0|(t|=0))==(0|(n|=0))&(0|(e|=0))==(0|(i|=0))|!1|134217728!=(2013265920&e|0)|!1|134217728!=(2013265920&i|0))return C=o,0|(u=0);if(a=0|ye(0|t,0|e,52),x(),a&=15,s=0|ye(0|n,0|i,52),x(),(0|a)!=(15&s|0))return C=o,0|(u=0);if(s=a+-1|0,a>>>0>1&&(l=0|Ct(t,e,s),c=0|x(),(0|l)==(0|(s=0|Ct(n,i,s)))&(0|c)==(0|x()))){if(a=0|ye(0|t,0|e,0|(s=3*(15^a)|0)),x(),a&=7,s=0|ye(0|n,0|i,0|s),x(),0==(0|a)|0==(0|(s&=7)))return C=o,0|(l=1);if((0|r[21136+(a<<2)>>2])==(0|s))return C=o,0|(l=1);if((0|r[21168+(a<<2)>>2])==(0|s))return C=o,0|(l=1)}s=(a=u)+56|0;do{r[a>>2]=0,a=a+4|0}while((0|a)<(0|s));return I(t,e,1,u),a=(0|r[(l=u)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)||(0|r[(l=u+8|0)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)||(0|r[(l=u+16|0)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)||(0|r[(l=u+24|0)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)||(0|r[(l=u+32|0)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)||(0|r[(l=u+40|0)>>2])==(0|n)&&(0|r[l+4>>2])==(0|i)?1:1&((0|r[(a=u+48|0)>>2])==(0|n)?(0|r[a+4>>2])==(0|i):0),C=o,0|(l=a)}function Wt(t){t|=0;var e,n,i=0;return(e=0|fe(1,12))||w(22330,22285,46,22343),0|(i=0|r[(n=t+4|0)>>2])?(r[(i=i+8|0)>>2]=e,r[n>>2]=e,0|e):(0|r[t>>2]&&w(22360,22285,58,22383),r[(i=t)>>2]=e,r[n>>2]=e,0|e)}function Ht(t,e){t|=0,e|=0;var n,i;return(i=0|he(24))||w(22397,22285,75,22411),r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],r[i+12>>2]=r[e+12>>2],r[i+16>>2]=0,0|(n=0|r[(e=t+4|0)>>2])?(r[n+16>>2]=i,r[e>>2]=i,0|i):(0|r[t>>2]&&w(22426,22285,79,22411),r[t>>2]=i,r[e>>2]=i,0|i)}function qt(t){var e,n,i=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0,x=0,E=0,T=0,S=0,P=0,M=0,C=0,I=0,O=0,L=0,R=0,k=0,D=0,B=0;if(0|r[(c=(t|=0)+8|0)>>2])return 0|(B=1);if(!(s=0|r[t>>2]))return 0|(B=0);i=s,a=0;do{a=a+1|0,i=0|r[i+8>>2]}while(0!=(0|i));if(a>>>0<2)return 0|(B=0);(n=0|he(a<<2))||w(22446,22285,312,22465),(e=0|he(a<<5))||w(22487,22285,316,22465),r[t>>2]=0,r[(M=t+4|0)>>2]=0,r[c>>2]=0,a=0,k=0,P=0,g=0;t:for(;;){if(A=0|r[s>>2]){l=0,h=A;do{if(f=+o[h+8>>3],i=h,h=0|r[h+16>>2],p=+o[(c=(d=0==(0|h))?A:h)+8>>3],+u(+(f-p))>3.141592653589793){B=14;break}l+=(p-f)*(+o[i>>3]+ +o[c>>3])}while(!d);if(14==(0|B)){B=0,l=0,i=A;do{S=+o[i+8>>3],L=0|r[(R=i+16|0)>>2],T=+o[(L=0==(0|L)?A:L)+8>>3],l+=(+o[i>>3]+ +o[L>>3])*((T<0?T+6.283185307179586:T)-(S<0?S+6.283185307179586:S)),i=0|r[(0==(0|i)?s:R)>>2]}while(0!=(0|i))}l>0?(r[n+(k<<2)>>2]=s,k=k+1|0,c=P,i=g):B=19}else B=19;if(19==(0|B)){B=0;do{if(!a){if(g){c=M,h=g+8|0,i=s,a=t;break}if(0|r[t>>2]){B=27;break t}c=M,h=t,i=s,a=t;break}if(0|r[(i=a+8|0)>>2]){B=21;break t}if(!(a=0|fe(1,12))){B=23;break t}r[i>>2]=a,c=a+4|0,h=a,i=g}while(0);if(r[h>>2]=s,r[c>>2]=s,h=e+(P<<5)|0,d=0|r[s>>2]){for(o[(A=e+(P<<5)+8|0)>>3]=17976931348623157e292,o[(g=e+(P<<5)+24|0)>>3]=17976931348623157e292,o[h>>3]=-17976931348623157e292,o[(m=e+(P<<5)+16|0)>>3]=-17976931348623157e292,x=17976931348623157e292,E=-17976931348623157e292,c=0,y=d,f=17976931348623157e292,_=17976931348623157e292,b=-17976931348623157e292,p=-17976931348623157e292;l=+o[y>>3],S=+o[y+8>>3],y=0|r[y+16>>2],T=+o[((v=0==(0|y))?d:y)+8>>3],l<f&&(o[A>>3]=l,f=l),S<_&&(o[g>>3]=S,_=S),l>b?o[h>>3]=l:l=b,S>p&&(o[m>>3]=S,p=S),x=S>0&S<x?S:x,E=S<0&S>E?S:E,c|=+u(+(S-T))>3.141592653589793,!v;)b=l;c&&(o[m>>3]=E,o[g>>3]=x)}else r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,r[h+16>>2]=0,r[h+20>>2]=0,r[h+24>>2]=0,r[h+28>>2]=0;c=P+1|0}if(s=0|r[(R=s+8|0)>>2],r[R>>2]=0,!s){B=45;break}P=c,g=i}if(21==(0|B))w(22263,22285,32,22297);else if(23==(0|B))w(22317,22285,34,22297);else if(27==(0|B))w(22360,22285,58,22383);else if(45==(0|B)){t:do{if((0|k)>0){for(R=0==(0|c),O=c<<2,L=0==(0|t),I=0,i=0;;){if(C=0|r[n+(I<<2)>>2],R)B=73;else{if(!(P=0|he(O))){B=50;break}if(!(M=0|he(O))){B=52;break}e:do{if(L)a=0;else{for(c=0,a=0,h=t;s=e+(c<<5)|0,0|Xt(0|r[h>>2],s,0|r[C>>2])?(r[P+(a<<2)>>2]=h,r[M+(a<<2)>>2]=s,v=a+1|0):v=a,h=0|r[h+8>>2];)c=c+1|0,a=v;if((0|v)>0)if(s=0|r[P>>2],1==(0|v))a=s;else for(m=0,y=-1,a=s,g=s;;){for(d=0|r[g>>2],s=0,h=0;A=(0|(c=0|r[r[P+(h<<2)>>2]>>2]))==(0|d)?s:s+(1&(0|Xt(c,0|r[M+(h<<2)>>2],0|r[d>>2])))|0,(0|(h=h+1|0))!=(0|v);)s=A;if(a=(c=(0|A)>(0|y))?g:a,(0|(s=m+1|0))==(0|v))break e;m=s,y=c?A:y,g=0|r[P+(s<<2)>>2]}else a=0}}while(0);if(pe(P),pe(M),a){if(s=0|r[(c=a+4|0)>>2])a=s+8|0;else if(0|r[a>>2]){B=70;break}r[a>>2]=C,r[c>>2]=C}else B=73}if(73==(0|B)){if(B=0,0|(i=0|r[C>>2]))do{M=i,i=0|r[i+16>>2],pe(M)}while(0!=(0|i));pe(C),i=2}if((0|(I=I+1|0))>=(0|k)){D=i;break t}}50==(0|B)?w(22502,22285,246,22521):52==(0|B)?w(22540,22285,248,22521):70==(0|B)&&w(22360,22285,58,22383)}else D=0}while(0);return pe(n),pe(e),0|(B=D)}return 0}function Xt(t,e,n){t|=0;var i,a=0,s=0,u=0,c=0,l=0,h=0,p=0;if(!(0|V(e|=0,n|=0)))return 0|(t=0);if(e=0|U(e),i=+o[n>>3],a=e&(a=+o[n+8>>3])<0?a+6.283185307179586:a,!(t=0|r[t>>2]))return 0|(t=0);if(e){e=0,n=t;t:for(;;){for(;c=+o[n>>3],h=+o[n+8>>3],p=0|r[(n=n+16|0)>>2],u=+o[(p=0==(0|p)?t:p)>>3],s=+o[p+8>>3],c>u?(l=c,c=h):(l=u,u=c,c=s,s=h),i<u|i>l;)if(!(n=0|r[n>>2])){n=22;break t}if(a=(c=c<0?c+6.283185307179586:c)==a|(h=s<0?s+6.283185307179586:s)==a?a+-2220446049250313e-31:a,((h+=(i-u)/(l-u)*(c-h))<0?h+6.283185307179586:h)>a&&(e^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|e}else{e=0,n=t;t:for(;;){for(;c=+o[n>>3],h=+o[n+8>>3],p=0|r[(n=n+16|0)>>2],u=+o[(p=0==(0|p)?t:p)>>3],s=+o[p+8>>3],c>u?(l=c,c=h):(l=u,u=c,c=s,s=h),i<u|i>l;)if(!(n=0|r[n>>2])){n=22;break t}if(s+(i-u)/(l-u)*(c-s)>(a=c==a|s==a?a+-2220446049250313e-31:a)&&(e^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|e}return 0}function Zt(t,e,n,o,a){n|=0,o|=0,a|=0;var s,u,c,l,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0;if(l=C,C=C+32|0,_=l+16|0,c=l,h=0|ye(0|(t|=0),0|(e|=0),52),x(),h&=15,m=0|ye(0|n,0|o,52),x(),(0|h)!=(15&m|0))return C=l,0|(_=1);if(A=0|ye(0|t,0|e,45),x(),A&=127,g=0|ye(0|n,0|o,45),x(),m=(0|A)!=(0|(g&=127))){if(7==(0|(f=0|j(A,g))))return C=l,0|(_=2);7==(0|(d=0|j(g,A)))?w(22564,22588,151,22598):(y=f,p=d)}else y=0,p=0;s=0|k(A),u=0|k(g),r[_>>2]=0,r[_+4>>2]=0,r[_+8>>2]=0,r[_+12>>2]=0;do{if(y){if(f=(0|(g=0|r[4304+(28*A|0)+(y<<2)>>2]))>0,u)if(f){A=0,d=n,f=o;do{d=0|Dt(d,f),f=0|x(),1==(0|(p=0|at(p)))&&(p=0|at(1)),A=A+1|0}while((0|A)!=(0|g));g=p,A=d,d=f}else g=p,A=n,d=o;else if(f){A=0,d=n,f=o;do{d=0|Bt(d,f),f=0|x(),p=0|at(p),A=A+1|0}while((0|A)!=(0|g));g=p,A=d,d=f}else g=p,A=n,d=o;if(Nt(A,d,_),m||w(22611,22588,181,22598),(f=0!=(0|s))&(p=0!=(0|u))&&w(22638,22588,182,22598),f){if(p=0|Lt(t,e),0|i[22032+(7*p|0)+y>>0]){h=3;break}A=d=0|r[21200+(28*p|0)+(y<<2)>>2],v=26}else if(p){if(p=0|Lt(A,d),0|i[22032+(7*p|0)+g>>0]){h=4;break}A=0,d=0|r[21200+(28*g|0)+(p<<2)>>2],v=26}else p=0;if(26==(0|v))if((0|d)<=-1&&w(22669,22588,212,22598),(0|A)<=-1&&w(22692,22588,213,22598),(0|d)>0){f=_+4|0,p=0;do{rt(f),p=p+1|0}while((0|p)!=(0|d));p=A}else p=A;if(r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,nt(c,y),0|h)for(;0|Ft(h)?tt(c):et(c),(0|h)>1;)h=h+-1|0;if((0|p)>0){h=0;do{rt(c),h=h+1|0}while((0|h)!=(0|p))}Z(v=_+4|0,c,v),q(v),v=50}else if(Nt(n,o,_),0!=(0|s)&0!=(0|u))if((0|g)!=(0|A)&&w(22716,22588,243,22598),p=0|Lt(t,e),h=0|Lt(n,o),0|i[22032+(7*p|0)+h>>0])h=5;else if((0|(p=0|r[21200+(28*p|0)+(h<<2)>>2]))>0){f=_+4|0,h=0;do{rt(f),h=h+1|0}while((0|h)!=(0|p));v=50}else v=50;else v=50}while(0);return 50==(0|v)&&(h=_+4|0,r[a>>2]=r[h>>2],r[a+4>>2]=r[h+4>>2],r[a+8>>2]=r[h+8>>2],h=0),C=l,0|(_=h)}function Qt(t,e,n,i){n|=0,i|=0;var o,a,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0;if(a=C,C=C+48|0,c=a+36|0,l=a+24|0,h=a+12|0,p=a,u=0|ye(0|(t|=0),0|(e|=0),52),x(),u&=15,d=0|ye(0|t,0|e,45),x(),o=0|k(d&=127),ve(0|u,0,52),m=134225919|x(),r[(g=i)>>2]=-1,r[g+4>>2]=m,!u)return(0|r[n>>2])>1?(C=a,0|(m=1)):(0|r[n+4>>2])>1?(C=a,0|(m=1)):(0|r[n+8>>2])>1?(C=a,0|(m=1)):127==(0|(s=0|N(d,0|K(n))))?(C=a,0|(m=1)):(A=0|ve(0|s,0,45),g=0|x(),g=-1040385&r[(d=i)+4>>2]|g,r[(m=i)>>2]=r[d>>2]|A,r[m+4>>2]=g,C=a,0|(m=0));for(r[c>>2]=r[n>>2],r[c+4>>2]=r[n+4>>2],r[c+8>>2]=r[n+8>>2];r[l>>2]=r[c>>2],r[l+4>>2]=r[c+4>>2],r[l+8>>2]=r[c+8>>2],0|Ft(u)?(J(c),r[h>>2]=r[c>>2],r[h+4>>2]=r[c+4>>2],r[h+8>>2]=r[c+8>>2],tt(h)):($(c),r[h>>2]=r[c>>2],r[h+4>>2]=r[c+4>>2],r[h+8>>2]=r[c+8>>2],et(h)),Q(l,h,p),q(p),y=0|r[(g=i)>>2],g=0|r[g+4>>2],n=0|ve(7,0,0|(v=3*(15-u|0)|0)),g&=~(0|x()),v=0|ve(0|K(p),0,0|v),g=0|x()|g,r[(m=i)>>2]=v|y&~n,r[m+4>>2]=g,(0|u)>1;)u=u+-1|0;t:do{if((0|r[c>>2])<=1&&(0|r[c+4>>2])<=1&&(0|r[c+8>>2])<=1){p=127==(0|(l=0|N(d,u=0|K(c))))?0:0|k(l);e:do{if(u){if(o){if(c=21408+(28*(0|Lt(t,e))|0)+(u<<2)|0,(0|(c=0|r[c>>2]))>0){n=0;do{u=0|ot(u),n=n+1|0}while((0|n)!=(0|c))}if(1==(0|u)){s=3;break t}127==(0|(n=0|N(d,u)))&&w(22743,22588,376,22773),0|k(n)?w(22786,22588,377,22773):(A=c,f=u,s=n)}else A=0,f=u,s=l;if((0|(h=0|r[4304+(28*d|0)+(f<<2)>>2]))<=-1&&w(22817,22588,384,22773),!p){if((0|A)<=-1&&w(22669,22588,417,22773),0|A){u=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];do{n=0|kt(n,c),c=0|x(),r[(v=i)>>2]=n,r[v+4>>2]=c,u=u+1|0}while((0|u)<(0|A))}if((0|h)<=0){u=54;break}for(u=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];;)if(n=0|kt(n,c),c=0|x(),r[(v=i)>>2]=n,r[v+4>>2]=c,(0|(u=u+1|0))==(0|h)){u=54;break e}}if(7==(0|(l=0|j(s,d)))&&w(22564,22588,393,22773),n=0|r[(u=i)>>2],u=0|r[u+4>>2],(0|h)>0){c=0;do{n=0|kt(n,u),u=0|x(),r[(v=i)>>2]=n,r[v+4>>2]=u,c=c+1|0}while((0|c)!=(0|h))}if(n=0|Lt(n,u),v=0|D(s),(0|(n=0|r[(v?21824:21616)+(28*l|0)+(n<<2)>>2]))<=-1&&w(22669,22588,412,22773),n){u=0,c=0|r[(l=i)>>2],l=0|r[l+4>>2];do{c=0|Rt(c,l),l=0|x(),r[(v=i)>>2]=c,r[v+4>>2]=l,u=u+1|0}while((0|u)<(0|n));u=54}else u=54}else if(0!=(0|o)&0!=(0|p))if(u=21408+(28*(v=0|Lt(t,e))|0)+((0|Lt(0|r[(u=i)>>2],0|r[u+4>>2]))<<2)|0,(0|(u=0|r[u>>2]))<=-1&&w(22840,22588,433,22773),u){s=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];do{n=0|kt(n,c),c=0|x(),r[(v=i)>>2]=n,r[v+4>>2]=c,s=s+1|0}while((0|s)<(0|u));s=l,u=54}else s=l,u=55;else s=l,u=54}while(0);if(54==(0|u)&&p&&(u=55),55==(0|u)&&1==(0|Lt(0|r[(v=i)>>2],0|r[v+4>>2]))){s=4;break}m=0|r[(v=i)>>2],v=-1040385&r[v+4>>2],y=0|ve(0|s,0,45),v=0|v|x(),r[(s=i)>>2]=m|y,r[s+4>>2]=v,s=0}else s=2}while(0);return C=a,0|(v=s)}function Yt(t,e){var n=0;if(!(e|=0))return 0|(n=1);n=t|=0,t=1;do{t=0|v(0==(1&e|0)?1:n,t),e>>=1,n=0|v(n,n)}while(0!=(0|e));return 0|t}function Kt(t,e,n){t|=0;var i,a,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0;if(!(0|V(e|=0,n|=0)))return 0|(d=0);if(e=0|U(e),a=+o[n>>3],s=e&(s=+o[n+8>>3])<0?s+6.283185307179586:s,(0|(d=0|r[t>>2]))<=0)return 0|(d=0);if(i=0|r[t+4>>2],e){e=0,n=-1,t=0;t:for(;;){for(f=t;l=+o[i+(f<<4)>>3],p=+o[i+(f<<4)+8>>3],c=+o[i+((t=(n+2|0)%(0|d)|0)<<4)>>3],u=+o[i+(t<<4)+8>>3],l>c?(h=l,l=p):(h=c,c=l,l=u,u=p),a<c|a>h;){if(!((0|(n=f+1|0))<(0|d))){n=22;break t}t=f,f=n,n=t}if(s=(l=l<0?l+6.283185307179586:l)==s|(p=u<0?u+6.283185307179586:u)==s?s+-2220446049250313e-31:s,((p+=(a-c)/(h-c)*(l-p))<0?p+6.283185307179586:p)>s&&(e^=1),(0|(t=f+1|0))>=(0|d)){n=22;break}n=f}if(22==(0|n))return 0|e}else{e=0,n=-1,t=0;t:for(;;){for(f=t;l=+o[i+(f<<4)>>3],p=+o[i+(f<<4)+8>>3],c=+o[i+((t=(n+2|0)%(0|d)|0)<<4)>>3],u=+o[i+(t<<4)+8>>3],l>c?(h=l,l=p):(h=c,c=l,l=u,u=p),a<c|a>h;){if(!((0|(n=f+1|0))<(0|d))){n=22;break t}t=f,f=n,n=t}if(u+(a-c)/(h-c)*(l-u)>(s=l==s|u==s?s+-2220446049250313e-31:s)&&(e^=1),(0|(t=f+1|0))>=(0|d)){n=22;break}n=f}if(22==(0|n))return 0|e}return 0}function Jt(t,e){e|=0;var n,i,a,s,c,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0;if(!(i=0|r[(t|=0)>>2]))return r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,void(r[e+28>>2]=0);if(o[(a=e+8|0)>>3]=17976931348623157e292,o[(s=e+24|0)>>3]=17976931348623157e292,o[e>>3]=-17976931348623157e292,o[(c=e+16|0)>>3]=-17976931348623157e292,!((0|i)<=0)){for(n=0|r[t+4>>2],m=17976931348623157e292,y=-17976931348623157e292,v=0,t=-1,f=17976931348623157e292,d=17976931348623157e292,g=-17976931348623157e292,h=-17976931348623157e292,_=0;l=+o[n+(_<<4)>>3],A=+o[n+(_<<4)+8>>3],p=+o[n+(((0|(t=t+2|0))==(0|i)?0:t)<<4)+8>>3],l<f&&(o[a>>3]=l,f=l),A<d&&(o[s>>3]=A,d=A),l>g?o[e>>3]=l:l=g,A>h&&(o[c>>3]=A,h=A),m=A>0&A<m?A:m,y=A<0&A>y?A:y,v|=+u(+(A-p))>3.141592653589793,(0|(t=_+1|0))!=(0|i);)b=_,g=l,_=t,t=b;v&&(o[c>>3]=y,o[s>>3]=m)}}function $t(t,e,n){var i=0,o=0,a=0;if(!(0|Kt(t|=0,e|=0,n|=0)))return 0|(o=0);if((0|r[(o=t+8|0)>>2])<=0)return 0|(o=1);for(i=t+12|0,t=0;;){if(a=t,t=t+1|0,0|Kt((0|r[i>>2])+(a<<3)|0,e+(t<<5)|0,n)){t=0,i=6;break}if((0|t)>=(0|r[o>>2])){t=1,i=6;break}}return 6==(0|i)?0|t:0}function te(t,e,n,i,r){e|=0,n|=0,i|=0,r|=0;var a,s,u,c,l,h,p,f=0;c=+o[(t|=0)>>3],u=+o[e>>3]-c,s=+o[t+8>>3],a=+o[e+8>>3]-s,h=+o[n>>3],f=((f=+o[i>>3]-h)*(s-(p=+o[n+8>>3]))-(c-h)*(l=+o[i+8>>3]-p))/(u*l-a*f),o[r>>3]=c+u*f,o[r+8>>3]=s+a*f}function ee(t,e){return e|=0,+o[(t|=0)>>3]!=+o[e>>3]?0|(e=0):0|(e=+o[t+8>>3]==+o[e+8>>3])}function ne(t,e){e|=0;var n,i,r;return+((r=+o[(t|=0)>>3]-+o[e>>3])*r+(i=+o[t+8>>3]-+o[e+8>>3])*i+(n=+o[t+16>>3]-+o[e+16>>3])*n)}function ie(t,e,n){t|=0,n|=0;var i=0;(0|(e|=0))>0?(i=0|fe(e,4),r[t>>2]=i,i||w(22869,22892,37,22906)):r[t>>2]=0,r[t+4>>2]=e,r[t+8>>2]=0,r[t+12>>2]=n}function re(t){var e,n,i,a=0,s=0,c=0,h=0;e=(t|=0)+4|0,n=t+12|0,i=t+8|0;t:for(;;){for(s=0|r[e>>2],a=0;;){if((0|a)>=(0|s))break t;if(c=0|r[t>>2],h=0|r[c+(a<<2)>>2])break;a=a+1|0}a=c+(~~(+u(+ +l(10,+ +(15-(0|r[n>>2])|0))*(+o[h>>3]+ +o[h+8>>3]))%+(0|s))>>>0<<2)|0,s=0|r[a>>2];e:do{if(0|s){if(c=h+32|0,(0|s)==(0|h))r[a>>2]=r[c>>2];else{if(!(a=0|r[(s=s+32|0)>>2]))break;for(;(0|a)!=(0|h);)if(!(a=0|r[(s=a+32|0)>>2]))break e;r[s>>2]=r[c>>2]}pe(h),r[i>>2]=(0|r[i>>2])-1}}while(0)}pe(0|r[t>>2])}function oe(t){var e,n=0,i=0;for(e=0|r[(t|=0)+4>>2],i=0;;){if((0|i)>=(0|e)){n=0,i=4;break}if(n=0|r[(0|r[t>>2])+(i<<2)>>2]){i=4;break}i=i+1|0}return 4==(0|i)?0|n:0}function ae(t,e){e|=0;var n=0,i=0,a=0,s=0;if(n=~~(+u(+ +l(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|r[t+4>>2]))>>>0,n=(0|r[t>>2])+(n<<2)|0,!(i=0|r[n>>2]))return 0|(s=1);s=e+32|0;do{if((0|i)!=(0|e)){if(!(n=0|r[i+32>>2]))return 0|(s=1);for(a=n;;){if((0|a)==(0|e)){a=8;break}if(!(n=0|r[a+32>>2])){n=1,a=10;break}i=a,a=n}if(8==(0|a)){r[i+32>>2]=r[s>>2];break}if(10==(0|a))return 0|n}else r[n>>2]=r[s>>2]}while(0);return pe(e),r[(s=t+8|0)>>2]=(0|r[s>>2])-1,0|(s=0)}function se(t,e,n){t|=0,e|=0,n|=0;var i,a=0,s=0,c=0;(i=0|he(40))||w(22922,22892,95,22935),r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],r[i+12>>2]=r[e+12>>2],r[(s=i+16|0)>>2]=r[n>>2],r[s+4>>2]=r[n+4>>2],r[s+8>>2]=r[n+8>>2],r[s+12>>2]=r[n+12>>2],r[i+32>>2]=0,s=~~(+u(+ +l(10,+ +(15-(0|r[t+12>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|r[t+4>>2]))>>>0,s=(0|r[t>>2])+(s<<2)|0,a=0|r[s>>2];do{if(a){for(;!(0|Et(a,e)&&0|Et(a+16|0,n));)if(s=0|r[a+32>>2],!(0|r[(a=0==(0|s)?a:s)+32>>2])){c=10;break}if(10==(0|c)){r[a+32>>2]=i;break}return pe(i),0|(c=a)}r[s>>2]=i}while(0);return r[(c=t+8|0)>>2]=1+(0|r[c>>2]),0|(c=i)}function ue(t,e,n){e|=0,n|=0;var i=0,a=0;if(a=~~(+u(+ +l(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(a=0|r[(0|r[t>>2])+(a<<2)>>2]))return 0|(n=0);if(!n){for(t=a;;){if(0|Et(t,e)){i=10;break}if(!(t=0|r[t+32>>2])){t=0,i=10;break}}if(10==(0|i))return 0|t}for(t=a;;){if(0|Et(t,e)&&0|Et(t+16|0,n)){i=10;break}if(!(t=0|r[t+32>>2])){t=0,i=10;break}}return 10==(0|i)?0|t:0}function ce(t,e){e|=0;var n=0;if(n=~~(+u(+ +l(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(t=0|r[(0|r[t>>2])+(n<<2)>>2]))return 0|(n=0);for(;;){if(0|Et(t,e)){e=5;break}if(!(t=0|r[t+32>>2])){t=0,e=5;break}}return 5==(0|e)?0|t:0}function le(t){return 0|~~+function(t){return+ +we(+(t=+t))}(t=+t)}function he(t){t|=0;var e,n=0,i=0,o=0,a=0,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0,x=0;e=C,C=C+16|0,d=e;do{if(t>>>0<245){if(t=(h=t>>>0<11?16:t+11&-8)>>>3,3&(i=(f=0|r[5741])>>>t)|0)return o=0|r[(i=(t=23004+((n=(1&i^1)+t|0)<<1<<2)|0)+8|0)>>2],(0|(s=0|r[(a=o+8|0)>>2]))==(0|t)?r[5741]=f&~(1<<n):(r[s+12>>2]=t,r[i>>2]=s),x=n<<3,r[o+4>>2]=3|x,r[(x=o+x+4|0)>>2]=1|r[x>>2],C=e,0|(x=a);if(h>>>0>(p=0|r[5743])>>>0){if(0|i)return n=((n=i<<t&((n=2<<t)|0-n))&0-n)-1|0,s=0|r[(t=(n=23004+((o=((i=(n>>>=c=n>>>12&16)>>>5&8)|c|(s=(n>>>=i)>>>2&4)|(t=(n>>>=s)>>>1&2)|(o=(n>>>=t)>>>1&1))+(n>>>o)|0)<<1<<2)|0)+8|0)>>2],(0|(i=0|r[(c=s+8|0)>>2]))==(0|n)?(t=f&~(1<<o),r[5741]=t):(r[i+12>>2]=n,r[t>>2]=i,t=f),u=(x=o<<3)-h|0,r[s+4>>2]=3|h,r[(a=s+h|0)+4>>2]=1|u,r[s+x>>2]=u,0|p&&(o=0|r[5746],i=23004+((n=p>>>3)<<1<<2)|0,t&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5741]=t|n,n=i,t=i+8|0),r[t>>2]=o,r[n+12>>2]=o,r[o+8>>2]=n,r[o+12>>2]=i),r[5743]=u,r[5746]=a,C=e,0|(x=c);if(s=0|r[5742]){for(i=(s&0-s)-1|0,i=l=0|r[23268+(((o=(i>>>=a=i>>>12&16)>>>5&8)|a|(u=(i>>>=o)>>>2&4)|(c=(i>>>=u)>>>1&2)|(l=(i>>>=c)>>>1&1))+(i>>>l)<<2)>>2],c=l,l=(-8&r[l+4>>2])-h|0;(t=0|r[i+16>>2])||(t=0|r[i+20>>2]);)i=t,c=(a=(u=(-8&r[t+4>>2])-h|0)>>>0<l>>>0)?t:c,l=a?u:l;if((u=c+h|0)>>>0>c>>>0){a=0|r[c+24>>2],n=0|r[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|r[(t=c+20|0)>>2])&&!(n=0|r[(t=c+16|0)>>2])){i=0;break}for(;;)if(i=0|r[(o=n+20|0)>>2])n=i,t=o;else{if(!(i=0|r[(o=n+16|0)>>2]))break;n=i,t=o}r[t>>2]=0,i=n}else i=0|r[c+8>>2],r[i+12>>2]=n,r[n+8>>2]=i,i=n}while(0);do{if(0|a){if(n=0|r[c+28>>2],(0|c)==(0|r[(t=23268+(n<<2)|0)>>2])){if(r[t>>2]=i,!i){r[5742]=s&~(1<<n);break}}else if(r[((0|r[(x=a+16|0)>>2])==(0|c)?x:a+20|0)>>2]=i,!i)break;r[i+24>>2]=a,0|(n=0|r[c+16>>2])&&(r[i+16>>2]=n,r[n+24>>2]=i),0|(n=0|r[c+20>>2])&&(r[i+20>>2]=n,r[n+24>>2]=i)}}while(0);return l>>>0<16?(x=l+h|0,r[c+4>>2]=3|x,r[(x=c+x+4|0)>>2]=1|r[x>>2]):(r[c+4>>2]=3|h,r[u+4>>2]=1|l,r[u+l>>2]=l,0|p&&(o=0|r[5746],i=23004+((n=p>>>3)<<1<<2)|0,(n=1<<n)&f?n=0|r[(t=i+8|0)>>2]:(r[5741]=n|f,n=i,t=i+8|0),r[t>>2]=o,r[n+12>>2]=o,r[o+8>>2]=n,r[o+12>>2]=i),r[5743]=l,r[5746]=u),C=e,0|(x=c+8|0)}f=h}else f=h}else f=h}else if(t>>>0<=4294967231)if(h=-8&(t=t+11|0),o=0|r[5742]){a=0-h|0,l=(t>>>=8)?h>>>0>16777215?31:h>>>((l=14-((c=((m=t<<(f=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|f|(l=((m<<=c)+245760|0)>>>16&2))+(m<<l>>>15)|0)+7|0)&1|l<<1:0,i=0|r[23268+(l<<2)>>2];t:do{if(i)for(t=0,c=h<<(31==(0|l)?0:25-(l>>>1)|0),s=0;;){if((u=(-8&r[i+4>>2])-h|0)>>>0<a>>>0){if(!u){t=i,a=0,m=65;break t}t=i,a=u}if(s=0==(0|(m=0|r[i+20>>2]))|(0|m)==(0|(i=0|r[i+16+(c>>>31<<2)>>2]))?s:m,!i){i=s,m=61;break}c<<=1}else i=0,t=0,m=61}while(0);if(61==(0|m)){if(0==(0|i)&0==(0|t)){if(!(t=((t=2<<l)|0-t)&o)){f=h;break}f=(t&0-t)-1|0,t=0,i=0|r[23268+(((s=(f>>>=u=f>>>12&16)>>>5&8)|u|(c=(f>>>=s)>>>2&4)|(l=(f>>>=c)>>>1&2)|(i=(f>>>=l)>>>1&1))+(f>>>i)<<2)>>2]}i?m=65:(c=t,u=a)}if(65==(0|m))for(s=i;;){if(a=(i=(f=(-8&r[s+4>>2])-h|0)>>>0<a>>>0)?f:a,t=i?s:t,(i=0|r[s+16>>2])||(i=0|r[s+20>>2]),!i){c=t,u=a;break}s=i}if(0!=(0|c)&&u>>>0<((0|r[5743])-h|0)>>>0&&(p=c+h|0)>>>0>c>>>0){s=0|r[c+24>>2],n=0|r[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|r[(t=c+20|0)>>2])&&!(n=0|r[(t=c+16|0)>>2])){n=0;break}for(;;)if(i=0|r[(a=n+20|0)>>2])n=i,t=a;else{if(!(i=0|r[(a=n+16|0)>>2]))break;n=i,t=a}r[t>>2]=0}else x=0|r[c+8>>2],r[x+12>>2]=n,r[n+8>>2]=x}while(0);do{if(s){if(t=0|r[c+28>>2],(0|c)==(0|r[(i=23268+(t<<2)|0)>>2])){if(r[i>>2]=n,!n){o&=~(1<<t),r[5742]=o;break}}else if(r[((0|r[(x=s+16|0)>>2])==(0|c)?x:s+20|0)>>2]=n,!n)break;r[n+24>>2]=s,0|(t=0|r[c+16>>2])&&(r[n+16>>2]=t,r[t+24>>2]=n),(t=0|r[c+20>>2])&&(r[n+20>>2]=t,r[t+24>>2]=n)}}while(0);t:do{if(u>>>0<16)x=u+h|0,r[c+4>>2]=3|x,r[(x=c+x+4|0)>>2]=1|r[x>>2];else{if(r[c+4>>2]=3|h,r[p+4>>2]=1|u,r[p+u>>2]=u,n=u>>>3,u>>>0<256){i=23004+(n<<1<<2)|0,(t=0|r[5741])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5741]=t|n,n=i,t=i+8|0),r[t>>2]=p,r[n+12>>2]=p,r[p+8>>2]=n,r[p+12>>2]=i;break}if(n=23268+((i=(n=u>>>8)?u>>>0>16777215?31:u>>>((i=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(i=((x<<=_)+245760|0)>>>16&2))+(x<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[p+28>>2]=i,r[(t=p+16|0)+4>>2]=0,r[t>>2]=0,!(o&(t=1<<i))){r[5742]=o|t,r[n>>2]=p,r[p+24>>2]=n,r[p+12>>2]=p,r[p+8>>2]=p;break}n=0|r[n>>2];e:do{if((-8&r[n+4>>2]|0)!=(0|u)){for(o=u<<(31==(0|i)?0:25-(i>>>1)|0);t=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|u)){n=t;break e}o<<=1,n=t}r[i>>2]=p,r[p+24>>2]=n,r[p+12>>2]=p,r[p+8>>2]=p;break t}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=p,r[b>>2]=p,r[p+8>>2]=x,r[p+12>>2]=n,r[p+24>>2]=0}}while(0);return C=e,0|(x=c+8|0)}f=h}else f=h;else f=-1}while(0);if((i=0|r[5743])>>>0>=f>>>0)return n=i-f|0,t=0|r[5746],n>>>0>15?(x=t+f|0,r[5746]=x,r[5743]=n,r[x+4>>2]=1|n,r[t+i>>2]=n,r[t+4>>2]=3|f):(r[5743]=0,r[5746]=0,r[t+4>>2]=3|i,r[(x=t+i+4|0)>>2]=1|r[x>>2]),C=e,0|(x=t+8|0);if((u=0|r[5744])>>>0>f>>>0)return _=u-f|0,r[5744]=_,b=(x=0|r[5747])+f|0,r[5747]=b,r[b+4>>2]=1|_,r[x+4>>2]=3|f,C=e,0|(x=x+8|0);if(0|r[5859]?t=0|r[5861]:(r[5861]=4096,r[5860]=4096,r[5862]=-1,r[5863]=-1,r[5864]=0,r[5852]=0,r[5859]=-16&d^1431655768,t=4096),c=f+48|0,(h=(s=t+(l=f+47|0)|0)&(a=0-t|0))>>>0<=f>>>0)return C=e,0|(x=0);if(0|(t=0|r[5851])&&(d=(p=0|r[5849])+h|0)>>>0<=p>>>0|d>>>0>t>>>0)return C=e,0|(x=0);t:do{if(4&r[5852])n=0,m=143;else{i=0|r[5747];e:do{if(i){for(o=23412;!((d=0|r[o>>2])>>>0<=i>>>0&&(d+(0|r[o+4>>2])|0)>>>0>i>>>0);){if(!(t=0|r[o+8>>2])){m=128;break e}o=t}if((n=s-u&a)>>>0<2147483647)if((0|(t=0|Ee(0|n)))==((0|r[o>>2])+(0|r[o+4>>2])|0)){if(-1!=(0|t)){u=n,s=t,m=145;break t}}else o=t,m=136;else n=0}else m=128}while(0);do{if(128==(0|m))if(-1!=(0|(i=0|Ee(0)))&&(n=i,g=(n=(0==((g=(A=0|r[5860])+-1|0)&n|0)?0:(g+n&0-A)-n|0)+h|0)+(A=0|r[5849])|0,n>>>0>f>>>0&n>>>0<2147483647)){if(0|(d=0|r[5851])&&g>>>0<=A>>>0|g>>>0>d>>>0){n=0;break}if((0|(t=0|Ee(0|n)))==(0|i)){u=n,s=i,m=145;break t}o=t,m=136}else n=0}while(0);do{if(136==(0|m)){if(i=0-n|0,!(c>>>0>n>>>0&n>>>0<2147483647&-1!=(0|o))){if(-1==(0|o)){n=0;break}u=n,s=o,m=145;break t}if((t=l-n+(t=0|r[5861])&0-t)>>>0>=2147483647){u=n,s=o,m=145;break t}if(-1==(0|Ee(0|t))){Ee(0|i),n=0;break}u=t+n|0,s=o,m=145;break t}}while(0);r[5852]=4|r[5852],m=143}}while(0);if(143==(0|m)&&h>>>0<2147483647&&!(-1==(0|(_=0|Ee(0|h)))|1^(v=(y=(g=0|Ee(0))-_|0)>>>0>(f+40|0)>>>0)|_>>>0<g>>>0&-1!=(0|_)&-1!=(0|g)^1)&&(u=v?y:n,s=_,m=145),145==(0|m)){n=(0|r[5849])+u|0,r[5849]=n,n>>>0>(0|r[5850])>>>0&&(r[5850]=n),l=0|r[5747];t:do{if(l){for(n=23412;;){if((0|s)==((t=0|r[n>>2])+(i=0|r[n+4>>2])|0)){m=154;break}if(!(o=0|r[n+8>>2]))break;n=o}if(154==(0|m)&&(b=n+4|0,0==(8&r[n+12>>2]|0))&&s>>>0>l>>>0&t>>>0<=l>>>0){r[b>>2]=i+u,b=l+(_=0==(7&(_=l+8|0)|0)?0:0-_&7)|0,_=(x=(0|r[5744])+u|0)-_|0,r[5747]=b,r[5744]=_,r[b+4>>2]=1|_,r[l+x+4>>2]=40,r[5748]=r[5863];break}for(s>>>0<(0|r[5745])>>>0&&(r[5745]=s),i=s+u|0,n=23412;;){if((0|r[n>>2])==(0|i)){m=162;break}if(!(t=0|r[n+8>>2]))break;n=t}if(162==(0|m)&&0==(8&r[n+12>>2]|0)){r[n>>2]=s,r[(p=n+4|0)>>2]=(0|r[p>>2])+u,h=(p=s+(0==(7&(p=s+8|0)|0)?0:0-p&7)|0)+f|0,c=(n=i+(0==(7&(n=i+8|0)|0)?0:0-n&7)|0)-p-f|0,r[p+4>>2]=3|f;e:do{if((0|l)==(0|n))x=(0|r[5744])+c|0,r[5744]=x,r[5747]=h,r[h+4>>2]=1|x;else{if((0|r[5746])==(0|n)){x=(0|r[5743])+c|0,r[5743]=x,r[5746]=h,r[h+4>>2]=1|x,r[h+x>>2]=x;break}if(1==(3&(t=0|r[n+4>>2])|0)){u=-8&t,o=t>>>3;n:do{if(t>>>0<256){if(t=0|r[n+8>>2],(0|(i=0|r[n+12>>2]))==(0|t)){r[5741]=r[5741]&~(1<<o);break}r[t+12>>2]=i,r[i+8>>2]=t;break}s=0|r[n+24>>2],t=0|r[n+12>>2];do{if((0|t)==(0|n)){if(t=0|r[(o=(i=n+16|0)+4|0)>>2])i=o;else if(!(t=0|r[i>>2])){t=0;break}for(;;)if(o=0|r[(a=t+20|0)>>2])t=o,i=a;else{if(!(o=0|r[(a=t+16|0)>>2]))break;t=o,i=a}r[i>>2]=0}else x=0|r[n+8>>2],r[x+12>>2]=t,r[t+8>>2]=x}while(0);if(!s)break;o=23268+((i=0|r[n+28>>2])<<2)|0;do{if((0|r[o>>2])==(0|n)){if(r[o>>2]=t,0|t)break;r[5742]=r[5742]&~(1<<i);break n}if(r[((0|r[(x=s+16|0)>>2])==(0|n)?x:s+20|0)>>2]=t,!t)break n}while(0);if(r[t+24>>2]=s,0|(o=0|r[(i=n+16|0)>>2])&&(r[t+16>>2]=o,r[o+24>>2]=t),!(i=0|r[i+4>>2]))break;r[t+20>>2]=i,r[i+24>>2]=t}while(0);n=n+u|0,a=u+c|0}else a=c;if(r[(n=n+4|0)>>2]=-2&r[n>>2],r[h+4>>2]=1|a,r[h+a>>2]=a,n=a>>>3,a>>>0<256){i=23004+(n<<1<<2)|0,(t=0|r[5741])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5741]=t|n,n=i,t=i+8|0),r[t>>2]=h,r[n+12>>2]=h,r[h+8>>2]=n,r[h+12>>2]=i;break}n=a>>>8;do{if(n){if(a>>>0>16777215){o=31;break}o=a>>>((o=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(o=((x<<=_)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1}else o=0}while(0);if(n=23268+(o<<2)|0,r[h+28>>2]=o,r[(t=h+16|0)+4>>2]=0,r[t>>2]=0,!((t=0|r[5742])&(i=1<<o))){r[5742]=t|i,r[n>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break}n=0|r[n>>2];n:do{if((-8&r[n+4>>2]|0)!=(0|a)){for(o=a<<(31==(0|o)?0:25-(o>>>1)|0);t=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|a)){n=t;break n}o<<=1,n=t}r[i>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break e}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=h,r[b>>2]=h,r[h+8>>2]=x,r[h+12>>2]=n,r[h+24>>2]=0}}while(0);return C=e,0|(x=p+8|0)}for(n=23412;!((t=0|r[n>>2])>>>0<=l>>>0&&(x=t+(0|r[n+4>>2])|0)>>>0>l>>>0);)n=0|r[n+8>>2];n=(t=(t=(a=x+-47|0)+(0==(7&(t=a+8|0)|0)?0:0-t&7)|0)>>>0<(a=l+16|0)>>>0?l:t)+8|0,b=s+(_=0==(7&(_=s+8|0)|0)?0:0-_&7)|0,_=(i=u+-40|0)-_|0,r[5747]=b,r[5744]=_,r[b+4>>2]=1|_,r[s+i+4>>2]=40,r[5748]=r[5863],r[(i=t+4|0)>>2]=27,r[n>>2]=r[5853],r[n+4>>2]=r[5854],r[n+8>>2]=r[5855],r[n+12>>2]=r[5856],r[5853]=s,r[5854]=u,r[5856]=0,r[5855]=n,n=t+24|0;do{b=n,r[(n=n+4|0)>>2]=7}while((b+8|0)>>>0<x>>>0);if((0|t)!=(0|l)){if(s=t-l|0,r[i>>2]=-2&r[i>>2],r[l+4>>2]=1|s,r[t>>2]=s,n=s>>>3,s>>>0<256){i=23004+(n<<1<<2)|0,(t=0|r[5741])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5741]=t|n,n=i,t=i+8|0),r[t>>2]=l,r[n+12>>2]=l,r[l+8>>2]=n,r[l+12>>2]=i;break}if(i=23268+((o=(n=s>>>8)?s>>>0>16777215?31:s>>>((o=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(o=((x<<=_)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1:0)<<2)|0,r[l+28>>2]=o,r[l+20>>2]=0,r[a>>2]=0,!((n=0|r[5742])&(t=1<<o))){r[5742]=n|t,r[i>>2]=l,r[l+24>>2]=i,r[l+12>>2]=l,r[l+8>>2]=l;break}n=0|r[i>>2];e:do{if((-8&r[n+4>>2]|0)!=(0|s)){for(o=s<<(31==(0|o)?0:25-(o>>>1)|0);t=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|s)){n=t;break e}o<<=1,n=t}r[i>>2]=l,r[l+24>>2]=n,r[l+12>>2]=l,r[l+8>>2]=l;break t}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=l,r[b>>2]=l,r[l+8>>2]=x,r[l+12>>2]=n,r[l+24>>2]=0}}else 0==(0|(x=0|r[5745]))|s>>>0<x>>>0&&(r[5745]=s),r[5853]=s,r[5854]=u,r[5856]=0,r[5750]=r[5859],r[5749]=-1,r[5754]=23004,r[5753]=23004,r[5756]=23012,r[5755]=23012,r[5758]=23020,r[5757]=23020,r[5760]=23028,r[5759]=23028,r[5762]=23036,r[5761]=23036,r[5764]=23044,r[5763]=23044,r[5766]=23052,r[5765]=23052,r[5768]=23060,r[5767]=23060,r[5770]=23068,r[5769]=23068,r[5772]=23076,r[5771]=23076,r[5774]=23084,r[5773]=23084,r[5776]=23092,r[5775]=23092,r[5778]=23100,r[5777]=23100,r[5780]=23108,r[5779]=23108,r[5782]=23116,r[5781]=23116,r[5784]=23124,r[5783]=23124,r[5786]=23132,r[5785]=23132,r[5788]=23140,r[5787]=23140,r[5790]=23148,r[5789]=23148,r[5792]=23156,r[5791]=23156,r[5794]=23164,r[5793]=23164,r[5796]=23172,r[5795]=23172,r[5798]=23180,r[5797]=23180,r[5800]=23188,r[5799]=23188,r[5802]=23196,r[5801]=23196,r[5804]=23204,r[5803]=23204,r[5806]=23212,r[5805]=23212,r[5808]=23220,r[5807]=23220,r[5810]=23228,r[5809]=23228,r[5812]=23236,r[5811]=23236,r[5814]=23244,r[5813]=23244,r[5816]=23252,r[5815]=23252,b=s+(_=0==(7&(_=s+8|0)|0)?0:0-_&7)|0,_=(x=u+-40|0)-_|0,r[5747]=b,r[5744]=_,r[b+4>>2]=1|_,r[s+x+4>>2]=40,r[5748]=r[5863]}while(0);if((n=0|r[5744])>>>0>f>>>0)return _=n-f|0,r[5744]=_,b=(x=0|r[5747])+f|0,r[5747]=b,r[b+4>>2]=1|_,r[x+4>>2]=3|f,C=e,0|(x=x+8|0)}return r[(x=22960)>>2]=12,C=e,0|(x=0)}function pe(t){var e=0,n=0,i=0,o=0,a=0,s=0,u=0,c=0;if(t|=0){n=t+-8|0,o=0|r[5745],c=n+(e=-8&(t=0|r[t+-4>>2]))|0;do{if(1&t)u=n,s=n;else{if(i=0|r[n>>2],!(3&t))return;if(a=i+e|0,(s=n+(0-i)|0)>>>0<o>>>0)return;if((0|r[5746])==(0|s)){if(3!=(3&(e=0|r[(t=c+4|0)>>2])|0)){u=s,e=a;break}return r[5743]=a,r[t>>2]=-2&e,r[s+4>>2]=1|a,void(r[s+a>>2]=a)}if(n=i>>>3,i>>>0<256){if(t=0|r[s+8>>2],(0|(e=0|r[s+12>>2]))==(0|t)){r[5741]=r[5741]&~(1<<n),u=s,e=a;break}r[t+12>>2]=e,r[e+8>>2]=t,u=s,e=a;break}o=0|r[s+24>>2],t=0|r[s+12>>2];do{if((0|t)==(0|s)){if(t=0|r[(n=(e=s+16|0)+4|0)>>2])e=n;else if(!(t=0|r[e>>2])){t=0;break}for(;;)if(n=0|r[(i=t+20|0)>>2])t=n,e=i;else{if(!(n=0|r[(i=t+16|0)>>2]))break;t=n,e=i}r[e>>2]=0}else u=0|r[s+8>>2],r[u+12>>2]=t,r[t+8>>2]=u}while(0);if(o){if(e=0|r[s+28>>2],(0|r[(n=23268+(e<<2)|0)>>2])==(0|s)){if(r[n>>2]=t,!t){r[5742]=r[5742]&~(1<<e),u=s,e=a;break}}else if(r[((0|r[(u=o+16|0)>>2])==(0|s)?u:o+20|0)>>2]=t,!t){u=s,e=a;break}r[t+24>>2]=o,0|(n=0|r[(e=s+16|0)>>2])&&(r[t+16>>2]=n,r[n+24>>2]=t),(e=0|r[e+4>>2])?(r[t+20>>2]=e,r[e+24>>2]=t,u=s,e=a):(u=s,e=a)}else u=s,e=a}}while(0);if(!(s>>>0>=c>>>0)&&1&(i=0|r[(t=c+4|0)>>2])){if(2&i)r[t>>2]=-2&i,r[u+4>>2]=1|e,r[s+e>>2]=e,o=e;else{if((0|r[5747])==(0|c)){if(c=(0|r[5744])+e|0,r[5744]=c,r[5747]=u,r[u+4>>2]=1|c,(0|u)!=(0|r[5746]))return;return r[5746]=0,void(r[5743]=0)}if((0|r[5746])==(0|c))return c=(0|r[5743])+e|0,r[5743]=c,r[5746]=s,r[u+4>>2]=1|c,void(r[s+c>>2]=c);o=(-8&i)+e|0,n=i>>>3;do{if(i>>>0<256){if(e=0|r[c+8>>2],(0|(t=0|r[c+12>>2]))==(0|e)){r[5741]=r[5741]&~(1<<n);break}r[e+12>>2]=t,r[t+8>>2]=e;break}a=0|r[c+24>>2],t=0|r[c+12>>2];do{if((0|t)==(0|c)){if(t=0|r[(n=(e=c+16|0)+4|0)>>2])e=n;else if(!(t=0|r[e>>2])){n=0;break}for(;;)if(n=0|r[(i=t+20|0)>>2])t=n,e=i;else{if(!(n=0|r[(i=t+16|0)>>2]))break;t=n,e=i}r[e>>2]=0,n=t}else n=0|r[c+8>>2],r[n+12>>2]=t,r[t+8>>2]=n,n=t}while(0);if(0|a){if(t=0|r[c+28>>2],(0|r[(e=23268+(t<<2)|0)>>2])==(0|c)){if(r[e>>2]=n,!n){r[5742]=r[5742]&~(1<<t);break}}else if(r[((0|r[(i=a+16|0)>>2])==(0|c)?i:a+20|0)>>2]=n,!n)break;r[n+24>>2]=a,0|(e=0|r[(t=c+16|0)>>2])&&(r[n+16>>2]=e,r[e+24>>2]=n),0|(t=0|r[t+4>>2])&&(r[n+20>>2]=t,r[t+24>>2]=n)}}while(0);if(r[u+4>>2]=1|o,r[s+o>>2]=o,(0|u)==(0|r[5746]))return void(r[5743]=o)}if(t=o>>>3,o>>>0<256)return n=23004+(t<<1<<2)|0,(e=0|r[5741])&(t=1<<t)?t=0|r[(e=n+8|0)>>2]:(r[5741]=e|t,t=n,e=n+8|0),r[e>>2]=u,r[t+12>>2]=u,r[u+8>>2]=t,void(r[u+12>>2]=n);t=23268+((i=(t=o>>>8)?o>>>0>16777215?31:o>>>((i=14-((a=((c=t<<(s=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(i=((c<<=a)+245760|0)>>>16&2))+(c<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[u+28>>2]=i,r[u+20>>2]=0,r[u+16>>2]=0,e=0|r[5742],n=1<<i;t:do{if(e&n){t=0|r[t>>2];e:do{if((-8&r[t+4>>2]|0)!=(0|o)){for(i=o<<(31==(0|i)?0:25-(i>>>1)|0);e=0|r[(n=t+16+(i>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|o)){t=e;break e}i<<=1,t=e}r[n>>2]=u,r[u+24>>2]=t,r[u+12>>2]=u,r[u+8>>2]=u;break t}}while(0);c=0|r[(s=t+8|0)>>2],r[c+12>>2]=u,r[s>>2]=u,r[u+8>>2]=c,r[u+12>>2]=t,r[u+24>>2]=0}else r[5742]=e|n,r[t>>2]=u,r[u+24>>2]=t,r[u+12>>2]=u,r[u+8>>2]=u}while(0);if(c=(0|r[5749])-1|0,r[5749]=c,!(0|c)){for(t=23420;t=0|r[t>>2];)t=t+8|0;r[5749]=-1}}}}function fe(t,e){e|=0;var n=0;return(t|=0)?(n=0|v(e,t),(e|t)>>>0>65535&&(n=(0|(n>>>0)/(t>>>0))==(0|e)?n:-1)):n=0,(t=0|he(n))&&3&r[t+-4>>2]?(xe(0|t,0,0|n),0|t):0|t}function de(t,e,n,i){return 0|(b(0|(i=(e|=0)-(i|=0)-((n|=0)>>>0>(t|=0)>>>0|0)>>>0)),t-n>>>0|0)}function Ae(t){return 0|((t|=0)?31-(0|_(t^t-1))|0:32)}function ge(t,e,n,i,o){o|=0;var a=0,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0;if(h=t|=0,s=n|=0,u=f=i|=0,!(l=c=e|=0))return a=0!=(0|o),u?a?(r[o>>2]=0|t,r[o+4>>2]=0&e,o=0,0|(b(0|(f=0)),o)):(o=0,0|(b(0|(f=0)),o)):(a&&(r[o>>2]=(h>>>0)%(s>>>0),r[o+4>>2]=0),o=(h>>>0)/(s>>>0)>>>0,0|(b(0|(f=0)),o));a=0==(0|u);do{if(s){if(!a){if((a=(0|_(0|u))-(0|_(0|l))|0)>>>0<=31){s=p=a+1|0,t=h>>>(p>>>0)&(e=a-31>>31)|l<<(u=31-a|0),e&=l>>>(p>>>0),a=0,u=h<<u;break}return o?(r[o>>2]=0|t,r[o+4>>2]=c|0&e,o=0,0|(b(0|(f=0)),o)):(o=0,0|(b(0|(f=0)),o))}if((a=s-1|0)&s|0){s=u=33+(0|_(0|s))-(0|_(0|l))|0,t=(p=32-u|0)-1>>31&l>>>((d=u-32|0)>>>0)|(l<<p|h>>>(u>>>0))&(e=d>>31),e&=l>>>(u>>>0),a=h<<(A=64-u|0)&(c=p>>31),u=(l<<A|h>>>(d>>>0))&c|h<<p&u-33>>31;break}return 0|o&&(r[o>>2]=a&h,r[o+4>>2]=0),1==(0|s)?(A=0|t,0|(b(0|(d=c|0&e)),A)):(d=l>>>((A=0|Ae(0|s))>>>0)|0,A=l<<32-A|h>>>(A>>>0)|0,0|(b(0|d),A))}if(a)return 0|o&&(r[o>>2]=(l>>>0)%(s>>>0),r[o+4>>2]=0),A=(l>>>0)/(s>>>0)>>>0,0|(b(0|(d=0)),A);if(!h)return 0|o&&(r[o>>2]=0,r[o+4>>2]=(l>>>0)%(u>>>0)),A=(l>>>0)/(u>>>0)>>>0,0|(b(0|(d=0)),A);if(!((a=u-1|0)&u))return 0|o&&(r[o>>2]=0|t,r[o+4>>2]=a&l|0&e),d=0,A=l>>>((0|Ae(0|u))>>>0),0|(b(0|d),A);if((a=(0|_(0|u))-(0|_(0|l))|0)>>>0<=30){s=e=a+1|0,t=l<<(u=31-a|0)|h>>>(e>>>0),e=l>>>(e>>>0),a=0,u=h<<u;break}return o?(r[o>>2]=0|t,r[o+4>>2]=c|0&e,A=0,0|(b(0|(d=0)),A)):(A=0,0|(b(0|(d=0)),A))}while(0);if(s){l=0|function(t,e,n,i){return 0|(b((e|=0)+(i|=0)+((n=(t|=0)+(n|=0)>>>0)>>>0<t>>>0|0)>>>0|0),0|n)}(0|(p=0|n),0|(h=f|0&i),-1,-1),n=0|x(),c=u,u=0;do{i=c,c=a>>>31|c<<1,a=u|a<<1,de(0|l,0|n,0|(i=t<<1|i>>>31|0),0|(f=t>>>31|e<<1|0)),u=1&(d=(A=0|x())>>31|((0|A)<0?-1:0)<<1),t=0|de(0|i,0|f,d&p|0,(((0|A)<0?-1:0)>>31|((0|A)<0?-1:0)<<1)&h|0),e=0|x(),s=s-1|0}while(0!=(0|s));l=c,c=0}else l=u,c=0,u=0;return s=0,0|o&&(r[o>>2]=t,r[o+4>>2]=e),A=-2&(a<<1|0)|u,0|(b(0|(d=(0|a)>>>31|(l|s)<<1|0&(s<<1|a>>>31)|c)),A)}function me(t,e,n,i){var o,a;return a=C,C=C+16|0,ge(t|=0,e|=0,n|=0,i|=0,o=0|a),C=a,0|(b(0|r[o+4>>2]),0|r[o>>2])}function ye(t,e,n){return t|=0,e|=0,(0|(n|=0))<32?(b(e>>>n|0),t>>>n|(e&(1<<n)-1)<<32-n):(b(0),e>>>n-32|0)}function ve(t,e,n){return t|=0,e|=0,(0|(n|=0))<32?(b(e<<n|(t&(1<<n)-1<<32-n)>>>32-n|0),t<<n):(b(t<<n-32|0),0)}function _e(t){return(t=+t)>=0?+s(t+.5):+y(t-.5)}function be(t,e,n){t|=0,e|=0;var o,a,s=0;if((0|(n|=0))>=8192)return S(0|t,0|e,0|n),0|t;if(a=0|t,o=t+n|0,(3&t)==(3&e)){for(;3&t;){if(!n)return 0|a;i[t>>0]=0|i[e>>0],t=t+1|0,e=e+1|0,n=n-1|0}for(s=(n=-4&o|0)-64|0;(0|t)<=(0|s);)r[t>>2]=r[e>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2],r[t+16>>2]=r[e+16>>2],r[t+20>>2]=r[e+20>>2],r[t+24>>2]=r[e+24>>2],r[t+28>>2]=r[e+28>>2],r[t+32>>2]=r[e+32>>2],r[t+36>>2]=r[e+36>>2],r[t+40>>2]=r[e+40>>2],r[t+44>>2]=r[e+44>>2],r[t+48>>2]=r[e+48>>2],r[t+52>>2]=r[e+52>>2],r[t+56>>2]=r[e+56>>2],r[t+60>>2]=r[e+60>>2],t=t+64|0,e=e+64|0;for(;(0|t)<(0|n);)r[t>>2]=r[e>>2],t=t+4|0,e=e+4|0}else for(n=o-4|0;(0|t)<(0|n);)i[t>>0]=0|i[e>>0],i[t+1>>0]=0|i[e+1>>0],i[t+2>>0]=0|i[e+2>>0],i[t+3>>0]=0|i[e+3>>0],t=t+4|0,e=e+4|0;for(;(0|t)<(0|o);)i[t>>0]=0|i[e>>0],t=t+1|0,e=e+1|0;return 0|a}function xe(t,e,n){e|=0;var o,a=0,s=0,u=0;if(o=(t|=0)+(n|=0)|0,e&=255,(0|n)>=67){for(;3&t;)i[t>>0]=e,t=t+1|0;for(u=e|e<<8|e<<16|e<<24,s=(a=-4&o|0)-64|0;(0|t)<=(0|s);)r[t>>2]=u,r[t+4>>2]=u,r[t+8>>2]=u,r[t+12>>2]=u,r[t+16>>2]=u,r[t+20>>2]=u,r[t+24>>2]=u,r[t+28>>2]=u,r[t+32>>2]=u,r[t+36>>2]=u,r[t+40>>2]=u,r[t+44>>2]=u,r[t+48>>2]=u,r[t+52>>2]=u,r[t+56>>2]=u,r[t+60>>2]=u,t=t+64|0;for(;(0|t)<(0|a);)r[t>>2]=u,t=t+4|0}for(;(0|t)<(0|o);)i[t>>0]=e,t=t+1|0;return o-n|0}function we(t){return(t=+t)>=0?+s(t+.5):+y(t-.5)}function Ee(t){t|=0;var e,n,i;return i=0|T(),(0|t)>0&(0|(e=(n=0|r[a>>2])+t|0))<(0|n)|(0|e)<0?(M(0|e),E(12),-1):(0|e)>(0|i)&&!(0|P(0|e))?(E(12),-1):(r[a>>2]=e,0|n)}return{___uremdi3:me,_bitshift64Lshr:ye,_bitshift64Shl:ve,_calloc:fe,_compact:function(t,e,n){e|=0;var i,o=0,a=0,s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0,w=0,E=0;if(!(n|=0))return 0|(E=0);if(o=0|r[(a=t|=0)>>2],!0&0==(15728640&(a=0|r[a+4>>2])|0)){if((0|n)<=0)return 0|(E=0);if(r[(E=e)>>2]=o,r[E+4>>2]=a,1==(0|n))return 0|(E=0);o=1;do{w=0|r[(b=t+(o<<3)|0)+4>>2],r[(E=e+(o<<3)|0)>>2]=r[b>>2],r[E+4>>2]=w,o=o+1|0}while((0|o)!=(0|n));return 0|(o=0)}be(0|(w=0|he(b=n<<3)),0|t,0|b),i=0|fe(n,8),o=n;t:for(;;){v=0|ye(0|(p=0|r[(u=w)>>2]),0|(u=0|r[u+4>>2]),52),x(),_=(v&=15)+-1|0,y=(0|o)>0;e:do{if(y){if(m=((0|o)<0)<<31>>31,A=0|ve(0|_,0,52),g=0|x(),_>>>0>15)for(a=0,t=p,n=u;;){if(!(0==(0|t)&0==(0|n))){if(s=0|ye(0|t,0|n,52),x(),c=(0|(s&=15))<(0|_),s=(0|s)==(0|_),n=0|me(0|(h=c?0:s?t:0),0|(t=c?0:s?n:0),0|o,0|m),x(),0==(0|(l=0|r[(c=s=i+(n<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2])))n=h;else for(A=0,d=n,f=l,n=h,l=s;;){if((0|A)>(0|o)){E=33;break t}if((0|f)==(0|n)&(-117440513&c|0)==(0|t)){if(s=0|ye(0|f,0|c,56),x(),7==(0|(s&=7))){E=38;break t}g=0|ve(s+1|0,0,56),t=0|x()|-117440513&t,r[l>>2]=0,r[l+4>>2]=0,l=d,n|=g}else l=(d+1|0)%(0|o)|0;if(0==(0|(f=0|r[(c=s=i+(l<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2])))break;A=A+1|0,d=l,l=s}r[(g=s)>>2]=n,r[g+4>>2]=t}if((0|(a=a+1|0))>=(0|o))break e;t=0|r[(n=w+(a<<3)|0)>>2],n=0|r[n+4>>2]}for(a=0,t=p,n=u;;){if(!(0==(0|t)&0==(0|n))){if(c=0|ye(0|t,0|n,52),x(),(0|(c&=15))>=(0|_)){if((0|c)!=(0|_)&&(t|=A,n=-15728641&n|g,c>>>0>=v>>>0)){s=_;do{d=0|ve(7,0,3*(14-s|0)|0),s=s+1|0,t|=d,n=0|x()|n}while(s>>>0<c>>>0)}}else t=0,n=0;if(c=0|me(0|t,0|n,0|o,0|m),x(),!(0==(0|(h=0|r[(l=s=i+(c<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2]))))for(d=0,f=h,h=s;;){if((0|d)>(0|o)){E=33;break t}if((0|f)==(0|t)&(-117440513&l|0)==(0|n)){if(s=0|ye(0|f,0|l,56),x(),7==(0|(s&=7))){E=38;break t}f=0|ve(s+1|0,0,56),n=0|x()|-117440513&n,r[h>>2]=0,r[h+4>>2]=0,t|=f}else c=(c+1|0)%(0|o)|0;if(0==(0|(f=0|r[(l=s=i+(c<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2])))break;d=d+1|0,h=s}r[(d=s)>>2]=t,r[d+4>>2]=n}if((0|(a=a+1|0))>=(0|o))break e;t=0|r[(n=w+(a<<3)|0)>>2],n=0|r[n+4>>2]}}}while(0);if((o+5|0)>>>0<11){E=84;break}m=0|he(((0|o)/6|0)<<3);e:do{if(y){A=0,d=0;do{if(!(0==(0|(a=0|r[(t=c=i+(A<<3)|0)>>2]))&0==(0|(t=0|r[t+4>>2])))){l=0|ye(0|a,0|t,56),x(),n=(l&=7)+1|0,h=-117440513&t,g=0|ye(0|a,0|t,45),x();n:do{if(0|k(127&g)){if(f=0|ye(0|a,0|t,52),x(),0|(f&=15))for(s=1;;){if(!(0==(a&(g=0|ve(7,0,3*(15-s|0)|0))|0)&0==(h&(0|x())|0)))break n;if(!(s>>>0<f>>>0))break;s=s+1|0}a|=t=0|ve(0|n,0,56),t=0|x()|h,r[(n=c)>>2]=a,r[n+4>>2]=t,n=l+2|0}}while(0);7==(0|n)&&(r[(g=m+(d<<3)|0)>>2]=a,r[g+4>>2]=-117440513&t,d=d+1|0)}A=A+1|0}while((0|A)!=(0|o));if(y){if(g=((0|o)<0)<<31>>31,f=0|ve(0|_,0,52),A=0|x(),_>>>0>15)for(t=0,a=0;;){do{if(!(0==(0|p)&0==(0|u))){for(l=0|ye(0|p,0|u,52),x(),s=(0|(l&=15))<(0|_),l=(0|l)==(0|_),s=0|me(0|(c=s?0:l?p:0),0|(l=s?0:l?u:0),0|o,0|g),x(),n=0;;){if((0|n)>(0|o)){E=83;break t}if((-117440513&(h=0|r[(v=i+(s<<3)|0)+4>>2])|0)==(0|l)&&(0|r[v>>2])==(0|c)){E=55;break}if((0|r[(v=i+((s=(s+1|0)%(0|o)|0)<<3)|0)>>2])==(0|c)&&(0|r[v+4>>2])==(0|l))break;n=n+1|0}if(55==(0|E)&&(E=0,!0&100663296==(117440512&h|0)))break;r[(v=e+(a<<3)|0)>>2]=p,r[v+4>>2]=u,a=a+1|0}}while(0);if((0|(t=t+1|0))>=(0|o)){o=d;break e}p=0|r[(u=w+(t<<3)|0)>>2],u=0|r[u+4>>2]}for(t=0,a=0;;){do{if(!(0==(0|p)&0==(0|u))){if(l=0|ye(0|p,0|u,52),x(),(0|(l&=15))>=(0|_))if((0|l)!=(0|_))if(n=p|f,s=-15728641&u|A,l>>>0<v>>>0)l=s;else{c=_;do{y=0|ve(7,0,3*(14-c|0)|0),c=c+1|0,n|=y,s=0|x()|s}while(c>>>0<l>>>0);l=s}else n=p,l=u;else n=0,l=0;for(c=0|me(0|n,0|l,0|o,0|g),x(),s=0;;){if((0|s)>(0|o)){E=83;break t}if((-117440513&(h=0|r[(y=i+(c<<3)|0)+4>>2])|0)==(0|l)&&(0|r[y>>2])==(0|n)){E=78;break}if((0|r[(y=i+((c=(c+1|0)%(0|o)|0)<<3)|0)>>2])==(0|n)&&(0|r[y+4>>2])==(0|l))break;s=s+1|0}if(78==(0|E)&&(E=0,!0&100663296==(117440512&h|0)))break;r[(y=e+(a<<3)|0)>>2]=p,r[y+4>>2]=u,a=a+1|0}}while(0);if((0|(t=t+1|0))>=(0|o)){o=d;break e}p=0|r[(u=w+(t<<3)|0)>>2],u=0|r[u+4>>2]}}else a=0,o=d}else a=0,o=0}while(0);if(xe(0|i,0,0|b),be(0|w,0|m,o<<3|0),pe(m),!o)break;e=e+(a<<3)|0}return 33==(0|E)?(pe(w),pe(i),0|(E=-1)):38==(0|E)?(pe(w),pe(i),0|(E=-2)):83==(0|E)?(pe(m),pe(w),pe(i),0|(E=-1)):(84==(0|E)&&be(0|e,0|w,o<<3|0),pe(w),pe(i),0|(E=0))},_destroyLinkedPolygon:function(t){var e=0,n=0,i=0,o=0;if(t|=0)for(i=1;;){if(0|(e=0|r[t>>2]))do{if(0|(n=0|r[e>>2]))do{o=n,n=0|r[n+16>>2],pe(o)}while(0!=(0|n));o=e,e=0|r[e+8>>2],pe(o)}while(0!=(0|e));if(e=t,t=0|r[t+8>>2],i||pe(e),!t)break;i=0}},_edgeLengthKm:function(t){return+ +o[20752+((t|=0)<<3)>>3]},_edgeLengthM:function(t){return+ +o[20880+((t|=0)<<3)>>3]},_emscripten_replace_memory:function(t){return i=new Int8Array(t),new Uint8Array(t),r=new Int32Array(t),new Float32Array(t),o=new Float64Array(t),n=t,!0},_experimentalH3ToLocalIj:function(t,e,n,i,r){var o,a;return r|=0,a=C,C=C+16|0,(t=0|Zt(t|=0,e|=0,n|=0,i|=0,o=a))||(lt(o,r),t=0),C=a,0|t},_experimentalLocalIjToH3:function(t,e,n,i){var r,o;return t|=0,e|=0,i|=0,r=C,C=C+16|0,ht(n|=0,o=r),i=0|Qt(t,e,o,i),C=r,0|i},_free:pe,_geoToH3:zt,_getDestinationH3IndexFromUnidirectionalEdge:function(t,e){t|=0;var n,i,o=0;return n=C,C=C+16|0,o=n,!0&268435456==(2013265920&(e|=0)|0)?(i=0|ye(0|t,0|e,56),x(),r[o>>2]=0,o=0|R(t,-2130706433&e|134217728,7&i,o),e=0|x(),b(0|e),C=n,0|o):(o=0,b(0|(e=0)),C=n,0|o)},_getH3IndexesFromUnidirectionalEdge:function(t,e,n){t|=0;var i,o,a,s,u=0;a=C,C=C+16|0,i=a,s=!0&268435456==(2013265920&(e|=0)|0),o=-2130706433&e|134217728,r[(u=n|=0)>>2]=s?t:0,r[u+4>>2]=s?o:0,s?(e=0|ye(0|t,0|e,56),x(),r[i>>2]=0,t=0|R(t,o,7&e,i),e=0|x()):(t=0,e=0),r[(u=n+8|0)>>2]=t,r[u+4>>2]=e,C=a},_getH3UnidirectionalEdge:function(t,e,n,i){var o,a,s=0,u=0;if(a=C,C=C+16|0,o=a,!(0|Gt(t|=0,e|=0,n|=0,i|=0)))return s=0,b(0|(t=0)),C=a,0|s;if(s=-2130706433&e,r[o>>2]=0,(0|(u=0|R(t,e,1,o)))==(0|n)&(0|x())==(0|i))e=0,n=16777216;else if(r[o>>2]=0,(0|(u=0|R(t,e,2,o)))==(0|n)&(0|x())==(0|i))e=0,n=33554432;else if(r[o>>2]=0,(0|(u=0|R(t,e,3,o)))==(0|n)&(0|x())==(0|i))e=0,n=50331648;else if(r[o>>2]=0,(0|(u=0|R(t,e,4,o)))==(0|n)&(0|x())==(0|i))e=0,n=67108864;else if(r[o>>2]=0,(0|(u=0|R(t,e,5,o)))==(0|n)&(0|x())==(0|i))e=0,n=83886080;else{if(r[o>>2]=0,!((0|(u=0|R(t,e,6,o)))==(0|n)&(0|x())==(0|i)))return u=0,b(0|(s=0)),C=a,0|u;e=0,n=100663296}return u=t|e,b(0|(s=s|n|268435456)),C=a,0|u},_getH3UnidirectionalEdgeBoundary:function(t,e,n){t|=0,e|=0,n|=0;var i,o,a=0,s=0,u=0,c=0,l=0,h=0;if(o=C,C=C+368|0,s=o+352|0,l=o+16|0,h=o,xe(0|(i=o+184|0),0,168),xe(0|l,0,168),r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,a=-2130706433&e|134217728,Vt((c=!0&268435456==(2013265920&e|0))?t:0,c?a:0,i),c?(e=0|ye(0|t,0|e,56),x(),r[s>>2]=0,t=0|R(t,a,7&e,s),e=0|x()):(t=0,e=0),Vt(t,e,l),(0|r[i>>2])<=0)return h=0,r[n>>2]=h,void(C=o);c=i+24|0,t=0,e=0,u=0;do{s=i+8+(u<<4)|0;t:do{if((0|r[l>>2])>0){for(a=0;!(0|wt(s,l+8+(a<<4)|0,1e-6));)if((0|(a=a+1|0))>=(0|r[l>>2]))break t;e:do{if(!u){if((0|r[l>>2])>0){a=0;do{if(0|wt(c,l+8+(a<<4)|0,1e-6))break e;a=a+1|0}while((0|a)<(0|r[l>>2]))}r[h>>2]=r[s>>2],r[h+4>>2]=r[s+4>>2],r[h+8>>2]=r[s+8>>2],r[h+12>>2]=r[s+12>>2],e=1;break t}}while(0);r[(a=n+8+(t<<4)|0)>>2]=r[s>>2],r[a+4>>2]=r[s+4>>2],r[a+8>>2]=r[s+8>>2],r[a+12>>2]=r[s+12>>2],t=t+1|0}}while(0);u=u+1|0}while((0|u)<(0|r[i>>2]));if(!e)return h=t,r[n>>2]=h,void(C=o);r[(l=n+8+(t<<4)|0)>>2]=r[h>>2],r[l+4>>2]=r[h+4>>2],r[l+8>>2]=r[h+8>>2],r[l+12>>2]=r[h+12>>2],h=t+1|0,r[n>>2]=h,C=o},_getH3UnidirectionalEdgesFromHexagon:function(t,e,n){n|=0;var i,o=0;i=0==(0|Ot(t|=0,e|=0)),e&=-2130706433,r[(o=n)>>2]=i?t:0,r[o+4>>2]=i?285212672|e:0,r[(o=n+8|0)>>2]=t,r[o+4>>2]=301989888|e,r[(o=n+16|0)>>2]=t,r[o+4>>2]=318767104|e,r[(o=n+24|0)>>2]=t,r[o+4>>2]=335544320|e,r[(o=n+32|0)>>2]=t,r[o+4>>2]=352321536|e,r[(n=n+40|0)>>2]=t,r[n+4>>2]=369098752|e},_getOriginH3IndexFromUnidirectionalEdge:function(t,e){var n;return t|=0,b(0|((n=!0&268435456==(2013265920&(e|=0)|0))?-2130706433&e|134217728:0)),0|(n?t:0)},_getPentagonIndexes:function(t,e){e|=0;var n,i=0,o=0,a=0,s=0,u=0,c=0;if(ve(0|(t|=0),0,52),n=134225919|x(),(0|t)<1){o=0,i=0;do{0|k(o)&&(ve(0|o,0,45),u=0|n|x(),r[(t=e+(i<<3)|0)>>2]=-1,r[t+4>>2]=u,i=i+1|0),o=o+1|0}while(122!=(0|o))}else{u=0,i=0;do{if(0|k(u)){for(ve(0|u,0,45),o=1,a=-1,s=0|n|x();a&=~(c=0|ve(7,0,3*(15-o|0)|0)),s&=~(0|x()),(0|o)!=(0|t);)o=o+1|0;r[(c=e+(i<<3)|0)>>2]=a,r[c+4>>2]=s,i=i+1|0}u=u+1|0}while(122!=(0|u))}},_getRes0Indexes:function(t){t|=0;var e=0,n=0,i=0;e=0;do{ve(0|e,0,45),i=134225919|x(),r[(n=t+(e<<3)|0)>>2]=-1,r[n+4>>2]=i,e=e+1|0}while(122!=(0|e))},_h3Distance:function(t,e,n,i){var r,o,a;return n|=0,i|=0,a=C,C=C+32|0,o=a,t=0==(0|Zt(t|=0,e|=0,t,e,r=a+12|0))&&0==(0|Zt(t,e,n,i,o))?0|ct(r,o):-1,C=a,0|t},_h3GetBaseCell:function(t,e){return e=0|ye(0|(t|=0),0|(e|=0),45),x(),127&e|0},_h3GetFaces:function t(e,n,i){i|=0;var o,a=0,s=0,u=0,c=0,l=0,h=0,p=0,f=0;o=C,C=C+128|0,p=o+112|0,u=o+96|0,f=o,s=0|ye(0|(e|=0),0|(n|=0),52),x(),l=15&s,r[p>>2]=l,c=0|ye(0|e,0|n,45),x(),c&=127;t:do{if(0|k(c)){if(0|l)for(a=1;;){if(!(0==((h=0|ve(7,0,3*(15-a|0)|0))&e|0)&0==((0|x())&n|0))){s=0;break t}if(!(a>>>0<l>>>0))break;a=a+1|0}if(!(1&s))return h=0|ve(l+1|0,0,52),f=0|x()|-15728641&n,t((h|e)&~(p=0|ve(7,0,3*(14-l|0)|0)),f&~(0|x()),i),void(C=o);s=1}else s=0}while(0);jt(e,n,u),s?(mt(u,p,f),h=5):(bt(u,p,f),h=6);t:do{if(0|k(c))if(l)for(a=1;;){if(!(0==((c=0|ve(7,0,3*(15-a|0)|0))&e|0)&0==((0|x())&n|0))){a=8;break t}if(!(a>>>0<l>>>0)){a=20;break}a=a+1|0}else a=20;else a=8}while(0);if(xe(0|i,-1,0|a),s){s=0;do{for(vt(u=f+(s<<4)|0,0|r[p>>2]),u=0|r[u>>2],a=0;!(-1==(0|(l=0|r[(c=i+(a<<2)|0)>>2]))|(0|l)==(0|u));)a=a+1|0;r[c>>2]=u,s=s+1|0}while((0|s)!=(0|h))}else{s=0;do{for(yt(u=f+(s<<4)|0,0|r[p>>2],0,1),u=0|r[u>>2],a=0;!(-1==(0|(l=0|r[(c=i+(a<<2)|0)>>2]))|(0|l)==(0|u));)a=a+1|0;r[c>>2]=u,s=s+1|0}while((0|s)!=(0|h))}C=o},_h3IndexesAreNeighbors:Gt,_h3IsPentagon:Ot,_h3IsResClassIII:function(t,e){return e=0|ye(0|(t|=0),0|(e|=0),52),x(),1&e|0},_h3IsValid:Mt,_h3Line:function(t,e,n,i,o){n|=0,i|=0,o|=0;var a,s=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0,x=0,w=0,E=0;if(a=C,C=C+48|0,c=a+12|0,w=a,0==(0|Zt(t|=0,e|=0,t,e,s=a+24|0))&&0==(0|Zt(t,e,n,i,c))){if((0|(x=0|ct(s,c)))<0)return C=a,0|(w=x);for(r[s>>2]=0,r[s+4>>2]=0,r[s+8>>2]=0,r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,Zt(t,e,t,e,s),Zt(t,e,n,i,c),pt(s),pt(c),x?(g=+(0|x),b=s,n=f=0|r[s>>2],i=d=0|r[(v=s+4|0)>>2],s=A=0|r[(_=s+8|0)>>2],m=+((0|r[c>>2])-f|0)/g,y=+((0|r[c+4>>2])-d|0)/g,g=+((0|r[c+8>>2])-A|0)/g):(v=i=s+4|0,_=A=s+8|0,b=s,n=0|r[s>>2],i=0|r[i>>2],s=0|r[A>>2],m=0,y=0,g=0),r[w>>2]=n,r[(A=w+4|0)>>2]=i,r[(d=w+8|0)>>2]=s,f=0;;){E=m*(h=+(0|f))+ +(0|n),l=y*h+ +(0|r[v>>2]),h=g*h+ +(0|r[_>>2]),i=~~+_e(+E),c=~~+_e(+l),n=~~+_e(+h),E=+u(+(+(0|i)-E)),l=+u(+(+(0|c)-l)),h=+u(+(+(0|n)-h));do{if(!(E>l&E>h)){if(p=0-i|0,l>h){s=p-n|0;break}s=c,n=p-c|0;break}i=0-(c+n)|0,s=c}while(0);if(r[w>>2]=i,r[A>>2]=s,r[d>>2]=n,ft(w),Qt(t,e,w,o+(f<<3)|0),(0|f)==(0|x))break;f=f+1|0,n=0|r[b>>2]}return C=a,0|(w=0)}return C=a,0|(w=-1)},_h3LineSize:function(t,e,n,i){var r,o,a;return n|=0,i|=0,a=C,C=C+32|0,o=a,t=0==(0|Zt(t|=0,e|=0,t,e,r=a+12|0))&&0==(0|Zt(t,e,n,i,o))?0|ct(r,o):-1,C=a,(t>>>31^1)+t|0},_h3SetToLinkedGeo:function(t,e,n){n|=0;var i,o,a,s=0;if(a=C,C=C+32|0,i=a,function(t,e,n){t|=0,n|=0;var i,o,a=0,s=0,u=0,c=0,l=0;if(o=C,C=C+176|0,i=o,(0|(e|=0))<1)return ie(n,0,0),void(C=o);c=0|ye(0|r[(c=t)>>2],0|r[c+4>>2],52),x(),ie(n,(0|e)>6?e:6,15&c),c=0;do{if(Vt(0|r[(a=t+(c<<3)|0)>>2],0|r[a+4>>2],i),(0|(a=0|r[i>>2]))>0){l=0;do{u=i+8+(l<<4)|0,(s=0|ue(n,a=i+8+(((0|(l=l+1|0))%(0|a)|0)<<4)|0,u))?ae(n,s):se(n,u,a),a=0|r[i>>2]}while((0|l)<(0|a))}c=c+1|0}while((0|c)!=(0|e));C=o}(t|=0,e|=0,o=a+16|0),r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,!(t=0|oe(o)))return qt(n),re(o),void(C=a);do{e=0|Wt(n);do{Ht(e,t),s=t+16|0,r[i>>2]=r[s>>2],r[i+4>>2]=r[s+4>>2],r[i+8>>2]=r[s+8>>2],r[i+12>>2]=r[s+12>>2],ae(o,t),t=0|ce(o,i)}while(0!=(0|t));t=0|oe(o)}while(0!=(0|t));qt(n),re(o),C=a},_h3ToCenterChild:function(t,e,n){n|=0;var i=0,r=0;if(i=0|ye(0|(t|=0),0|(e|=0),52),x(),(0|n)<16&(0|(i&=15))<=(0|n)){if((0|i)!=(0|n)&&(t|=r=0|ve(0|n,0,52),e=0|x()|-15728641&e,(0|i)<(0|n)))do{r=0|ve(7,0,3*(14-i|0)|0),i=i+1|0,t&=~r,e&=~(0|x())}while((0|i)<(0|n))}else e=0,t=0;return b(0|e),0|t},_h3ToChildren:It,_h3ToGeo:Ut,_h3ToGeoBoundary:Vt,_h3ToParent:Ct,_h3UnidirectionalEdgeIsValid:function(t,e){var n=0;if(!(!0&268435456==(2013265920&(e|=0)|0)))return 0|(n=0);switch(n=0|ye(0|(t|=0),0|e,56),x(),7&n){case 0:case 7:return 0|(n=0)}return!0&16777216==(117440512&e|0)&0!=(0|Ot(t,n=-2130706433&e|134217728))?0|(n=0):0|(n=0|Mt(t,n))},_hexAreaKm2:function(t){return+ +o[20496+((t|=0)<<3)>>3]},_hexAreaM2:function(t){return+ +o[20624+((t|=0)<<3)>>3]},_hexRing:function(t,e,n,i){t|=0,e|=0,i|=0;var o,a=0,s=0,u=0,c=0,l=0,h=0,p=0;if(o=C,C=C+16|0,p=o,!(n|=0))return r[(p=i)>>2]=t,r[p+4>>2]=e,C=o,0|(p=0);r[p>>2]=0;t:do{if(0|Ot(t,e))t=1;else{if(s=(0|n)>0){a=0,h=t;do{if(0==(0|(h=0|R(h,e,4,p)))&0==(0|(e=0|x()))){t=2;break t}if(a=a+1|0,0|Ot(h,e)){t=1;break t}}while((0|a)<(0|n));if(r[(l=i)>>2]=h,r[l+4>>2]=e,l=n+-1|0,s){s=0,u=1,a=h,t=e;do{if(0==(0|(a=0|R(a,t,2,p)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=i+(u<<3)|0)>>2]=a,r[c+4>>2]=t,u=u+1|0,0|Ot(a,t)){t=1;break t}s=s+1|0}while((0|s)<(0|n));c=0,s=u;do{if(0==(0|(a=0|R(a,t,3,p)))&0==(0|(t=0|x()))){t=2;break t}if(r[(u=i+(s<<3)|0)>>2]=a,r[u+4>>2]=t,s=s+1|0,0|Ot(a,t)){t=1;break t}c=c+1|0}while((0|c)<(0|n));u=0;do{if(0==(0|(a=0|R(a,t,1,p)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=i+(s<<3)|0)>>2]=a,r[c+4>>2]=t,s=s+1|0,0|Ot(a,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));u=0;do{if(0==(0|(a=0|R(a,t,5,p)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=i+(s<<3)|0)>>2]=a,r[c+4>>2]=t,s=s+1|0,0|Ot(a,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));u=0;do{if(0==(0|(a=0|R(a,t,4,p)))&0==(0|(t=0|x()))){t=2;break t}if(r[(c=i+(s<<3)|0)>>2]=a,r[c+4>>2]=t,s=s+1|0,0|Ot(a,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));for(u=0;;){if(0==(0|(a=0|R(a,t,6,p)))&0==(0|(t=0|x()))){t=2;break t}if((0|u)!=(0|l)){if(r[(c=i+(s<<3)|0)>>2]=a,r[c+4>>2]=t,0|Ot(a,t)){t=1;break t}s=s+1|0}if((0|(u=u+1|0))>=(0|n)){u=h,s=e;break}}}else u=h,a=h,s=e,t=e}else r[(u=i)>>2]=t,r[u+4>>2]=e,u=t,a=t,s=e,t=e;t=1&((0|u)!=(0|a)|(0|s)!=(0|t))}}while(0);return C=o,0|(p=t)},_i64Subtract:de,_kRing:I,_kRingDistances:function(t,e,n,i,r){var o;t|=0,e|=0,i|=0,r|=0,o=1+(0|v(3*(n|=0)|0,n+1|0))|0,0|O(t,e,n,i,r)&&(xe(0|i,0,o<<3|0),xe(0|r,0,o<<2|0),L(t,e,n,i,r,o,0))},_llvm_round_f64:_e,_malloc:he,_maxFaceCount:function(t,e){var n=0,i=0;if(i=0|ye(0|(t|=0),0|(e|=0),45),x(),!(0|k(127&i)))return 0|(i=2);if(i=0|ye(0|t,0|e,52),x(),!(i&=15))return 0|(i=5);for(n=1;;){if(!(0==((0|ve(7,0,3*(15-n|0)|0))&t|0)&0==((0|x())&e|0))){n=2,t=6;break}if(!(n>>>0<i>>>0)){n=5,t=6;break}n=n+1|0}return 6==(0|t)?0|n:0},_maxH3ToChildrenSize:function(t,e,n){return n|=0,t=0|ye(0|(t|=0),0|(e|=0),52),x(),(0|n)<16&(0|(t&=15))<=(0|n)?0|(n=0|Yt(7,n-t|0)):0|(n=0)},_maxKringSize:function(t){return 1+(0|v(3*(t|=0)|0,t+1|0))|0},_maxPolyfillSize:function(t,e){var n,i;return e|=0,n=C,C=C+32|0,Jt(t|=0,i=n),e=0|G(i,e),e=1+(0|v(3*e|0,e+1|0))|0,C=n,0|e},_maxUncompactSize:function(t,e,n){t|=0,n|=0;var i=0,o=0,a=0,s=0;if((0|(e|=0))<=0)return 0|(n=0);if((0|n)>=16){for(i=0;;){if(!(0==(0|r[(s=t+(i<<3)|0)>>2])&0==(0|r[s+4>>2]))){i=-1,o=13;break}if((0|(i=i+1|0))>=(0|e)){i=0,o=13;break}}if(13==(0|o))return 0|i}i=0,s=0;t:for(;;){a=0|r[(o=t+(s<<3)|0)>>2],o=0|r[o+4>>2];do{if(!(0==(0|a)&0==(0|o))){if(o=0|ye(0|a,0|o,52),x(),(0|(o&=15))>(0|n)){i=-1,o=13;break t}if((0|o)==(0|n)){i=i+1|0;break}i=(0|Yt(7,n-o|0))+i|0;break}}while(0);if((0|(s=s+1|0))>=(0|e)){o=13;break}}return 13==(0|o)?0|i:0},_memcpy:be,_memset:xe,_numHexagons:function(t){var e;return t=0|r[(e=21008+((t|=0)<<3)|0)>>2],b(0|r[e+4>>2]),0|t},_pentagonIndexCount:function(){return 12},_polyfill:function(t,e,n){e|=0,n|=0;var i,a,s,c,l=0,h=0,p=0,f=0,d=0,A=0;if(c=C,C=C+32|0,l=c+16|0,a=c,(s=0|he(32+(r[(t|=0)+8>>2]<<5)|0))||w(22487,22096,678,22104),function(t,e){e|=0;var n,i=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,d=0,A=0,g=0,m=0,y=0,v=0,_=0,b=0,x=0,w=0,E=0,T=0,S=0;if(y=0|r[(t=t|0)>>2]){if(o[(v=e+8|0)>>3]=17976931348623157e292,o[(_=e+24|0)>>3]=17976931348623157e292,o[e>>3]=-17976931348623157e292,o[(b=e+16|0)>>3]=-17976931348623157e292,(0|y)>0){for(s=0|r[t+4>>2],g=17976931348623157e292,m=-17976931348623157e292,a=0,i=-1,p=17976931348623157e292,f=17976931348623157e292,A=-17976931348623157e292,l=-17976931348623157e292,x=0;c=+o[s+(x<<4)>>3],d=+o[s+(x<<4)+8>>3],h=+o[s+(((0|(T=i+2|0))==(0|y)?0:T)<<4)+8>>3],c<p&&(o[v>>3]=c,p=c),d<f&&(o[_>>3]=d,f=d),c>A?o[e>>3]=c:c=A,d>l&&(o[b>>3]=d,l=d),g=d>0&d<g?d:g,m=d<0&d>m?d:m,a|=+u(+(d-h))>3.141592653589793,(0|(i=x+1|0))!=(0|y);)T=x,A=c,x=i,i=T;a&&(o[b>>3]=m,o[_>>3]=g)}}else r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,r[e+28>>2]=0;if((0|(i=0|r[(T=t+8|0)>>2]))<=0)return;n=t+12|0,E=0;do{if(s=0|r[n>>2],a=E,_=e+((E=E+1|0)<<5)|0,b=0|r[s+(a<<3)>>2]){if(o[(x=e+(E<<5)+8|0)>>3]=17976931348623157e292,o[(t=e+(E<<5)+24|0)>>3]=17976931348623157e292,o[_>>3]=-17976931348623157e292,o[(w=e+(E<<5)+16|0)>>3]=-17976931348623157e292,(0|b)>0){for(y=0|r[s+(a<<3)+4>>2],g=17976931348623157e292,m=-17976931348623157e292,s=0,a=-1,v=0,p=17976931348623157e292,f=17976931348623157e292,d=-17976931348623157e292,l=-17976931348623157e292;c=+o[y+(v<<4)>>3],A=+o[y+(v<<4)+8>>3],h=+o[y+(((0|(a=a+2|0))==(0|b)?0:a)<<4)+8>>3],c<p&&(o[x>>3]=c,p=c),A<f&&(o[t>>3]=A,f=A),c>d?o[_>>3]=c:c=d,A>l&&(o[w>>3]=A,l=A),g=A>0&A<g?A:g,m=A<0&A>m?A:m,s|=+u(+(A-h))>3.141592653589793,(0|(a=v+1|0))!=(0|b);)S=v,v=a,d=c,a=S;s&&(o[w>>3]=m,o[t>>3]=g)}}else r[_>>2]=0,r[_+4>>2]=0,r[_+8>>2]=0,r[_+12>>2]=0,r[_+16>>2]=0,r[_+20>>2]=0,r[_+24>>2]=0,r[_+28>>2]=0,i=0|r[T>>2]}while((0|E)<(0|i))}(t,s),f=0|G(s,e),i=(d=0|v(3*f|0,f+1|0))+1|0,function(t,e){t|=0;var n,i=0;o[(e=e|0)>>3]=.5*(+o[t>>3]+ +o[t+8>>3]),i=+o[t+16>>3],n=+o[t+24>>3],i=+St(.5*(n+(i<n?i+6.283185307179586:i))),o[e+8>>3]=i}(s,l),0|O(e=0|zt(l,e),l=0|x(),f,n,p=0|he(h=i<<2))&&(xe(0|n,0,i<<3|0),xe(0|p,0,0|h),L(e,l,f,n,p,i,0)),pe(p),(0|d)<0)return pe(s),void(C=c);l=a+8|0,e=0;do{0==(0|(p=0|r[(f=h=n+(e<<3)|0)>>2]))&0==(0|(f=0|r[f+4>>2]))||(Ut(p,f,a),A=+Tt(+o[a>>3]),o[a>>3]=A,A=+St(+o[l>>3]),o[l>>3]=A,0|$t(t,s,a))||(r[(d=h)>>2]=0,r[d+4>>2]=0),e=e+1|0}while((0|e)!=(0|i));pe(s),C=c},_res0IndexCount:function(){return 122},_round:we,_sbrk:Ee,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(t,e,n,i,o){t|=0,n|=0,i|=0,o|=0;var a=0,s=0,u=0,c=0,l=0,h=0;if((0|(e|=0))<=0)return 0|(o=0);if((0|o)>=16){for(a=0;;){if(!(0==(0|r[(h=t+(a<<3)|0)>>2])&0==(0|r[h+4>>2]))){a=14;break}if((0|(a=a+1|0))>=(0|e)){s=0,a=16;break}}if(14==(0|a))return 0|((0|i)>0?-2:-1);if(16==(0|a))return 0|s}a=0,h=0;t:for(;;){s=0|r[(u=l=t+(h<<3)|0)>>2],u=0|r[u+4>>2];do{if(!(0==(0|s)&0==(0|u))){if((0|a)>=(0|i)){s=-1,a=16;break t}if(c=0|ye(0|s,0|u,52),x(),(0|(c&=15))>(0|o)){s=-2,a=16;break t}if((0|c)==(0|o)){r[(l=n+(a<<3)|0)>>2]=s,r[l+4>>2]=u,a=a+1|0;break}if((0|(s=(0|Yt(7,o-c|0))+a|0))>(0|i)){s=-1,a=16;break t}It(0|r[l>>2],0|r[l+4>>2],o,n+(a<<3)|0),a=s}}while(0);if((0|(h=h+1|0))>=(0|e)){s=0,a=16;break}}return 16==(0|a)?0|s:0},establishStackSpace:function(t,e){C=t|=0},stackAlloc:function(t){var e;return e=C,C=(C=C+(t|=0)|0)+15&-16,0|e},stackRestore:function(t){C=t|=0},stackSave:function(){return 0|C}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{a:ut,b:function(t){c=t},c:l,d:function(t,e,n,i){ut("Assertion failed: "+A(t)+", at: "+[e?A(e):"unknown filename",n,i?A(i):"unknown function"])},e:function(t){return n.___errno_location&&(_[n.___errno_location()>>2]=t),t},f:q,g:function(t,e,n){y.set(y.subarray(e,e+n),t)},h:function(t){var e=q();if(t>2130706432)return!1;for(var n=Math.max(e,16777216);n<t;)n=n<=536870912?w(2*n,16777216):Math.min(w((3*n+2147483648)/4,16777216),2130706432);return!!X(n)},i:function(t){ut("OOM")},j:G,k:W,l:X,m:H,n:function(){var t=H();return n.extraStackTrace&&(t+="\n"+n.extraStackTrace()),W(t)},o:23680,p:23664},g),$=(n.___uremdi3=J.___uremdi3,n._bitshift64Lshr=J._bitshift64Lshr,n._bitshift64Shl=J._bitshift64Shl,n._calloc=J._calloc,n._compact=J._compact,n._destroyLinkedPolygon=J._destroyLinkedPolygon,n._edgeLengthKm=J._edgeLengthKm,n._edgeLengthM=J._edgeLengthM,n._emscripten_replace_memory=J._emscripten_replace_memory),tt=(n._experimentalH3ToLocalIj=J._experimentalH3ToLocalIj,n._experimentalLocalIjToH3=J._experimentalLocalIjToH3,n._free=J._free,n._geoToH3=J._geoToH3,n._getDestinationH3IndexFromUnidirectionalEdge=J._getDestinationH3IndexFromUnidirectionalEdge,n._getH3IndexesFromUnidirectionalEdge=J._getH3IndexesFromUnidirectionalEdge,n._getH3UnidirectionalEdge=J._getH3UnidirectionalEdge,n._getH3UnidirectionalEdgeBoundary=J._getH3UnidirectionalEdgeBoundary,n._getH3UnidirectionalEdgesFromHexagon=J._getH3UnidirectionalEdgesFromHexagon,n._getOriginH3IndexFromUnidirectionalEdge=J._getOriginH3IndexFromUnidirectionalEdge,n._getPentagonIndexes=J._getPentagonIndexes,n._getRes0Indexes=J._getRes0Indexes,n._h3Distance=J._h3Distance,n._h3GetBaseCell=J._h3GetBaseCell,n._h3GetFaces=J._h3GetFaces,n._h3IndexesAreNeighbors=J._h3IndexesAreNeighbors,n._h3IsPentagon=J._h3IsPentagon,n._h3IsResClassIII=J._h3IsResClassIII,n._h3IsValid=J._h3IsValid,n._h3Line=J._h3Line,n._h3LineSize=J._h3LineSize,n._h3SetToLinkedGeo=J._h3SetToLinkedGeo,n._h3ToCenterChild=J._h3ToCenterChild,n._h3ToChildren=J._h3ToChildren,n._h3ToGeo=J._h3ToGeo,n._h3ToGeoBoundary=J._h3ToGeoBoundary,n._h3ToParent=J._h3ToParent,n._h3UnidirectionalEdgeIsValid=J._h3UnidirectionalEdgeIsValid,n._hexAreaKm2=J._hexAreaKm2,n._hexAreaM2=J._hexAreaM2,n._hexRing=J._hexRing,n._i64Subtract=J._i64Subtract,n._kRing=J._kRing,n._kRingDistances=J._kRingDistances,n._llvm_round_f64=J._llvm_round_f64,n._malloc=J._malloc,n._maxFaceCount=J._maxFaceCount,n._maxH3ToChildrenSize=J._maxH3ToChildrenSize,n._maxKringSize=J._maxKringSize,n._maxPolyfillSize=J._maxPolyfillSize,n._maxUncompactSize=J._maxUncompactSize,n._memcpy=J._memcpy,n._memset=J._memset,n._numHexagons=J._numHexagons,n._pentagonIndexCount=J._pentagonIndexCount,n._polyfill=J._polyfill,n._res0IndexCount=J._res0IndexCount,n._round=J._round,n._sbrk=J._sbrk,n._sizeOfCoordIJ=J._sizeOfCoordIJ,n._sizeOfGeoBoundary=J._sizeOfGeoBoundary,n._sizeOfGeoCoord=J._sizeOfGeoCoord,n._sizeOfGeoPolygon=J._sizeOfGeoPolygon,n._sizeOfGeofence=J._sizeOfGeofence,n._sizeOfH3Index=J._sizeOfH3Index,n._sizeOfLinkedGeoPolygon=J._sizeOfLinkedGeoPolygon,n._uncompact=J._uncompact,n.establishStackSpace=J.establishStackSpace,n.stackAlloc=J.stackAlloc),et=n.stackRestore=J.stackRestore,nt=n.stackSave=J.stackSave;if(n.asm=J,n.cwrap=function(t,e,n,i){var r=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&r&&!i?p(t):function(){return f(t,e,n,arguments)}},n.setValue=function(t,e,n,i){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":m[t>>0]=e;break;case"i16":v[t>>1]=e;break;case"i32":_[t>>2]=e;break;case"i64":N=[e>>>0,(z=e,+O(z)>=1?z>0?(0|k(+R(z/4294967296),4294967295))>>>0:~~+L((z-+(~~z>>>0))/4294967296)>>>0:0)],_[t>>2]=N[0],_[t+4>>2]=N[1];break;case"float":b[t>>2]=e;break;case"double":x[t>>3]=e;break;default:ut("invalid type for setValue: "+n)}},n.getValue=function(t,e,n){switch("*"===(e=e||"i8").charAt(e.length-1)&&(e="i32"),e){case"i1":case"i8":return m[t>>0];case"i16":return v[t>>1];case"i32":case"i64":return _[t>>2];case"float":return b[t>>2];case"double":return x[t>>3];default:ut("invalid type for getValue: "+e)}return null},n.getTempRet0=l,j){V(j)||(Y=j,j=n.locateFile?n.locateFile(Y,a):a+Y),D++,n.monitorRunDependencies&&n.monitorRunDependencies(D);var it=function(t){t.byteLength&&(t=new Uint8Array(t)),y.set(t,8),n.memoryInitializerRequest&&delete n.memoryInitializerRequest.response,function(t){if(D--,n.monitorRunDependencies&&n.monitorRunDependencies(D),0==D&&(null!==B&&(clearInterval(B),B=null),F)){var e=F;F=null,e()}}()},rt=function(){r(j,it,(function(){throw"could not load memory initializer "+j}))},ot=Q(j);if(ot)it(ot.buffer);else if(n.memoryInitializerRequest){var at=function(){var t=n.memoryInitializerRequest,e=t.response;if(200!==t.status&&0!==t.status){var i=Q(n.memoryInitializerRequestURL);if(!i)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+t.status+", retrying "+j),void rt();e=i.buffer}it(e)};n.memoryInitializerRequest.response?setTimeout(at,0):n.memoryInitializerRequest.addEventListener("load",at)}else rt()}function st(t){function e(){K||(K=!0,h||(S(M),S(C),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)t=n.postRun.shift(),I.unshift(t);var t;S(I)}()))}t=t||o,D>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)t=n.preRun.shift(),P.unshift(t);var t;S(P)}(),D>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),e()}),1)):e()))}function ut(t){throw n.onAbort&&n.onAbort(t),s(t+=""),u(t),h=!0,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if(F=function t(){K||st(),K||(F=t)},n.run=st,n.abort=ut,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return st(),t}("object"==typeof te?te:{}),ee="number",ne={};[["sizeOfH3Index",ee],["sizeOfGeoCoord",ee],["sizeOfGeoBoundary",ee],["sizeOfGeoPolygon",ee],["sizeOfGeofence",ee],["sizeOfLinkedGeoPolygon",ee],["sizeOfCoordIJ",ee],["h3IsValid","number",["number","number"]],["geoToH3","number",[ee,ee,"number"]],["h3ToGeo",null,["number","number",ee]],["h3ToGeoBoundary",null,["number","number",ee]],["maxKringSize",ee,[ee]],["kRing",null,["number","number",ee,ee]],["kRingDistances",null,["number","number",ee,ee,ee]],["hexRing",null,["number","number",ee,ee]],["maxPolyfillSize",ee,[ee,"number"]],["polyfill",null,[ee,"number",ee]],["h3SetToLinkedGeo",null,[ee,ee,ee]],["destroyLinkedPolygon",null,[ee]],["compact",ee,[ee,ee,ee]],["uncompact",ee,[ee,ee,ee,ee,"number"]],["maxUncompactSize",ee,[ee,ee,"number"]],["h3IsPentagon","number",["number","number"]],["h3IsResClassIII","number",["number","number"]],["h3GetBaseCell",ee,["number","number"]],["maxFaceCount",ee,["number","number"]],["h3GetFaces",null,["number","number",ee]],["h3ToParent","number",["number","number","number"]],["h3ToChildren",null,["number","number","number",ee]],["h3ToCenterChild","number",["number","number","number"]],["maxH3ToChildrenSize",ee,["number","number","number"]],["h3IndexesAreNeighbors","number",["number","number","number","number"]],["getH3UnidirectionalEdge","number",["number","number","number","number"]],["getOriginH3IndexFromUnidirectionalEdge","number",["number","number"]],["getDestinationH3IndexFromUnidirectionalEdge","number",["number","number"]],["h3UnidirectionalEdgeIsValid","number",["number","number"]],["getH3IndexesFromUnidirectionalEdge",null,["number","number",ee]],["getH3UnidirectionalEdgesFromHexagon",null,["number","number",ee]],["getH3UnidirectionalEdgeBoundary",null,["number","number",ee]],["h3Distance",ee,["number","number","number","number"]],["h3Line",ee,["number","number","number","number",ee]],["h3LineSize",ee,["number","number","number","number"]],["experimentalH3ToLocalIj",ee,["number","number","number","number",ee]],["experimentalLocalIjToH3",ee,["number","number",ee,ee]],["hexAreaM2",ee,["number"]],["hexAreaKm2",ee,["number"]],["edgeLengthM",ee,["number"]],["edgeLengthKm",ee,["number"]],["numHexagons",ee,["number"]],["getRes0Indexes",null,[ee]],["res0IndexCount",ee],["getPentagonIndexes",null,[ee,ee]],["pentagonIndexCount",ee]].forEach((function(t){ne[t[0]]=te.cwrap.apply(te,t)}));var ie=ne.sizeOfH3Index(),re=ne.sizeOfGeoCoord(),oe=ne.sizeOfGeoBoundary(),ae=(ne.sizeOfGeoPolygon(),ne.sizeOfGeofence(),ne.sizeOfLinkedGeoPolygon()),se=(ne.sizeOfCoordIJ(),"m"),ue="km";function ce(t){if("number"!=typeof t||t<0||t>15||Math.floor(t)!==t)throw new Error("Invalid resolution: "+t)}function le(t){if("string"!=typeof t)return[0,0];var e=parseInt(t.substring(0,t.length-8),16);return[parseInt(t.substring(t.length-8),16),e]}function he(t){if(t>=0)return t.toString(16);var e=fe(8,(t&=2147483647).toString(16));return e=(parseInt(e[0],16)+8).toString(16)+e.substring(1)}function pe(t,e){return he(e)+fe(8,he(t))}function fe(t,e){for(var n=t-e.length,i="",r=0;r<n;r++)i+="0";return i+=e}function de(t){return[t,te.getTempRet0()]}function Ae(t){var e=de(t),n=e[0],i=e[1];return i?pe(n,i):null}function ge(t,e,n){te.HEAPU32.set(le(t),e/4+2*n)}function me(t,e){for(var n=e.length,i=0;i<n;i++)ge(e[i],t,i)}function ye(t){return 180*te.getValue(t,"double")/Math.PI}function ve(t){return[ye(t),ye(t+8)]}function _e(t){return[ye(t+8),ye(t)]}function be(t,e,n){for(var i=te.getValue(t,"i32"),r=t+8,o=[],a=e?_e:ve,s=0;s<2*i;s+=2)o.push(a(r+8*s));return n&&o.push(o[0]),o}function xe(t){var e=le(t),n=e[0],i=e[1];return Boolean(ne.h3IsPentagon(n,i))}function we(t){var e=te._malloc(re),n=le(t),i=n[0],r=n[1];ne.h3ToGeo(i,r,e);var o=ve(e);return te._free(e),o}function Ee(t,e){if(!t||!t.length)return[];var n=t.length,i=te._calloc(n,ie);me(i,t);var r=te._calloc(ae),o=r;ne.h3SetToLinkedGeo(i,n,r);var a=function(t,e){for(var n,i,r,o,a=[],s=e?_e:ve;t;){for(a.push(n=[]),i=te.getValue(t,"i8*");i;){for(n.push(r=[]),o=te.getValue(i,"i8*");o;)r.push(s(o)),o=te.getValue(o+16,"i8*");e&&r.push(r[0]),i=te.getValue(i+8,"i8*")}t=te.getValue(t+8,"i8*")}return a}(r,e);return ne.destroyLinkedPolygon(o),te._free(o),te._free(i),a}function Te(t,e){switch(ce(t),e){case se:return ne.edgeLengthM(t);case ue:return ne.edgeLengthKm(t);default:throw new Error("Unknown unit: "+e)}}function Se(t){return t*Math.PI/180}var Pe=n(45);const Me={...a.a.defaultProps,getHexagons:{type:"accessor",value:t=>t.hexagons}};class Ce extends o.a{updateState({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagons){const{data:e,getHexagons:n}=t,i=[],{iterable:r,objectInfo:o}=Object(Pe.a)(e);for(const t of r){o.index++;const e=Ee(n(t,o),!0);for(const n of e)i.push(this.getSubLayerRow({polygon:n},t,o.index))}this.setState({polygons:i})}}renderLayers(){const{elevationScale:t,extruded:e,wireframe:n,filled:i,stroked:r,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:c,lineMiterLimit:l,lineDashJustified:h,material:p,getFillColor:f,getLineColor:d,getLineWidth:A,getLineDashArray:g,getElevation:m,transitions:y,updateTriggers:v}=this.props;return new(this.getSubLayerClass("cluster-region",a.a))({filled:i,wireframe:n,extruded:e,elevationScale:t,stroked:r,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:c,lineMiterLimit:l,lineDashJustified:h,material:p,transitions:y,getFillColor:this.getSubLayerAccessor(f),getLineColor:this.getSubLayerAccessor(d),getLineWidth:this.getSubLayerAccessor(A),getLineDashArray:this.getSubLayerAccessor(g),getElevation:this.getSubLayerAccessor(m)},this.getSubLayerProps({id:"cluster-region",updateTriggers:v}),{data:this.state.polygons,getPolygon:t=>t.polygon})}}Ce.defaultProps=Me,Ce.layerName="H3ClusterLayer";var Ie=n(154);function Oe(t,e){e=void 0===e?t[0][0]:e;for(const n of t){const t=n[0]-e;t>180?n[0]-=360:t<-180&&(n[0]+=360)}}function Le(t,e,n){const i=t(e,n),[r,o]=we(i);return[o,r]}function Re(t,e=1,n){const i=function(t,e){var n=te._malloc(oe),i=le(t),r=i[0],o=i[1];ne.h3ToGeoBoundary(r,o,n);var a=be(n,e,e);return te._free(n),a}(t,!0);if(1!==e?function(t,e,n){const[i,r]=we(t),o=e.length;Oe(e,r);const a=e[0]===e[o-1]?o-1:o;for(let t=0;t<a;t++)e[t][0]=Object(Rt.g)(r,e[t][0],n),e[t][1]=Object(Rt.g)(i,e[t][1],n)}(t,i,e):Oe(i),n){const t=new Float64Array(2*i.length);let e=0;for(const n of i)t[e++]=n[0],t[e++]=n[1];return t}return i}const ke={...a.a.defaultProps,highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};delete ke.getLineDashArray;class De extends o.a{shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,oldProps:e,changeFlags:n}){if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagon){let e=-1,n=!1,r=!1;const{iterable:o,objectInfo:a}=Object(Pe.a)(t.data);for(const s of o){a.index++;const o=t.getHexagon(s,a),u="string"!=typeof(i=o)?-1:parseInt(i.charAt(1),16);if(e<0)e=u;else if(e!==u){r=!0;break}if(xe(o)){n=!0;break}}this.setState({resolution:e,edgeLengthKM:e>=0?Te(e,ue):0,hasMultipleRes:r,hasPentagon:n})}var i;this._updateVertices(this.context.viewport)}_shouldUseHighPrecision(){const{resolution:t,hasPentagon:e,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return this.props.highPrecision||i.resolution||n||e||t>=0&&t<=5}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:e,edgeLengthKM:n,centerHex:i}=this.state;if(e<0)return;const r=this.props.centerHexagon||function(t,e,n){var i=te._malloc(re);te.HEAPF64.set([t,e].map(Se),i/8);var r=Ae(ne.geoToH3(i,n));return te._free(i),r}(t.latitude,t.longitude,e);if(i===r)return;if(i){const t=(o=r,a=le(i),s=a[0],u=a[1],c=le(o),l=c[0],h=c[1],ne.h3Distance(s,u,l,h));if(t>=0&&t*n<10)return}var o,a,s,u,c,l,h;const{unitsPerMeter:p}=t.distanceScales;let f=Re(r);const[d,A]=we(r),[g,m]=t.projectFlat([A,d]);f=f.map(e=>{const n=t.projectFlat(e);return[(n[0]-g)/p[0],(n[1]-m)/p[1]]}),this.setState({centerHex:r,vertices:f})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:e,coverage:n,extruded:i,wireframe:r,stroked:o,filled:a,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:c,lineWidthMaxPixels:l,getFillColor:h,getElevation:p,getLineColor:f,getLineWidth:d,transitions:A,updateTriggers:g}=this.props;return{elevationScale:t,extruded:i,coverage:n,wireframe:r,stroked:o,filled:a,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:c,lineWidthMaxPixels:l,material:e,getElevation:p,getFillColor:h,getLineColor:f,getLineWidth:d,transitions:A,updateTriggers:{getFillColor:g.getFillColor,getElevation:g.getElevation,getLineColor:g.getLineColor,getLineWidth:g.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:e,updateTriggers:n,coverage:i}=this.props,r=this.getSubLayerClass("hexagon-cell-hifi",a.a),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(t,e){let n;return n=null==t?e:"object"==typeof t?{...t,coverage:e}:{getHexagon:t,coverage:e},n}(n.getHexagon,i),new r(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(t,n)=>Re(e(t,n),i,!0)})}_renderColumnLayer(){const{data:t,getHexagon:e,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Ie.a),r=this._getForwardProps();return r.updateTriggers.getPosition=n.getHexagon,new i(r,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:r.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Le.bind(null,e)})}}De.defaultProps=ke,De.layerName="H3HexagonLayer";var Be=n(58),Fe=n(5),ze=n(221),Ne=n(218),je=n(223);function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Ve(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function We(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function He(t,e,n){return e&&We(t.prototype,e),n&&We(t,n),t}var qe=n(12),Xe=(Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Ze=new C.a;function Qe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xe;return Object(ut.f)(t)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z),e}function Ye(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ze;return Qe(t,e,ut.b._cartographicRadians?Xe:ut.j)}function Ke(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xe;return Object(ut.f)(e)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]),e}function Je(t,e){return Ke(t,e,ut.b._cartographicRadians?Xe:ut.i)}var $e=new C.a,tn=new C.a,en=new C.a;var nn=new C.a,rn={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},on={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},an={east:new C.a,north:new C.a,up:new C.a,west:new C.a,south:new C.a,down:new C.a},sn=new C.a,un=new C.a,cn=new C.a;function ln(t,e,n,i,r,o){var a,s,u,c=rn[e]&&rn[e][n];Object(st.a)(c&&(!i||i===c));var l=nn.copy(r);if(Object(ut.d)(l.x,0,1e-14)&&Object(ut.d)(l.y,0,1e-14)){var h=Math.sign(l.z);a=sn.fromArray(on[e]),"east"!==e&&"west"!==e&&a.scale(h),s=un.fromArray(on[n]),"east"!==n&&"west"!==n&&s.scale(h),u=cn.fromArray(on[i]),"east"!==i&&"west"!==i&&u.scale(h)}else{var p=an.up,f=an.east,d=an.north;f.set(-l.y,l.x,0).normalize(),t.geodeticSurfaceNormal(l,p),d.copy(p).cross(f);var A=an.west,g=an.south;an.down.copy(p).scale(-1),A.copy(f).scale(-1),g.copy(d).scale(-1),a=an[e],s=an[n],u=an[i]}return o[0]=a.x,o[1]=a.y,o[2]=a.z,o[3]=0,o[4]=s.x,o[5]=s.y,o[6]=s.z,o[7]=0,o[8]=u.x,o[9]=u.y,o[10]=u.z,o[11]=0,o[12]=l.x,o[13]=l.y,o[14]=l.z,o[15]=1,o}var hn,pn=new C.a,fn=new C.a,dn=new C.a,An=new C.a,gn=new C.a,mn=new C.a,yn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ge(this,t),Object(st.a)(e>=0),Object(st.a)(n>=0),Object(st.a)(i>=0),this.radii=new C.a(e,n,i),this.radiiSquared=new C.a(e*e,n*n,i*i),this.radiiToTheFourth=new C.a(e*e*e*e,n*n*n*n,i*i*i*i),this.oneOverRadii=new C.a(0===e?0:1/e,0===n?0:1/n,0===i?0:1/i),this.oneOverRadiiSquared=new C.a(0===e?0:1/(e*e),0===n?0:1/(n*n),0===i?0:1/(i*i)),this.minimumRadius=Math.min(e,n,i),this.maximumRadius=Math.max(e,n,i),this.centerToleranceSquared=Lt.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return He(t,null,[{key:"WGS84",get:function(){return hn=hn||new t(6378137,6378137,6356752.314245179)}}]),He(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=fn,i=dn,r=Ve(t,3),o=r[2];this.geodeticSurfaceNormalCartographic(t,n),i.copy(this.radiiSquared).scale(n);var a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(o),i.add(n),i.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];mn.from(t);var n=this.scaleToGeodeticSurface(mn,An);if(n){var i=this.geodeticSurfaceNormal(n,fn),r=gn;r.copy(mn).subtract(n);var o=Math.atan2(i.y,i.x),a=Math.asin(i.z),s=Math.sign(qe.d(r,mn))*qe.g(r);return Je([o,a,s],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vt.a;return ln(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new vt.a;return ln(this,t,e,n,i,r)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return pn.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=Ye(t),i=n[0],r=n[1],o=Math.cos(r);return pn.set(o*Math.cos(i),o*Math.sin(i),Math.sin(r)).normalize(),pn.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return pn.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.a,i=e.oneOverRadii,r=e.oneOverRadiiSquared,o=e.centerToleranceSquared;$e.from(t);var a=t.x,s=t.y,u=t.z,c=i.x,l=i.y,h=i.z,p=a*a*c*c,f=s*s*l*l,d=u*u*h*h,A=p+f+d,g=Math.sqrt(1/A);if(Number.isFinite(g)){var m=tn;if(m.copy(t).scale(g),A<o)return m.to(n);var y=r.x,v=r.y,_=r.z,b=en;b.set(m.x*y*2,m.y*v*2,m.z*_*2);var x,w,E,T,S=(1-g)*t.len()/(.5*b.len()),P=0;do{var M=(x=1/(1+(S-=P)*y))*x,I=(w=1/(1+S*v))*w,O=(E=1/(1+S*_))*E,L=M*x,R=I*w,k=O*E,D=p*L*y+f*R*v+d*k*_,B=-2*D;P=(T=p*M+f*I+d*O-1)/B}while(Math.abs(T)>Lt.a.EPSILON12);return $e.scale([x,w,E]).to(n)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];An.from(t);var n=An.x,i=An.y,r=An.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(n*n*o.x+i*i*o.y+r*r*o.z);return An.multiplyScalar(a).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return An.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return An.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(st.a)(Object(ut.d)(this.radii.x,this.radii.y,Lt.a.EPSILON15)),Object(st.a)(this.radii.z>0),An.from(t);var i=An.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return An.set(0,0,i).to(n)}}]),t}(),vn=n(172),_n=n(65),bn=n(9);class xn{constructor(t,e,n){this.item=t,this.previous=e,this.next=n}}class wn{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const e=new xn(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}function En(t){return null!=t}class Tn{constructor(){this._list=new wn,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;En(e)&&this._list.splice(this._sentinel,e)}add(t,e,n){En(e._cacheNode)||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const i=e._cacheNode;En(i)&&(this._list.remove(i),e._cacheNode=void 0,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,r=1024*t.maximumMemoryUsage*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>r||n);){const n=a.item;a=a.next,this.unloadTile(t,n,e)}}trim(){this._trimTiles=!0}}const Sn=new C.a,Pn=new C.a,Mn=new mt([new ht,new ht,new ht,new ht,new ht,new ht]);function Cn(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:o}=t.distanceScales,a=[t.longitude,t.latitude,0],s=yn.WGS84.cartographicToCartesian(a,new C.a),u=yn.WGS84.eastNorthUpToFixedFrame(s),c=t.unprojectPosition(t.cameraPosition),l=yn.WGS84.cartographicToCartesian(c,new C.a),h=new C.a(u.transformAsVector(new C.a(n).scale(o))).normalize(),p=new C.a(u.transformAsVector(new C.a(i).scale(o))).normalize();return function(t,e){const n=t.getFrustumPlanes();let i=0;for(const r in n){const o=n[r],a=o.normal.dot(t.center);Pn.copy(o.normal).scale(o.distance-a).add(t.center);const s=t.unprojectPosition(Pn),u=yn.WGS84.cartographicToCartesian(s,new C.a);Mn.planes[i++].fromPointNormal(u,Sn.copy(e).subtract(u))}}(t,s),{camera:{position:l,direction:h,up:p},viewport:t,height:r,cullingVolume:Mn,frameNumber:e,sseDenominator:1.15}}const In=new C.a;const On=0,Ln=1,Rn=3,kn=4,Dn=5,Bn=1,Fn=2,zn="empty",Nn="scenegraph",jn="pointcloud",Un="mesh",Vn="I3S",Gn="TILES3D",Wn="geometricError",Hn=1;function qn(t){return null!=t}const Xn=new C.a,Zn=new C.a,Qn=new C.a;new vt.a;function Yn(t,e,n){if(Object(_n.a)(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,n){const i=new C.a(t[0],t[1],t[2]);e.transform(i,i);const r=e.transformAsVector(t.slice(3,6)),o=e.transformAsVector(t.slice(6,9)),a=e.transformAsVector(t.slice(9,12)),s=new N.a([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);if(qn(n))return n.center=i,n.halfAxes=s,n;return new at(i,s)}(t.box,e,n);if(t.region){const[e,n,i,r,o,a]=t.region,s=yn.WGS84.cartographicToCartesian([Object(ut.c)(e),Object(ut.c)(r),o],Zn),u=yn.WGS84.cartographicToCartesian([Object(ut.c)(i),Object(ut.c)(n),a],Qn),c=(new C.a).addVectors(s,u).multiplyScalar(.5),l=(new C.a).subVectors(s,u).len()/2;return Kn([c[0],c[1],c[2],l],new vt.a)}if(t.sphere)return Kn(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Kn(t,e,n){const i=new C.a(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(Xn),o=Math.max(Math.max(r[0],r[1]),r[2]),a=t[3]*o;return qn(n)?(n.center=i,n.radius=a,n):new B(i,a)}new C.a,new C.a,new vt.a,new C.a,new C.a,new C.a;function Jn(t,e){if(t.dynamicScreenSpaceError&&t._dynamicScreenSpaceErrorComputedDensity){const n=t._dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return function(t,e){const n=t*e;return 1-Math.exp(-n*n)}(e,n)*i}return 0}const $n=Math.PI/2;function ti([t,e,n]){const i=Object(ut.j)(t),r=Object(ut.j)(e),o=1+n/6378137,a=o*Math.cos(r);return[t=a*Math.cos(i),e=a*Math.sin(i),n=o*Math.sin(r)]}function ei([t,e,n=0],[i,r,o=0]){const a=ti([i,r,o]),s=ti([t,e,n]),u=s[0]-a[0],c=s[1]-a[1],l=s[2]-a[2];return u*u+c*c+l*l}function ni(t,e){const n=e.viewport,i=t.header.mbs[1],r=[t.header.mbs[0],i,t.header.mbs[2]],o=t.header.mbs[3]/6378137,a=ei(n.unprojectPosition(n.cameraPosition),r)-o*o;if(a<=0)return 170141175e30;let s=function(t,e){const{width:n,height:i,pixelProjectionMatrix:r}=e.viewport,o=Math.tan(Math.atan(Math.sqrt(1/(r[0]*r[0])+1/(r[5]*r[5]))));return Math.sqrt(i*i+n*n)/o}(0,e);return s*=o/Math.sqrt(a)/n.scale,s}const ii=new C.a;class ri{constructor(t,e,n){Object(_n.a)("object"==typeof e),this.header=e,this.tileset=t,this.id=e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=On,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.userData={},this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Rn||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===On}get contentExpired(){return this.contentState===kn}get contentFailed(){return this.contentState===Dn}getScreenSpaceError(t,e){switch(this.tileset.type){case Vn:return ni(this,t);case Gn:return function(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=n?r:t.lodMetricValue;if(0===o)return 0;const a=Math.max(t._distanceToCamera,1e-7),{height:s,sseDenominator:u}=e;let c=o*s/(a*u);return c-=Jn(i,a),c}(this,t,e);default:return console.error("Unsupported tileset type"),null}}_getPriority(){return this.isVisible?this.contentState===On?-1:Math.max(1e7-this._priority,0)||0:-1}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ln;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);if(!t)return this.contentState=On,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.fetchOptions,i=this.tileset.loader,r={...n,[i.id]:{tile:this.header,tileset:this.tileset.tileset,isTileset:"json"===this.type,isTileHeader:!1,...this._getLoaderSpecificOptions(i.id)}};return this.content=await Object(x.a)(e,i,r),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,bn.a.dirname(this.contentUrl)),this.contentState=Rn,this._onContentLoaded(),!0}catch(t){throw this.contentState=Dn,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=On,!0}updateVisibility(t){if(this._frameNumber===t.frameNumber)return;const e=this.parent,n=e?e.computedTransform:this.tileset.modelMatrix,i=e?e._visibilityPlaneMask:mt.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==mt.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._priority=this.lodMetricValue,this._frameNumber=t.frameNumber}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,e)}contentVisibility(t){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return ii.subVectors(e.center,t.position),t.direction.dot(ii)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new vt.a(t.transform):new vt.a;const e=this.parent,n=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new vt.a(i).multiplyRight(this.transform);const r=e&&e._initialTransform?e._initialTransform.clone():new vt.a;this._initialTransform=new vt.a(r).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=On,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=mt.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Fn}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(t){this.boundingVolume=Yn(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Yn(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Yn(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new vt.a){const e=t.clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{};case"3d-tiles":case"cesium-ion":default:return{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"}}var e}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=kn,this._expiredContent=this.content)}}get extras(){return this.header.extras}}class oi{constructor(t=0){this._array=new Array(t),this._map=new Map,this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Object(_n.a)(t<this._array.length),this._array[t]}set(t,e){Object(_n.a)(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Object(_n.a)(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Object(_n.a)(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const ai={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class si{constructor(t){this.options={...ai,...t},this._traversalStack=new oi,this._emptyTraversalStack=new oi,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(n.push(t);n.length>0;){const t=n.pop();let i=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),i=this.updateAndPushChildren(t,e,n));const r=t.parent,o=Boolean(!r||r._shouldRefine),a=!i;t.hasRenderContent?t.refine===Bn?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===Fn&&(this.loadTile(t,e),a&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),a&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=i&&o}this.options.onTraversalEnd&&this.options.onTraversalEnd(e)}updateChildTiles(t,e){const n=t.children;for(const t of n)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,n){const{loadSiblings:i,skipLevelOfDetail:r}=this.options,o=t.children;o.sort(this.compareDistanceToCamera);const a=!r&&t.refine===Fn&&t.hasRenderContent;let s=!1;for(const t of o)if(t.isVisibleAndInRequestVolume?(n.find(t)&&n.delete(t),n.push(t),s=!0):(a||i)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let n;if(n=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),!n)return n}return s}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t,e)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t,e)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,n=!1,i=!1){return!(!i&&!t.isVisibleAndInRequestVolume)&&(!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e,n)))}shouldLoadTile(t,e){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t,e){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,n){let i=t._screenSpaceError;return n&&(i=t.getScreenSpaceError(e,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){t.updateVisibility(e)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}getPriority(t){const{options:e}=this;switch(t.refine){case Bn:return t._distanceToCamera;case Fn:const{parent:n}=t,i=n&&(!e.skipLevelOfDetail||0===t._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-i;default:return Object(_n.a)(!1)}}anyChildrenVisible(t,e){let n=!1;for(const i of t.children)i.updateVisibility(e),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const i=this._emptyTraversalStack;for(;i.length>0;){const t=i.pop();this.updateTile(t,e),t.isVisibleAndInRequestVolume||(this.loadTile(t,e),this.touchTile(t,e));const r=!t.hasRenderContent&&this.canTraverse(t,e,!1,!0);if(r||t.contentAvailable||(n=!1),r){const e=t.children.filter(t=>t);for(const t of e)i.find(t)&&i.delete(t),i.push(t)}}return n}}class ui extends si{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(t.updateVisibility(e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const i=t.refine===Fn,r=t._optimChildrenWithinParent===Hn;i&&r&&n&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!(!n||n.hasTilesetContent||n.refine!==Bn)&&!this.shouldRefine(t,e,!0)}}const ci="REQUESTED",li="COMPLETED",hi="ERROR";class pi{constructor(){this._statusMap={}}add(t,e,n,i){this._statusMap[e]||(this._statusMap[e]={request:t,callback:n,key:e,frameState:i,status:ci},t().then(t=>{this._statusMap[e].status=li,this._statusMap[e].callback(t,i)}).catch(t=>{this._statusMap[e].status=hi,n(t)}))}update(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}find(t){return this._statusMap[t]}}class fi extends si{constructor(t){super(t),this._tileManager=new pi}shouldRefine(t,e){return t._lodJudge=function(t,e){const n=e.viewport,i=n.metersPerPixel,r=t.header.mbs[1],o=t.header.mbs[0],a=t.header.mbs[2],s=t.header.mbs[3],{height:u,width:c,latitude:l,longitude:h}=n,p=[h,l],f=[o,r,a],d=[h,r],A=[o,l],g=Math.sqrt(u*u+c*c)*i[0],m=.5*u+s/6378137,y=.5*c+s/6378137;if(ei(p,f)>g+s/6378137)return"OUT";if(ei(p,d)>m)return"OUT";if(ei(p,A)>y)return"OUT";if(0===t.lodMetricValue)return"DIG";let v=ni(t,e);return v*=$n,v<.5?"OUT":!t.header.children||v<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const n=t.header.children||[],i=t.children,r=t.tileset;for(const o of n){const n=i&&i.find(t=>t.id===o.id);if(n)n&&this.updateTile(n,e);else{let n=()=>this._loadTile(o.id,r);this._tileManager.find(o.id)?this._tileManager.update(o.id,e):(r.tileset.nodePages&&(n=()=>r.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(n,o.id,e=>this._onTileLoad(e,t),e))}}}async _loadTile(t,e){const{loader:n}=e,i=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),r={i3s:{...e.fetchOptions,isTileHeader:!0,loadContent:!1}};return await Object(x.a)(i,n,r)}_onTileLoad(t,e){const n=this.options.basePath,i=new ri(e.tileset,t,e,n);e.children.push(i);const r=this._tileManager.find(i.id).frameState;this.updateTile(i,r),this._frameNumber===r.frameNumber&&this.executeTraversal(i,r)}}const di={ellipsoid:yn.WGS84,modelMatrix:new vt.a,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(t,e,n)=>{},maximumScreenSpaceError:8};class Ai{constructor(t,e={}){Object(_n.a)(t),this.options={...di,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||bn.a.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new Tn,this._requestScheduler=new Ht.a({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new vn.a({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(t,this.options)}isLoaded(){return 0===this._pendingCount}destroy(){this._destroy()}get tiles(){return Object.values(this._tiles)}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}update(t){this._cache.reset(),this._frameNumber++,this._frameState=Cn(t,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}_onTraversalEnd(){const t=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,t)&&this._updateFrameNumber++,this.selectedTiles=t;for(const t of this.selectedTiles)this._tiles[t.id]=t;return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(t=>t.id)),i=new Set(e.map(t=>t.id));let r=t.filter(t=>!i.has(t.id)).length>0;return r=r||e.filter(t=>!n.has(t.id)).length>0,r}_loadTiles(t){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e,t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&(t++,n.content.pointCount&&(e+=n.content.pointCount));this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=e}_initializeTileSet(t){this.root=this._initializeTileHeaders(t,null,this.basePath),this.type===Gn&&this._initializeCesiumTileset(t),this.type===Vn&&this._initializeI3STileset(t),this._calculateViewProps()}_calculateViewProps(){const t=this.root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new C.a,void(this.zoom=1);this.cartographicCenter=yn.WGS84.cartesianToCartographic(e,new C.a),this.cartesianCenter=e,this.zoom=function(t){const{halfAxes:e,radius:n,width:i,height:r}=t;if(e){e.getColumn(0,In);const t=In.len();e.getColumn(1,In);const n=In.len();e.getColumn(2,In);const i=t/2,r=n/2,o=In.len()/2;return(Math.log2(6378137/i)+Math.log2(6378137/r)+Math.log2(6356752.314245179/o))/3}if(n)return Math.log2(6356752.314245179/n);if(r&&i){return(Math.log2(6378137/i)+Math.log2(6378137/r))/2}return 1}(t.boundingVolume)}_initializeStats(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}_initializeTileHeaders(t,e,n){const i=new ri(this,t.root,e,n);if(e&&(e.children.push(i),i.depth=e.depth+1),this.type===Gn){const t=[];for(t.push(i);t.length>0;){const e=t.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();const i=e.header.children||[];for(const r of i){const i=new ri(this,r,e,n);e.children.push(i),i.depth=e.depth+1,t.push(i)}}}return i}_initializeTraverser(){let t;switch(this.type){case Gn:t=ui;break;case Vn:t=fi;break;default:t=si}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t,e){let n;try{this._onStartTileLoading(),n=await t.loadContent(e)}catch(e){this._onTileLoadError(t,e)}finally{this._onEndTileLoading(),this._onTileLoad(t,n)}}_onTileLoadError(t,e){this.stats.get("Failed Tile Loads").incrementCount();const n=e.message||e.toString(),i=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(n)),this.options.onTileError(t,n,i)}_onTileLoad(t,e){e&&(t&&t.content&&function(t,e){Object(_n.a)(t),Object(_n.a)(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:o}}=t;let a=new vt.a(r);switch(n&&a.translate(n),i){case"Z":break;case"Y":const t=(new vt.a).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const e=(new vt.a).rotateY(-Math.PI/2);a=a.multiplyRight(e)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new C.a(o);e.cartesianModelMatrix=a,e.cartesianOrigin=s;const u=yn.WGS84.cartesianToCartographic(s,new C.a),c=yn.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=c.multiplyRight(a),e.cartographicOrigin=u,e.modelMatrix=e.cartographicModelMatrix}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}_onStartTileLoading(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const e of t.children)n.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeCesiumTileset(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}_initializeI3STileset(t){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=t.store.defaultGeometrySchema}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(t){const e=[];for(const n of Object.keys(t))e.push("".concat(n,"=").concat(t[n]));switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}}const gi={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(gi);function mi(t,e,n){Object(_n.a)(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}var yi=n(284);const vi={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},_i={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...vi},bi={[vi.DOUBLE]:Float64Array,[vi.FLOAT]:Float32Array,[vi.UNSIGNED_SHORT]:Uint16Array,[vi.UNSIGNED_INT]:Uint32Array,[vi.UNSIGNED_BYTE]:Uint8Array,[vi.BYTE]:Int8Array,[vi.SHORT]:Int16Array,[vi.INT]:Int32Array},xi={DOUBLE:vi.DOUBLE,FLOAT:vi.FLOAT,UNSIGNED_SHORT:vi.UNSIGNED_SHORT,UNSIGNED_INT:vi.UNSIGNED_INT,UNSIGNED_BYTE:vi.UNSIGNED_BYTE,BYTE:vi.BYTE,SHORT:vi.SHORT,INT:vi.INT};class wi{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in bi){if(bi[e]===t)return e}throw new Error("Failed to convert GL type")}static fromName(t){const e=xi[t];if(!e)throw new Error("Failed to convert GL type");return e}static getArrayType(t,e=!1){switch(t){case vi.UNSIGNED_SHORT_5_6_5:case vi.UNSIGNED_SHORT_4_4_4_4:case vi.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=bi[t];if(!e)throw new Error("Failed to convert GL type");return e}}static getByteSize(t){return wi.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(wi.getArrayType(t))}static createTypedArray(t,e,n=0,i){return void 0===i&&(i=(e.byteLength-n)/wi.getByteSize(t)),new(wi.getArrayType(t))(e,n,i)}}class Ei{constructor(t,e){this.json=t,this.buffer=e,this.featuresLength=0,this._cachedTypedArrays={}}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=_i.UNSIGNED_INT,n=1){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,i.byteOffset):i}getPropertyArray(t,e,n){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=wi.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,n,i,r){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,e,n);if(1===n)return a[i];for(let t=0;t<n;++t)r[t]=a[n*i+t];return r}_getTypedArrayFromBinary(t,e,n,i,r){const o=this._cachedTypedArrays;let a=o[t];return a||(a=wi.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+r,i*n),o[t]=a),a}_getTypedArrayFromArray(t,e,n){const i=this._cachedTypedArrays;let r=i[t];return r||(r=wi.createTypedArray(e,n),i[t]=r),r}}const Ti={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Si={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Pi={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};const Mi=t=>void 0!==t;function Ci(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?function(t,e){let n,i,r;const o=t.instancesLength,a=t.classes,s=t.classIds,u=t.parentCounts,c=t.parentIds,l=o;Mi(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,r=getBinaryAccessor(s),s=r.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let h;if(Mi(u))for(Mi(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,r=getBinaryAccessor(u),u=r.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,o)),h=new Uint16Array(o),l=0,n=0;n<o;++n)h[n]=l,l+=u[n];Mi(c)&&Mi(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,l));const p=a.length;for(n=0;n<p;++n){const t=a[n].length,i=a[n].instances,r=getBinaryProperties(t,i,e);a[n].instances=combine(r,i)}const f=new Array(p).fill(0),d=new Uint16Array(o);for(n=0;n<o;++n)i=s[n],d[n]=f[i],++f[i];const A={classes:a,classIds:s,classIndexes:d,parentCounts:u,parentIndexes:h,parentIds:c};return function(t){const e=t.classIds.length;for(let n=0;n<e;++n)Oi(t,n,stack)}(A),A}(i,n):null}function Ii(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?function(t,e,n){const i=t.classIds,r=t.parentCounts,o=t.parentIds,a=t.parentIndexes,s=i.length,u=scratchVisited;u.length=Math.max(u.length,s);const c=++marker,l=scratchStack;l.length=0,l.push(e);for(;l.length>0;){if(e=l.pop(),u[e]===c)continue;u[e]=c;const i=n(t,e);if(Mi(i))return i;const s=r[e],h=a[e];for(let t=0;t<s;++t){const n=o[h+t];n!==e&&l.push(n)}}return null}(t,e,n):function(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(Mi(r))return r;const o=t.parentIds[e];i=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}(t,e,n)}function Oi(t,e,n){const i=t.parentCounts,r=t.parentIds,o=t.parentIndexes,a=t.classIds.length;if(!Mi(r))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(-1===n.indexOf(e),"Circular dependency detected in the batch table hierarchy."),n.push(e);const s=Mi(i)?i[e]:1,u=Mi(i)?o[e]:e;for(let i=0;i<s;++i){const o=r[u+i];o!==e&&Oi(t,o,n)}n.pop(e)}function Li(t){return null!=t}const Ri=(t,e)=>t,ki={HIERARCHY:!0,extensions:!0,extras:!0};class Di{constructor(t,e,n,i={}){Object(_n.a)(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=this.json&&this.json.extensions||{},this._properties={};for(const t in this.json)ki[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Ci(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Object(_n.a)("string"==typeof e,e),this._hierarchy){return Li(Ii(this._hierarchy,t,(t,n)=>{const i=t.classIds[n];return t.classes[i].name===e}))}return!1}isExactClass(t,e){return Object(_n.a)("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Object(_n.a)("string"==typeof e,e),Li(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=Li(e)?e:[]).length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Object(_n.a)("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(Li(n))return this._getBinaryProperty(n,t)}const n=this._properties[e];if(Li(n))return Ri(n[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(Li(n))return n}}setProperty(t,e,n){const i=this.featureCount;if(this._checkBatchId(t),Object(_n.a)("string"==typeof e,e),this._binaryProperties){const i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,n)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let r=this._properties[e];Li(r)||(this._properties[e]=new Array(i),r=this._properties[e]),r[t]=Ri(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],i=this._initializeBinaryProperty(e,n);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;Object(_n.a)(this.binary,"Property ".concat(t," requires a batch table binary.")),Object(_n.a)(n.type,"Property ".concat(t," requires a type."));const i=function(t,e,n,i){const{componentType:r}=t;Object(_n.a)(t.componentType);const o="string"==typeof r?wi.fromName(r):r,a=Ti[t.type],s=Si[t.type],u=Pi[t.type];return n+=t.byteOffset,{values:wi.createTypedArray(o,e,n,a*i),type:o,size:a,unpacker:s,packer:u}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Ii(this._hierarchy,t,(t,n)=>{const i=t.classIds[n];return Li(t.classes[i].instances[e])});return Li(n)}_getPropertyNamesInHierarchy(t,e){Ii(this._hierarchy,t,(t,n)=>{const i=t.classIds[n],r=t.classes[i].instances;for(const t in r)r.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)})}_getHierarchyProperty(t,e){return Ii(this._hierarchy,t,(t,n)=>{const i=t.classIds[n],r=t.classes[i],o=t.classIndexes[n],a=r.instances[e];return Li(a)?Li(a.typedArray)?this._getBinaryProperty(a,o):Ri(a[o]):null})}_setHierarchyProperty(t,e,n,i){const r=Ii(this._hierarchy,e,(t,r)=>{const o=t.classIds[r],a=t.classes[o],s=t.classIndexes[r],u=a.instances[n];return!!Li(u)&&(Object(_n.a)(r===e,'Inherited property "'.concat(n,'" is read-only.')),Li(u.typedArray)?this._setBinaryProperty(u,s,i):u[s]=Ri(i),!0)});return Li(r)}}function Bi(t,e,n=0){const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=4,t.version=i.getUint32(n,!0),n+=4,t.byteLength=i.getUint32(n,!0),n+=4,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}function Fi(t,e,n){const i=new DataView(e);return t.header=t.header||{},t.header.featureTableJsonByteLength=i.getUint32(n,!0),n+=4,t.header.featureTableBinaryByteLength=i.getUint32(n,!0),n+=4,t.header.batchTableJsonByteLength=i.getUint32(n,!0),n+=4,t.header.batchTableBinaryByteLength=i.getUint32(n,!0),n+=4}function zi(t,e,n,i){return n=function(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:0},r>0){const i=mi(e,n,r);t.featureTableJson=JSON.parse(i)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,o),n+=o}(t,e,n),n=function(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:o}=t.header;if(r>0){const i=mi(e,n,r);t.batchTableJson=JSON.parse(i),n+=r,o>0&&(t.batchTableBinary=new Uint8Array(e,n,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=o)}return n}(t,e,n)}function Ni(t,e=[0,0,0]){const n=t>>11&31,i=t>>5&63,r=31&t;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}function ji(t,e,n){if(!(e||t&&t.batchIds&&n))return null;const{batchIds:i,isRGB565:r,pointCount:o}=t;if(i&&n){const t=new Uint8ClampedArray(3*o);for(let e=0;e<o;e++){const r=i[e],o=n.getProperty(r,"dimensions").map(t=>255*t);t[3*e]=o[0],t[3*e+1]=o[1],t[3*e+2]=o[2]}return{type:_i.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(r){const t=new Uint8ClampedArray(3*o);for(let n=0;n<o;n++){const i=Ni(e[n]);t[3*n]=i[0],t[3*n+1]=i[1],t[3*n+2]=i[2]}return{type:_i.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*o?{type:_i.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:_i.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}var Ui=n(204);function Vi(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}new Ui.a,new C.a,new Ui.a,new Ui.a,new Uint8Array(1);function Gi(t,e=255){return Object(ut.a)(t,0,e)/e*2-1}function Wi(t){return t<0?-1:1}function Hi(t,e,n,i){if(Vi(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=Gi(t,n),i.y=Gi(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const t=i.x;i.x=(1-Math.abs(i.y))*Wi(t),i.y=(1-Math.abs(t))*Wi(i.y)}return i.normalize()}function qi(t,e,n){return Hi(t,e,255,n)}const Xi=new C.a;function Zi(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const n=new C.a,i=new Float32Array(3*t.pointCount);for(let r=0;r<t.pointCount;r++)n.set(e[3*r],e[3*r+1],e[3*r+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,3*r);return i}(t,e)):{type:_i.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}async function Qi(t,e,n,i,r){n=zi(t,e,n=Fi(t,e,n=Bi(t,e,n))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:o,batchTable:a}=function(t){const e=new Ei(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",_i.FLOAT,3);const i=function(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",_i.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:o}=t;n=new Di(r,o,i)}return n}(t,e);return{featureTable:e,batchTable:i}}(t);return await async function(t,e,n,i,r){let o,a,s;const u=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];u&&(s=u.properties);const c=e.getExtension("3DTILES_draco_point_compression");if(c){a=c.properties;const e=c.byteOffset,n=c.byteLength;if(!a||!Number.isFinite(e)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=t.featureTableBinary.slice(e,e+n),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA)}if(!o)return!0;const l={buffer:o,properties:{...a,...s},featureTableProperties:a,batchTableProperties:s,dequantizeInShader:!1};return await async function(t,e,n,i){const{parse:r}=i,o={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const a=await r(e.buffer,yi.a,o),s=a.attributes.POSITION&&a.attributes.POSITION.value,u=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,c=a.attributes.NORMAL&&a.attributes.NORMAL.value,l=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,h=s&&a.attributes.POSITION.value.quantization,p=c&&a.attributes.NORMAL.value.quantization;if(h){const e=a.POSITION.data.quantization,n=e.range;t.quantizedVolumeScale=new C.a(n,n,n),t.quantizedVolumeOffset=new C.a(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}p&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const t of Object.keys(e.batchTableProperties))a.attributes[t]&&a.attributes[t].value&&(f[t.toLowerCase()]=a.attributes[t].value);t.attributes={positions:s,colors:ji(t,u),normals:c,batchIds:l,...f}}(t,l,i,r)}(t,o,0,i,r),function(t,e,n){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",_i.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",_i.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_i.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_i.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Zi(t,i,n)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,o,i),function(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",_i.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",_i.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",_i.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=ji(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",_i.UNSIGNED_BYTE,4))}(t,o,a),function(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",_i.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",_i.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(3*t.pointsLength);for(let i=0;i<t.pointsLength;i++)qi(e[2*i],e[2*i+1],Xi),Xi.toArray(n,3*i);return{type:_i.FLOAT,size:2,value:n}}return{type:_i.FLOAT,size:2,value:e}}(t,n)}}(t,o),n}var Yi=n(280),Ki=n(102);const Ji=0,$i=1;function tr(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Object(Ki.b)(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function er(t,e,n,i){const r=n["3d-tiles"]||{};if(function(t,e,n){switch(e){case Ji:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),n=(new TextDecoder).decode(e);t.gltfUrl=n.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case $i:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),r.loadGLTF){const{parse:e,fetch:r}=i;t.gltfUrl&&(t.gltfArrayBuffer=await r(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,Yi.a,n,i),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function nr(t,e,n,i,r){n=function(t,e,n,i,r){n=Bi(t,e,n),n=Fi(t,e,n),n=zi(t,e,n),n=tr(t,e,n,i);const o=new Ei(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",_i.FLOAT,3),n}(t,e,n,i),await er(t,$i,i,r);const{extensions:o}=t.gltf||{};return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}async function ir(t,e,n,i,r){return n=function(t,e,n,i,r){if(n=Bi(t,e,n),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=Fi(t,e,n);const o=new DataView(e);if(t.gltfFormat=o.getUint32(n,!0),n=zi(t,e,n+=4),n=tr(t,e,n,i),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new Ei(t.featureTableJson,t.featureTableBinary),s=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",_i.FLOAT,3);new Di(t.batchTableJson,t.batchTableBinary,s);return function(t,e,n,i){const r=[new Array(i),t._batchTable][0],o=new C.a,a=new C.a,s=new C.a,u=new C.a,c=new N.a,l=new j.a,h=new C.a,p={},f=new vt.a,d=[],A=[],g=new C.a,m=new C.a;for(let n=0;n<i;n++){let i;if(e.hasProperty("POSITION"))i=e.getProperty("POSITION",_i.FLOAT,3,n,o);else if(e.hasProperty("POSITION_QUANTIZED")){i=e.getProperty("POSITION_QUANTIZED",_i.UNSIGNED_SHORT,3,n,o);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_i.FLOAT,3,g);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const r=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_i.FLOAT,3,m);if(!r)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const a=65535;for(let e=0;e<3;e++)i[e]=i[e]/a*r[e]+t[e]}if(!i)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");o.copy(i),p.translation=o,t.normalUp=e.getProperty("NORMAL_UP",_i.FLOAT,3,n,d),t.normalRight=e.getProperty("NORMAL_RIGHT",_i.FLOAT,3,n,A);const y=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",_i.UNSIGNED_SHORT,2,d),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",_i.UNSIGNED_SHORT,2,A),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(yn.WGS84.eastNorthUpToFixedFrame(o,f),f.getRotationMatrix3(c)):c.identity()}y&&(u.copy(a).cross(s).normalize(),c.setColumn(0,a),c.setColumn(1,s),c.setColumn(2,u)),l.fromMatrix3(c),p.rotation=l,h.set(1,1,1);const v=e.getProperty("SCALE",_i.FLOAT,1,n);Number.isFinite(v)&&h.multiplyByScalar(v);const _=e.getProperty("SCALE_NON_UNIFORM",_i.FLOAT,3,n,d);_&&h.scale(_),p.scale=h;let b=e.getProperty("BATCH_ID",_i.UNSIGNED_SHORT,1,n);void 0===b&&(b=n);const x=(new vt.a).fromQuaternion(p.rotation);f.identity(),f.translate(p.translation),f.multiplyRight(x),f.scale(p.scale);const w=f.clone();r[n]={modelMatrix:w,batchId:b}}t.instances=r}(t,a,0,s),n}(t,e,n,i),await er(t,t.gltfFormat,i,r),n}async function rr(t,e=0,n,i,r={}){switch(r.byteOffset=e,r.type=function(t,e=0){const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}(t,e),r.type){case gi.COMPOSITE:return await async function(t,e,n,i,r,o){n=Bi(t,e,n);const a=new DataView(e);for(t.tilesLength=a.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await o(e,n,i,r,a)}return n}(r,t,e,n,i,rr);case gi.BATCHED_3D_MODEL:return await nr(r,t,e,n,i);case gi.INSTANCED_3D_MODEL:return await ir(r,t,e,n,i);case gi.POINT_CLOUD:return await Qi(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}function or(t,e){if(t.content){const n=t.content.uri||t.content.url;t.contentUrl="".concat(e.basePath,"/").concat(n)}return t.id=t.contentUrl,t.lodMetricType=Wn,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=function(t){if(!t.contentUrl)return zn;const e=t.contentUrl.split(".").pop();switch(e){case"pnts":return jn;case"i3dm":case"b3dm":return Nn;default:return e}}(t),t.refine=function(t){switch(t){case"REPLACE":case"replace":return Fn;case"ADD":case"add":return Bn;default:return t}}(t.refine),t}const ar={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:"3.0.0-alpha.6",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,n,i){const r=e["3d-tiles"]||{};let o;o="auto"===r.isTileset?n.url&&-1!==n.url.indexOf(".json"):r.isTileset;t=o?await async function(t,e,n){const i=JSON.parse((new TextDecoder).decode(t));return i.loader=e.loader||ar,i.url=n.url,i.basePath=function(t){return bn.a.dirname(t.url)}(i),i.root=function(t){const e=t.basePath,n=or(t.root,t),i=[];for(i.push(n);i.length>0;){const t=i.pop().children||[];for(const n of t)or(n,{basePath:e}),i.push(n)}return n}(i),i.type=Gn,i.lodMetricType=Wn,i.lodMetricValue=i.root.lodMetricValue,i}(t,e,n):await async function(t,e,n){const i={};i.content=i.content||{};return await rr(t,0,e,n,i.content),i.content}(t,e,n);return t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",tile:null,tileset:null,assetGltfUpAxis:null}}};const sr=[0],ur={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:ar,onTilesetLoad:{type:"function",value:t=>{},compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:(t,e,n)=>{},compare:!1}};class cr extends o.a{initializeState(){"onTileLoadFail"in this.props&&w.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null}}get isLoaded(){const{tileset3d:t}=this.state;return t&&t.isLoaded()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:e,changeFlags:n}){if(t.data&&t.data!==e.data&&this._loadTileset(t.data),n.viewportChanged){const{tileset3d:t}=this.state;this._updateTileset(t)}if(n.propsChanged){const{layerMap:t}=this.state;for(const e in t)t[e].needsUpdate=!0}}getPickingInfo({info:t,sourceLayer:e}){const{layerMap:n}=this.state,i=e&&e.id;if(i){const e=i.substring(this.id.length+1),r=e.substring(e.indexOf("-")+1);t.object=n[r]&&n[r].tile}return t}_updateAutoHighlight(t){t.sourceLayer&&t.sourceLayer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e}=this.props;let n=this.props.loader||this.props.loaders;Array.isArray(n)&&(n=n[0]);const i={...e};if(n.preload){const r=await n.preload(t,e);Object.assign(i,r)}const r=await Object(x.a)(t,n,i),o=new Ai(r,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError,...i});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(o),this.props.onTilesetLoad(o)}_onTileLoad(t){this.props.onTileLoad(t),this._updateTileset(this.state.tileset3d),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){const{timeline:e,viewport:n}=this.context;if(!e||!n||!t)return;const i=t.update(n);this.state.frameNumber!==i&&this.setState({frameNumber:i})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case jn:return this._makePointCloudLayer(t,e);case Nn:return this._make3DModelLayer(t,e);case Un:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:n,pointCount:i,constantRGBA:r,cartographicOrigin:o,modelMatrix:a}=t.content,{positions:s,normals:u,colors:c}=n;if(!s)return null;const l=e&&e.props.data||{header:{vertexCount:i},attributes:{POSITION:s,NORMAL:u,COLOR_0:c}},{pointSize:h,getPointColor:p}=this.props;return new(this.getSubLayerClass("pointcloud",ze.a))({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),data:l,coordinateSystem:Fe.a.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:r||p})}_make3DModelLayer(t){const{gltf:e,instances:n,cartographicOrigin:i,modelMatrix:r}=t.content;return new(this.getSubLayerClass("scenegraph",Ne.a))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),data:n||sr,scenegraph:e,coordinateSystem:Fe.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:r,getTransformMatrix:t=>t.modelMatrix,getPosition:[0,0,0]})}_makeSimpleMeshLayer(t,e){const n=t.content,{attributes:i,modelMatrix:r,cartographicOrigin:o,texture:a}=n,s=e&&e.props.mesh||new Be.a({drawMode:4,attributes:lr(i)});return new(this.getSubLayerClass("mesh",je.a))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),mesh:s,data:sr,getPosition:[0,0,0],getColor:[255,255,255],texture:a,modelMatrix:r,coordinateOrigin:o,coordinateSystem:Fe.a.METER_OFFSETS})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(t=>{const n=e[t.id]=e[t.id]||{tile:t};let{layer:i}=n;return t.selected?i?n.needsUpdate?(i=this._getSubLayer(t,i),n.needsUpdate=!1):i.props.visible||(i=i.clone({visible:!0})):i=this._getSubLayer(t):i&&i.props.visible&&(i=i.clone({visible:!1})),n.layer=i,i}).filter(Boolean):null}}function lr(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),e}cr.layerName="Tile3DLayer",cr.defaultProps=ur;var hr=n(104);class pr{constructor(t=257){this.gridSize=t;const e=t-1;if(e&e-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let n=t+2,i=0,r=0,o=0,a=0,s=0,u=0;for(1&n?o=a=s=e:i=r=u=e;(n>>=1)>1;){const t=i+o>>1,e=r+a>>1;1&n?(o=i,a=r,i=s,r=u):(i=o,r=a,o=s,a=u),s=t,u=e}const c=4*t;this.coords[c+0]=i,this.coords[c+1]=r,this.coords[c+2]=o,this.coords[c+3]=a}}createTile(t){return new fr(t,this)}}class fr{constructor(t,e){const n=e.gridSize;if(t.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${t.length}.`);this.terrain=t,this.martini=e,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:e,coords:n,gridSize:i}=this.martini,{terrain:r,errors:o}=this;for(let a=t-1;a>=0;a--){const t=4*a,s=n[t+0],u=n[t+1],c=n[t+2],l=n[t+3],h=s+c>>1,p=u+l>>1,f=h+p-u,d=p+s-h,A=(r[u*i+s]+r[l*i+c])/2,g=p*i+h,m=Math.abs(A-r[g]);if(o[g]=Math.max(o[g],m),a<e){const t=(u+d>>1)*i+(s+f>>1),e=(l+d>>1)*i+(c+f>>1);o[g]=Math.max(o[g],o[t],o[e])}}}getMesh(t=0){const{gridSize:e,indices:n}=this.martini,{errors:i}=this;let r=0,o=0;const a=e-1;function s(a,u,c,l,h,p){const f=a+c>>1,d=u+l>>1;Math.abs(a-h)+Math.abs(u-p)>1&&i[d*e+f]>t?(s(h,p,a,u,f,d),s(c,l,h,p,f,d)):(n[u*e+a]=n[u*e+a]||++r,n[l*e+c]=n[l*e+c]||++r,n[p*e+h]=n[p*e+h]||++r,o++)}n.fill(0),s(0,0,a,a,a,0),s(a,a,0,0,0,a);const u=new Uint16Array(2*r),c=new Uint32Array(3*o);let l=0;function h(r,o,a,s,p,f){const d=r+a>>1,A=o+s>>1;if(Math.abs(r-p)+Math.abs(o-f)>1&&i[A*e+d]>t)h(p,f,r,o,d,A),h(a,s,p,f,d,A);else{const t=n[o*e+r]-1,i=n[s*e+a]-1,h=n[f*e+p]-1;u[2*t]=r,u[2*t+1]=o,u[2*i]=a,u[2*i+1]=s,u[2*h]=p,u[2*h+1]=f,c[l++]=t,c[l++]=i,c[l++]=h}}return h(0,0,a,a,a,0),h(a,a,0,0,0,a),{vertices:u,triangles:c}}}var dr=n(184);function Ar(t,e){if(null===t)return null;const{meshMaxError:n,bounds:i,elevationDecoder:r}=e,o=t.data,a=t.width,s=a+1,u=function(t,e,n){const{rScaler:i,bScaler:r,gScaler:o,offset:a}=n,s=e+1,u=new Float32Array(s*s);for(let n=0,s=0;s<e;s++)for(let c=0;c<e;c++,n++){const e=4*n,c=t[e+0],l=t[e+1],h=t[e+2];u[n+s]=c*i+l*o+h*r+a}for(let t=s*(s-1),e=0;e<s-1;e++,t++)u[t]=u[t-s];for(let t=s-1,e=0;e<s;e++,t+=s)u[t]=u[t-1];return u}(o,a,r),c=new pr(s).createTile(u),{vertices:l,triangles:h}=c.getMesh(n),p=function(t,e,n,i){const r=n+1,o=t.length/2,a=new Float32Array(3*o),s=new Float32Array(2*o),[u,c,l,h]=i||[0,0,n,n],p=(l-u)/n,f=(h-c)/n;for(let i=0;i<o;i++){const o=t[2*i],c=t[2*i+1],l=c*r+o;a[3*i+0]=o*p+u,a[3*i+1]=-c*f+h,a[3*i+2]=e[l],s[2*i+0]=o/n,s[2*i+1]=c/n}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:s,size:2}}}(l,u,a,i);return{loaderData:{header:{}},header:{vertexCount:h.length,boundingBox:Object(dr.a)(p)},mode:4,indices:{value:h,size:1},attributes:p}}const gr={...{name:"Terrain",id:"terrain",module:"terrain",version:"3.0.0-alpha.6",worker:!0,extensions:["png","pngraw"],mimeTypes:["image/png"],options:{terrain:{bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0}}}},parse:async function(t,e,n){return e.image=e.image||{},e.image.type="data",Ar(await n.parse(t,e,e.baseUri),e.terrain)}},mr=[1],yr={...Kt.defaultProps,elevationData:Bt,texture:Bt,meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:{type:"string",value:null},wireframe:!1,material:!0,loaders:[gr]};function vr(t){return Array.isArray(t)?t.join(";"):t}class _r extends o.a{updateState({props:t,oldProps:e}){const n=t.elevationData!==e.elevationData;if(n){const{elevationData:e}=t,n=e&&(Array.isArray(e)||e.includes("{x}")&&e.includes("{y}"));this.setState({isTiled:n})}const i=n||t.meshMaxError!==e.meshMaxError||t.elevationDecoder!==e.elevationDecoder||t.bounds!==e.bounds;if(!this.state.isTiled&&i){const e=this.loadTerrain(t);this.setState({terrain:e})}}loadTerrain({elevationData:t,bounds:e,elevationDecoder:n,meshMaxError:i,workerUrl:r}){if(!t)return null;const o={terrain:{bounds:e,meshMaxError:i,elevationDecoder:n}};return null!==r&&(o.terrain.workerUrl=r),Object(x.a)(t,this.props.loaders,o)}getTiledTerrainData(t){const{elevationData:e,texture:n,elevationDecoder:i,meshMaxError:r,workerUrl:o}=this.props,a=zt(e,t),s=zt(n,t),{bbox:u,z:c}=t,l=new hr.a({longitude:(u.west+u.east)/2,latitude:(u.north+u.south)/2,zoom:c}),h=l.projectFlat([u.west,u.south]),p=l.projectFlat([u.east,u.north]),f=[h[0],h[1],p[0],p[1]],d=this.loadTerrain({elevationData:a,bounds:f,elevationDecoder:i,meshMaxError:r,workerUrl:o}),A=s?Object(x.a)(s).catch(t=>null):Promise.resolve(null);return Promise.all([d,A])}renderSubLayers(t){const e=this.getSubLayerClass("mesh",je.a),{data:n,color:i}=t;if(!n)return null;const[r,o]=n;return new e(t,{data:mr,mesh:r,texture:o,coordinateSystem:Fe.a.CARTESIAN,getPosition:t=>[0,0,0],getColor:i})}onViewportLoad(t){if(!t)return;const{zRange:e}=this.state,n=t.map(t=>t.content).filter(Boolean).map(t=>t[0].header.boundingBox.map(t=>t[2]));if(0===n.length)return;const i=Math.min(...n.map(t=>t[0])),r=Math.max(...n.map(t=>t[1]));(!e||i<e[0]||r>e[1])&&this.setState({zRange:[i,r]})}renderLayers(){const{color:t,material:e,elevationData:n,texture:i,wireframe:r,meshMaxError:o,elevationDecoder:a,tileSize:s,maxZoom:u,minZoom:c,extent:l,maxRequests:h}=this.props;return this.state.isTiled?new Kt(this.getSubLayerProps({id:"tiles"}),{wireframe:r,color:t,material:e,getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:vr(n),texture:vr(i),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:s,maxZoom:u,minZoom:c,extent:l,maxRequests:h}):new(this.getSubLayerClass("mesh",je.a))(this.getSubLayerProps({id:"mesh"}),{data:mr,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:t=>[0,0,0],getColor:t,material:e,wireframe:r})}}_r.layerName="TerrainLayer",_r.defaultProps=yr;class br{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(wr,this,e)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,i=0,r=0,o=0;const a=[];let s;for(;t.pos<e;){if(i<=0){const e=t.readVarint();n=7&e,i=e>>3}if(i--,1===n||2===n)r+=t.readSVarint(),o+=t.readSVarint(),1===n&&(s&&a.push(s),s=[]),s.push([r,o]);else{if(7!==n)throw new Error("unknown command ".concat(n));s&&s.push(s[0].slice())}}return s&&a.push(s),a}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,i=0,r=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;for(;t.pos<e;){if(i<=0){const e=t.readVarint();n=7&e,i=e>>3}if(i--,1===n||2===n)r+=t.readSVarint(),o+=t.readSVarint(),r<a&&(a=r),r>s&&(s=r),o<u&&(u=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command ".concat(n))}return[a,u,s,c]}_toGeoJSON(t){let e,n,i=this.loadGeometry(),r=br.types[this.type];switch(this.type){case 1:var o=[];for(e=0;e<i.length;e++)o[e]=i[e][0];i=o,t(i,this);break;case 2:for(e=0;e<i.length;e++)t(i[e],this);break;case 3:for(i=function(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let o=0;o<e;o++){const e=xr(t[o]);0!==e&&(void 0===r&&(r=e<0),r===e<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}i&&n.push(i);return n}(i),e=0;e<i.length;e++)for(n=0;n<i[e].length;n++)t(i[e][n],this)}1===i.length?i=i[0]:r="Multi".concat(r);const a={type:"Feature",geometry:{type:r,coordinates:i},properties:this.properties};return null!==this.id&&(a.id=this.id),a}toGeoJSON(t){if("function"==typeof t)return this._toGeoJSON(t);const{x:e,y:n,z:i}=t,r=this.extent*Math.pow(2,i),o=this.extent*e,a=this.extent*n;return this._toGeoJSON((function(t){for(let e=0;e<t.length;e++){const n=t[e];n[0]=360*(n[0]+o)/r-180;const i=180-360*(n[1]+a)/r;n[1]=360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90}}))}}function xr(t){let e=0;for(let n,i,r=0,o=t.length-1;r<t.length;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}function wr(t,e,n){1===t?e.id=n.readVarint():2===t?function(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(n,e):3===t?e.type=n.readVarint():4===t&&(e._geometry=n.pos)}class Er{constructor(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Tr,this,e),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new br(this._pbf,e,this.extent,this._keys,this._values)}}function Tr(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(n))}class Sr{constructor(t,e){this.layers=t.readFields(Pr,{},e)}}function Pr(t,e,n){if(3===t){const t=new Er(n,n.readVarint()+n.pos);t.length&&(e[t.name]=t)}}function Mr(t){let e=0,n=0,i=0,r=0,o=0,a=0,s=0,u=0,c=0;const l=new Set,h={};for(const f of t){const t=f.geometry;switch(t.type){case"Point":n++,e++,l.add(t.coordinates.length);break;case"MultiPoint":n++,e+=t.coordinates.length;for(const e of t.coordinates)l.add(e.length);break;case"LineString":o++,i+=t.coordinates.length,r++;for(const e of t.coordinates)l.add(e.length);break;case"MultiLineString":o++;for(const e of t.coordinates){i+=e.length,r++;for(const t of e)l.add(t.length)}break;case"Polygon":c++,s++,u+=t.coordinates.length,a+=Nr(t.coordinates).length;for(const e of Nr(t.coordinates))l.add(e.length);break;case"MultiPolygon":c++;for(const e of t.coordinates){s++,u+=e.length,a+=Nr(e).length;for(const t of Nr(e))l.add(t.length)}break;default:throw new Error("Unsupported geometry type: ".concat(t.type))}if(f.properties)for(const t in f.properties){const e=f.properties[t];h[t]=h[t]||void 0===h[t]?(p=e,Number.isFinite(p)):h[t]}}var p;return{pointPositionsCount:e,pointFeaturesCount:n,linePositionsCount:i,linePathsCount:r,lineFeaturesCount:o,coordLength:Math.max(...l),polygonPositionsCount:a,polygonObjectsCount:s,polygonRingsCount:u,polygonFeaturesCount:c,numericPropKeys:Object.keys(h).filter(t=>h[t])}}function Cr(t,e={},n={}){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:o,linePathsCount:a,lineFeaturesCount:s,polygonPositionsCount:u,polygonObjectsCount:c,polygonRingsCount:l,polygonFeaturesCount:h}=e,{coordLength:p,numericPropKeys:f,PositionDataType:d=Float32Array}=n,A=t.length>65535?Uint32Array:Uint16Array,g={positions:new d(i*p),globalFeatureIds:new A(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[]},m={pathIndices:o>65535?new Uint32Array(a+1):new Uint16Array(a+1),positions:new d(o*p),globalFeatureIds:new A(o),featureIds:s>65535?new Uint32Array(o):new Uint16Array(o),numericProps:{},properties:[]},y={polygonIndices:u>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:u>65535?new Uint32Array(l+1):new Uint16Array(l+1),positions:new d(u*p),globalFeatureIds:new A(u),featureIds:h>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[]};for(const t of[g,m,y])for(const e of f)t.numericProps[e]=new Float32Array(t.positions.length/p);m.pathIndices[a]=o,y.polygonIndices[c]=u,y.primitivePolygonIndices[l]=u;const v={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const e of t){const t=e.geometry,n=e.properties||{};switch(t.type){case"Point":Ir(t.coordinates,g,v,p,n),g.properties.push(Fr(n,f)),v.pointFeature++;break;case"MultiPoint":Or(t.coordinates,g,v,p,n),g.properties.push(Fr(n,f)),v.pointFeature++;break;case"LineString":Lr(t.coordinates,m,v,p,n),m.properties.push(Fr(n,f)),v.lineFeature++;break;case"MultiLineString":Rr(t.coordinates,m,v,p,n),m.properties.push(Fr(n,f)),v.lineFeature++;break;case"Polygon":kr(t.coordinates,y,v,p,n),y.properties.push(Fr(n,f)),v.polygonFeature++;break;case"MultiPolygon":Dr(t.coordinates,y,v,p,n),y.properties.push(Fr(n,f)),v.polygonFeature++;break;default:throw new Error("Invalid geometry type")}v.feature++}return function(t,e,n,i){const r={points:{positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:t.numericProps,properties:t.properties},lines:{pathIndices:{value:e.pathIndices,size:1},positions:{value:e.positions,size:i},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:e.numericProps,properties:e.properties},polygons:{polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},positions:{value:n.positions,size:i},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:n.numericProps,properties:n.properties}};for(const t in r)for(const e in r[t].numericProps)r[t].numericProps[e]={value:r[t].numericProps[e],size:1};return r}(g,m,y,p)}function Ir(t,e,n,i,r){e.positions.set(t,n.pointPosition*i),e.globalFeatureIds[n.pointPosition]=n.feature,e.featureIds[n.pointPosition]=n.pointFeature,Br(e,r,n.pointPosition,1),n.pointPosition++}function Or(t,e,n,i,r){for(const o of t)Ir(o,e,n,i,r)}function Lr(t,e,n,i,r){e.pathIndices[n.linePath]=n.linePosition,n.linePath++,zr(e.positions,t,n.linePosition,i);const o=t.length;Br(e,r,n.linePosition,o),e.globalFeatureIds.set(new Uint32Array(o).fill(n.feature),n.linePosition),e.featureIds.set(new Uint32Array(o).fill(n.lineFeature),n.linePosition),n.linePosition+=o}function Rr(t,e,n,i,r){for(const o of t)Lr(o,e,n,i,r)}function kr(t,e,n,i,r){e.polygonIndices[n.polygonObject]=n.polygonPosition,n.polygonObject++;for(const o of t){e.primitivePolygonIndices[n.polygonRing]=n.polygonPosition,n.polygonRing++,zr(e.positions,o,n.polygonPosition,i);const t=o.length;Br(e,r,n.polygonPosition,t),e.globalFeatureIds.set(new Uint32Array(t).fill(n.feature),n.polygonPosition),e.featureIds.set(new Uint32Array(t).fill(n.polygonFeature),n.polygonPosition),n.polygonPosition+=t}}function Dr(t,e,n,i,r){for(const o of t)kr(o,e,n,i,r)}function Br(t,e,n,i){for(const r in t.numericProps)r in e&&t.numericProps[r].set(new Array(i).fill(e[r]),n)}function Fr(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function zr(t,e,n,i){let r=n*i;for(const n of e)t.set(n,r),r+=i}function Nr(t){return[].concat(...t)}var jr=n(233),Ur=n.n(jr);function Vr(t,e){e=function(t){const e="wgs84"===(t={...t,mvt:t.mvt||{},gis:t.gis||{}}).coordinates,{tileIndex:n}=t,i=n&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z);if(e&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property. Check documentation.");return t}(e);const n=[];if(t.byteLength>0){const i=new Sr(new Ur.a(t)),r=e.mvt;(Array.isArray(r.layers)?r.layers:Object.keys(i.layers)).forEach(t=>{const e=i.layers[t],o={...r,layerName:t};if(e)for(let t=0;t<e.length;t++){const i=Gr(e.feature(t),o);n.push(i)}})}if("binary"===e.gis.format){const e=function(t,e={}){const n=Mr(t);return Cr(t,n,{coordLength:e.coordLength||n.coordLength,numericPropKeys:e.numericPropKeys||n.numericPropKeys,PositionDataType:e.PositionDataType||Float32Array})}(n);return e.byteLength=t.byteLength,e}return n}function Gr(t,e={}){const n=t.toGeoJSON("wgs84"===e.coordinates?e.tileIndex:Wr);return e.layerProperty&&(n.properties[e.layerProperty]=e.layerName),n}function Wr(t,e){const{extent:n}=e;for(let e=0;e<t.length;e++){const i=t[e];i[0]/=n,i[1]/=n}}const Hr={...{name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:"3.0.0-alpha.6",extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{coordinates:"local",layerProperty:"layerName",layers:null,tileIndex:null,_format:"geojson"}}},parse:async(t,e)=>Vr(t,e),parseSync:Vr,binary:!0};function qr(t,e,n){if("geometry"===n)return Zr(t);const i=function(t,e){if(!Boolean(t.points||t.lines||t.polygons))return t.type=e||function(t){if(t.pathIndices)return"LineString";if(t.polygonIndices)return"Polygon";return"Point"}(t),[t];const n=[];t.points&&(t.points.type="Point",n.push(t.points));t.lines&&(t.lines.type="LineString",n.push(t.lines));t.polygons&&(t.polygons.type="Polygon",n.push(t.polygons));return n}(t,e);switch(function(t){if(t.length>1)return"FeatureCollection";const e=t[0];if(!(e.featureIds||e.globalFeatureIds||e.numericProps||e.properties))return"Geometry";return"FeatureCollection"}(i)){case"Geometry":return Zr(i[0]);case"FeatureCollection":return function(t){const e=[];for(const n of t){if(0===n.featureIds.value.length)continue;let t=0,i=n.featureIds.value[0];for(let r=0;r<n.featureIds.value.length;r++){const o=n.featureIds.value[r];o!==i&&(e.push(Xr(n,t,r)),t=r,i=o)}e.push(Xr(n,t,n.featureIds.value.length))}return e}(i)}return null}function Xr(t,e,n){return{type:"Feature",geometry:Zr(t,e,n),properties:function(t,e,n){const i=Object.assign(t.properties[t.featureIds.value[e]]);for(const n in t.numericProps)i[n]=t.numericProps[n].value[e];return i}(t,e)}}function Zr(t,e,n){switch(t.type){case"Point":return function(t,e,n){const{positions:i}=t,r=Qr(i,e,n);if(r.length>1)return{type:"MultiPoint",coordinates:r};return{type:"Point",coordinates:r[0]}}(t,e,n);case"LineString":return function(t,e=-1/0,n=1/0){const{positions:i}=t,r=t.pathIndices.value.filter(t=>t>=e&&t<=n);if(!(r.length>2)){return{type:"LineString",coordinates:Qr(i,r[0],r[1])}}const o=[];for(let t=0;t<r.length-1;t++){const e=Qr(i,r[t],r[t+1]);o.push(e)}return{type:"MultiLineString",coordinates:o}}(t,e,n);case"Polygon":return function t(e,n=-1/0,i=1/0){const{positions:r}=e,o=e.polygonIndices.value.filter(t=>t>=n&&t<=i),a=e.primitivePolygonIndices.value.filter(t=>t>=n&&t<=i),s=o.length>2,u=[];if(!s){for(let t=0;t<a.length-1;t++){const e=a[t],n=a[t+1],i=Qr(r,e,n);u.push(i)}return{type:"Polygon",coordinates:u}}for(let n=0;n<o.length-1;n++){const i=o[n],r=o[n+1],a=t(e,i,r).coordinates;u.push(a)}return{type:"MultiPolygon",coordinates:u}}(t,e,n);default:throw new Error("Unsupported geometry type: ".concat(t.type))}}function Qr(t,e,n){e=e||0,n=n||t.value.length/t.size;const i=[];for(let r=e;r<n;r++)i.push(Array.from(t.value.subarray(r*t.size,(r+1)*t.size)));return i}var Yr=n(90),Kr=n(208);const Jr={clipBounds:[0,0,1,1]},$r="\nuniform vec4 clip_bounds;\n\nbool clip_isInBounds(vec2 position) {\n  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",to={name:"clip-vs",vs:$r},eo={"vs:#decl":"\nvarying float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nvarying float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\n  if (clip_isVisible < 0.5) discard;\n"},no={name:"clip-fs",fs:$r},io={"vs:#decl":"\nvarying vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nvarying vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\n  if (!clip_isInBounds(clip_commonPosition)) discard;\n"};class ro extends Kr.a{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(t=this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[to],inject:eo}:{modules:[no],inject:io}}draw({uniforms:t}){const{clipBounds:e=Jr.clipBounds}=this.props;if(this.state.clipByInstance)t.clip_bounds=e;else{const n=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);t.clip_bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}}}ro.extensionName="ClipExtension",ro.defaultProps=Jr;const oo={Point:ao,MultiPoint:function(t,e,n){return so(t,e,n)},LineString:uo,MultiLineString:function(t,e,n){return t.map(t=>uo(t,e,n))},Polygon:co,MultiPolygon:function(t,e,n){return t.map(t=>co(t,e,n))}};function ao([t,e],[n,i],r){const o=Object(Rt.g)(n[0],i[0],t),a=Object(Rt.g)(n[1],i[1],e);return r.unprojectFlat([o,a])}function so(t,e,n){return t.map(t=>ao(t,e,n))}function uo(t,e,n){return so(t,e,n)}function co(t,e,n){return t.map(t=>so(t,e,n))}const lo={uniqueIdProperty:{type:"string",value:""},highlightedFeatureId:null,loaders:[Hr],binary:!1};class ho extends Kt{initializeState(){super.initializeState(),this.setState({data:null,tileJSON:null})}get isLoaded(){return this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:t,oldProps:e,context:n,changeFlags:i}){i.dataChanged&&this._updateTileData({props:t}),this.state.data&&(super.updateState({props:t,oldProps:e,context:n,changeFlags:i}),this._setWGS84PropertyForTiles())}async _updateTileData({props:t}){const{onDataLoad:e}=this.props;let{data:n}=t,i=null,{minZoom:r,maxZoom:o}=t;"string"!=typeof n||/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(n)?n.tilejson&&(i=n):(this.setState({data:null,tileJSON:null}),i=await async function(t){try{return await Object(x.a)(t)}catch(t){throw new Error("An error occurred fetching TileJSON: ".concat(t))}}(n),e&&e(i)),i&&(n=i.tiles,Number.isFinite(i.minzoom)&&i.minzoom>r&&(r=i.minzoom),Number.isFinite(i.maxzoom)&&(!Number.isFinite(o)||i.maxzoom<o)&&(o=i.maxzoom)),this.setState({data:n,tileJSON:i,minZoom:r,maxZoom:o})}renderLayers(){return this.state.data?super.renderLayers():null}getTileData(t){const e=zt(this.state.data,t);if(!e)return Promise.reject("Invalid URL");let n=this.getLoadOptions();return n={...n,mvt:{...n&&n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:{x:t.x,y:t.y,z:t.z}},gis:this.props.binary?{format:"binary"}:{}},Object(x.a)(e,this.props.loaders[0],n)}renderSubLayers(t){const{tile:e}=t,n=Math.pow(2,e.z),i=512/n,r=-i,o=512*e.x/n,a=512*(1-e.y/n),s=(new Rt.a).scale([i,r,1]);return t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=s,t.coordinateOrigin=[o,a,0],t.coordinateSystem=Fe.a.CARTESIAN,t.extensions=[...t.extensions||[],new ro]),super.renderSubLayers(t)}_updateAutoHighlight(t){const{uniqueIdProperty:e}=this.props,{hoveredFeatureId:n}=this.state,i=t.object;let r;i&&(r=po(i,e)),n!==r&&-1!==r&&this.setState({hoveredFeatureId:r})}getPickingInfo(t){const e=super.getPickingInfo(t),n=this.context.viewport.resolution;if(e.object&&!n)e.object=Ao(e.object,e.tile.bbox,this.context.viewport);else if(this.props.binary&&-1!==e.index){const{data:n}=t.sourceLayer.props;e.object=Object(Yr.a)(n.points,e.index)||Object(Yr.a)(n.lines,e.index)||Object(Yr.a)(n.polygons,e.index)}return e}getHighlightedObjectIndex(t){const{hoveredFeatureId:e}=this.state,{uniqueIdProperty:n,highlightedFeatureId:i,binary:r}=this.props,{data:o}=t;if(!(fo(e)||fo(i)))return-1;const a=fo(i)?i:e;if(Array.isArray(o))return o.findIndex(t=>po(t,n)===a);if(o&&r){const t=Object(Yr.d)(o,n,a),e=["points","lines","polygons"];for(const n of e){const e=o[n]&&o[n].featureIds.value[t];if(void 0!==e)return e}}return-1}_pickObjects(t){const{deck:e,viewport:n}=this.context,i=n.width,r=n.height,o=n.x,a=n.y,s=[this.id];return e.pickObjects({x:o,y:a,width:i,height:r,layerIds:s,maxObjects:t})}getRenderedFeatures(t=null){const e=this._pickObjects(t),n=new Set,i=[];for(const t of e){const e=po(t.object,this.props.uniqueIdProperty);-1===e?i.push(t.object):n.has(e)||(n.add(e),i.push(t.object))}return i}_setWGS84PropertyForTiles(){const{tileset:t}=this.state;t.selectedTiles.forEach(t=>{t.hasOwnProperty("dataInWGS84")||Object.defineProperty(t,"dataInWGS84",{get:()=>{if(!t.content)return null;if(this.props.binary&&Array.isArray(t.content)&&!t.content.length)return[];if(void 0===t._contentWGS84){const e=this.props.binary?qr(t.content):t.content;t._contentWGS84=e.map(e=>Ao(e,t.bbox,this.context.viewport))}return t._contentWGS84}})})}}function po(t,e){return e?t.properties[e]:"id"in t?t.id:-1}function fo(t){return null!=t&&""!==t}function Ao(t,e,n){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>function(t,e,n){const i=[n.projectFlat([e.west,e.north]),n.projectFlat([e.east,e.south])];return{...t,coordinates:oo[t.type](t.coordinates,i,n)}}(t.geometry,e,n).coordinates}),i}ho.layerName="MVTLayer",ho.defaultProps=lo,n.d(e,"GreatCircleLayer",(function(){return r})),n.d(e,"S2Layer",(function(){return v})),n.d(e,"TileLayer",(function(){return Kt})),n.d(e,"TripsLayer",(function(){return $t})),n.d(e,"H3ClusterLayer",(function(){return Ce})),n.d(e,"H3HexagonLayer",(function(){return De})),n.d(e,"Tile3DLayer",(function(){return cr})),n.d(e,"TerrainLayer",(function(){return _r})),n.d(e,"MVTLayer",(function(){return ho}))},function(t,e,n){"use strict";n.r(e);var i=n(6),r=n(191),o=n(261),a=n(0),s=n(196),u=n(170),c=n(283);function l(t,e=[],n=0){const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function h(t){return t-Math.fround(t)}function p(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;l(t[4*i+n],e,2*r)}return e}const f={ONE:1};const d={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",fs:null,getUniforms:function(){return f},fp64ify:l,fp64LowPart:h,fp64ifyMatrix4:p};var A=n(151),g=n(207);const m={SUM:1,MEAN:2,MIN:3,MAX:4};function y(t,e){return t+e}function v(t,e){return e>t?e:t}function _(t,e){return e<t?e:t}function b(t,e,n){const i=m[t]||m.SUM;switch(e=function(t,e={}){if(Number.isFinite(t))return t;return n=>(e.index=n.index,t(n.source,e))}(e,n),i){case m.MIN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(_,1/0):null}(t,e);case m.SUM:return t=>function(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(y,0):null}(t,e);case m.MEAN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(y,0)/n.length:null}(t,e);case m.MAX:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(v,-1/0):null}(t,e);default:return null}}function x(t,e={}){return n=>(e.indices=n.map(t=>t.index),t(n.map(t=>t.source),e))}const w={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},E=[32775,32774],T=[32776,32774],S=[32776,32775],P={[m.SUM]:32774,[m.MEAN]:32774,[m.MIN]:E,[m.MAX]:T},M={size:1,operation:m.SUM,needMin:!1,needMax:!1,combineMaxMin:!1};var C=n(116),I=n(68);const O={10240:9728,10241:9728};function L(t,e={}){const{width:n=1,height:i=1,data:r=null,unpackFlipY:o=!0,parameters:s=O}=e;return new C.a(t,{data:r,format:Object(a.j)(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:s,dataFormat:6408,width:n,height:i,unpackFlipY:o})}function R(t,e){const{id:n,width:i=1,height:r=1,texture:o}=e;return new I.a(t,{id:n,width:i,height:r,attachments:{36064:o}})}const k=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],D={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},B=[r.a.WEBGL2,r.a.COLOR_ATTACHMENT_RGBA32F,r.a.BLEND_EQUATION_MINMAX,r.a.FLOAT_BLEND,r.a.TEXTURE_FLOAT];class F{static getAggregationData({aggregationData:t,maxData:e,minData:n,maxMinData:i,pixelIndex:r}){const o=4*r,a={};return t&&(a.cellCount=t[o+3],a.cellWeight=t[o]),i?(a.maxCellWieght=i[0],a.minCellWeight=i[3]):(e&&(a.maxCellWieght=e[0],a.totalCount=e[3]),n&&(a.minCellWeight=n[0],a.totalCount=e[3])),a}static getCellData({countsData:t,size:e=1}){const n=t.length/4,i=new Float32Array(n*e),r=new Uint32Array(n);for(let o=0;o<n;o++){for(let n=0;n<e;n++)i[o*e+n]=t[4*o+n];r[o]=t[4*o+3]}return{cellCounts:r,cellWeights:i}}static isSupported(t){return Object(o.c)(t,B)}constructor(t,e={}){this.id=e.id||"gpu-grid-aggregator",this.gl=t,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(a.j)(t)&&Object(o.c)(this.gl,r.a.BLEND_EQUATION_MINMAX,r.a.COLOR_ATTACHMENT_RGBA32F,r.a.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:e,meanTransform:n}=this,{textures:i,framebuffers:r,maxMinFramebuffers:o,minFramebuffers:a,maxFramebuffers:s,meanTextures:u,resources:c}=this.state;null==t||t.delete(),null==e||e.delete(),null==n||n.delete(),function(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{for(const e in t)t[e].delete()})}([r,i,o,a,s,u,c])}run(t={}){this.setState({results:{}});const e=this._normalizeAggregationParams(t);return this._hasGPUSupport||i.a.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(e)}getData(t){const e={},n=this.state.results;n[t].aggregationData||(n[t].aggregationData=n[t].aggregationBuffer.getData()),e.aggregationData=n[t].aggregationData;for(const i in D){const r=D[i];(n[t][i]||n[t][r])&&(n[t][i]=n[t][i]||n[t][r].getData(),e[i]=n[t][i])}return e}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const e={...w,...t},{weights:n}=e;return n&&(e.weights=function(t){const e={};for(const n in t)e[n]={...M,...t[n]};return e}(n)),e}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const e={},{textures:n,framebuffers:i,maxMinFramebuffers:r,minFramebuffers:o,maxFramebuffers:a,resources:u}=this.state,{weights:c}=t;for(const t in c){e[t]={};const{needMin:l,needMax:h,combineMaxMin:p}=c[t];e[t].aggregationTexture=n[t],e[t].aggregationBuffer=Object(s.d)(i[t],{target:c[t].aggregationBuffer,sourceType:5126}),l&&h&&p?(e[t].maxMinBuffer=Object(s.d)(r[t],{target:c[t].maxMinBuffer,sourceType:5126}),e[t].maxMinTexture=u["".concat(t,"-maxMinTexture")]):(l&&(e[t].minBuffer=Object(s.d)(o[t],{target:c[t].minBuffer,sourceType:5126}),e[t].minTexture=u["".concat(t,"-minTexture")]),h&&(e[t].maxBuffer=Object(s.d)(a[t],{target:c[t].maxBuffer,sourceType:5126}),e[t].maxTexture=u["".concat(t,"-maxTexture")]))}return this._trackGPUResultBuffers(e,c),e}_renderAggregateData(t){const{cellSize:e,projectPoints:n,attributes:i,moduleSettings:r,numCol:o,numRow:a,weights:s,translation:u,scaling:c}=t,{maxMinFramebuffers:l,minFramebuffers:h,maxFramebuffers:p}=this.state,f=[o,a],d={blend:!0,depthTest:!1,blendFunc:[1,1]},A={cellSize:e,gridSize:f,projectPoints:n,translation:u,scaling:c};for(const t in s){const{needMin:e,needMax:n}=s[t],o=e&&n&&s[t].combineMaxMin;this._renderToWeightsTexture({id:t,parameters:d,moduleSettings:r,uniforms:A,gridSize:f,attributes:i,weights:s}),o?this._renderToMaxMinTexture({id:t,parameters:{...d,blendEquation:S},gridSize:f,minOrMaxFb:l[t],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:o}):(e&&this._renderToMaxMinTexture({id:t,parameters:{...d,blendEquation:E},gridSize:f,minOrMaxFb:h[t],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:o}),n&&this._renderToMaxMinTexture({id:t,parameters:{...d,blendEquation:T},gridSize:f,minOrMaxFb:p[t],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:o}))}}_renderToMaxMinTexture(t){const{id:e,parameters:n,gridSize:i,minOrMaxFb:r,combineMaxMin:o,clearParams:s={}}=t,{framebuffers:u}=this.state,{gl:c,allAggregationModel:l}=this;Object(a.o)(c,{...s,framebuffer:r,viewport:[0,0,i[0],i[1]]},()=>{c.clear(16384),l.draw({parameters:n,uniforms:{uSampler:u[e].texture,gridSize:i,combineMaxMin:o}})})}_renderToWeightsTexture(t){const{id:e,parameters:n,moduleSettings:i,uniforms:r,gridSize:o,weights:s}=t,{framebuffers:u,equations:l,weightAttributes:h}=this.state,{gl:p,gridAggregationModel:f}=this,{operation:d}=s[e],A=d===m.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];if(Object(a.o)(p,{framebuffer:u[e],viewport:[0,0,o[0],o[1]],clearColor:A},()=>{p.clear(16384);const t={weights:h[e]};f.draw({parameters:{...n,blendEquation:l[e]},moduleSettings:i,uniforms:r,attributes:t})}),d===m.MEAN){const{meanTextures:t,textures:n}=this.state,i={_sourceTextures:{aggregationValues:t[e]},_targetTexture:n[e],elementCount:n[e].width*n[e].height};this.meanTransform?this.meanTransform.update(i):this.meanTransform=function(t,e){return new c.a(t,{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n  gl_PointSize = 1.0;\n}\n",_targetTextureVarying:"meanValues",...e})}(p,i),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),u[e].attach({36064:n[e]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const e=this._getAggregateData(t);return this.setState({results:e}),e}_setupFramebuffers(t){const{textures:e,framebuffers:n,maxMinFramebuffers:i,minFramebuffers:r,maxFramebuffers:o,meanTextures:a,equations:s}=this.state,{weights:u}=t,{numCol:c,numRow:l}=t,h={width:c,height:l};for(const t in u){const{needMin:p,needMax:f,combineMaxMin:d,operation:A}=u[t];e[t]=u[t].aggregationTexture||e[t]||L(this.gl,{id:"".concat(t,"-texture"),width:c,height:l}),e[t].resize(h);let g=e[t];A===m.MEAN&&(a[t]=a[t]||L(this.gl,{id:"".concat(t,"-mean-texture"),width:c,height:l}),a[t].resize(h),g=a[t]),n[t]?n[t].attach({36064:g}):n[t]=R(this.gl,{id:"".concat(t,"-fb"),width:c,height:l,texture:g}),n[t].resize(h),s[t]=P[A]||P.SUM,(p||f)&&(p&&f&&d?i[t]||(g=u[t].maxMinTexture||this._getMinMaxTexture("".concat(t,"-maxMinTexture")),i[t]=R(this.gl,{id:"".concat(t,"-maxMinFb"),texture:g})):(p&&(r[t]||(g=u[t].minTexture||this._getMinMaxTexture("".concat(t,"-minTexture")),r[t]=R(this.gl,{id:"".concat(t,"-minFb"),texture:g}))),f&&(o[t]||(g=u[t].maxTexture||this._getMinMaxTexture("".concat(t,"-maxTexture")),o[t]=R(this.gl,{id:"".concat(t,"-maxFb"),texture:g})))))}}_getMinMaxTexture(t){const{resources:e}=this.state;return e[t]||(e[t]=L(this.gl,{id:"resourceName"})),e[t]}_setupModels({numCol:t=0,numRow:e=0}={}){var n;const{gl:i}=this,{shaderOptions:r}=this.state;if(null===(n=this.gridAggregationModel)||void 0===n||n.delete(),this.gridAggregationModel=function(t,e){const n=Object(A.a)({vs:"#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result;\n  pos.xy = pos.xy/pos.w;\n  result = pos + vec4(translation, 0., 0.);\n  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\n  return result.xy;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  vec2 pixelXY64[2];\n  pixelXY64[0] = vec2(pos.x, 0.);\n  pixelXY64[1] = vec2(pos.y, 0.);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",fs:"#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[d,g.a]},e);return new u.a(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...n})}(i,r),!this.allAggregationModel){const n=t*e;this.allAggregationModel=function(t,e){return new u.a(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:[d],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}(i,n)}}_setupWeightAttributes(t){const{weightAttributes:e}=this.state,{weights:n}=t;for(const i in n)e[i]=t.attributes[i]}_trackGPUResultBuffers(t,e){const{resources:n}=this.state;for(const i in t)if(t[i])for(const r of k)if(t[i][r]&&e[i][r]!==t[i][r]){const e="gpu-result-".concat(i,"-").concat(r);n[e]&&n[e].delete(),n[e]=t[i][r]}}_updateModels(t){const{vertexCount:e,attributes:n,numCol:i,numRow:r}=t,{modelDirty:o}=this.state;o&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(e),this.gridAggregationModel.setAttributes(n),this.allAggregationModel.setInstanceCount(i*r)}}var z=n(58),N=n(108),j=n(224);const U=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function V(t,e=!1,n=Float32Array){let i;if(Number.isFinite(t[0]))i=new n(t);else{i=new n(4*t.length);let e=0;for(let n=0;n<t.length;n++){const r=t[n];i[e++]=r[0],i[e++]=r[1],i[e++]=r[2],i[e++]=Number.isFinite(r[3])?r[3]:255}}if(e)for(let t=0;t<i.length;t++)i[t]/=255;return i}const G=[0,0,0,0],W=[0,255,0,255],H=["minColor","maxColor","colorRange","colorDomain"],q={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:U};class X extends N.a{static isSupported(t){return Object(o.c)(t,[r.a.TEXTURE_FLOAT])}getShaders(){return{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[j.a]}}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(t)})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({oldProps:t,props:e,changeFlags:n}){super.updateState({oldProps:t,props:e,changeFlags:n});const i=this.getAttributeManager();e.numInstances!==t.numInstances?i.invalidateAll():t.cellSizePixels!==e.cellSizePixels&&i.invalidate("instancePositions"),this._updateUniforms(t,e,n)}draw({uniforms:t}){const{parameters:e,maxTexture:n}=this.props,i=this.props.minColor||G,r=this.props.maxColor||W,o=this.props.colorDomain||[1,0],{model:a}=this.state;a.setUniforms(t).setUniforms({minColor:i,maxColor:r,maxTexture:n,colorDomain:o}).draw({parameters:{depthTest:!1,depthMask:!1,...e}})}calculateInstancePositions(t,{numInstances:e}){const{width:n,height:i}=this.context.viewport,{cellSizePixels:r}=this.props,o=Math.ceil(n/r),{value:a,size:s}=t;for(let t=0;t<e;t++){const e=t%o,u=Math.floor(t/o);a[t*s+0]=e*r/n*2-1,a[t*s+1]=1-u*r/i*2,a[t*s+2]=0}}_getModel(t){return new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new z.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:t,maxColor:e,colorDomain:n,colorRange:r}=this.props;return t||e?(i.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!n&&!r}_updateUniforms(t,e,n){const{model:i}=this.state;if(H.some(n=>t[n]!==e[n])&&i.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==e.colorRange&&i.setUniforms({colorRange:V(e.colorRange)}),t.cellMarginPixels!==e.cellMarginPixels||t.cellSizePixels!==e.cellSizePixels||n.viewportChanged){const{width:t,height:e}=this.context.viewport,{cellSizePixels:n,cellMarginPixels:r}=this.props,o=n>r?r:0,a=new Float32Array([(n-o)/t*2,-(n-o)/e*2,1]);i.setUniforms({cellScale:a})}}}X.layerName="ScreenGridCellLayer",X.defaultProps=q;var Z=n(188),Q=n(128),Y=n(153);function K(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}class J extends Z.a{initializeState(t){super.initializeState(),this.setState({ignoreProps:K(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:Object(a.e)(n)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:n,oldProps:i,changeFlags:r}=t,{compareAll:o=!1,dimension:a}=e,{ignoreProps:s}=this.state,{props:u,accessors:c=[]}=a,{updateTriggersChanged:l}=r;if(r.dataChanged)return!0;if(l){if(l.all)return!0;for(const t of c)if(l[t])return!0}if(o)return!!r.extensionsChanged||Object(Q.a)({oldProps:i,newProps:n,ignoreProps:s,propTypes:this.constructor._propTypes});for(const t of u)if(n[t]!==i[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const n in t){e=!1;break}return e}(e)}_getAttributeManager(){return new Y.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}}J.layerName="AggregationLayer";var $=n(27);function tt(t,e,n){const i=n;return i.domain=()=>t,i.range=()=>e,i}function et(t,e){return tt(t,e,n=>function(t,e,n){const r=t[1]-t[0];if(r<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const o=r/e.length,a=Math.floor((n-t[0])/o),s=Math.max(Math.min(a,e.length-1),0);return e[s]}(t,e,n))}function nt(t,e){return tt(t,e,n=>function(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}(t,e,n))}function it(t,e){const n=t.sort(rt);let i=0;const r=Math.max(1,e.length),o=new Array(r-1);for(;++i<r;)o[i-1]=ot(n,i/r);const a=t=>function(t,e,n){return e[function(t,e){let n=0,i=t.length;for(;n<i;){const r=n+i>>>1;rt(t[r],e)>0?i=r:n=r+1}return n}(t,n)]}(o,e,t);return a.thresholds=()=>o,tt(t,e,a)}function rt(t,e){return t-e}function ot(t,e){const n=t.length;if(e<=0||n<2)return t[0];if(e>=1)return t[n-1];const i=(n-1)*e,r=Math.floor(i),o=t[r];return o+(t[r+1]-o)*(i-r)}function at(t,e){const n=new Map,i=[];for(const e of t){const t="".concat(e);n.has(t)||n.set(t,i.push(e))}return tt(t,e,t=>function(t,e,n,i){const r="".concat(i);let o=e.get(r);return void 0===o&&(o=t.push(i),e.set(r,o)),n[(o-1)%n.length]}(i,n,e,t))}function st(t){return null!=t}function ut(t,e){return("function"==typeof e?t.map(e):t).filter(st)}function ct(t,e){return ut(t,e)}function lt(t,e){return function(t){const e=[];return t.forEach(t=>{!e.includes(t)&&st(t)&&e.push(t)}),e}(ut(t,e))}const ht=t=>t.length,pt=t=>t.points,ft=t=>t.index,dt=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,At={getValue:ht,getPoints:pt,getIndex:ft,filterData:null};class gt{constructor(t=[],e=At){this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:n=ht,getPoints:i=pt,getIndex:r=ft,filterData:o}=e,a="function"==typeof o,s=t.length,u=[];let c=0;for(let e=0;e<s;e++){const s=t[e],l=i(s),h=r(s),p=a?l.filter(o):l;s.filteredPoints=a?p:null;const f=p.length?n(p):null;null!=f&&(u[c]={i:Number.isFinite(h)?h:e,value:f,counts:p.length},c++)}return u}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[n,i]=t.map(t=>{return e=t,n=0,i=100,Math.max(n,Math.min(i,e));var e,n,i});return[Math.ceil(n/100*(e-1)),Math.floor(i/100*(e-1))]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,n=3402823466e29,i=0;for(const r of this.aggregatedBins)t=t>r.counts?t:r.counts,e=e>r.value?e:r.value,n=n<r.value?n:r.value,i+=r.counts;this.maxCount=t,this.maxValue=e,this.minValue=n,this.totalCount=i}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>dt(t.value,e.value))),!this.sortedBins.length)return[];let e=0,n=this.sortedBins.length-1;if(Array.isArray(t)){const i=this._percentileToIndex(t);e=i[0],n=i[1]}return[this.sortedBins[e].value,this.sortedBins[n].value]}getValueDomainByScale(t,[e=0,n=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>dt(t.value,e.value))),!this.sortedBins.length)return[];const i=this._percentileToIndex([e,n]);return this._getScaleDomain(t,i)}_getScaleDomain(t,[e,n]){const i=this.sortedBins;switch(t){case"quantize":case"linear":return[i[e].value,i[n].value];case"quantile":return ct(i.slice(e,n+1),t=>t.value);case"ordinal":return lt(i,t=>t.value);default:return[i[e].value,i[n].value]}}}var mt=n(45),yt=n(5);function vt(t){return Number.isFinite(t)?t:0}function _t(t,e){const n=t.positions.value;let i,r,o=1/0,a=-1/0,s=1/0,u=-1/0;for(let t=0;t<e;t++)r=n[3*t],i=n[3*t+1],o=i<o?i:o,a=i>a?i:a,s=r<s?r:s,u=r>u?r:u;return{xMin:vt(s),xMax:vt(u),yMin:vt(o),yMax:vt(a)}}function bt(t,e){const n=t<0?-1:1;let i=n<0?Math.abs(t)+e:Math.abs(t);return i=Math.floor(i/e)*e,i*n}function xt(t,e,n=!0){if(!n)return{xOffset:e,yOffset:e};const{yMin:i,yMax:r}=t;return function(t,e){const n=(a=t,a/6378e3*(180/Math.PI)),i=(r=e,o=t,o/6378e3*(180/Math.PI)/Math.cos(r*Math.PI/180));var r,o;var a;return{yOffset:n,xOffset:i}}(e,(i+r)/2)}function wt(t,e,n,r){const o=xt(t,e,r!==yt.a.CARTESIAN),a=function(t,e,n,r){const{width:o,height:a}=r,s=n===yt.a.CARTESIAN?[-o/2,-a/2]:[-180,-90];i.a.assert(n===yt.a.CARTESIAN||n===yt.a.LNGLAT||n===yt.a.DEFAULT);const{xMin:u,yMin:c}=t;return[-1*(bt(u-s[0],e.xOffset)+s[0]),-1*(bt(c-s[1],e.yOffset)+s[1])]}(t,o,r,n),{xMin:s,yMin:u,xMax:c,yMax:l}=t,h=c-s+o.xOffset,p=l-u+o.yOffset;return{gridOffset:o,translation:a,width:h,height:p,numCol:Math.ceil(h/o.xOffset),numRow:Math.ceil(p/o.yOffset)}}function Et(t,e){const n=function(t,e){const{data:n=[],cellSize:i}=t,{attributes:r,viewport:o,projectPoints:a,numInstances:s}=e,u=r.positions.value,{size:c}=r.positions.getAccessor(),l=e.boundingBox||function(t,e){const n=t.value,{size:i}=t.getAccessor();let r,o,a=1/0,s=-1/0,u=1/0,c=-1/0;for(let t=0;t<e;t++)o=n[t*i],r=n[t*i+1],Number.isFinite(o)&&Number.isFinite(r)&&(a=r<a?r:a,s=r>s?r:s,u=o<u?o:u,c=o>c?o:c);return{xMin:u,xMax:c,yMin:a,yMax:s}}(r.positions,s),h=e.posOffset||[180,90],p=e.gridOffset||xt(l,i);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};const{width:f,height:d}=o,A=Math.ceil(f/p.xOffset),g=Math.ceil(d/p.yOffset),m={},{iterable:y,objectInfo:v}=Object(mt.a)(n),_=new Array(3);for(const t of y){v.index++,_[0]=u[v.index*c],_[1]=u[v.index*c+1],_[2]=c>=3?u[v.index*c+2]:0;const[e,n]=a?o.project(_):_;if(Number.isFinite(e)&&Number.isFinite(n)){const i=Math.floor((n+h[1])/p.yOffset),r=Math.floor((e+h[0])/p.xOffset);if(!a||r>=0&&r<A&&i>=0&&i<g){const e="".concat(i,"-").concat(r);m[e]=m[e]||{count:0,points:[],lonIdx:r,latIdx:i},m[e].count+=1,m[e].points.push({source:t,index:v.index})}}}return{gridHash:m,gridOffset:p,offsets:[-1*h[0],-1*h[1]]}}(t,e),i=function({gridHash:t,gridOffset:e,offsets:n}){const i=new Array(Object.keys(t).length);let r=0;for(const o in t){const a=o.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c=r++;i[c]={index:c,position:[n[0]+e.xOffset*u,n[1]+e.yOffset*s],...t[o]}}return i}(n);return{gridHash:n.gridHash,gridOffset:n.gridOffset,data:i}}class Tt extends J{initializeState({dimensions:t}){const{gl:e}=this.context;super.initializeState(t),this.setState({layerData:{},gpuGridAggregator:new F(e,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:Et})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:e,aggregationWeightsDirty:n,gpuAggregation:i}=this.state;if(this.getNumInstances()<=0)return;let r=!1;(e||i&&n)&&(this._updateAggregation(t),r=!0),i||!e&&!n||(this._updateWeightBins(),this._uploadAggregationResults(),r=!0),this.setState({aggregationDirty:r})}finalizeState(){var t;const{count:e}=this.state.weights;e&&e.aggregationBuffer&&e.aggregationBuffer.delete(),null===(t=this.state.gpuGridAggregator)||void 0===t||t.delete(),super.finalizeState()}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){i.a.assert(!1)}allocateResources(t,e){if(this.state.numRow!==t||this.state.numCol!==e){const n=e*t*4*4,i=this.context.gl,{weights:r}=this.state;for(const t in r){const e=r[t];e.aggregationBuffer&&e.aggregationBuffer.delete(),e.aggregationBuffer=new $.a(i,{byteLength:n,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:e,maxData:n,minData:i}){const{count:r}=this.state.weights;r&&(r.aggregationData=t,r.maxMinData=e,r.maxData=n,r.minData=i)}_updateAggregation(t){const{cpuGridAggregator:e,gpuGridAggregator:n,gridOffset:i,posOffset:r,translation:o=[0,0],scaling:a=[0,0,0],boundingBox:s,projectPoints:u,gpuAggregation:c,numCol:l,numRow:h}=this.state,{props:p}=t,{viewport:f}=this.context,d=this.getAttributes(),A=this.getNumInstances();if(c){const{weights:t}=this.state;n.run({weights:t,cellSize:[i.xOffset,i.yOffset],numCol:l,numRow:h,translation:o,scaling:a,vertexCount:A,projectPoints:u,attributes:d,moduleSettings:this.getModuleSettings()})}else{const t=e(p,{gridOffset:i,projectPoints:u,attributes:d,viewport:f,posOffset:r,boundingBox:s});this.setState({layerData:t})}}_updateWeightBins(){const{getValue:t}=this.state,e=new gt(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:e})}_uploadAggregationResults(){const{numCol:t,numRow:e}=this.state,{data:n}=this.state.layerData,{aggregatedBins:i,minValue:r,maxValue:o,totalCount:a}=this.state.sortedBins,s=new Float32Array(t*e*4).fill(0);for(const e of i){const{lonIdx:i,latIdx:r}=n[e.i],{value:o,counts:a}=e,u=4*(i+r*t);s[u]=o,s[u+4-1]=a}const u=new Float32Array([o,0,0,r]),c=new Float32Array([o,0,0,a]),l=new Float32Array([r,0,0,a]);this.updateResults({aggregationData:s,maxMinData:u,maxData:c,minData:l})}}Tt.layerName="GridAggregationLayer";const St={...X.defaultProps,getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},Pt={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class Mt extends Tt{initializeState(){const{gl:t}=this.context;if(!X.isSupported(t))return this.setState({supported:!1}),void i.a.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();super.initializeState({dimensions:Pt,getCellSize:t=>t.cellSizePixels});const e={count:{size:1,operation:m.SUM,needMax:!0,maxTexture:L(t,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return this.state.supported&&t.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:t,numRow:e,numCol:n,weights:i}=this.state,{updateTriggers:r}=this.props,{aggregationBuffer:o}=i.count;return new(this.getSubLayerClass("cells",X))(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:r}),{data:{attributes:{instanceCounts:o}},maxTexture:t,numInstances:e*n})}finalizeState(){super.finalizeState();const{aggregationBuffer:t,maxBuffer:e,maxTexture:n}=this.state;null==t||t.delete(),null==e||e.delete(),null==n||n.delete()}getPickingInfo({info:t,mode:e}){const{index:n}=t;if(n>=0){const{gpuGridAggregator:e}=this.state,i=e.getData("count");t.object=F.getAggregationData({pixelIndex:n,...i})}return t}updateResults({aggregationData:t,maxData:e}){const{count:n}=this.state.weights;n.aggregationData=t,n.aggregationBuffer.setData({data:t}),n.maxData=e,n.maxTexture.setImageData({data:e})}updateAggregationState(t){const e=t.props.cellSizePixels,n=t.oldProps.cellSizePixels!==e,{viewportChanged:r}=t.changeFlags;let o=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&o&&!F.isSupported(this.context.gl)&&(i.a.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);const a=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});const s=this.isAttributeChanged("positions"),{dimensions:u}=this.state,{data:c,weights:l}=u,h=s||a||r||this.isAggregationDirty(t,{compareAll:o,dimension:c}),p=this.isAggregationDirty(t,{dimension:l});this.setState({aggregationDataDirty:h,aggregationWeightsDirty:p});const{viewport:f}=this.context;if(r||n){const{width:t,height:n}=f,i=Math.ceil(t/e),r=Math.ceil(n/e);this.allocateResources(r,i),this.setState({scaling:[t/2,-n/2,1],gridOffset:{xOffset:e,yOffset:e},width:t,height:n,numCol:i,numRow:r})}p&&this._updateAccessors(t),(h||p)&&this._resetResults()}_updateAccessors(t){const{getWeight:e,aggregation:n,data:i}=t.props,{count:r}=this.state.weights;r&&(r.getWeight=e,r.operation=m[n]),this.setState({getValue:b(n,e,{data:i})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}}Mt.layerName="ScreenGridLayer",Mt.defaultProps=St;var Ct=n(213);function It(){}const Ot=["getBins","getDomain","getScaleFunc"],Lt=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],Rt=t=>t.cellSize;class kt{constructor(t){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||Rt,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||Lt)}static defaultDimensions(){return Lt}updateState(t,e){const{oldProps:n,props:i,changeFlags:r}=t;this.updateGetValueFuncs(n,i,r);const o=this.needsReProjectPoints(n,i,r);let a=!1;if(r.dataChanged||o)this.getAggregatedData(i,e),a=!0;else{(this.getDimensionChanges(n,i,r)||[]).forEach(t=>"function"==typeof t&&t()),a=!0}return this.setState({aggregationDirty:a}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,e){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...e}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,e){const n=this._getAggregator(t)(t,e);this.setState({layerData:this.normalizeResult(n)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,e,n){for(const i in this.dimensionUpdaters){const{value:r,weight:o,aggregation:a}=this.dimensionUpdaters[i].getBins.triggers;let s=e[r.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,t,e,n)&&(s=s?x(s,{data:e.data}):b(e[a.prop],e[o.prop],{data:e.data})),s&&this.setDimensionState(i,{getValue:s})}}needsReProjectPoints(t,e,n){return this._getCellSize(t)!==this._getCellSize(e)||this._getAggregator(t)!==this._getAggregator(e)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(t=>{const{key:e}=t;this.dimensionUpdaters[e]=this.getDimensionUpdaters(t),this.state.dimensions[e]={getValue:null,domain:null,sortedBins:null,scaleFunc:It}})}getDimensionUpdaters({key:t,accessor:e,pickingInfo:n,getBins:i,getDomain:r,getScaleFunc:o,nullValue:a}){return{key:t,accessor:e,pickingInfo:n,getBins:{updater:this.getDimensionSortedBins,...i},getDomain:{updater:this.getDimensionValueDomain,...r},getScaleFunc:{updater:this.getDimensionScale,...o},attributeAccessor:this.getSubLayerDimensionAttribute(t,a)}}needUpdateDimensionStep(t,e,n,i){return Object.values(t.triggers).some(t=>t.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[t.updateTrigger]):e[t.prop]!==n[t.prop])}getDimensionChanges(t,e,n){const i=[];for(const r in this.dimensionUpdaters){const o=Ot.find(i=>this.needUpdateDimensionStep(this.dimensionUpdaters[r][i],t,e,n));o&&i.push(this.dimensionUpdaters[r][o].updater.bind(this,e,this.dimensionUpdaters[r]))}return i.length?i:null}getUpdateTriggers(t){const e=t.updateTriggers||{},n={};for(const i in this.dimensionUpdaters){const{accessor:r}=this.dimensionUpdaters[i];n[r]={},Ot.forEach(o=>{Object.values(this.dimensionUpdaters[i][o].triggers).forEach(({prop:i,updateTrigger:o})=>{if(o){const t=e[o];"object"!=typeof t||Array.isArray(t)?void 0!==t&&(n[r][i]=t):Object.assign(n[r],t)}else n[r][i]=t[i]})})}return n}getSortedBins(t){for(const e in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[e])}getDimensionSortedBins(t,e){const{key:n}=e,{getValue:i}=this.state.dimensions[n],r=new gt(this.state.layerData.data||[],{getValue:i,filterData:t._filterData});this.setDimensionState(n,{sortedBins:r}),this.getDimensionValueDomain(t,e)}getDimensionValueDomain(t,e){const{getDomain:n,key:i}=e,{triggers:{lowerPercentile:r,upperPercentile:o,scaleType:a}}=n,s=this.state.dimensions[i].sortedBins.getValueDomainByScale(t[a.prop],[t[r.prop],t[o.prop]]);this.setDimensionState(i,{valueDomain:s}),this.getDimensionScale(t,e)}getDimensionScale(t,e){const{key:n,getScaleFunc:i,getDomain:r}=e,{domain:o,range:a}=i.triggers,{scaleType:s}=r.triggers,{onSet:u}=i,c=t[a.prop],l=t[o.prop]||this.state.dimensions[n].valueDomain,h=function(t){switch(t){case"quantize":return et;case"linear":return nt;case"quantile":return it;case"ordinal":return at;default:return et}}(s&&t[s.prop])(l,c);"object"==typeof u&&"function"==typeof t[u.props]&&t[u.props](h.domain()),this.setDimensionState(n,{scaleFunc:h})}getSubLayerDimensionAttribute(t,e){return n=>{const{sortedBins:i,scaleFunc:r}=this.state.dimensions[t],o=i.binMap[n.index];if(o&&0===o.counts)return e;const a=o&&o.value,s=r.domain();return a>=s[0]&&a<=s[s.length-1]?r(a):e}}getSubLayerAccessors(t){const e={};for(const n in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[n];e[i]=this.getSubLayerDimensionAttribute(t,n)}return e}getPickingInfo({info:t}){let e=null;if(t.picked&&t.index>-1){const n=this.state.layerData.data[t.index],i={};for(const t in this.dimensionUpdaters){const{pickingInfo:e}=this.dimensionUpdaters[t],{sortedBins:r}=this.state.dimensions[t],o=r.binMap[n.index]&&r.binMap[n.index].value;i[e]=o}e=Object.assign(i,n,{points:n.filteredPoints||n.points})}return t.picked=Boolean(e),t.object=e,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:It}}function Dt(){}const Bt={colorDomain:null,colorRange:U,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Dt,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Dt,gridAggregator:Et,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class Ft extends J{initializeState(){const t=new kt({getAggregator:t=>t.gridAggregator,getCellSize:t=>t.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances(t.props)})})}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,cellSize:n,coverage:i,material:r,transitions:o}=this.props,{cpuAggregator:a}=this.state,s=this.getSubLayerClass("grid-cell",Ct.a),u=this._getSublayerUpdateTriggers();return new s({cellSize:n,coverage:i,material:r,elevationScale:t,extruded:e,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:u}),{data:a.state.layerData.data})}}Ft.layerName="CPUGridLayer",Ft.defaultProps=Bt;var zt=n(154),Nt=Math.PI/3,jt=[0,Nt,2*Nt,3*Nt,4*Nt,5*Nt];function Ut(t){return t[0]}function Vt(t){return t[1]}function Gt(){}const Wt={colorDomain:null,colorRange:U,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Gt,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Gt,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){const{data:n,radius:r}=t,{viewport:o,attributes:a}=e,s=n.length?function(t,e){const{attributes:n}=e,i=n.positions.value,{size:r}=n.positions.getAccessor();let o,a=1/0,s=1/0,u=-1/0,c=-1/0;for(o=0;o<r*t.length;o+=r){const t=i[o],e=i[o+1];Number.isFinite(t)&&Number.isFinite(e)&&(a=Math.min(t,a),u=Math.max(t,u),s=Math.min(e,s),c=Math.max(e,c))}return[a,s,u,c].every(Number.isFinite)?[(a+u)/2,(s+c)/2]:null}(n,e):null,u=function(t,e,n){const{unitsPerMeter:i}=e.getDistanceScales(n);return t*i[0]}(r,o,s),c=[],{iterable:l,objectInfo:h}=Object(mt.a)(n),p=a.positions.value,{size:f}=a.positions.getAccessor();for(const t of l){h.index++;const e=h.index*f,n=[p[e],p[e+1]];Number.isFinite(n[0])&&Number.isFinite(n[1])?c.push({screenCoord:o.projectFlat(n),source:t,index:h.index}):i.a.warn("HexagonLayer: invalid position")()}return{hexagons:function(){var t,e,n,i=0,r=0,o=1,a=1,s=Ut,u=Vt;function c(t){var i,r={},o=[],a=t.length;for(i=0;i<a;++i)if(!isNaN(l=+s.call(null,c=t[i],i,t))&&!isNaN(h=+u.call(null,c,i,t))){var c,l,h,p=Math.round(h/=n),f=Math.round(l=l/e-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var A=l-f,g=f+(l<f?-1:1)/2,m=p+(h<p?-1:1),y=l-g,v=h-m;A*A+d*d>y*y+v*v&&(f=g+(1&p?1:-1)/2,p=m)}var _=f+"-"+p,b=r[_];b?b.push(c):(o.push(b=r[_]=[c]),b.x=(f+(1&p)/2)*e,b.y=p*n)}return o}function l(t){var e=0,n=0;return jt.map((function(i){var r=Math.sin(i)*t,o=-Math.cos(i)*t,a=r-e,s=o-n;return e=r,n=o,[a,s]}))}return c.hexagon=function(e){return"m"+l(null==e?t:+e).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(r/n),c=Math.round(i/e),l=u*n;l<a+t;l+=n,++u)for(var h=c*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,l]);return s},c.mesh=function(){var e=l(t).slice(0,4).join("l");return c.centers().map((function(t){return"M"+t+"m"+e})).join("")},c.x=function(t){return arguments.length?(s=t,c):s},c.y=function(t){return arguments.length?(u=t,c):u},c.radius=function(i){return arguments.length?(e=2*(t=+i)*Math.sin(Nt),n=1.5*t,c):t},c.size=function(t){return arguments.length?(i=r=0,o=+t[0],a=+t[1],c):[o-i,a-r]},c.extent=function(t){return arguments.length?(i=+t[0][0],r=+t[0][1],o=+t[1][0],a=+t[1][1],c):[[i,r],[o,a]]},c.radius(1)}().radius(u).x(t=>t.screenCoord[0]).y(t=>t.screenCoord[1])(c).map((t,e)=>({position:o.unprojectFlat([t.x,t.y]),points:t,index:e})),radiusCommon:u}},getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class Ht extends J{shouldUpdateState({changeFlags:t}){return t.somethingChanged}initializeState(){const t=new kt({getAggregator:t=>t.hexagonAggregator,getCellSize:t=>t.radius});this.state={cpuAggregator:t,aggregatorState:t.state,hexagonVertices:null},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t);const{cpuAggregator:e,hexagonVertices:n}=this.state;t.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:e.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes()})});const{hexagonVertices:i}=e.state.layerData||{};if(i&&n!==i){const t=this.convertLatLngToMeterOffset(i);t&&this.setState({hexagonVertices:i,vertices:t})}else this.updateRadiusAngle()}updateRadiusAngle(t){const{viewport:e}=this.context,{unitsPerMeter:n}=e.getDistanceScales(),{cpuAggregator:i}=this.state;if(i.state.layerData&&i.state.layerData.radiusCommon){const{radiusCommon:t}=i.state.layerData,e=t/n[0];this.setState({angle:90,radius:e})}}convertLatLngToMeterOffset(t){const{viewport:e}=this.context;if(Array.isArray(t)&&6===t.length){const n=t[0],i=t[3],r=[(n[0]+i[0])/2,(n[1]+i[1])/2],o=e.projectFlat(r),{metersPerUnit:a}=e.getDistanceScales(r);return t.map(t=>{const n=e.projectFlat(t);return[(n[0]-o[0])*a[0],(n[1]-o[1])*a[1]]})}return i.a.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,coverage:n,material:i,transitions:r}=this.props,{angle:o,radius:a,cpuAggregator:s,vertices:u}=this.state,c=this.getSubLayerClass("hexagon-cell",zt.a),l=this._getSublayerUpdateTriggers();return new c({...u&&u.length?{vertices:u,radius:1}:{radius:a,angle:o},diskResolution:6,elevationScale:t,extruded:e,coverage:n,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:s.state.layerData.data})}}Ht.layerName="HexagonLayer",Ht.defaultProps=Wt;var qt=n(220),Xt=n(109);const Zt={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},Qt=[Zt.W,Zt.SW,Zt.S],Yt=[Zt.S,Zt.SE,Zt.E],Kt=[Zt.E,Zt.NE,Zt.N],Jt=[Zt.NW,Zt.W,Zt.N],$t=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5]],te=[[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6]],ee=[[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],ne=[[-.5,1/6],[-.5,-1/6],[1/6,.5],[-1/6,.5]],ie=[Zt.W,Zt.SW,Zt.SE,Zt.E],re=[Zt.S,Zt.SE,Zt.NE,Zt.N],oe=[Zt.NW,Zt.W,Zt.E,Zt.NE],ae=[Zt.NW,Zt.SW,Zt.S,Zt.N],se=[[-.5,1/6],[-.5,-1/6],[.5,-1/6],[.5,1/6]],ue=[[-1/6,-.5],[1/6,-.5],[1/6,.5],[-1/6,.5]],ce=[Zt.NW,Zt.SW,Zt.SE,Zt.NE],le=[Zt.NW,Zt.SW,Zt.SE,Zt.E,Zt.N],he=[Zt.W,Zt.SW,Zt.SE,Zt.NE,Zt.N],pe=[Zt.NW,Zt.W,Zt.S,Zt.SE,Zt.NE],fe=[Zt.NW,Zt.SW,Zt.S,Zt.E,Zt.NE],de=[Zt.NW,Zt.W,[.5,-1/6],[.5,1/6],Zt.N],Ae=[[-1/6,-.5],[1/6,-.5],Zt.E,Zt.NE,Zt.N],ge=[[-.5,1/6],[-.5,-1/6],Zt.S,Zt.SE,Zt.E],me=[Zt.W,Zt.SW,Zt.S,[1/6,.5],[-1/6,.5]],ye=[Zt.NW,Zt.W,[-1/6,-.5],[1/6,-.5],Zt.N],ve=[[-.5,1/6],[-.5,-1/6],Zt.E,Zt.NE,Zt.N],_e=[Zt.S,Zt.SE,Zt.E,[1/6,.5],[-1/6,.5]],be=[Zt.W,Zt.SW,Zt.S,[.5,-1/6],[.5,1/6]],xe=[Zt.W,Zt.SW,Zt.SE,Zt.E,[1/6,.5],[-1/6,.5]],we=[[-.5,1/6],[-.5,-1/6],Zt.S,Zt.SE,Zt.NE,Zt.N],Ee=[Zt.NW,Zt.W,[-1/6,-.5],[1/6,-.5],Zt.E,Zt.NE],Te=[Zt.NW,Zt.SW,Zt.S,[.5,-1/6],[.5,1/6],Zt.N],Se=[Zt.W,Zt.SW,Zt.S,Zt.E,Zt.NE,Zt.N],Pe=[Zt.NW,Zt.W,Zt.S,Zt.SE,Zt.E,Zt.N],Me=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],Zt.E,Zt.NE,Zt.N],Ce=[Zt.W,Zt.SW,Zt.S,[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],Ie=[Zt.NW,Zt.W,[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],Zt.N],Oe=[[-.5,1/6],[-.5,-1/6],Zt.S,Zt.SE,Zt.E,[1/6,.5],[-1/6,.5]],Le=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],Re={0:[],1:[[Zt.W,Zt.S]],2:[[Zt.S,Zt.E]],3:[[Zt.W,Zt.E]],4:[[Zt.N,Zt.E]],5:{0:[[Zt.W,Zt.S],[Zt.N,Zt.E]],1:[[Zt.W,Zt.N],[Zt.S,Zt.E]]},6:[[Zt.N,Zt.S]],7:[[Zt.W,Zt.N]],8:[[Zt.W,Zt.N]],9:[[Zt.N,Zt.S]],10:{0:[[Zt.W,Zt.N],[Zt.S,Zt.E]],1:[[Zt.W,Zt.S],[Zt.N,Zt.E]]},11:[[Zt.N,Zt.E]],12:[[Zt.W,Zt.E]],13:[[Zt.S,Zt.E]],14:[[Zt.W,Zt.S]],15:[]};function ke(t){return parseInt(t,4)}const De={[ke("0000")]:[],[ke("2222")]:[],[ke("2221")]:[Qt],[ke("2212")]:[Yt],[ke("2122")]:[Kt],[ke("1222")]:[Jt],[ke("0001")]:[Qt],[ke("0010")]:[Yt],[ke("0100")]:[Kt],[ke("1000")]:[Jt],[ke("2220")]:[$t],[ke("2202")]:[te],[ke("2022")]:[ee],[ke("0222")]:[ne],[ke("0002")]:[$t],[ke("0020")]:[te],[ke("0200")]:[ee],[ke("2000")]:[ne],[ke("0011")]:[ie],[ke("0110")]:[re],[ke("1100")]:[oe],[ke("1001")]:[ae],[ke("2211")]:[ie],[ke("2112")]:[re],[ke("1122")]:[oe],[ke("1221")]:[ae],[ke("2200")]:[se],[ke("2002")]:[ue],[ke("0022")]:[se],[ke("0220")]:[ue],[ke("1111")]:[ce],[ke("1211")]:[le],[ke("2111")]:[he],[ke("1112")]:[pe],[ke("1121")]:[fe],[ke("1011")]:[le],[ke("0111")]:[he],[ke("1110")]:[pe],[ke("1101")]:[fe],[ke("1200")]:[de],[ke("0120")]:[Ae],[ke("0012")]:[ge],[ke("2001")]:[me],[ke("1022")]:[de],[ke("2102")]:[Ae],[ke("2210")]:[ge],[ke("0221")]:[me],[ke("1002")]:[ye],[ke("2100")]:[ve],[ke("0210")]:[_e],[ke("0021")]:[be],[ke("1220")]:[ye],[ke("0122")]:[ve],[ke("2012")]:[_e],[ke("2201")]:[be],[ke("0211")]:[xe],[ke("2110")]:[we],[ke("1102")]:[Ee],[ke("1021")]:[Te],[ke("2011")]:[xe],[ke("0112")]:[we],[ke("1120")]:[Ee],[ke("1201")]:[Te],[ke("2101")]:[Se],[ke("0121")]:[Se],[ke("1012")]:[Pe],[ke("1210")]:[Pe],[ke("0101")]:{0:[Qt,Kt],1:[Se],2:[Se]},[ke("1010")]:{0:[Jt,Yt],1:[Pe],2:[Pe]},[ke("2121")]:{0:[Se],1:[Se],2:[Qt,Kt]},[ke("1212")]:{0:[Pe],1:[Pe],2:[Jt,Yt]},[ke("2120")]:{0:[Me],1:[Me],2:[$t,Kt]},[ke("2021")]:{0:[Ce],1:[Ce],2:[Qt,ee]},[ke("1202")]:{0:[Ie],1:[Ie],2:[Jt,te]},[ke("0212")]:{0:[Oe],1:[Oe],2:[Yt,ne]},[ke("0102")]:{0:[$t,Kt],1:[Me],2:[Me]},[ke("0201")]:{0:[Qt,ee],1:[Ce],2:[Ce]},[ke("1020")]:{0:[Jt,te],1:[Ie],2:[Ie]},[ke("2010")]:{0:[Yt,ne],1:[Oe],2:[Oe]},[ke("2020")]:{0:[ne,te],1:[Le],2:[$t,ee]},[ke("0202")]:{0:[ee,$t],1:[Le],2:[ne,te]}},Be={ISO_LINES:1,ISO_BANDS:2},Fe={zIndex:0,zOffset:.005};function ze(t,e){return Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function Ne(t){const{cellWeights:e,x:n,y:r,width:o,height:a}=t;let s=t.threshold;t.thresholdValue&&(i.a.deprecated("thresholdValue","threshold")(),s=t.thresholdValue);const u=n<0,c=n>=o-1,l=r<0,h=r>=a-1,p=u||c||l||h,f={},d={};u||h?d.top=0:(f.top=e[(r+1)*o+n],d.top=ze(f.top,s)),c||h?d.topRight=0:(f.topRight=e[(r+1)*o+n+1],d.topRight=ze(f.topRight,s)),c||l?d.right=0:(f.right=e[r*o+n+1],d.right=ze(f.right,s)),u||l?d.current=0:(f.current=e[r*o+n],d.current=ze(f.current,s));const{top:A,topRight:g,right:m,current:y}=d;let v=-1;Number.isFinite(s)&&(v=A<<3|g<<2|m<<1|y),Array.isArray(s)&&(v=A<<6|g<<4|m<<2|y);let _=0;return p||(_=ze((f.top+f.topRight+f.right+f.current)/4,s)),{code:v,meanCode:_}}function je(t){const{gridOrigin:e,cellSize:n,x:i,y:r,code:o,meanCode:a,type:s=Be.ISO_LINES}=t,u={...Fe,...t.thresholdData};let c=s===Be.ISO_BANDS?De[o]:Re[o];Array.isArray(c)||(c=c[a]);const l=u.zIndex*u.zOffset,h=(i+1)*n[0],p=(r+1)*n[1],f=e[0]+h,d=e[1]+p;if(s===Be.ISO_BANDS){const t=[];return c.forEach(e=>{const i=[];e.forEach(t=>{const e=f+t[0]*n[0],r=d+t[1]*n[1];i.push([e,r,l])}),t.push(i)}),t}const A=[];return c.forEach(t=>{t.forEach(t=>{const e=f+t[0]*n[0],i=d+t[1]*n[1];A.push([e,i,l])})}),A}const Ue=[255,255,255,255],Ve={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:[{threshold:1}],zOffset:.005},Ge={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class We extends Tt{initializeState(){super.initializeState({dimensions:Ge}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:m.SUM}}}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(t){super.updateState(t);let e=!1;const{oldProps:n,props:i}=t,{aggregationDirty:r}=this.state;n.contours===i.contours&&n.zOffset===i.zOffset||(e=!0,this._updateThresholdData(t.props)),this.getNumInstances()>0&&(r||e)&&this._generateContours()}renderLayers(){const{contourSegments:t,contourPolygons:e}=this.state.contourData,n=this.getSubLayerClass("lines",qt.a),i=this.getSubLayerClass("bands",Xt.a);return[t&&t.length>0&&new n(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:t=>t.start,getTargetPosition:t=>t.end,getColor:t=>t.contour.color||Ue,getWidth:t=>t.contour.strokeWidth||1}),e&&e.length>0&&new i(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:t=>t.vertices,getFillColor:t=>t.contour.color||Ue})]}updateAggregationState(t){const{props:e,oldProps:n}=t,{cellSize:r,coordinateSystem:o}=e,{viewport:a}=this.context,s=n.cellSize!==r;let u=e.gpuAggregation;this.state.gpuAggregation!==e.gpuAggregation&&u&&!F.isSupported(this.context.gl)&&(i.a.warn("GPU Grid Aggregation not supported, falling back to CPU")(),u=!1);const c=u!==this.state.gpuAggregation;this.setState({gpuAggregation:u});const{dimensions:l}=this.state,h=this.isAttributeChanged("positions"),{data:p,weights:f}=l;let{boundingBox:d}=this.state;if(h&&(d=_t(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:d})),h||s){const{gridOffset:t,translation:e,width:n,height:i,numCol:s,numRow:u}=wt(d,r,a,o);this.allocateResources(u,s),this.setState({gridOffset:t,boundingBox:d,translation:e,posOffset:e.slice(),gridOrigin:[-1*e[0],-1*e[1]],width:n,height:i,numCol:s,numRow:u})}const A=h||c||this.isAggregationDirty(t,{dimension:p,compareAll:u}),g=this.isAggregationDirty(t,{dimension:f});g&&this._updateAccessors(t),(A||g)&&this._resetResults(),this.setState({aggregationDataDirty:A,aggregationWeightsDirty:g})}_updateAccessors(t){const{getWeight:e,aggregation:n,data:i}=t.props,{count:r}=this.state.weights;r&&(r.getWeight=e,r.operation=m[n]),this.setState({getValue:b(n,e,{data:i})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}_generateContours(){const{numCol:t,numRow:e,gridOrigin:n,gridOffset:i,thresholdData:r}=this.state,{count:o}=this.state.weights;let{aggregationData:a}=o;a||(a=o.aggregationBuffer.getData(),o.aggregationData=a);const{cellWeights:s}=F.getCellData({countsData:a}),u=function({thresholdData:t,colors:e,cellWeights:n,gridSize:i,gridOrigin:r,cellSize:o}){const a=[],s=[],u=i[0],c=i[1];let l=0,h=0;for(const e of t){const{contour:t}=e,{threshold:i}=t;for(let p=-1;p<u;p++)for(let f=-1;f<c;f++){const{code:d,meanCode:A}=Ne({cellWeights:n,threshold:i,x:p,y:f,width:u,height:c}),g={gridOrigin:r,cellSize:o,x:p,y:f,width:u,height:c,code:d,meanCode:A,thresholdData:e};if(Array.isArray(i)){g.type=Be.ISO_BANDS;const e=je(g);for(const n of e)s[h++]={vertices:n,contour:t}}else{g.type=Be.ISO_LINES;const e=je(g);for(let n=0;n<e.length;n+=2)a[l++]={start:e[n],end:e[n+1],contour:t}}}}return{contourSegments:a,contourPolygons:s}}({thresholdData:r,cellWeights:s,gridSize:[t,e],gridOrigin:n,cellSize:[i.xOffset,i.yOffset]});this.setState({contourData:u})}_updateThresholdData(t){const{contours:e,zOffset:n}=t,i=e.length,r=new Array(i);for(let t=0;t<i;t++){const i=e[t];r[t]={contour:i,zIndex:i.zIndex||t,zOffset:n}}this.setState({thresholdData:r})}}We.layerName="ContourLayer",We.defaultProps=Ve;var He=n(285),qe=n(29),Xe=n(262);const Ze={colorDomain:null,colorRange:U,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class Qe extends N.a{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:[g.a,He.a,j.a,d]})}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const e=this._getModel(t);this._setupUniformBuffer(e),this.setState({model:e})}_getModel(t){return new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new Xe.a,isInstanced:!0})}draw({uniforms:t}){const{cellSize:e,offset:n,extruded:i,elevationScale:r,coverage:o,gridSize:a,gridOrigin:s,gridOffset:u,elevationRange:c,colorMaxMinBuffer:l,elevationMaxMinBuffer:h}=this.props,p=[Object(qe.b)(s[0]),Object(qe.b)(s[1])],f=[Object(qe.b)(u[0]),Object(qe.b)(u[1])],d=this.getDomainUniforms(),A=V(this.props.colorRange);this.bindUniformBuffers(l,h),this.state.model.setUniforms(t).setUniforms(d).setUniforms({cellSize:e,offset:n,extruded:i,elevationScale:r,coverage:o,gridSize:a,gridOrigin:s,gridOriginLow:p,gridOffset:u,gridOffsetLow:f,colorRange:A,elevationRange:c}).draw(),this.unbindUniformBuffers(l,h)}bindUniformBuffers(t,e){t.bind({target:35345,index:0}),e.bind({target:35345,index:1})}unbindUniformBuffers(t,e){t.unbind({target:35345,index:0}),e.unbind({target:35345,index:1})}getDomainUniforms(){const{colorDomain:t,elevationDomain:e}=this.props,n={};return null!==t?(n.colorDomainValid=!0,n.colorDomain=t):n.colorDomainValid=!1,null!==e?(n.elevationDomainValid=!0,n.elevationDomain=e):n.elevationDomainValid=!1,n}_setupUniformBuffer(t){const e=this.context.gl,n=t.program.handle,i=e.getUniformBlockIndex(n,"ColorData"),r=e.getUniformBlockIndex(n,"ElevationData");e.uniformBlockBinding(n,i,0),e.uniformBlockBinding(n,r,1)}}Qe.layerName="GPUGridCellLayer",Qe.defaultProps=Ze;const Ye={colorDomain:null,colorRange:U,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0},Ke={data:{props:["cellSize","colorAggregation","elevationAggregation"]}};class Je extends Tt{initializeState(){const{gl:t}=this.context,e=F.isSupported(t);e||i.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeState({dimensions:Ke}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:e,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new $.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new $.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(!1===this.state.isSupported)return;super.updateState(t);const{aggregationDirty:e}=this.state;e&&this.setState({gridHash:null})}getHashKeyForIndex(t){const{numRow:e,numCol:n,boundingBox:i,gridOffset:r}=this.state,o=[n,e],a=[i.xMin,i.yMin],s=[r.xOffset,r.yOffset],u=Math.floor(t/o[0]),c=t-u*o[0],l=Math.floor((u*s[1]+a[1]+90+s[1]/2)/s[1]),h=Math.floor((c*s[0]+a[0]+180+s[0]/2)/s[0]);return"".concat(l,"-").concat(h)}getPositionForIndex(t){const{numRow:e,numCol:n,boundingBox:i,gridOffset:r}=this.state,o=[n,e],a=[i.xMin,i.yMin],s=[r.xOffset,r.yOffset],u=Math.floor(t/o[0]);return[(t-u*o[0])*s[0]+a[0],u*s[1]+a[1]]}getPickingInfo({info:t,mode:e}){const{index:n}=t;let i=null;if(n>=0){const{gpuGridAggregator:t}=this.state,r=this.getPositionForIndex(n),o=F.getAggregationData({pixelIndex:n,...t.getData("color")}),a=F.getAggregationData({pixelIndex:n,...t.getData("elevation")});if(i={colorValue:o.cellWeight,elevationValue:a.cellWeight,count:o.cellCount||a.cellCount,position:r,totalCount:o.totalCount||a.totalCount},"hover"!==e){const{props:t}=this;let{gridHash:e}=this.state;if(!e){const{gridOffset:n,translation:i,boundingBox:r}=this.state,{viewport:o}=this.context;e=Et(t,{gridOffset:n,attributes:this.getAttributes(),viewport:o,translation:i,boundingBox:r}).gridHash,this.setState({gridHash:e})}const r=e[this.getHashKeyForIndex(n)];Object.assign(i,r)}}return t.picked=Boolean(i),t.object=i,t}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:t,extruded:e,cellSize:n,coverage:i,material:r,elevationRange:o,colorDomain:a,elevationDomain:s}=this.props,{weights:u,numRow:c,numCol:l,gridOrigin:h,gridOffset:p}=this.state,{color:f,elevation:d}=u,A=V(this.props.colorRange);return new(this.getSubLayerClass("gpu-grid-cell",Qe))({gridSize:[l,c],gridOrigin:h,gridOffset:[p.xOffset,p.yOffset],colorRange:A,elevationRange:o,colorDomain:a,elevationDomain:s,cellSize:n,coverage:i,material:r,elevationScale:t,extruded:e},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:f.aggregationBuffer,elevations:d.aggregationBuffer}},colorMaxMinBuffer:f.maxMinBuffer,elevationMaxMinBuffer:d.maxMinBuffer,numInstances:l*c})}finalizeState(){const{color:t,elevation:e}=this.state.weights;[t,e].forEach(t=>{const{aggregationBuffer:e,maxMinBuffer:n}=t;n.delete(),null==e||e.delete()}),super.finalizeState()}updateAggregationState(t){const{props:e,oldProps:n}=t,{cellSize:i,coordinateSystem:r}=e,{viewport:o}=this.context,a=n.cellSize!==i,{dimensions:s}=this.state,u=this.isAttributeChanged("positions"),c=u||this.isAttributeChanged();let{boundingBox:l}=this.state;if(u&&(l=_t(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:l})),u||a){const{gridOffset:t,translation:e,width:n,height:a,numCol:s,numRow:u}=wt(l,i,o,r);this.allocateResources(u,s),this.setState({gridOffset:t,translation:e,gridOrigin:[-1*e[0],-1*e[1]],width:n,height:a,numCol:s,numRow:u})}const h=c||this.isAggregationDirty(t,{dimension:s.data,compareAll:!0});h&&this._updateAccessors(t),this.setState({aggregationDataDirty:h})}_updateAccessors(t){const{colorAggregation:e,elevationAggregation:n}=t.props,{color:i,elevation:r}=this.state.weights;i.operation=m[e],r.operation=m[n]}}Je.layerName="GPUGridLayer",Je.defaultProps=Ye;const $e={...Je.defaultProps,...Ft.defaultProps,gpuAggregation:!1};class tn extends Z.a{initializeState(){this.state={useGPUAggregation:!0}}updateState({oldProps:t,props:e,changeFlags:n}){const i={};i.useGPUAggregation=this.canUseGPUAggregation(e),this.setState(i)}renderLayers(){const{data:t,updateTriggers:e}=this.props,n=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",Je):this.getSubLayerClass("CPU",Ft))(this.props,this.getSubLayerProps({id:n,updateTriggers:e}),{data:t})}canUseGPUAggregation(t){const{gpuAggregation:e,lowerPercentile:n,upperPercentile:i,getColorValue:r,getElevationValue:o,colorScaleType:a}=t;return!!e&&(!!F.isSupported(this.context.gl)&&(0===n&&100===i&&(null===r&&null===o&&("quantile"!==a&&"ordinal"!==a))))}}tn.layerName="GridLayer",tn.defaultProps=$e;const en=new Float32Array(12);function nn(t,e=2){let n=0;for(const i of t)for(let t=0;t<e;t++)en[n++]=i[t]||0;return en}class rn extends N.a{getShaders(){return{vs:"#define SHADER_NAME heatp-map-layer-vertex-shader\n\nuniform sampler2D maxTexture;\nuniform float intensity;\nuniform vec2 colorDomain;\nuniform float threshold;\nuniform float aggregationMode;\n\nattribute vec3 positions;\nattribute vec2 texCoords;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\n  vTexCoords = texCoords;\n  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));\n  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\n  float minValue = maxValue * threshold;\n  if (colorDomain[1] > 0.) {\n    maxValue = colorDomain[1];\n    minValue = colorDomain[0];\n  }\n  vIntensityMax = intensity / maxValue;\n  vIntensityMin = intensity / minValue;\n}\n",fs:"#define SHADER_NAME triangle-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D texture;\nuniform sampler2D colorTexture;\nuniform float aggregationMode;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvec4 getLinearColor(float value) {\n  float factor = clamp(value * vIntensityMax, 0., 1.);\n  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));\n  color.a *= min(value * vIntensityMin, 1.0);\n  return color;\n}\n\nvoid main(void) {\n  vec4 weights = texture2D(texture, vTexCoords);\n  float weight = weights.r;\n\n  if (aggregationMode > 0.5) {\n    weight /= max(1.0, weights.a);\n  }\n  if (weight <= 0.) {\n     discard;\n  }\n\n  vec4 linearColor = getLinearColor(weight);\n  linearColor.a *= opacity;\n  gl_FragColor =linearColor;\n}\n",modules:[g.a]}}initializeState(){const{gl:t}=this.context;this.getAttributeManager().add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:e}=this.props;return new u.a(t,{...this.getShaders(),id:this.props.id,geometry:new z.a({drawMode:6,vertexCount:e})})}draw({uniforms:t}){const{model:e}=this.state,{texture:n,maxTexture:i,colorTexture:r,intensity:o,threshold:a,aggregationMode:s,colorDomain:u}=this.props;e.setUniforms({...t,texture:n,maxTexture:i,colorTexture:r,intensity:o,threshold:a,aggregationMode:s,colorDomain:u}).draw()}}rn.layerName="TriangleLayer";const on={mipmaps:!1,parameters:{10240:9729,10241:9729,10242:33071,10243:33071},dataFormat:6408},an=[0,0],sn={SUM:0,MEAN:1},un={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:U,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM"},cn=[r.a.BLEND_EQUATION_MINMAX,r.a.TEXTURE_FLOAT],ln={data:{props:["radiusPixels"]}};class hn extends J{initializeState(){const{gl:t}=this.context;if(!Object(o.c)(t,cn))return this.setState({supported:!1}),void i.a.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();super.initializeState(ln),this.setState({supported:!0}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){if(!this.state.supported)return;super.updateState(t);const{props:e,oldProps:n}=t,i=this._getChangeFlags(t);if(i.viewportChanged&&(i.boundsChanged=this._updateBounds(),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),e.colorRange!==n.colorRange&&this._updateColorTexture(t),n.colorDomain!==e.colorDomain||i.viewportChanged){const{viewport:t}=this.context,{weightsScale:n}=this.state,i=(t?1024/t.scale:1)*n,r=e.colorDomain?e.colorDomain.map(t=>t*i):an;if(r[1]>0&&n<1){const t=Math.min(r[1],1);r[0]*=t/r[1],r[1]=t}this.setState({colorDomain:r})}this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){if(!this.state.supported)return[];const{weightsTexture:t,triPositionBuffer:e,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:r,colorDomain:o}=this.state,{updateTriggers:a,intensity:s,threshold:u,aggregation:c}=this.props;return new(this.getSubLayerClass("triangle",rn))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:yt.a.DEFAULT,data:{attributes:{positions:e,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:r,aggregationMode:sn[c]||0,texture:t,intensity:s,threshold:u,colorDomain:o})}finalizeState(){super.finalizeState();const{weightsTransform:t,weightsTexture:e,maxWeightTransform:n,maxWeightsTexture:i,triPositionBuffer:r,triTexCoordBuffer:o,colorTexture:a,updateTimer:s}=this.state;null==t||t.delete(),null==e||e.delete(),null==n||n.delete(),null==i||i.delete(),null==r||r.delete(),null==o||o.delete(),null==a||a.delete(),s&&clearTimeout(s)}_getAttributeManager(){return new Y.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const e={},{dimensions:n}=this.state;e.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data}),e.viewportChanged=t.changeFlags.viewportChanged;const{zoom:i}=this.state;return t.context.viewport&&t.context.viewport.zoom===i||(e.viewportZoomChanged=!0),e}_createTextures(){const{gl:t}=this.context,{textureSize:e,format:n,type:i}=this.state;this.setState({weightsTexture:new C.a(t,{width:e,height:e,format:n,type:i,...on}),maxWeightsTexture:new C.a(t,{format:n,type:i,...on})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{gl:t}=this.context,e=Math.min(2048,Object(a.f)(t,3379)),n=Object(o.c)(t,r.a.COLOR_ATTACHMENT_RGBA32F),{format:s,type:u}=function({gl:t,floatTargetSupport:e}){return{format:Object(a.j)(t)?34836:6408,type:e?5126:5121}}({gl:t,floatTargetSupport:n}),c=n?1:1/255;this.setState({textureSize:e,format:s,type:u,weightsScale:c}),n||i.a.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}_createWeightsTransform(t={}){var e;const{gl:n}=this.context;let{weightsTransform:i}=this.state;const{weightsTexture:r}=this.state;null===(e=i)||void 0===e||e.delete();const o=Object(A.a)({vs:"attribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float weights;\nvarying vec4 weightsTexture;\nuniform float radiusPixels;\nuniform float textureWidth;\nuniform vec4 commonBounds;\nuniform float weightsScale;\nvoid main()\n{\n  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);\n\n  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);\n  gl_PointSize = radiusTexels * 2.;\n\n  vec3 commonPosition = project_position(positions, positions64Low);\n  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;\n  gl_Position.xy = (gl_Position.xy * 2.) - (1.);\n}\n",_fs:"varying vec4 weightsTexture;\nfloat gaussianKDE(float u){\n  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\n  float dist = length(gl_PointCoord - vec2(0.5, 0.5));\n  if (dist > 0.5) {\n    discard;\n  }\n  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"},t);i=new c.a(n,{id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:r,_targetTextureVarying:"weightsTexture",...o}),this.setState({weightsTransform:i})}_setupResources(){const{gl:t}=this.context;this._createTextures();const{textureSize:e,weightsTexture:n,maxWeightsTexture:i}=this.state;this._createWeightsTransform();const r=new c.a(t,{id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:n},_targetTexture:i,_targetTextureVarying:"outTexture",vs:"attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\noutTexture = inTexture;\ngl_Position = vec4(0, 0, 0, 1.);\ngl_PointSize = 1.0;\n}\n",_fs:"varying vec4 outTexture;\nvoid main() {\n  gl_FragColor = outTexture;\n  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n",elementCount:e*e});this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:r,zoom:null,triPositionBuffer:new $.a(t,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new $.a(t,{byteLength:48,accessor:{size:2}})})}updateShaders(t){this._createWeightsTransform(t)}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}_updateBounds(t=!1){const{viewport:e}=this.context,n=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])].map(t=>t.map(Math.fround)),i=function(t){const e=t.map(t=>t[0]),n=t.map(t=>t[1]),i=Math.min.apply(null,e),r=Math.max.apply(null,e);return[i,Math.min.apply(null,n),r,Math.max.apply(null,n)]}(n),r={visibleWorldBounds:i,viewportCorners:n};let o=!1;if(t||!this.state.worldBounds||(a=this.state.worldBounds,!((s=i)[0]>=a[0]&&s[2]<=a[2]&&s[1]>=a[1]&&s[3]<=a[3]))){const t=this._worldToCommonBounds(i),e=this._commonToWorldBounds(t);this.props.coordinateSystem===yt.a.LNGLAT&&(e[1]=Math.max(e[1],-85.051129),e[3]=Math.min(e[3],85.051129),e[0]=Math.max(e[0],-360),e[2]=Math.min(e[2],360));const n=this._worldToCommonBounds(e);r.worldBounds=e,r.normalizedCommonBounds=n,o=!0}var a,s;return this.setState(r),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:e,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:r}=this.context;t.subData(nn(i,3));const o=i.map(t=>function(t,e){const[n,i,r,o]=e;return[(t[0]-n)/(r-n),(t[1]-i)/(o-i)]}(r.projectPosition(t),n));e.subData(nn(o,2))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:n}=this.state;const i=V(e,!1,Uint8Array);n?n.setImageData({data:i,width:e.length}):n=new C.a(this.context.gl,{data:i,width:e.length,height:1,...on}),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:t}=this.props,{weightsTransform:e,worldBounds:n,textureSize:i,weightsTexture:r,weightsScale:o}=this.state;this.state.isWeightMapDirty=!1;const a={radiusPixels:t,commonBounds:this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0}),textureWidth:i,weightsScale:o};e.update({elementCount:this.getNumInstances()}),e.run({uniforms:a,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:this.getAttributes(),moduleSettings:this.getModuleSettings()}),this._updateMaxWeightValue(),r.setParameters({10240:9729,10241:9729})}_debouncedUpdateWeightmap(t=!1){let{updateTimer:e}=this.state;t?(e=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(e),e=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),500)),this.setState({updateTimer:e})}_worldToCommonBounds(t,e={}){const{useLayerCoordinateSystem:n=!1}=e,[i,r,o,a]=t,{viewport:s}=this.context,{textureSize:u}=this.state,{coordinateSystem:c}=this.props,l=n&&(c===yt.a.LNGLAT_OFFSETS||c===yt.a.METER_OFFSETS),h=l?s.projectPosition(this.props.coordinateOrigin):[0,0],p=2*u/s.scale;let f,d;return n&&!l?(f=this.projectPosition([i,r,0]),d=this.projectPosition([o,a,0])):(f=s.projectPosition([i,r,0]),d=s.projectPosition([o,a,0])),function(t,e,n){const[i,r,o,a]=t,s=o-i,u=a-r;let c=s,l=u;s/u<e/n?c=e/n*u:l=n/e*s,c<e&&(c=e,l=n);const h=(o+i)/2,p=(a+r)/2;return[h-c/2,p-l/2,h+c/2,p+l/2]}([f[0]-h[0],f[1]-h[1],d[0]-h[0],d[1]-h[1]],p,p)}_commonToWorldBounds(t){const[e,n,i,r]=t,{viewport:o}=this.context,a=o.unprojectPosition([e,n]),s=o.unprojectPosition([i,r]);return a.slice(0,2).concat(s.slice(0,2))}}hn.layerName="HeatmapLayer",hn.defaultProps=un,n.d(e,"ScreenGridLayer",(function(){return Mt})),n.d(e,"CPUGridLayer",(function(){return Ft})),n.d(e,"HexagonLayer",(function(){return Ht})),n.d(e,"ContourLayer",(function(){return We})),n.d(e,"GridLayer",(function(){return tn})),n.d(e,"GPUGridLayer",(function(){return Je})),n.d(e,"AGGREGATION_OPERATION",(function(){return m})),n.d(e,"HeatmapLayer",(function(){return hn})),n.d(e,"_GPUGridAggregator",(function(){return F})),n.d(e,"_CPUAggregator",(function(){return kt})),n.d(e,"_AggregationLayer",(function(){return J})),n.d(e,"_BinSorter",(function(){return gt}))},function(t,e,n){"use strict";n.r(e);var i=n(170),r=n(283),o=n(234),a=n(279),s=n(0),u=n(191),c=n(261),l=n(196),h=n(227),p=n(27),f=n(282),d=n(68),A=n(96),g=n(116),m=n(228),y=n(229),v=n(278),_=n(58),b=n(99);const x={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class w extends _.a{constructor(t={}){const{id:e=Object(b.c)("truncated-code-geometry")}=t,{indices:n,attributes:i}=function(t){const{bottomRadius:e=0,topRadius:n=0,height:i=1,nradial:r=10,nvertical:o=10,verticalAxis:a="y",topCap:s=!1,bottomCap:u=!1}=t,c=(s?2:0)+(u?2:0),l=(r+1)*(o+1+c),h=Math.atan2(e-n,i),p=Math.sin,f=Math.cos,d=Math.PI,A=f(h),g=p(h),m=s?-2:0,y=o+(u?2:0),v=r+1,_=new Uint16Array(r*(o+c)*6),b=x[a],w=new Float32Array(3*l),E=new Float32Array(3*l),T=new Float32Array(2*l);let S=0,P=0;for(let t=m;t<=y;t++){let a,s=t/o,u=i*s;t<0?(u=0,s=1,a=e):t>o?(u=i,s=1,a=n):a=e+t/o*(n-e),-2!==t&&t!==o+2||(a=0,s=0),u-=i/2;for(let e=0;e<v;e++){const n=p(e*d*2/r),i=f(e*d*2/r);w[S+b[0]]=n*a,w[S+b[1]]=u,w[S+b[2]]=i*a,E[S+b[0]]=t<0||t>o?0:n*A,E[S+b[1]]=t<0?-1:t>o?1:g,E[S+b[2]]=t<0||t>o?0:i*A,T[P+0]=e/r,T[P+1]=s,P+=2,S+=3}}for(let t=0;t<o+c;t++)for(let e=0;e<r;e++){const n=6*(t*r+e);_[n+0]=v*(t+0)+0+e,_[n+1]=v*(t+0)+1+e,_[n+2]=v*(t+1)+1+e,_[n+3]=v*(t+0)+0+e,_[n+4]=v*(t+1)+1+e,_[n+5]=v*(t+1)+0+e}return{indices:_,attributes:{POSITION:{size:3,value:w},NORMAL:{size:3,value:E},TEXCOORD_0:{size:2,value:T}}}}(t);super({...t,id:e,indices:n,attributes:{...i,...t.attributes}})}}class E extends w{constructor(t={}){const{id:e=Object(b.c)("cone-geometry"),radius:n=1,cap:i=!0}=t;super({...t,id:e,topRadius:0,topCap:Boolean(i),bottomCap:Boolean(i),bottomRadius:n})}}var T=n(262);class S extends w{constructor(t={}){const{id:e=Object(b.c)("cylinder-geometry"),radius:n=1}=t;super({...t,id:e,bottomRadius:n,topRadius:n})}}var P=n(147);const M=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],C=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];class I extends _.a{constructor(t={}){const{id:e=Object(b.c)("ico-sphere-geometry")}=t,{indices:n,attributes:i}=function(t){const{iterations:e=0}=t,n=Math.PI,i=2*n,r=[...M];let o=[...C];r.push(),o.push();const a=(()=>{const t={};return(e,n)=>{const i=(e*=3)>(n*=3)?e:n,o="".concat(e<n?e:n,"|").concat(i);if(o in t)return t[o];const a=r[e],s=r[e+1],u=r[e+2];let c=(a+r[n])/2,l=(s+r[n+1])/2,h=(u+r[n+2])/2;const p=Math.sqrt(c*c+l*l+h*h);return c/=p,l/=p,h/=p,r.push(c,l,h),t[o]=r.length/3-1}})();for(let t=0;t<e;t++){const t=[];for(let e=0;e<o.length;e+=3){const n=a(o[e+0],o[e+1]),i=a(o[e+1],o[e+2]),r=a(o[e+2],o[e+0]);t.push(r,o[e+0],n,n,o[e+1],i,i,o[e+2],r,n,i,r)}o=t}const s=new Array(r.length),u=new Array(r.length/3*2);for(let t=o.length-3;t>=0;t-=3){const e=o[t+0],a=o[t+1],c=o[t+2],l=3*e,h=3*a,p=3*c,f=2*e,d=2*a,A=2*c,g=r[l+0],m=r[l+1],y=r[l+2],v=Math.acos(y/Math.sqrt(g*g+m*m+y*y)),_=Math.atan2(m,g)+n,b=v/n,x=1-_/i,w=r[h+0],E=r[h+1],T=r[h+2],S=Math.acos(T/Math.sqrt(w*w+E*E+T*T)),M=Math.atan2(E,w)+n,C=S/n,I=1-M/i,O=r[p+0],L=r[p+1],R=r[p+2],k=Math.acos(R/Math.sqrt(O*O+L*L+R*R)),D=Math.atan2(L,O)+n,B=k/n,F=1-D/i,z=[O-w,L-E,R-T],N=[g-w,m-E,y-T],j=new P.a(z).cross(N).normalize();let U;(0===x||0===I||0===F)&&(0===x||x>.5)&&(0===I||I>.5)&&(0===F||F>.5)&&(r.push(r[l+0],r[l+1],r[l+2]),U=r.length/3-1,o.push(U),u[2*U+0]=1,u[2*U+1]=b,s[3*U+0]=j.x,s[3*U+1]=j.y,s[3*U+2]=j.z,r.push(r[h+0],r[h+1],r[h+2]),U=r.length/3-1,o.push(U),u[2*U+0]=1,u[2*U+1]=C,s[3*U+0]=j.x,s[3*U+1]=j.y,s[3*U+2]=j.z,r.push(r[p+0],r[p+1],r[p+2]),U=r.length/3-1,o.push(U),u[2*U+0]=1,u[2*U+1]=B,s[3*U+0]=j.x,s[3*U+1]=j.y,s[3*U+2]=j.z),s[l+0]=s[h+0]=s[p+0]=j.x,s[l+1]=s[h+1]=s[p+1]=j.y,s[l+2]=s[h+2]=s[p+2]=j.z,u[f+0]=x,u[f+1]=b,u[d+0]=I,u[d+1]=C,u[A+0]=F,u[A+1]=B}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(r)},NORMAL:{size:3,value:new Float32Array(s)},TEXCOORD_0:{size:2,value:new Float32Array(u)}}}}(t);super({...t,id:e,indices:n,attributes:{...i,...t.attributes}})}}class O extends _.a{constructor(t={}){const{id:e=Object(b.c)("plane-geometry")}=t,{indices:n,attributes:i}=function(t){const{type:e="x,y",offset:n=0,flipCull:i=!1,unpack:r=!1}=t,o=e.split(",");let a=t["".concat(o[0],"len")]||1;const s=t["".concat(o[1],"len")]||1,u=t["n".concat(o[0])]||1,c=t["n".concat(o[1])]||1,l=(u+1)*(c+1),h=new Float32Array(3*l),p=new Float32Array(3*l),f=new Float32Array(2*l);i&&(a=-a);let d=0,A=0;for(let t=0;t<=c;t++)for(let r=0;r<=u;r++){const o=r/u,l=t/c;switch(f[d+0]=i?1-o:o,f[d+1]=l,e){case"x,y":h[A+0]=a*o-.5*a,h[A+1]=s*l-.5*s,h[A+2]=n,p[A+0]=0,p[A+1]=0,p[A+2]=i?1:-1;break;case"x,z":h[A+0]=a*o-.5*a,h[A+1]=n,h[A+2]=s*l-.5*s,p[A+0]=0,p[A+1]=i?1:-1,p[A+2]=0;break;case"y,z":h[A+0]=n,h[A+1]=a*o-.5*a,h[A+2]=s*l-.5*s,p[A+0]=i?1:-1,p[A+1]=0,p[A+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}d+=2,A+=3}const g=u+1,m=new Uint16Array(u*c*6);for(let t=0;t<c;t++)for(let e=0;e<u;e++){const n=6*(t*u+e);m[n+0]=(t+0)*g+e,m[n+1]=(t+1)*g+e,m[n+2]=(t+0)*g+e+1,m[n+3]=(t+1)*g+e,m[n+4]=(t+1)*g+e+1,m[n+5]=(t+0)*g+e+1}const y={indices:{size:1,value:m},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:p},TEXCOORD_0:{size:2,value:f}}};return r?function(t){const{indices:e,attributes:n}=t;if(!e)return t;const i=e.value.length,r={};for(const t in n){const o=n[t],{constant:a,value:s,size:u}=o;if(a||!u)continue;const c=new s.constructor(i*u);for(let t=0;t<i;++t){const n=e.value[t];for(let e=0;e<u;e++)c[t*u+e]=s[n*u+e]}r[t]={size:u,value:c}}return{attributes:Object.assign({},n,r)}}(y):y}(t);super({...t,id:e,indices:n,attributes:{...i,...t.attributes}})}}class L extends _.a{constructor(t={}){const{id:e=Object(b.c)("sphere-geometry")}=t,{indices:n,attributes:i}=function(t){const{nlat:e=10,nlong:n=10}=t;let{radius:i=1}=t;const r=Math.PI-0,o=2*Math.PI-0,a=(e+1)*(n+1);if("number"==typeof i){const t=i;i=(e,n,i,r,o)=>t}const s=new Float32Array(3*a),u=new Float32Array(3*a),c=new Float32Array(2*a),l=new(a>65535?Uint32Array:Uint16Array)(e*n*6);for(let t=0;t<=e;t++)for(let a=0;a<=n;a++){const l=a/n,h=t/e,p=a+t*(n+1),f=2*p,d=3*p,A=o*l,g=r*h,m=Math.sin(A),y=Math.cos(A),v=Math.sin(g),_=Math.cos(g),b=y*v,x=_,w=m*v,E=i(b,x,w,l,h);s[d+0]=E*b,s[d+1]=E*x,s[d+2]=E*w,u[d+0]=b,u[d+1]=x,u[d+2]=w,c[f+0]=l,c[f+1]=1-h}const h=n+1;for(let t=0;t<n;t++)for(let n=0;n<e;n++){const i=6*(t*e+n);l[i+0]=n*h+t,l[i+1]=n*h+t+1,l[i+2]=(n+1)*h+t,l[i+3]=(n+1)*h+t,l[i+4]=n*h+t+1,l[i+5]=(n+1)*h+t+1}return{indices:{size:1,value:l},attributes:{POSITION:{size:3,value:s},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:c}}}}(t);super({...t,id:e,indices:n,attributes:{...i,...t.attributes}})}}n.d(e,"Model",(function(){return i.a})),n.d(e,"Transform",(function(){return r.a})),n.d(e,"ProgramManager",(function(){return o.a})),n.d(e,"Timeline",(function(){return a.a})),n.d(e,"instrumentGLContext",(function(){return s.h})),n.d(e,"isWebGL2",(function(){return s.j})),n.d(e,"FEATURES",(function(){return u.a})),n.d(e,"hasFeatures",(function(){return c.c})),n.d(e,"getParameters",(function(){return s.f})),n.d(e,"setParameters",(function(){return s.n})),n.d(e,"withParameters",(function(){return s.o})),n.d(e,"cssToDeviceRatio",(function(){return s.e})),n.d(e,"readPixelsToBuffer",(function(){return l.d})),n.d(e,"copyToTexture",(function(){return l.b})),n.d(e,"cloneTextureFrom",(function(){return h.a})),n.d(e,"Buffer",(function(){return p.a})),n.d(e,"Program",(function(){return f.a})),n.d(e,"Framebuffer",(function(){return d.a})),n.d(e,"Renderbuffer",(function(){return A.a})),n.d(e,"Texture2D",(function(){return g.a})),n.d(e,"TextureCube",(function(){return m.a})),n.d(e,"Texture3D",(function(){return y.a})),n.d(e,"TransformFeedback",(function(){return v.a})),n.d(e,"Geometry",(function(){return _.a})),n.d(e,"ConeGeometry",(function(){return E})),n.d(e,"CubeGeometry",(function(){return T.a})),n.d(e,"CylinderGeometry",(function(){return S})),n.d(e,"IcoSphereGeometry",(function(){return I})),n.d(e,"PlaneGeometry",(function(){return O})),n.d(e,"SphereGeometry",(function(){return L})),n.d(e,"TruncatedConeGeometry",(function(){return w}))},function(t,e,n){"use strict";n.r(e);var i=n(189);function r(t,e){const n=document.createElement("div");return n.style.position="absolute",Object.assign(n.style,e),t.getPanes().overlayLayer.appendChild(n),n}function o(t){const{_eventListeners:e}=t.props.userData;for(const t in e)e[t].remove();t.finalize()}function a(t,e){if(t.pixel)return t.pixel;const n=e.getViewports()[0].project([t.latLng.lng(),t.latLng.lat()]);return{x:n[0],y:n[1]}}function s(t,e,n){const i={type:e,offsetCenter:a(n,t),srcEvent:n};switch(e){case"click":t._lastPointerDownInfo=t.pickObject(i.offsetCenter),i.tapCount=1,t._onEvent(i);break;case"dblclick":i.type="click",i.tapCount=2,t._onEvent(i);break;case"mousemove":i.type="pointermove",t._onPointerMove(i);break;case"mouseout":i.type="pointerleave",t._onPointerMove(i);break;default:return}}const u=()=>!1;class c{constructor(t){this.props={},this._map=null;const e=new google.maps.OverlayView;e.onAdd=this._onAdd.bind(this),e.onRemove=this._onRemove.bind(this),e.draw=this._draw.bind(this),this._overlay=e,this.setProps(t)}setMap(t){t!==this._map&&(this._map&&(this._overlay.setMap(null),this._map=null),t&&(this._map=t,this._overlay.setMap(t)))}setProps(t){Object.assign(this.props,t),this._deck&&(t.style&&(Object.assign(this._deck.canvas.parentElement.style,t.style),t.style=null),this._deck.setProps(t))}pickObject(t){return this._deck&&this._deck.pickObject(t)}pickMultipleObjects(t){return this._deck&&this._deck.pickMultipleObjects(t)}pickObjects(t){return this._deck&&this._deck.pickObjects(t)}finalize(){this.setMap(null),this._deck&&(o(this._deck),this._deck=null)}_onAdd(){this._deck=function(t,e,n,a){if(n){if(n.props.userData._googleMap===t)return n;o(n)}const u={click:null,dblclick:null,mousemove:null,mouseout:null};n=new i.a({...a,style:null,parent:r(e,a.style),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1,userData:{_googleMap:t,_eventListeners:u}});for(const e in u)u[e]=t.addListener(e,t=>s(n,e,t));return n}(this._map,this._overlay,this._deck,this.props)}_onRemove(){this._deck.setProps({layerFilter:u})}_draw(){const t=this._deck,{width:e,height:n,left:i,top:r,zoom:o,pitch:a,latitude:s,longitude:c}=function(t,e){const n=t.getDiv().firstChild,i=n.offsetWidth,r=n.offsetHeight,o=e.getProjection(),a=t.getBounds(),s=a.getNorthEast(),u=a.getSouthWest(),c=o.fromLatLngToDivPixel(s),l=o.fromLatLngToDivPixel(u),h=new google.maps.Point(0,0),p=o.fromContainerPixelToLatLng(h),f=o.fromLatLngToDivPixel(p);let d=f.x,A=f.y;const g=o.getWorldWidth(),m=Math.ceil(i/g);d-=Math.floor(m/2)*g;const y=r?(l.y-c.y)/r:1,v=Math.log2(y||1)+t.getZoom()-1;let _=new google.maps.Point(i/2,r/2);const b=o.fromContainerPixelToLatLng(_);let x=b.lat();const w=b.lng();if(Math.abs(x)>85.05113){x=x>0?85.05113:-85.05113;const t=new google.maps.LatLng(x,w);_=o.fromLatLngToContainerPixel(t),A+=_.y-r/2}return{width:i,height:r,left:d,top:A,zoom:v,pitch:t.getTilt(),latitude:x,longitude:w}}(this._map,this._overlay),l=0===a,h=t.canvas.parentElement.style;h.left="".concat(i,"px"),h.top="".concat(r,"px"),t.setProps({width:e,height:n,viewState:{latitude:s,longitude:c,zoom:o,repeat:!0},layerFilter:l?this.props.layerFilter:u}),t.redraw()}}n.d(e,"GoogleMapsOverlay",(function(){return c}))},function(t,e,n){"use strict";n.r(e);var i=n(132),r=n(117);function o(t){switch(t){case"int8":return Int8Array;case"uint8":return Uint8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"float32":return Float32Array;case"float64":return Float64Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error("Unrecognized dtype ".concat(t))}}function a(t,e){if(!t)return null;for(const e in t){const n=t[e].attributes;for(const t in n){const{dtype:e,value:i}=n[t],r=o(e);n[t].value=new r(i.buffer)}}return t}n.d(e,"default",(function(){return s}));class s extends i.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:s.model_name,_model_module:s.model_module,_model_module_version:s.model_module_version,_view_name:s.view_name,_view_module:s.view_module,_view_module_version:s.view_module_version,custom_libraries:[],json_input:null,mapbox_key:null,selected_data:[],data_buffer:null,tooltip:null,width:"100%",height:500,js_warning:!1}}static get serializers(){return{...i.DOMWidgetModel.serializers,data_buffer:{deserialize:a}}}static get model_name(){return"JupyterTransportModel"}static get model_module(){return r.MODULE_NAME}static get model_module_version(){return r.MODULE_VERSION}static get view_name(){return"JupyterTransportView"}static get view_module(){return r.MODULE_NAME}static get view_module_version(){return r.MODULE_VERSION}}},function(t,e,n){"use strict";n.r(e);var i=n(37),r=n(159),o=n(169),a=n(121),s=n(83);function u(){r.a.setCallbacks({onInitialize({transport:t}){const{width:e,height:n,customLibraries:i,mapboxApiKey:r,jsonInput:u,tooltip:l}=function(t){const{jupyterModel:e}=t;if(!e)throw new Error("deck.gl playground currently only works with the Jupyter Widget Transport");return{width:e.get("width"),height:e.get("height"),customLibraries:e.get("custom_libraries"),mapboxApiKey:e.get("mapbox_key"),jsonInput:e.get("json_input"),tooltip:e.get("tooltip")}}(t);Object(a.b)();const h=t.getRootDOMElement(),p=Object(o.a)(e,n);h.appendChild(p);const f=JSON.parse(u),d=Object(s.createDeck)({mapboxApiKey:r,container:p,jsonInput:f,tooltip:l,handleEvent:(e,n)=>function(t,e,n){if("hover"===e&&!n.picked&&-1===n.index)return;const i=JSON.parse(JSON.stringify(n,c));t.sendJSONMessage(e,i)}(t,e,n),customLibraries:i});t.userData.deck=d},onFinalize({transport:t}){const{deck:e}=t.userData;e.finalize()},onMessage({transport:t,type:e,json:n,binary:i}){const{deck:r}=t.userData;let o;switch(e){case"json":o=s.jsonConverter.convert(n),r.setProps(o);break;case"json-with-binary":o=s.jsonConverter.convert(n);const e=function({binary:t,convertedJson:e}){for(let n=0;n<e.layers.length;n++){const i=e.layers[n].id,r=e.layers[n];e.layers[n]=r.clone({data:t[i]})}return e}({binary:t.jupyterModel.get("data_buffer"),convertedJson:o});r.setProps(e)}}})}function c(t,e){return e instanceof i.Layer?e.id:e}n.d(e,"initPlayground",(function(){return u})),n.d(e,"createDeck",(function(){return s.createDeck})),n.d(e,"updateDeck",(function(){return s.updateDeck}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(0);function r(t,e,n,r){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);r.forEach(t=>{a.methodName||(a[t]=()=>{throw i.k.removed("Calling removed method ".concat(e,".").concat(t,": "),o)(),new Error(t)})})}},function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return u}));var i=n(191),r=n(0),o=n(13);function a(t,e){return s(t,e)}function s(t,e){return(e=Array.isArray(e)?e:[e]).every(e=>c(t,e))}function u(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in i.b)void 0===t.luma.caps[e]&&(t.luma.caps[e]=c(t,e));return t.luma.caps}function c(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=function(t,e){const n=i.b[e];let a;Object(o.a)(n,e);const s=Object(r.j)(t)&&n[1]||n[0];if("function"==typeof s)a=s(t);else if(Array.isArray(s)){a=!0;for(const e of s)a=a&&Boolean(t.getExtension(e))}else"string"==typeof s?a=Boolean(t.getExtension(s)):"boolean"==typeof s?a=s:Object(o.a)(!1);return a}(t,e)),t.luma.caps[e]||r.k.log(2,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n(58),r=n(99);const o=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),a=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),s=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),u=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),c={POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(s)},TEXCOORD_0:{size:2,value:new Float32Array(u)}};class l extends i.a{constructor(t={}){const{id:e=Object(r.c)("cube-geometry")}=t;super({...t,id:e,indices:{size:1,value:new Uint16Array(o)},attributes:{...c,...t.attributes}})}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var i=n(32);function r(t,e){const n=e||{},r=n[t.id]||{},o="".concat(t.id,"-worker.js");let a=r.workerUrl;if("test"===n._workerType&&(a="modules/".concat(t.module,"/dist/").concat(o)),!a){const e=t.version?"@".concat(t.version):"";a="https://unpkg.com/@loaders.gl/".concat(t.module).concat(e,"/dist/").concat(o)}return Object(i.a)(a),a}function o(t,e="3.0.0-alpha.6"){Object(i.a)(t,"no worker provided");let n=t.version;e&&n&&(e=a(e),n=a(n))}function a(t){const e=t.split(".").map(Number);return{major:e[0],minor:e[1]}}},function(t,e,n){"use strict";var i=n(46);function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=n(51),a=n(17),s=n(18),u=n(160),c=Object(u.a)();function l(t){try{var e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}var h=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(a.a)(this,t),this.storage=l(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return Object(s.a)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function p(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));var o=t.width*n,a=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(r,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}var f={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function d(t){return"string"==typeof t?f[t.toUpperCase()]||f.WHITE:t}function A(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,o=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw r}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),o=A(r);try{var a=function(){var i=e.value;"function"==typeof t[i]&&(n.find((function(t){return i===t}))||(t[i]=t[i].bind(t)))};for(o.s();!(e=o.n()).done;)a()}catch(t){o.e(t)}finally{o.f()}}function y(t,e){if(!t)throw new Error(e||"Assertion failed")}var v=n(55);function _(){var t;if(c&&v.b.performance)t=v.b.performance.now();else if(v.a.hrtime){var e=v.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}n.d(e,"a",(function(){return P}));var b={debug:c&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},x={enabled:!0,level:0};function w(){}var E={},T={once:!0};function S(t){for(var e in t)for(var n in t[e])return n||"untitled";return"empty"}var P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.id;Object(a.a)(this,t),this.id=n,this.VERSION="8.5.0-alpha.4",this._startTs=_(),this._deltaTs=_(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new h("__probe-".concat(this.id,"__"),x),this.userData={},this.timeStamp("".concat(this.id," started")),m(this),Object.seal(this)}return Object(s.a)(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((_()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((_()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({level:t}),this}},{key:"assert",value:function(t,e){y(t,e)}},{key:"warn",value:function(t){return this._getLogFunction(0,t,b.warn,arguments,T)}},{key:"error",value:function(t){return this._getLogFunction(0,t,b.error,arguments)}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){return this._getLogFunction(t,e,b.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(t,e){return this._getLogFunction(t,e,b.debug,arguments)}},{key:"info",value:function(t,e){return this._getLogFunction(t,e,console.info,arguments)}},{key:"once",value:function(t,e){return this._getLogFunction(t,e,b.debug||b.info,arguments,T)}},{key:"table",value:function(t,e,n){return e?this._getLogFunction(t,e,console.table||w,n&&[n],{tag:S(e)}):w}},{key:"image",value:function(t){var e=t.logLevel,i=t.priority,o=t.image,a=t.message,s=void 0===a?"":a,u=t.scale,l=void 0===u?1:u;return this._shouldLog(e||i)?c?function(t){var e=t.image,n=t.message,i=void 0===n?"":n,o=t.scale,a=void 0===o?1:o;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=p(s,i,a);(t=console).log.apply(t,r(e))},s.src=e,w}var u=e.nodeName||"";if("img"===u.toLowerCase()){var c;return(c=console).log.apply(c,r(p(e,i,a))),w}if("canvas"===u.toLowerCase()){var l=new Image;return l.onload=function(){var t;return(t=console).log.apply(t,r(p(l,i,a)))},l.src=e.toDataURL(),w}return w}({image:o,message:s,scale:l}):function(t){var e=t.image,i=(t.message,t.scale),r=void 0===i?1:i,o=null;try{o=n(244)}catch(t){}if(o)return function(){return o(e,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then((function(t){return console.log(t)}))};return w}({image:o,message:s,scale:l}):w}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(Object(o.a)({},t,e))}},{key:"time",value:function(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}},{key:"timeEnd",value:function(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(t,e){return this._getLogFunction(t,e,console.timeStamp||w)}},{key:"group",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=n=C({logLevel:t,message:e,opts:n}),r=i.collapsed;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}},{key:"groupCollapsed",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction(t,"",console.groupEnd||w)}},{key:"withGroup",value:function(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return this.isEnabled()&&this.getLevel()>=M(t)}},{key:"_getLogFunction",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(t)){var a;o=C({logLevel:t,message:e,args:i,opts:o}),y(n=n||o.method),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=_();var s=o.tag||o.message;if(o.once){if(E[s])return w;E[s]=_()}return e=I(this.id,o.message,o),(a=n).bind.apply(a,[console,e].concat(r(o.args)))}return w}},{key:"level",set:function(t){this.setLevel(t)},get:function(){return this.getLevel()}},{key:"priority",set:function(t){this.level=t},get:function(){return this.level}}]),t}();function M(t){if(!t)return 0;var e;switch(Object(i.a)(t)){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return y(Number.isFinite(e)&&e>=0),e}function C(t){var e=t.logLevel,n=t.message;t.logLevel=M(e);for(var r=t.args?Array.from(t.args):[];r.length&&r.shift()!==n;);switch(t.args=r,Object(i.a)(e)){case"string":case"function":void 0!==n&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());var o=Object(i.a)(t.message);return y("string"===o||"object"===o),Object.assign(t,t.opts)}function I(t,e,n){if("string"==typeof e){var i=n.time?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}((s=n.total)<10?"".concat(s.toFixed(2),"ms"):s<100?"".concat(s.toFixed(1),"ms"):s<1e3?"".concat(s.toFixed(0),"ms"):"".concat((s/1e3).toFixed(2),"s")):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),r=e,o=n.color,a=n.background,c||"string"!=typeof r||(o&&(o=d(o),r="[".concat(o,"m").concat(r,"[39m")),a&&(o=d(a),r="[".concat(a+10,"m").concat(r,"[49m"))),e=r}var r,o,a,s;return e}P.VERSION="8.5.0-alpha.4"},function(t,e,n){"use strict";var i=n(17),r=n(18),o=n(127),a=function(){function t(e,n){Object(i.a)(this,t),this.name=e,this.type=n,this.sampleSize=1,this.reset()}return Object(r.a)(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(o.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(o.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),s=function(){function t(e){var n=e.id,r=e.stats;Object(i.a)(this,t),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return Object(r.a)(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,n=t.type;return this.stats[e]||(this.stats[e]=t instanceof a?t:new a(e,n)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();n.d(e,"a",(function(){return s}))},,,,,,,,,,,,,function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(0),r=n(33),o=n(27),a=n(99);class s extends r.a{static isSupported(t){return Object(i.j)(t)}constructor(t,e={}){Object(i.a)(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(t={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Object(a.a)(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(t={}){return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:r,byteSize:o,byteOffset:a}=this._getBufferParams(e);return n<0?(this.unused[t]=r,i.k.warn(()=>"".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,r,a,o),this)}begin(t=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,i;return t instanceof o.a==!1?(i=t.buffer,n=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===n||(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e,n=0,i){const r=e&&e.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,t,r,n,i):this.gl.bindBufferBase(35982,t,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));let i=1,r=1;class o{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:o=1}=t,a=i++,s={time:0,delay:e,duration:n,rate:r,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(a,s),a}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(t){if(void 0===t)return this.time;const e=this.channels.get(t);return void 0===e?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const t of e)this._setChannelTime(t,this.time);const n=this.animations.values();for(const t of n){const{animation:e,channel:n}=t;e.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=r++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay;n>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}},function(t,e,n){"use strict";var i={};n.r(i),n.d(i,"decode",(function(){return T})),n.d(i,"encode",(function(){return S}));var r={};n.r(r),n.d(r,"decode",(function(){return C})),n.d(r,"encode",(function(){return I}));var o={};n.r(o),n.d(o,"decode",(function(){return O})),n.d(o,"encode",(function(){return L}));var a={};n.r(a),n.d(a,"decode",(function(){return R})),n.d(a,"encode",(function(){return k}));var s=n(281),u=n(217),c=n(102);function l(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function h(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return n.substr(0,n.lastIndexOf("/")+1)+t}function p(t,e,n){const i=t.bufferViews[n];l(i);const r=e[i.buffer];l(r);const o=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,i.byteLength)}var f=n(284),d=n(86);const A=["SCALAR","VEC2","VEC3","VEC4"],g=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]]),m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},v={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function _(t){return A[t-1]||A[0]}function b(t){const e=g.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function x(t,e){const n=v[t.componentType],i=m[t.type],r=y[t.componentType],o=t.count*i,a=t.count*i*r;return l(a>=0&&a<=e.byteLength),{ArrayType:n,length:o,byteLength:a}}class w{constructor(t){if(t instanceof w)return t;t||(t={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},buffers:[]}),this.sourceBuffers=[],this.byteLength=0,t.buffers&&t.buffers[0]&&(this.byteLength=t.buffers[0].byteLength,this.sourceBuffers=[t.buffers[0]]),this.gltf=t,l(this.gltf.json)}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(e=>e===t),n=this.json.extensions||{};return e?n[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getCamera(t){return null}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return n}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,n=this.gltf.buffers[e];l(n);const i=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,{ArrayType:i,length:r}=x(t,e);return new i(n,e.byteOffset+t.byteOffset,r)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,i=e.byteOffset||0;return new Uint8Array(n,i,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return l(n),t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){(t.extensions||{})[e]=n}removeObjectExtension(t,e){const n=t.extensions||{},i=n[e];return delete n[e],i}addExtension(t,e={}){return l(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return l(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}setDefaultScene(t){this.json.scene=t}addScene({nodeIndices:t}){return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode({meshIndex:t,matrix:e=null}){this.json.nodes=this.json.nodes||[];const n={mesh:t};return e&&(n.matrix=e),this.json.nodes.push(n),this.json.nodes.length-1}addMesh({attributes:t,indices:e,material:n,mode:i=4}){const r={primitives:[{attributes:this._addAttributes(t),mode:i}]};if(e){const t=this._addIndices(e);r.primitives[0].indices=t}return Number.isFinite(n)&&(r.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){e=e||function(t){const e=Object(d.a)(t);return e?e.mimeType:null}(t);const n={bufferView:this.addBufferView(t),mimeType:e};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}addBufferView(t){const e=t.byteLength;l(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const n={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Object(c.c)(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:_(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const n=this.addBufferView(t);let i={min:e.min,max:e.max};i.min&&i.max||(i=this._getAccessorMinMax(t,e.size));const r={size:e.size,componentType:b(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(r,e))}addTexture({imageIndex:t}){const e={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(e),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const t=this.byteLength,e=new ArrayBuffer(t),n=new Uint8Array(e);let i=0;for(let t=0;t<this.sourceBuffers.length;t++){const e=this.sourceBuffers[t];i=Object(c.a)(e,n,i)}this.json.buffers[0]=this.json.buffers[0]||{},this.json.buffers[0].byteLength=t,this.gltf.binary=e,this.sourceBuffers=[e]}_removeStringFromArray(t,e){let n=!0;for(;n;){const i=t.indexOf(e);i>-1?t.splice(i,1):n=!1}}_addAttributes(t={}){const e={};for(const n in t){const i=t[n],r=this._getGltfAttributeName(n),o=this.addBinaryBuffer(i.value,i);e[r]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const i=t.subarray(0,e);for(const t of i)n.min.push(t),n.max.push(t);for(let i=e;i<t.length;i+=e)for(let r=0;r<e;r++)n.min[0+r]=Math.min(n.min[0+r],t[i+r]),n.max[0+r]=Math.max(n.max[0+r],t[i+r]);return n}}function E(t,e){const{buffer:n,size:i,count:r}=function(t,e){let n=t,i=1,r=0;t&&t.value&&(n=t.value,i=t.size||1);n&&(ArrayBuffer.isView(n)||(n=function(t,e,n=!1){if(!t)return null;if(Array.isArray(t))return new e(t);if(n&&!(t instanceof e))return new e(t);return t}(n,Float32Array)),r=n.length/i);return{buffer:n,size:i,count:r}}(t);return{value:n,size:i,bufferView:null,byteOffset:0,count:r,type:_(i),componentType:b(n)}}async function T(t,e,n){if(!e.gltf.decompressMeshes)return;const i=new w(t),r=[];for(const t of function*(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}(i))i.getObjectExtension(t,"KHR_draco_mesh_compression")&&r.push(P(t,i,e,n));await Promise.all(r),i.removeExtension("KHR_draco_mesh_compression")}function S(t,e={}){const n=new w(t);for(const t of n.json.meshes||[])M(t,e),n.addRequiredExtension("KHR_draco_mesh_compression")}async function P(t,e,n,i){const r=e.getObjectExtension(t,"KHR_draco_mesh_compression"),o=e.getTypedArrayForBufferView(r.bufferView),a=Object(c.b)(o.buffer,o.byteOffset),{parse:s}=i,u={...n};delete u["3d-tiles"];const l=await s(a,f.a,u,i);t.attributes=function(t){const e={};for(const n in t){const i=t[n];if("indices"!==n){const t=E(i);e[n]=t}}return e}(l.attributes),l.indices&&(t.indices=E(l.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(t)}function M(t,e,n=4,i,r){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),{parseSync:a}=r,s=a({attributes:t}),u=i._addFauxAttributes(s.attributes);return{primitives:[{attributes:u,mode:n,extensions:{KHR_draco_mesh_compression:{bufferView:i.addBufferView(o),attributes:u}}}]}}function C(t,e){const n=new w(t),{json:i}=n,r=n.getExtension("KHR_lights_punctual");r&&(n.json.lights=r.lights,n.removeExtension("KHR_lights_punctual"));for(const t of i.nodes||[]){const e=n.getObjectExtension(t,"KHR_lights_punctual");e&&(t.light=e.light),n.removeObjectExtension(t,"KHR_lights_punctual")}}function I(t,e){const n=new w(t),{json:i}=n;if(i.lights){const t=n.addExtension("KHR_lights_punctual");l(!t.lights),t.lights=i.lights,delete i.lights}if(n.json.lights){for(const t of n.json.lights){const e=t.node;n.addObjectExtension(e,"KHR_lights_punctual",t)}delete n.json.lights}}function O(t,e){const n=new w(t),{json:i}=n;n.removeExtension("KHR_materials_unlit");for(const t of i.materials||[]){t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),n.removeObjectExtension(t,"KHR_materials_unlit")}}function L(t,e){const n=new w(t),{json:i}=n;if(n.materials)for(const t of i.materials)t.unlit&&(delete t.unlit,n.addObjectExtension(t,"KHR_materials_unlit",{}),n.addExtension("KHR_materials_unlit"))}function R(t,e){const n=new w(t),{json:i}=n,r=n.getExtension("KHR_techniques_webgl");if(r){const t=function({programs:t=[],shaders:e=[],techniques:n=[]},i){const r=new TextDecoder;return e.forEach(t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=r.decode(i.getTypedArrayForBufferView(t.bufferView))}),t.forEach(t=>{t.fragmentShader=e[t.fragmentShader],t.vertexShader=e[t.vertexShader]}),n.forEach(e=>{e.program=t[e.program]}),n}(r,n);for(const e of i.materials||[]){const i=n.getObjectExtension(e,"KHR_techniques_webgl");i&&(e.technique=Object.assign({},i,t[i.technique]),e.technique.values=D(e.technique,n)),n.removeObjectExtension(e,"KHR_techniques_webgl")}n.removeExtension("KHR_techniques_webgl")}}function k(t,e){}function D(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(e=>{!t.uniforms[e].value||e in n||(n[e]=t.uniforms[e].value)}),Object.keys(n).forEach(t=>{"object"==typeof n[t]&&void 0!==n[t].index&&(n[t].texture=e.getTexture(n[t].index))}),n}const B={KHR_draco_mesh_compression:i,KHR_lights_punctual:r,KHR_materials_unlit:o,KHR_techniques_webgl:a};const F={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},z={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class N{constructor(t){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(n.asset.version))}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(t,e){const n=new w(t),{json:i}=n;for(const t of i.images||[]){const e=n.removeObjectExtension(t,"KHR_binary_glTF");e&&Object.assign(t,e)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,n.removeExtension("KHR_binary_glTF")}(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in F)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(n&&!Array.isArray(n)){t[e]=[];for(const i in n){const r=n[i];r.id=r.id||i;const o=t[e].length;t[e].push(r),this.idToIndexMap[e][i]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in F)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:n,material:i}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),i&&(e.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(t=>this._convertIdToIndex(t,"node"))),t.meshes&&(t.meshes=t.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const n of t[e])for(const t in n){const e=n[t],i=this._convertIdToIndex(e,t);n[t]=i}}_convertIdToIndex(t,e){const n=z[e];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][t];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return i}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=e.values&&e.values.tex,i=t.textures.findIndex(t=>t.id===n);-1!==i&&(e.pbrMetallicRoughness.baseColorTexture={index:i})}}}const j={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},U={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},V={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},G={magFilter:V.TEXTURE_MAG_FILTER,minFilter:V.TEXTURE_MIN_FILTER,wrapS:V.TEXTURE_WRAP_S,wrapT:V.TEXTURE_WRAP_T},W={[V.TEXTURE_MAG_FILTER]:V.LINEAR,[V.TEXTURE_MIN_FILTER]:V.NEAREST_MIPMAP_LINEAR,[V.TEXTURE_WRAP_S]:V.REPEAT,[V.TEXTURE_WRAP_]:V.REPEAT};class H{postProcess(t,e={}){const{json:n,buffers:i=[],images:r=[],baseUri:o=""}=t;return l(n),this.baseUri=o,this.json=n,this.buffers=i,this.images=r,this._resolveTree(this.json,e),this.json}_resolveTree(t,e={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map((t,e)=>this._resolveBufferView(t,e))),t.images&&(t.images=t.images.map((t,e)=>this._resolveImage(t,e))),t.samplers&&(t.samplers=t.samplers.map((t,e)=>this._resolveSampler(t,e))),t.textures&&(t.textures=t.textures.map((t,e)=>this._resolveTexture(t,e))),t.accessors&&(t.accessors=t.accessors.map((t,e)=>this._resolveAccessor(t,e))),t.materials&&(t.materials=t.materials.map((t,e)=>this._resolveMaterial(t,e))),t.meshes&&(t.meshes=t.meshes.map((t,e)=>this._resolveMesh(t,e))),t.nodes&&(t.nodes=t.nodes.map((t,e)=>this._resolveNode(t,e))),t.skins&&(t.skins=t.skins.map((t,e)=>this._resolveSkin(t,e))),t.scenes&&(t.scenes=t.scenes.map((t,e)=>this._resolveScene(t,e))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const n=this.json[t]&&this.json[t][e];return n||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),n}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(t=>this.getNode(t)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(t=>this.getNode(t))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce((t,e)=>{const n=this.getMesh(e);return t.id=n.id,t.primitives=t.primitives.concat(n.primitives),t},{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(t=>{const e=(t={...t}).attributes;t.attributes={};for(const n in e)t.attributes[n]=this.getAccessor(e[n]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var n,i;if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(n=t.componentType,U[n]),t.components=(i=t.type,j[i]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:n,byteLength:i}=x(t,t.bufferView),r=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+e.byteOffset,o=e.arrayBuffer.slice(r,r+i);t.value=new n(o)}return t}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):W,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const e in t){const n=this._enumSamplerParameter(e);void 0!==n&&(t.parameters[n]=t[e])}return t}_enumSamplerParameter(t){return G[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const n=this.images[e];return n&&(t.image=n),t}_resolveBufferView(t,e){t.id=t.id||"bufferView-".concat(e);const n=t.buffer;t.buffer=this.buffers[n];const i=this.buffers[n].arrayBuffer;let r=this.buffers[n].byteOffset||0;return"byteOffset"in t&&(r+=t.byteOffset),t.data=new Uint8Array(i,r,t.byteLength),t}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}var q=n(65);const X=1735152710;function Z(t,e=0,n={}){const i=new DataView(t),{magic:r=X}=n,o=i.getUint32(e,!1);return o===r||o===X}function Q(t,e,n=0,i={}){const r=new DataView(e);t.type=function(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}(r,n+0),t.version=r.getUint32(n+4,!0);const o=r.getUint32(n+8,!0);switch(t.header={byteOffset:n,byteLength:o},t.json={},t.binChunks=[],n+=12,t.version){case 1:return function(t,e,n,i){Object(q.a)(t.header.byteLength>20);const r=e.getUint32(n+0,!0),o=e.getUint32(n+4,!0);return n+=8,Object(q.a)(0===o),Y(t,e,n,r,i),n+=r,n+=K(t,e,n,t.header.byteLength,i)}(t,r,n,{});case 2:return function(t,e,n,i){return Object(q.a)(t.header.byteLength>20),function(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,!0),o=e.getUint32(n+4,!0);switch(n+=8,o){case 1313821514:Y(t,e,n,r,i);break;case 5130562:K(t,e,n,r,i);break;case 0:i.glb.strict||Y(t,e,n,r,i);break;case 1:i.glb.strict||K(t,e,n,r,i)}n+=Object(c.c)(r,4)}}(t,e,n,i),n+t.header.byteLength}(t,r,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function Y(t,e,n,i,r){const o=new Uint8Array(e.buffer,n,i),a=new TextDecoder("utf8").decode(o);return t.json=JSON.parse(a),Object(c.c)(i,4)}function K(t,e,n,i,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),Object(c.c)(i,4)}async function J(t,e,n=0,i,r){!function(t,e,n,i){i.uri&&(t.baseUri=i.uri);if(e instanceof ArrayBuffer&&!Z(e,n,i)){const t=new TextDecoder;e=t.decode(e)}if("string"==typeof e)t.json=Object(u.a)(e);else if(e instanceof ArrayBuffer){const r={};n=Q(r,e,n,i),l("glTF"===r.type,"Invalid GLB magic string ".concat(r.type)),t._glb=r,t.json=r.json}else l(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}(t,e,n,i),function(t,e={}){(new N).normalize(t,e)}(t,{normalize:i.gltf.normalize});const o=[];if(i.gltf.loadBuffers&&t.json.buffers&&await async function(t,e,n){for(let i=0;i<t.json.buffers.length;++i){const r=t.json.buffers[i];if(r.uri){const{fetch:o}=n;l(o);const a=h(r.uri,e),s=await o(a),u=await s.arrayBuffer();t.buffers[i]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete r.uri}}}(t,i,r),i.gltf.loadImages){const e=async function(t,e,n){const i=t.json.images||[],r=[];for(let o=0;o<i.length;++o)r.push($(t,i[o],o,e,n));return await Promise.all(r)}(t,i,r);o.push(e)}const a=async function(t,e={},n){e.gltf=e.gltf||{};for(const i in B){const r=e.gltf.excludeExtensions||{};if(!(i in r&&!r[i])){const r=B[i];await r.decode(t,e,n)}}}(t,i,r);return o.push(a),await Promise.all(o),i.gltf.postProcess?function(t,e){return(new H).postProcess(t,e)}(t,i):t}async function $(t,e,n,i,r){const{fetch:o,parse:a}=r;let u;if(e.uri){const t=h(e.uri,i),n=await o(t);u=await n.arrayBuffer()}if(Number.isFinite(e.bufferView)){const n=p(t.json,t.buffers,e.bufferView);u=Object(c.b)(n.buffer,n.byteOffset,n.byteLength)}l(u,"glTF image has no data");const f=await a(u,s.a,{},r);t.images[n]=f}n.d(e,"a",(function(){return tt}));const tt={name:"glTF",id:"gltf",module:"gltf",version:"3.0.0-alpha.6",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,e={},n){(e={...tt.options,...e}).gltf={...tt.options.gltf,...e.gltf},function(t){"fetchImages"in t&&(t.gltf.loadImages=t.fetchImages);"createImages"in t&&(t.gltf.loadImages=t.createImages);"fetchLinkedResources"in t&&(t.gltf.fetchBuffers=t.fetchLinkedResources);"decompress"in t&&(t.gltf.decompressMeshes=t.decompress);"decompress"in t.gltf&&(t.gltf.decompressMeshes=t.gltf.decompress);"postProcess"in t&&(t.gltf.postProcess=t.postProcess)}(e);const{byteOffset:i=0}=e;return await J({},t,i,e,n)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}}},function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e)}var r=n(137);const{_parseImageNode:o}=r.a,a="undefined"!=typeof Image,s="undefined"!=typeof ImageBitmap,u=Boolean(o),c=!!r.b||u;function l(t){const e=h(t);if(!e)throw new Error("Not an image");return e}function h(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}const p=/^data:image\/svg\+xml/,f=/\.svg((\?|#).*)?$/;function d(t){return t&&(p.test(t)||f.test(t))}function A(t,e){if(d(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function g(t,e,n){const i=function(t,e){if(d(e)){const e=(new TextDecoder).decode(t);return"data:image/svg+xml;base64,".concat(btoa(e))}return A(t,e)}(t,n),r=self.URL||self.webkitURL,o="string"!=typeof i&&r.createObjectURL(i);try{return await async function(t,e){const n=new Image;if(n.src=t,e.image&&e.image.decode&&n.decode)return await n.decode(),n;return await new Promise((e,i)=>{try{n.onload=()=>e(n),n.onerror=e=>i(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(t){i(t)}})}(o||i,e)}finally{o&&r.revokeObjectURL(o)}}const m={};let y=!0;async function v(t,e,n){let i;if(d(n)){i=await g(t,e,n)}else i=A(t,n);const r=e&&e.imagebitmap;return await async function(t,e=null){!function(t){for(const e in t||m)return!1;return!0}(e)&&y||(e=null);if(e)try{return await createImageBitmap(t,e)}catch(t){console.warn(t),y=!1}return await createImageBitmap(t)}(i,r)}var _=n(86);n.d(e,"a",(function(){return b}));const b={name:"Images",id:"image",module:"images",version:"3.0.0-alpha.6",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,n){const o=((e=e||{}).image||{}).type||"auto",{url:u}=n||{};let h;switch(function(t){switch(t){case"auto":case"data":return function(){if(s)return"imagebitmap";if(a)return"image";if(c)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return s||a||c;case"imagebitmap":return s;case"image":return a;case"data":return c;case"html":return a;case"ndarray":return c;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}(o)){case"imagebitmap":h=await v(t,e,u);break;case"image":h=await g(t,e,u);break;case"data":h=await function(t,e){const{mimeType:n}=Object(_.a)(t)||{},{_parseImageNode:o}=r.a;return i(o),o(t,n,e)}(t,e);break;default:i(!1)}return"data"===o&&(h=function(t){switch(l(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(n)return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:return i(!1)}}(h)),h},tests:[t=>Boolean(Object(_.a)(new DataView(t)))],options:{image:{type:"auto",decode:!0}}}},function(t,e,n){"use strict";var i=n(33),r=n(50),o=n(68),a=n(0),s=n(96),u=n(13);const c={5126:w.bind(null,"uniform1fv",A,1,E),35664:w.bind(null,"uniform2fv",A,2,E),35665:w.bind(null,"uniform3fv",A,3,E),35666:w.bind(null,"uniform4fv",A,4,E),5124:w.bind(null,"uniform1iv",g,1,E),35667:w.bind(null,"uniform2iv",g,2,E),35668:w.bind(null,"uniform3iv",g,3,E),35669:w.bind(null,"uniform4iv",g,4,E),35670:w.bind(null,"uniform1iv",g,1,E),35671:w.bind(null,"uniform2iv",g,2,E),35672:w.bind(null,"uniform3iv",g,3,E),35673:w.bind(null,"uniform4iv",g,4,E),35674:w.bind(null,"uniformMatrix2fv",A,4,T),35675:w.bind(null,"uniformMatrix3fv",A,9,T),35676:w.bind(null,"uniformMatrix4fv",A,16,T),35678:x,35680:x,5125:w.bind(null,"uniform1uiv",m,1,E),36294:w.bind(null,"uniform2uiv",m,2,E),36295:w.bind(null,"uniform3uiv",m,3,E),36296:w.bind(null,"uniform4uiv",m,4,E),35685:w.bind(null,"uniformMatrix2x3fv",A,6,T),35686:w.bind(null,"uniformMatrix2x4fv",A,8,T),35687:w.bind(null,"uniformMatrix3x2fv",A,6,T),35688:w.bind(null,"uniformMatrix3x4fv",A,12,T),35689:w.bind(null,"uniformMatrix4x2fv",A,8,T),35690:w.bind(null,"uniformMatrix4x3fv",A,12,T),35678:x,35680:x,35679:x,35682:x,36289:x,36292:x,36293:x,36298:x,36299:x,36300:x,36303:x,36306:x,36307:x,36308:x,36311:x},l={},h={},p={},f=[0];function d(t,e,n,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(f[0]=t,t=f);const r=t.length;if(r%e&&a.k.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let o=i[r];o||(o=new n(r),i[r]=o);for(let e=0;e<r;e++)o[e]=t[e];return o}function A(t,e){return d(t,e,Float32Array,l)}function g(t,e){return d(t,e,Int32Array,h)}function m(t,e){return d(t,e,Uint32Array,p)}function y(t,e,n){const i=c[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function v(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function _(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof r.a||(t instanceof s.a||t instanceof o.a&&Boolean(t.texture))))}function b(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let t=0,e=n.length;t<e;++t)i[t]=n[t]}else t[e]=n.slice();else t[e]=n}function x(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function w(t,e,n,i){let r=null,o=null;return(a,s,c)=>{const l=e(c,n),h=l.length;let p=!1;if(null===r)r=new Float32Array(h),o=h,p=!0;else{Object(u.a)(o===h,"Uniform length cannot change.");for(let t=0;t<h;++t)if(l[t]!==r[t]){p=!0;break}}return p&&(i(a,t,s,l),r.set(l)),p}}function E(t,e,n,i){t[e](n,i)}function T(t,e,n,i){t[e](n,!1,i)}function S(t,e="unnamed"){const n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e}function P(t,e,n,i){const r=t.split(/\r?\n/),o={},a={},s=i||S(e)||"(unnamed)",u="".concat(function(t){switch(t){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)," shader ").concat(s);for(let e=0;e<r.length;e++){const n=r[e];if(n.length<=1)continue;const i=n.split(":"),s=i[0],c=parseInt(i[2],10);if(isNaN(c))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));"WARNING"!==s?o[c]=n:a[c]=n}const c=function(t,e=1,n=": "){const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((t,i)=>{const o=String(i+e),a=o.length;return C(o,r-a)+n+t})}(e);return{shaderName:u,errors:M(o,c),warnings:M(a,c)}}function M(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(n+="".concat(r,"\n"),t[i+1])){const e=t[i+1],r=e.split(":",3),o=r[0],a=parseInt(r[1],10)||0,s=e.substring(r.join(":").length+1).trim();n+=C("^^^ ".concat(o,": ").concat(s,"\n\n"),a)}}return n}function C(t,e){let n="";for(let t=0;t<e;++t)n+=" ";return"".concat(n).concat(t)}var I=n(99);class O extends i.a{static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Object(u.a)(!1),"unknown"}}constructor(t,e){Object(a.b)(t),Object(u.a)("string"==typeof e.source,"Shader: GLSL source code must be a JavaScript string"),super(t,{id:S(e.source,null)||e.id||Object(I.c)("unnamed ".concat(O.getTypeName(e.shaderType)))}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize({source:t}){const e=S(t,null);e&&(this.id=Object(I.c)(e)),this._compile(t)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(O.getTypeName(this.shaderType),":").concat(this.id)}getName(){return S(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(t=this.source){if(t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:n,warnings:i}=P(t,this.source,this.shaderType,this.id);throw a.k.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),a.k.warn("GLSL compilation warnings in ".concat(e,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(e))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class L extends O{constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class R extends O{constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}var k=n(60),D=n(76);class B{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let i=0;i<n;i++){const{name:n,type:r,size:o}=e.getActiveAttrib(t.handle,i),a=e.getAttribLocation(t.handle,n);a>=0&&this._addAttribute(a,n,r,o)}this.attributeInfos.sort((t,e)=>t.location-e.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!Object(a.j)(e))return;const n=e.getProgramParameter(t.handle,35971);for(let i=0;i<n;i++){const{name:n,type:r,size:o}=e.getTransformFeedbackVarying(t.handle,i);this._addVarying(i,n,r,o)}this.varyingInfos.sort((t,e)=>t.location-e.location)}_addAttribute(t,e,n,i){const{type:r,components:o}=Object(D.a)(n),a={type:r,size:i*o};this._inferProperties(t,e,a);const s={location:t,name:e,accessor:new k.a(a)};this.attributeInfos.push(s),this.attributeInfosByLocation[t]=s,this.attributeInfosByName[s.name]=s}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,i){const{type:r,components:o}=Object(D.a)(n),a={location:t,name:e,accessor:new k.a({type:r,size:i*o})};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}var F=n(87);n.d(e,"a",(function(){return j}));const z=35981,N=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class j extends i.a{constructor(t,e={}){super(t,e),this.stubRemovedMethods("Program","v6.0",N),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(t={}){const{hash:e,vs:n,fs:i,varyings:r,bufferMode:o=z}=t;return this.hash=e||"",this.vs="string"==typeof n?new L(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs="string"==typeof i?new R(this.gl,{id:"".concat(t.id,"-fs"),source:i}):i,Object(u.a)(this.vs instanceof L),Object(u.a)(this.fs instanceof R),this.uniforms={},this._textureUniforms={},r&&r.length>0&&(Object(a.a)(this.gl),this.varyings=r,this.gl2.transformFeedbackVaryings(this.handle,r,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new B(this),this.setProps(t)}delete(t={}){return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw({logPriority:t,drawMode:e=4,vertexCount:n,offset:i=0,start:r,end:o,isIndexed:s=!1,indexType:c=5123,instanceCount:l=0,isInstanced:h=l>0,vertexArray:p=null,transformFeedback:f,framebuffer:d,parameters:A={},uniforms:g,samplers:m}){if((g||m)&&(a.k.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(g||{})),a.k.priority>=t){const i=d?d.id:"default",r="mode=".concat(Object(F.a)(this.gl,e)," verts=").concat(n," ")+"instances=".concat(l," indexType=").concat(Object(F.a)(this.gl,c)," ")+"isInstanced=".concat(h," isIndexed=").concat(s," ")+"Framebuffer=".concat(i);a.k.log(t,r)()}return Object(u.a)(p),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===n||h&&0===l)&&(p.bindForDraw(n,l,()=>{if(void 0!==d&&(A=Object.assign({},A,{framebuffer:d})),f){const t=Object(D.c)(e);f.begin(t)}this._bindTextures(),Object(a.o)(this.gl,A,()=>{s&&h?this.gl2.drawElementsInstanced(e,n,c,i,l):s&&Object(a.j)(this.gl)&&!isNaN(r)&&!isNaN(o)?this.gl2.drawRangeElements(e,r,o,n,c,i):s?this.gl.drawElements(e,n,c,i):h?this.gl2.drawArraysInstanced(e,i,n,l):this.gl.drawArrays(e,i,n)}),f&&f.end()}),!0)}setUniforms(t={}){a.k.priority>=2&&function(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!_(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}}(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],i=this._uniformSetters[e];if(i){let t=n,a=!1;if(t instanceof o.a&&(t=t.texture),t instanceof r.a)if(a=this.uniforms[e]!==n,a){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);const n=t,{textureIndex:r}=i;n.bind(r),t=r,this._textureUniforms[e]=n}else t=i.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(i(t)||a)&&b(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const t of e){switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new L({handle:t});break;case 35632:n.fs=new R({handle:t})}}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=Object(I.c)(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),a.k.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),a.k.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||a.k.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:i}=v(n.name);let r=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=y(t,r,n),n.size>1)for(let e=0;e<n.size;e++)r=t.getUniformLocation(this.handle,"".concat(i,"[").concat(e,"]")),this._uniformSetters["".concat(i,"[").concat(e,"]")]=y(t,r,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}},function(t,e,n){"use strict";var i=n(174);const r="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",o="#version 300 es\n".concat(r);function a(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,o]=n;return e.includes(i)&&r&&o?{qualifier:i,type:r,name:o.split(";")[0]}:null}function s(t={}){const{version:e=100,input:n,inputType:a,output:s}=t;if(!n)return 300===e?o:e>300?"#version ".concat(e,"\n").concat(r):"void main() {gl_FragColor = vec4(0);}";const u=function(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Object(i.a)(!1),null}}(n,a);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(a," ").concat(n,";\nout vec4 ").concat(s,";\nvoid main() {\n  ").concat(s," = ").concat(u,";\n}"):"varying ".concat(a," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(u,";\n}")}var u=n(0),c=n(27),l=n(278),h=n(13);class p{constructor(t,e={}){this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(t={}){const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(t={}){const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:i}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(t={}){this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof c.a?n:n.buffer:null}getData(t={}){const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(t={}){this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Object(h.a)(Object(u.j)(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const t in this.feedbackMap){const i=this.feedbackMap[t];t in e&&(n[i]=t)}Object.assign(n,t.feedbackBuffers);for(const t in n){const i=n[t];if("string"==typeof i){const r=e[i],{byteLength:o,usage:a,accessor:s}=r;n[t]=this._createNewBuffer(t,{byteLength:o,usage:a,accessor:s})}}return n}_setupBuffers(t={}){const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,{model:e}){const{program:n}=e;t.transformFeedback=new l.a(this.gl,{program:n,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:e}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:e})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const i in this.feedbackMap){const r=this.feedbackMap[i];e[i]=t.feedbackBuffers[r],n[r]=t.sourceBuffers[i],Object(h.a)(n[r]instanceof c.a)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new c.a(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}var f=n(196),d=n(116),A=n(68),g=n(227);function m(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const t=parseInt(n[1],10);Number.isFinite(t)&&(e=t)}return e}var y=n(176);const v={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};function _({vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}){let o=Object.keys(e).length,s=null;const u={};let c=t,l={};if(o>0||n){const t=c.split("\n"),p=t.slice();if(t.forEach((t,r,c)=>{if(o>0){const n=function(t,e){const n={},r=function(t){return a(t,["attribute","in"])}(t);if(!r)return null;const{type:o,name:s}=r;if(s&&e[s]){const e="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:r,sizeName:a,uniformDeclerations:u}=function(t){const e="".concat("transform_uSampler_").concat(t),n="".concat("transform_uSize_").concat(t),i="  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}(s),c=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Object(i.a)(!1),null}}(o),l="  ".concat(o," ").concat(s," = transform_getInput(").concat(r,", ").concat(a,").").concat(c,";\n");return n[r]=s,{updatedLine:e,inject:{"vs:#decl":u,"vs:#main-start":l},samplerTextureMap:n}}return null}(t,e);if(n){const{updatedLine:t,inject:e}=n;p[r]=t,l=Object(y.b)([l,e]),Object.assign(u,n.samplerTextureMap),o--}}n&&!s&&(s=function(t,e){const n=a(t,["varying","out"]);if(!n)return null;return n.name===e?n.type:null}(t,n))}),n){Object(h.a)(r);const t="".concat("transform_uSize_").concat(n),e={"vs:#decl":"uniform vec2 ".concat(t,";\n"),"vs:#main-start":"     vec2 ".concat("transform_position"," = transform_getPos(").concat(t,");\n     gl_Position = vec4(").concat("transform_position",", 0, 1.);\n")};l=Object(y.b)([l,e])}c=p.join("\n")}return{vs:c,targetTextureType:s,inject:l,samplerTextureMap:u}}const b={10241:9728,10240:9728,10242:33071,10243:33071};class x{constructor(t,e={}){this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(t={}){const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(t={}){const{sourceBuffers:e,sourceTextures:n,framebuffer:i,targetTexture:r}=this.bindings[this.currentIndex],o=Object.assign({},e,t.attributes),a=Object.assign({},t.uniforms),s=Object.assign({},t.parameters);let u=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const t in this.samplerTextureMap){const e=this.samplerTextureMap[t];a[t]=n[e]}this._setSourceTextureParameters();const t=function({sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}){const i={};let r,o;e&&(({width:r,height:o}=n),i["".concat("transform_uSize_").concat(e)]=[r,o]);for(const e in t)({width:r,height:o}=t[e]),i["".concat("transform_uSize_").concat(e)]=[r,o];return i}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(a,t)}return this.hasTargetTexture&&(u=!1,s.viewport=[0,0,i.width,i.height]),{attributes:o,framebuffer:i,uniforms:a,discard:u,parameters:s}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(t={}){this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData({packed:t=!1}={}){const{framebuffer:e}=this.bindings[this.currentIndex],n=Object(f.c)(e);if(!t)return n;const r=n.constructor,o=function(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Object(i.a)(!1),null}}(this.targetTextureType),a=new r(n.length*o/4);let s=0;for(let t=0;t<n.length;t+=4)for(let e=0;e<o;e++)a[s++]=n[t+e];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(t={}){const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof d.a)return n;const i=e[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(t={}){const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:i}=t,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:r}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if("number"!=typeof t||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((t,e,n)=>{n[e]=e}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new c.a(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:t,targetTexture:e}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:e})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:i,targetTexture:r}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,i),Object.assign(t.sourceBuffers,n),r){t.targetTexture=r;const{width:e,height:n}=r,{framebuffer:i}=t;i?(i.update({attachments:{36064:r},resizeAttachments:!1}),i.resize({width:e,height:n})):t.framebuffer=new A.a(this.gl,{id:"transform-framebuffer",width:e,height:n,attachments:{36064:r}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const t in e)e[t].setParameters(b)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);return e[this._swapTexture]=t.targetTexture,{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}_createNewTexture(t){const e=Object(g.a)(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(t={}){const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:r,targetTextureType:o,inject:a,samplerTextureMap:u}=_({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),c=Object(y.b)([t.inject||{},a]);return this.targetTextureType=o,this.samplerTextureMap=u,{vs:i,fs:t._fs||s({version:m(i),input:this.targetTextureVarying,inputType:o,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[v].concat(t.modules||[]):t.modules,uniforms:r,inject:c}}}var w=n(99),E=n(170);n.d(e,"a",(function(){return T}));class T{static isSupported(t){return Object(u.j)(t)}constructor(t,e={}){this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(t={}){const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();Object(h.a)(t,"Nothing to swap")}getBuffer(t=null){return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(t={}){const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const e=n.getData(t);if(e)return e}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(t={}){"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(t={}){const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new E.a(e,Object.assign({},t,{fs:t.fs||s({version:m(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=t.updateModelProps(e);return e}_buildResourceTransforms(t,e){(function(t){if(!Object(w.a)(t.feedbackBuffers)||!Object(w.a)(t.feedbackMap)||t.varyings&&t.varyings.length>0)return!0;return!1})(e)&&(this.bufferTransform=new p(t,e)),function(t){if(!Object(w.a)(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)return!0;return!1}(e)&&(this.textureTransform=new x(t,e)),Object(h.a)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=Object.assign(e,t.getDrawOptions(e));return e}}},function(t,e,n){"use strict";var i=n(73),r=n(143),o=n(32);const a={};async function s(t,e=null,n={}){return e&&(t=function(t,e,n){if(t.startsWith("http"))return t;const r=n.modules||{};if(r[t])return r[t];if(!i.b)return"modules/".concat(e,"/dist/libs/").concat(t);if(n.CDN)return Object(o.a)(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat("3.0.0-alpha.6","/dist/libs/").concat(t);if(i.d)return"../src/libs/".concat(t);return"modules/".concat(e,"/src/libs/").concat(t)}(t,e,n)),a[t]=a[t]||async function(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if(!i.b)return r.requireFromFile&&await r.requireFromFile(t);if(i.d)return importScripts(t);const e=await fetch(t);return function(t,e){if(!i.b)return r.requireFromString&&r.requireFromString(t,e);if(i.d)return eval.call(i.a,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch(e){n.text=t}return document.body.appendChild(n),null}(await e.text(),t)}(t),await a[t]}const u="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.js"),c="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_wasm_wrapper.js"),l="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.wasm");"https://raw.githubusercontent.com/google/draco/".concat("1.4.1","/javascript/draco_encoder.js");let h;async function p(t){const e=t.modules||{};return h=e.draco3d?h||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):h||async function(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await s(u,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await s(c,"draco",t),await s(l,"draco",t)])}return e=e||i.a.DracoDecoderModule,await function(t,e){const n={};e&&(n.wasmBinary=e);return new Promise(e=>{t({...n,onModuleLoaded:t=>e({draco:t})})})}(e,n)}(t),await h}var f=n(184);const d=0,A=1,g={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},m={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class y{constructor(t){this.draco=t,this.drawMode="TRIANGLE",this.metadataQuerier={}}destroy(){}parseSync(t,e={}){this.metadataQuerier=new this.draco.MetadataQuerier;const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength);const i=new this.draco.Decoder,r={};let o,a,s;try{const t=i.GetEncodedGeometryType(n);switch(t){case this.draco.TRIANGULAR_MESH:a=new this.draco.Mesh,o=i.DecodeBufferToMesh(n,a),s={type:d,faceCount:a.num_faces(),attributeCount:a.num_attributes(),vertexCount:a.num_points()};break;case this.draco.POINT_CLOUD:a=new this.draco.PointCloud,o=i.DecodeBufferToPointCloud(n,a),s={type:A,attributeCount:a.num_attributes(),vertexCount:a.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!o.ok()||!a.ptr){const t="DRACO decompression failed: ".concat(o.error_msg());throw a&&this.draco.destroy(a),new Error(t)}r.loaderData={header:s},this._extractDRACOGeometry(i,a,t,r,e);const u=this._getGeometryMetadata(i,a);r.header={vertexCount:s.vertexCount,boundingBox:Object(f.a)(r.attributes),metadata:u}}finally{this.draco.destroy(i),this.draco.destroy(n),this.draco.destroy(a),this.draco.destroy(this.metadataQuerier)}return r}_extractDRACOGeometry(t,e,n,i,r){const o=this._getAttributes(t,e,r);if(!o.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return n===this.draco.TRIANGULAR_MESH?(o.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(t,e):this._getMeshFaceIndices(t,e),i.mode="TRIANGLE_STRIP"===this.drawMode?5:4):i.mode=0,o.indices&&(i.indices={value:o.indices,size:1},delete o.indices),i.attributes=o,i}getPositionAttributeMetadata(t){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const e=new this.draco.AttributeQuantizationTransform;if(e.InitFromAttribute(t)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=e.range(),this.metadata.attributes.position.numQuantizationBits=e.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let t=0;t<3;++t)this.metadata.attributes.position.minValues[t]=e.min_value(t)}this.draco.destroy(e)}_getAttributes(t,e,n){const i={},r=e.num_points();for(let o=0;o<e.num_attributes();o++){const a=t.GetAttribute(e,o),s=this._getAttributeMetadata(t,e,o),u={uniqueId:a.unique_id(),attributeType:a.attribute_type(),dataType:m[a.data_type()],size:a.size(),numComponents:a.num_components(),byteOffset:a.byte_offset(),byteStride:a.byte_stride(),normalized:a.normalized(),metadata:s},c=this._deduceAttributeName(u,n),{typedArray:l}=this._getAttributeTypedArray(t,e,a,c);i[c]={value:l,size:l.length/r,metadata:s}}return i}_getMeshFaceIndices(t,e){const n=3*e.num_faces(),i=4*n,r=this.draco._malloc(i);t.GetTrianglesUInt32Array(e,i,r);const o=new Uint32Array(this.draco.HEAPF32.buffer,r,n).slice();return this.draco._free(r),o}_getMeshStripIndices(t,e){const n=new this.draco.DracoInt32Array;t.GetTriangleStripsFromMesh(e,n);const i=new Uint32Array(n.size());for(let t=0;t<n.size();++t)i[t]=n.GetValue(t);return this.draco.destroy(n),i}_getAttributeTypedArray(t,e,n,i){if(0===n.ptr){const t="DRACO decode bad attribute ".concat(i);throw new Error(t)}const r=m[n.data_type()],o=n.num_components(),a=e.num_points()*o,s=a*r.BYTES_PER_ELEMENT,u=this._getDracoDataType(r),c=this.draco._malloc(s);t.GetAttributeDataArrayForAllPoints(e,n,u,s,c);const l=new r(this.draco.HEAPF32.buffer,c,a).slice();return this.draco._free(c),{typedArray:l,components:o}}_getDracoDataType(t){switch(t){case Float32Array:return this.draco.DT_FLOAT32;case Int8Array:return this.draco.DT_INT8;case Int16Array:return this.draco.DT_INT16;case Int32Array:return this.draco.DT_INT32;case Uint8Array:return this.draco.DT_UINT8;case Uint16Array:return this.draco.DT_UINT16;case Uint32Array:return this.draco.DT_UINT32;default:return this.draco.DT_INVALID}}_deduceAttributeName(t,e){const{extraAttributes:n={}}=e;if(n&&"object"==typeof n)for(const[e,i]of Object.entries(n))if(i===t.uniqueId)return e;for(const e in g){const n=this.draco[e];if(t.attributeType===n)return g[e]}if(t.metadata){const n=e.attributeNameEntry||"name";if(t.metadata[n])return t.metadata[n].string}return"CUSTOM_ATTRIBUTE_".concat(t.uniqueId)}_getGeometryMetadata(t,e){const n=t.GetMetadata(e);return this._queryDracoMetadata(n)}_getAttributeMetadata(t,e,n){const i=t.GetAttributeMetadata(e,n);return this._queryDracoMetadata(i)}_queryDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t),i=new this.draco.DracoInt32Array;for(let r=0;r<n;r++){const n=this.metadataQuerier.GetEntryName(t,r);this.metadataQuerier.GetIntEntryArray(t,n,i);const o=i.size(),a=new Int32Array(o);for(let t=0;t<o;t++)a[t]=i.GetValue(t);e[n]={int:this.metadataQuerier.GetIntEntry(t,n),string:this.metadataQuerier.GetStringEntry(t,n),double:this.metadataQuerier.GetDoubleEntry(t,n),intArray:a}}return this.draco.destroy(i),e}decode(t,e){return this.parseSync(t,e)}}n.d(e,"a",(function(){return v}));const v={...{name:"Draco",id:"draco",module:"draco",version:"3.0.0-alpha.6",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{}}}},parse:async function(t,e,n,i){const{draco:r}=await p(e),o=new y(r);try{return o.parseSync(t,{extraAttributes:e.draco&&e.draco.extraAttributes||null,...e.parseOptions||{}})}finally{o.destroy()}}}},function(t,e,n){"use strict";var i=n(139),r="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return u}));const o={};function a(t=o){if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(t=>t/255)}}(e):{lighting_uEnabled:!1}}const s={name:"gouraud-lighting",dependencies:[i.a],vs:r,defines:{LIGHTING_VERTEX:1},getUniforms:a},u={name:"phong-lighting",dependencies:[i.a],fs:r,defines:{LIGHTING_FRAGMENT:1},getUniforms:a}}])}));
//# sourceMappingURL=index.js.map